import{A as Ve,E as Ge,H as He,ga as $e,p as Ne,q as Ue,r as Oe,va as qe,x as Re,xa as ze,ya as Qe}from"./chunk-DKZ3CIFV.js";import{Dd as F,Eh as At,F as fe,Mb as It,Na as _e,Ng as ke,Od as Z,Oh as Ft,P as ge,Pd as Mt,Qd as at,T as ye,Zd as Ae,ae as Fe,g as ut,gd as _t,mb as Me,ni as Pe,pi as kt,si as xe,sj as Le,t as bt,ui as Be,vi as we,vj as je,y as be}from"./chunk-OROXDDCC.js";import{F as lt,G as mt,I as ue,L as pt,M as ct,P as ht,V as St,Y as Et,g as Q,j as J,y as P}from"./chunk-6ASH6TVK.js";import{b as it}from"./chunk-JRGJBYKK.js";import{Fc as Tt,J as rt,Mc as X,Rc as Se,Sc as Ie,Ub as Y,Yb as K,Yc as Ee,cc as W,gc as ve,jc as ft,mc as gt,nc as yt,sc as De,t as de,tc as vt,uc as Ce,wc as Dt,x as le,xc as Te,yb as dt,zc as Ct}from"./chunk-K2POHFPS.js";import{A as j,ba as pe,ca as ce,jc as he,m as T,n as st,y as L,z as me}from"./chunk-7OOXQFUB.js";import{Aa as se,ab as re,g as ae,q as E,s as oe,t as ne}from"./chunk-2KNKNWMU.js";import{Ac as p,Bc as b,C as x,E as tt,Fa as V,Fc as Jt,Ga as Ht,Ic as g,Id as ee,J as et,Jb as wt,Kc as G,Ma as f,Nc as y,Pb as s,Qb as u,Rc as Yt,S as Vt,Sc as Kt,Ta as B,Tc as Wt,Ua as $t,Va as qt,Xc as Lt,Yc as h,Z as nt,Zc as H,_c as D,cb as zt,cc as A,db as Qt,dd as Xt,gd as Zt,i as Rt,ic as M,id as $,jd as te,je as w,nc as c,nd as d,od as m,pc as I,pd as q,pe as z,se as ie,w as R,ya as Gt,zc as l}from"./chunk-YRZDTKHG.js";import{a as Bt,d as Ot,j as C}from"./chunk-Z4H5XVQJ.js";C();var Je=(()=>{let o=class o{constructor(e,i,t){this.store=e,this.dialogService=i,this.translate=t}canDeactivate(e,i,t){let a=null;if(this.store.pipe(st(de),nt(1)).subscribe(r=>{a=r}),a&&a.isAuthenticated){let r=!1;if(e.confirmForm){let v=e.confirmForm();v&&(r=v.dirty)}else se(e.isDirty)&&(r=e.isDirty);if(r){let v=this.getMessage(e);return this.dialogService.confirm(this.translate.instant("confirm-on-exit.title"),v).pipe(x(_=>(_&&(e.confirmForm&&e.confirmForm()?e.confirmForm().markAsPristine():e.isDirty=!1),_)))}}return!0}getMessage(e){return e.confirmOnExitMessage?e.confirmOnExitMessage:this.translate.instant("confirm-on-exit.html-message")}};o.\u0275fac=function(i){return new(i||o)(f(T),f(bt),f(L))},o.\u0275prov=V({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();C();var Ye=n=>({dashboardTitle:n});function fi(n,o){n&1&&(l(0,"mat-error"),h(1),d(2,"translate"),p()),n&2&&(s(),D(" ",m(2,1,"dashboard.title-required")," "))}function gi(n,o){n&1&&(l(0,"mat-error"),h(1),d(2,"translate"),p()),n&2&&(s(),D(" ",m(2,1,"dashboard.title-max-length")," "))}function yi(n,o){if(n&1&&(b(0,"tb-entity-list",25),d(1,"translate")),n&2){let k=G();y("labelText",m(1,2,"dashboard.assigned-customers")),c("entityType",k.entityType.CUSTOMER)}}var Ze=(()=>{let o=class o extends Pe{constructor(e,i,t,a,r,v,_){super(e,v,a,r,_),this.store=e,this.translate=i,this.dashboardService=t,this.entityValue=a,this.entitiesTableConfigValue=r,this.fb=v,this.cd=_,this.entityType=E}ngOnInit(){this.dashboardScope=this.entitiesTableConfig.componentsData.dashboardScope,this.customerId=this.entitiesTableConfig.componentsData.customerId,super.ngOnInit()}isPublic(e){return Z(e)}isCurrentPublicCustomer(e){return at(e,this.customerId)}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){this.updateFields(e);let i=this.fb.group({title:[e?e.title:"",[ft.required,ft.maxLength(255)]],image:[e?e.image:null],mobileHide:[e?e.mobileHide:!1],mobileOrder:[e?e.mobileOrder:null,[ft.pattern(/^-?[0-9]+$/)]],configuration:this.fb.group({description:[e&&e.configuration?e.configuration.description:""]})});return this.isAdd&&i.addControl("assignedCustomerIds",this.fb.control([])),i}updateForm(e){this.updateFields(e),this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({image:e.image}),this.entityForm.patchValue({mobileHide:e.mobileHide}),this.entityForm.patchValue({mobileOrder:e.mobileOrder}),this.entityForm.patchValue({configuration:{description:e.configuration?e.configuration.description:""}})}prepareFormValue(e){let i=super.prepareFormValue(e);return i.configuration=Bt(Bt({},this.entity.configuration||{}),i.configuration||{}),i}onPublicLinkCopied(e){this.store.dispatch(new it({message:this.translate.instant("dashboard.public-link-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDashboardIdCopied(e){this.store.dispatch(new it({message:this.translate.instant("dashboard.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}updateFields(e){e&&!re(e,{})&&(this.assignedCustomersText=Mt(e),this.publicLink=this.dashboardService.getPublicDashboardLink(e))}};o.\u0275fac=function(i){return new(i||o)(u(T),u(L),u(F),u("entity"),u("entitiesTableConfig"),u(X),u(ee))},o.\u0275cmp=B({type:o,selectors:[["tb-dashboard-form"]],features:[A],decls:82,vars:103,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"flex","flex-col"],["shareHashTags","thingsboard, iot",2,"padding-bottom","1.25em",3,"shareTitle","shareText","shareLink"],[1,"mat-block","flex-1"],["mat-icon-button","","ngxClipboard","","matTooltipPosition","above",2,"margin-top","8px",3,"cbOnSuccess","cbContent","matTooltip"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","configuration",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["formControlName","assignedCustomerIds",3,"labelText","entityType",4,"ngIf"],[1,"tb-form-panel","stroked","no-gap"],["translate","",1,"tb-form-panel-title"],["formControlName","mobileHide",1,"mat-slide","margin","fixed-title-width"],["matInput","","formControlName","mobileOrder","type","number","step","1"],["formControlName","image",1,"flex-1",3,"label"],["formControlName","assignedCustomerIds",3,"labelText","entityType"]],template:function(i,t){i&1&&(l(0,"div",0)(1,"button",1),d(2,"async"),g("click",function(r){return t.onEntityAction(r,"open")}),h(3),d(4,"translate"),p(),l(5,"button",1),d(6,"async"),g("click",function(r){return t.onEntityAction(r,"export")}),h(7),d(8,"translate"),p(),l(9,"button",1),d(10,"async"),g("click",function(r){return t.onEntityAction(r,"makePublic")}),h(11),d(12,"translate"),p(),l(13,"button",1),d(14,"async"),g("click",function(r){return t.onEntityAction(r,"makePrivate")}),h(15),d(16,"translate"),p(),l(17,"button",1),d(18,"async"),g("click",function(r){return t.onEntityAction(r,"manageAssignedCustomers")}),h(19),d(20,"translate"),p(),l(21,"button",1),d(22,"async"),g("click",function(r){return t.onEntityAction(r,"unassignFromCustomer")}),h(23),d(24,"translate"),p(),l(25,"button",1),d(26,"async"),g("click",function(r){return t.onEntityAction(r,"unassignFromEdge")}),h(27),d(28,"translate"),p(),l(29,"button",1),d(30,"async"),g("click",function(r){return t.onEntityAction(r,"delete")}),h(31),d(32,"translate"),p(),l(33,"div",2)(34,"button",3),g("cbOnSuccess",function(r){return t.onDashboardIdCopied(r)}),b(35,"mat-icon",4),l(36,"span",5),h(37,"dashboard.copyId"),p()()()(),l(38,"div",6)(39,"mat-form-field",7)(40,"mat-label",5),h(41,"dashboard.assignedToCustomers"),p(),b(42,"input",8),p(),l(43,"div",9),b(44,"tb-social-share-panel",10),d(45,"translate"),d(46,"translate"),l(47,"div",2)(48,"mat-form-field",11)(49,"mat-label",5),h(50,"dashboard.public-link"),p(),b(51,"input",8),p(),l(52,"button",12),d(53,"translate"),g("cbOnSuccess",function(r){return t.onPublicLinkCopied(r)}),b(54,"mat-icon",4),p()()(),l(55,"form",13)(56,"fieldset",14),d(57,"async"),l(58,"mat-form-field",7)(59,"mat-label",5),h(60,"dashboard.title"),p(),b(61,"input",15),M(62,fi,3,3,"mat-error",16)(63,gi,3,3,"mat-error",16),p(),l(64,"div",17)(65,"mat-form-field",7)(66,"mat-label",5),h(67,"dashboard.description"),p(),b(68,"textarea",18),p()(),M(69,yi,2,4,"tb-entity-list",19),l(70,"div",20)(71,"div",21),h(72,"dashboard.mobile-app-settings"),p(),l(73,"mat-slide-toggle",22),h(74),d(75,"translate"),p(),l(76,"mat-form-field",7)(77,"mat-label",5),h(78,"dashboard.mobile-order"),p(),b(79,"input",23),p(),b(80,"tb-gallery-image-input",24),d(81,"translate"),p()()()()),i&2&&(s(),I("!hidden",t.isEdit),c("disabled",m(2,53,t.isLoading$)),s(2),D(" ",m(4,55,"dashboard.open-dashboard")," "),s(2),I("!hidden",t.isEdit||t.dashboardScope!=="tenant"),c("disabled",m(6,57,t.isLoading$)),s(2),D(" ",m(8,59,"dashboard.export")," "),s(2),I("!hidden",t.isEdit||t.dashboardScope!=="tenant"||t.isPublic(t.entity)),c("disabled",m(10,61,t.isLoading$)),s(2),D(" ",m(12,63,"dashboard.make-public")," "),s(2),I("!hidden",t.isEdit||!(t.dashboardScope==="tenant"&&t.isPublic(t.entity)||t.dashboardScope==="customer"&&t.isCurrentPublicCustomer(t.entity))),c("disabled",m(14,65,t.isLoading$)),s(2),D(" ",m(16,67,"dashboard.make-private")," "),s(2),I("!hidden",t.isEdit||t.dashboardScope!=="tenant"),c("disabled",m(18,69,t.isLoading$)),s(2),D(" ",m(20,71,"dashboard.manage-assigned-customers")," "),s(2),I("!hidden",t.isEdit||t.dashboardScope!=="customer"||t.isCurrentPublicCustomer(t.entity)),c("disabled",m(22,73,t.isLoading$)),s(2),D(" ",m(24,75,"dashboard.unassign-from-customer")," "),s(2),I("!hidden",t.isEdit||t.dashboardScope!=="edge"),c("disabled",m(26,77,t.isLoading$)),s(2),D(" ",m(28,79,"edge.unassign-from-edge")," "),s(2),I("!hidden",t.hideDelete()||t.isEdit),c("disabled",m(30,81,t.isLoading$)),s(2),D(" ",m(32,83,"dashboard.delete")," "),s(3),I("!hidden",t.isEdit),c("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),s(5),I("!hidden",t.isEdit||!(t.assignedCustomersText!=null&&t.assignedCustomersText.length)||t.dashboardScope!=="tenant"),s(3),c("ngModel",t.assignedCustomersText),s(),I("!hidden",t.isEdit||!(t.dashboardScope==="tenant"&&t.isPublic(t.entity)||t.dashboardScope==="customer"&&t.isCurrentPublicCustomer(t.entity))),s(),y("shareTitle",q(45,85,"dashboard.socialshare-title",$(99,Ye,t.entity==null?null:t.entity.title))),y("shareText",q(46,88,"dashboard.socialshare-text",$(101,Ye,t.entity==null?null:t.entity.title))),y("shareLink",t.publicLink),s(7),c("ngModel",t.publicLink),s(),y("cbContent",t.publicLink),y("matTooltip",m(53,91,"dashboard.copy-public-link")),s(3),c("formGroup",t.entityForm),s(),c("disabled",m(57,93,t.isLoading$)||!t.isEdit),s(6),c("ngIf",t.entityForm.get("title").hasError("required")),s(),c("ngIf",t.entityForm.get("title").hasError("maxlength")),s(6),c("ngIf",t.isAdd),s(5),D(" ",m(75,95,"dashboard.mobile-hide")," "),s(6),y("label",m(81,97,"dashboard.image")))},dependencies:[w,At,Ft,Y,K,W,_e,Ee,Se,Ie,ut,Me,_t,vt,ve,Ce,gt,yt,Tt,De,Dt,Ct,Te,me,je,z,j],styles:['@charset "UTF-8";']});let n=o;return n})();C();function Ci(n,o){n&1&&b(0,"mat-progress-bar",13)}function Ti(n,o){n&1&&b(0,"div",14)}var ei=(()=>{let o=class o extends ht{constructor(e,i,t,a,r,v,_){switch(super(e,i,v),this.store=e,this.router=i,this.data=t,this.dashboardService=a,this.errorStateMatcher=r,this.dialogRef=v,this.fb=_,this.submitted=!1,this.entityType=E,this.assignedCustomersIds=t.assignedCustomersIds||[],t.actionType){case"assign":this.titleText="dashboard.assign-to-customers",this.labelText="dashboard.assign-to-customers-text",this.actionName="action.assign";break;case"manage":this.titleText="dashboard.manage-assigned-customers",this.labelText="dashboard.assigned-customers",this.actionName="action.update";break;case"unassign":this.titleText="dashboard.unassign-from-customers",this.labelText="dashboard.unassign-from-customers-text",this.actionName="action.unassign";break}}ngOnInit(){this.dashboardCustomersFormGroup=this.fb.group({assignedCustomerIds:[[...this.assignedCustomersIds]]})}isErrorState(e,i){let t=this.errorStateMatcher.isErrorState(e,i),a=!!(e&&e.invalid&&this.submitted);return t||a}cancel(){this.dialogRef.close(!1)}submit(){this.submitted=!0;let e=this.dashboardCustomersFormGroup.get("assignedCustomerIds").value,i=[];this.data.dashboardIds.forEach(t=>{i.push(this.getManageDashboardCustomersTask(t,e))}),et(i).subscribe(()=>{this.dialogRef.close(!0)})}getManageDashboardCustomersTask(e,i){switch(this.data.actionType){case"assign":return this.dashboardService.addDashboardCustomers(e,i);case"manage":return this.dashboardService.updateDashboardCustomers(e,i);case"unassign":return this.dashboardService.removeDashboardCustomers(e,i)}}};o.\u0275fac=function(i){return new(i||o)(u(T),u(Q),u(mt),u(F),u(dt,4),u(lt),u(X))},o.\u0275cmp=B({type:o,selectors:[["tb-manage-dashboard-customers-dialog"]],features:[Xt([{provide:dt,useExisting:o}]),A],decls:30,vars:30,consts:[[2,"width","600px",3,"ngSubmit","formGroup"],["color","primary",1,"flex","flex-row"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["formControlName","assignedCustomerIds",3,"required","entityType"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,t){i&1&&(l(0,"form",0),g("ngSubmit",function(){return t.submit()}),l(1,"mat-toolbar",1)(2,"h2"),h(3),d(4,"translate"),p(),b(5,"span",2),l(6,"button",3),g("click",function(){return t.cancel()}),l(7,"mat-icon",4),h(8,"close"),p()()(),M(9,Ci,1,0,"mat-progress-bar",5),d(10,"async"),M(11,Ti,1,0,"div",6),d(12,"async"),l(13,"div",7)(14,"fieldset",8),d(15,"async"),l(16,"span"),h(17),d(18,"translate"),p(),b(19,"tb-entity-list",9),p()(),l(20,"div",10),b(21,"span",2),l(22,"button",11),d(23,"async"),g("click",function(){return t.cancel()}),h(24),d(25,"translate"),p(),l(26,"button",12),d(27,"async"),h(28),d(29,"translate"),p()()()),i&2&&(c("formGroup",t.dashboardCustomersFormGroup),s(3),H(m(4,12,t.titleText)),s(6),c("ngIf",m(10,14,t.isLoading$)),s(2),c("ngIf",!m(12,16,t.isLoading$)),s(3),c("disabled",m(15,18,t.isLoading$)),s(3),H(m(18,20,t.labelText)),s(2),c("required",t.data.actionType!=="manage")("entityType",t.entityType.CUSTOMER),s(3),c("disabled",m(23,22,t.isLoading$)),s(2),D(" ",m(25,24,"action.cancel")," "),s(2),c("disabled",m(27,26,t.isLoading$)||t.dashboardCustomersFormGroup.invalid||!t.dashboardCustomersFormGroup.dirty),s(2),D(" ",m(29,28,t.actionName)," "))},dependencies:[w,At,Y,K,W,St,Et,ct,pt,vt,gt,yt,Tt,Dt,Ct,z,j],encapsulation:2});let n=o;return n})();C();var Si=(n,o)=>({dashboardTitle:n,publicLink:o}),ii=n=>({dashboardTitle:n});function Ii(n,o){n&1&&b(0,"mat-progress-bar",17)}function Ei(n,o){n&1&&b(0,"div",18)}var ai=(()=>{let o=class o extends ht{constructor(e,i,t,a,r,v,_){super(e,i,v),this.store=e,this.router=i,this.data=t,this.translate=a,this.dashboardService=r,this.dialogRef=v,this.fb=_,this.dashboard=t.dashboard,this.publicLink=r.getPublicDashboardLink(this.dashboard)}ngOnInit(){}close(){this.dialogRef.close()}onPublicLinkCopied(e){this.store.dispatch(new it({message:this.translate.instant("dashboard.public-link-copied-message"),type:"success",target:"makeDashboardPublicDialogContent",duration:750,verticalPosition:"bottom",horizontalPosition:"left"}))}};o.\u0275fac=function(i){return new(i||o)(u(T),u(Q),u(mt),u(L),u(F),u(lt),u(X))},o.\u0275cmp=B({type:o,selectors:[["tb-make-dashboard-public-dialog"]],features:[A],decls:34,vars:42,consts:[[2,"min-width","400px","position","relative"],["color","primary",1,"flex","flex-row"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","makeDashboardPublicDialogContent"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],[1,"tb-notice",3,"innerHTML"],["shareHashTags","thingsboard, iot",2,"padding-top","15px",3,"shareTitle","shareText","shareLink"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,t){i&1&&(l(0,"div",0)(1,"mat-toolbar",1)(2,"h2"),h(3),d(4,"translate"),p(),b(5,"span",2),l(6,"button",3),g("click",function(){return t.close()}),l(7,"mat-icon",4),h(8,"close"),p()()(),M(9,Ii,1,0,"mat-progress-bar",5),d(10,"async"),M(11,Ei,1,0,"div",6),d(12,"async"),l(13,"div",7),b(14,"span",8),d(15,"async"),l(16,"div",9)(17,"pre",10)(18,"code"),h(19),p()(),l(20,"button",11),d(21,"translate"),g("cbOnSuccess",function(r){return t.onPublicLinkCopied(r)}),b(22,"mat-icon",12),p()(),b(23,"div",13),d(24,"translate"),b(25,"tb-social-share-panel",14),d(26,"translate"),d(27,"translate"),p(),l(28,"div",15),b(29,"span",2),l(30,"button",16),d(31,"async"),g("click",function(){return t.close()}),h(32),d(33,"translate"),p()()()),i&2&&(s(3),H(m(4,13,"dashboard.public-dashboard-title")),s(6),c("ngIf",m(10,15,t.isLoading$)),s(2),c("ngIf",!m(12,17,t.isLoading$)),s(3),y("innerHTML",m(15,19,t.translate.get("dashboard.public-dashboard-text",te(35,Si,t.dashboard.title,t.publicLink))),wt),s(5),H(t.publicLink),s(),y("cbContent",t.publicLink),y("matTooltip",m(21,21,"dashboard.copy-public-link")),s(3),y("innerHTML",m(24,23,"dashboard.public-dashboard-notice"),wt),s(2),y("shareTitle",q(26,25,"dashboard.socialshare-title",$(38,ii,t.dashboard.title))),y("shareText",q(27,28,"dashboard.socialshare-text",$(40,ii,t.dashboard.title))),y("shareLink",t.publicLink),s(5),c("disabled",m(31,31,t.isLoading$)),s(2),D(" ",m(33,33,"action.ok")," "))},dependencies:[w,ge,Ft,Y,K,W,St,Et,ct,pt,ut,_t,z,j],encapsulation:2});let n=o;return n})();C();C();var oi=(()=>{let o=class o extends he{set isEdit(e){this.isEditValue=e}get isEdit(){return this.isEditValue}set entity(e){this.setEntity(e)}get entity(){return this.entityValue}set entitiesTableConfig(e){this.setEntitiesTableConfig(e)}get entitiesTableConfig(){return this.entitiesTableConfigValue}constructor(e){super(e),this.store=e,this.attributeScopes=ce,this.latestTelemetryTypes=pe,this.authorities=P,this.entityTypes=E,this.auditLogModes=Ne,this.eventTypes=Ue,this.debugEventTypes=Oe,this.nullUid=ae,this.entityTabsSubject=new Rt(null),this.entityTabsChanged=this.entityTabsSubject.asObservable(),this.authUser=rt(e)}ngOnInit(){}ngAfterViewInit(){this.entityTabsSubject.next(this.entityTabs.toArray()),this.entityTabs.changes.subscribe(()=>{this.entityTabsSubject.next(this.entityTabs.toArray())})}setEntity(e){this.entityValue=e}setEntitiesTableConfig(e){this.entitiesTableConfigValue=e}};o.\u0275fac=function(i){return new(i||o)(u(T))},o.\u0275dir=qt({type:o,viewQuery:function(i,t){if(i&1&&Yt(It,5),i&2){let a;Kt(a=Wt())&&(t.entityTabs=a)}},inputs:{isEdit:"isEdit",entity:"entity",entitiesTableConfig:"entitiesTableConfig",detailsForm:"detailsForm"},features:[A]});let n=o;return n})();function _i(n,o){if(n&1&&(l(0,"mat-tab",3,0),d(2,"translate"),b(3,"tb-audit-log-table",4),p()),n&2){let k=Lt(1),e=G();y("label",m(2,4,"audit-log.audit-logs")),s(3),c("active",k.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function Mi(n,o){if(n&1){let k=Jt();l(0,"mat-tab",3,1),d(2,"translate"),l(3,"tb-version-control",5),g("versionRestored",function(){zt(k);let i=G();return Qt(i.entitiesTableConfig.updateData())}),p()()}if(n&2){let k=Lt(1),e=G();y("label",m(2,5,"version-control.version-control")),s(3),c("active",k.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var ni=(()=>{let o=class o extends oi{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};o.\u0275fac=function(i){return new(i||o)(u(T))},o.\u0275cmp=B({type:o,selectors:[["tb-dashboard-tabs"]],features:[A],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,t){i&1&&M(0,_i,4,6,"mat-tab",2)(1,Mi,4,7,"mat-tab",2),i&2&&(c("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),s(),c("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[w,It,He,Ge,j],encapsulation:2});let n=o;return n})();C();C();var Nt=(()=>{let o=class o{constructor(e,i,t,a,r,v,_,ri,di,li,mi){this.store=e,this.dashboardService=i,this.customerService=t,this.edgeService=a,this.dialogService=r,this.homeDialogs=v,this.importExport=_,this.translate=ri,this.datePipe=di,this.router=li,this.dialog=mi,this.config=new Be,this.config.entityType=E.DASHBOARD,this.config.entityComponent=Ze,this.config.entityTabsComponent=ni,this.config.entityTranslations=oe.get(E.DASHBOARD),this.config.entityResources=ne.get(E.DASHBOARD),this.config.rowPointer=!0,this.config.deleteEntityTitle=S=>this.translate.instant("dashboard.delete-dashboard-title",{dashboardTitle:S.title}),this.config.deleteEntityContent=()=>this.translate.instant("dashboard.delete-dashboard-text"),this.config.deleteEntitiesTitle=S=>this.translate.instant("dashboard.delete-dashboards-title",{count:S}),this.config.deleteEntitiesContent=()=>this.translate.instant("dashboard.delete-dashboards-text"),this.config.loadEntity=S=>this.dashboardService.getDashboard(S.id),this.config.saveEntity=S=>this.saveAndAssignDashboard(S),this.config.onEntityAction=S=>this.onDashboardAction(S),this.config.detailsReadonly=()=>this.config.componentsData.dashboardScope==="customer_user"||this.config.componentsData.dashboardScope==="edge_customer_user",this.config.handleRowClick=(S,Ut)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(S,Ut):this.openDashboard(S,Ut),!0),this.config.entityAdded=S=>{this.openDashboard(null,S)}}resolve(e){let i=e.params;return this.config.componentsData={dashboardScope:e.data.dashboardsType,customerId:i.customerId,edgeId:i.edgeId},this.store.pipe(st(le),nt(1)).pipe(Gt(t=>{t.authority===P.CUSTOMER_USER&&(e.data.dashboardsType==="edge"?this.config.componentsData.dashboardScope="edge_customer_user":this.config.componentsData.dashboardScope="customer_user",this.config.componentsData.customerId=t.customerId)}),tt(()=>this.config.componentsData.customerId?this.customerService.getCustomer(this.config.componentsData.customerId):R(null)),x(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-dashboards"):this.config.tableTitle=t.title+": "+this.translate.instant("dashboard.dashboards"):this.config.componentsData.dashboardScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(a=>this.config.tableTitle=a.name+": "+this.translate.instant("dashboard.dashboards")):this.config.tableTitle=this.translate.instant("dashboard.dashboards"),this.config.columns=this.configureColumns(this.config.componentsData.dashboardScope),this.configureEntityFunctions(this.config.componentsData.dashboardScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.dashboardScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.dashboardScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.dashboardScope),this.config.addEnabled=!(this.config.componentsData.dashboardScope==="customer_user"||this.config.componentsData.dashboardScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.dashboardScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.dashboardScope==="tenant",this.config)))}configureColumns(e){let i=[new xe("createdTime","common.created-time",this.datePipe,"150px"),new kt("title","dashboard.title","50%")];return e==="tenant"&&i.push(new kt("customersTitle","dashboard.assignedToCustomers","50%",t=>Mt(t),()=>({}),!1),new kt("dashboardIsPublic","dashboard.public","60px",t=>we(Z(t)),()=>({}),!1)),i}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=i=>this.dashboardService.getTenantDashboards(i),this.config.deleteEntity=i=>this.dashboardService.deleteDashboard(i.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=i=>this.dashboardService.getEdgeDashboards(this.config.componentsData.edgeId,i,this.config.componentsData.dashboardsType):(this.config.entitiesFetchFunction=i=>this.dashboardService.getCustomerDashboards(this.config.componentsData.customerId,i),this.config.deleteEntity=i=>this.dashboardService.unassignDashboardFromCustomer(this.config.componentsData.customerId,i.id))}configureCellActions(e){let i=[];return e==="tenant"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("dashboard.make-public"),icon:"share",isEnabled:t=>!Z(t),onAction:(t,a)=>this.makePublic(t,a)},{name:this.translate.instant("dashboard.make-private"),icon:"reply",isEnabled:t=>Z(t),onAction:(t,a)=>this.makePrivate(t,a)},{name:this.translate.instant("dashboard.manage-assigned-customers"),icon:"assignment_ind",isEnabled:()=>!0,onAction:(t,a)=>this.manageAssignedCustomers(t,a)}),e==="customer"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("dashboard.make-private"),icon:"reply",isEnabled:t=>at(t,this.config.componentsData.customerId),onAction:(t,a)=>this.makePrivate(t,a)},{name:this.translate.instant("dashboard.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>!at(t,this.config.componentsData.customerId),onAction:(t,a)=>this.unassignFromCustomer(t,a,this.config.componentsData.customerId)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(t,a)=>this.unassignFromEdge(t,a)}),i.push({name:this.translate.instant("dashboard.dashboard-details"),icon:"edit",isEnabled:()=>!0,onAction:(t,a)=>this.config.toggleEntityDetails(t,a)}),i}configureGroupActions(e){let i=[];return e==="tenant"&&(i.push({name:this.translate.instant("dashboard.assign-dashboards"),icon:"assignment_ind",isEnabled:!0,onAction:(t,a)=>this.assignDashboardsToCustomers(t,a.map(r=>r.id.id))}),i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromCustomers(t,a.map(r=>r.id.id))})),e==="customer"&&i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromCustomer(t,a.map(r=>r.id.id),this.config.componentsData.customerId)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromEdge(t,a)}),i}configureAddActions(e){let i=[];return e==="tenant"&&i.push({name:this.translate.instant("dashboard.create-new-dashboard"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("dashboard.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importDashboard(t)}),e==="customer"&&i.push({name:this.translate.instant("dashboard.assign-new-dashboard"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDashboardsToCustomer(t)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.assign-new-dashboard"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDashboardsToEdge(t)}),i}openDashboard(e,i){e&&e.stopPropagation(),this.config.componentsData.dashboardScope==="customer"?this.router.navigateByUrl(`customers/${this.config.componentsData.customerId}/dashboards/${i.id.id}`):this.config.componentsData.dashboardScope==="edge"?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/dashboards/${i.id.id}`):this.router.navigateByUrl(`dashboards/${i.id.id}`)}importDashboard(e){this.importExport.importDashboard(this.editMissingAliases.bind(this)).subscribe(i=>{i&&this.config.updateData()})}editMissingAliases(e,i,t,a){return this.dialog.open($e,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityAliases:a,widgets:e,customTitle:t,isSingleWidget:i,disableAdd:!0}}).afterClosed().pipe(x(r=>{if(r)return r;throw new Error("Unable to resolve missing entity aliases!")}))}exportDashboard(e,i){e&&e.stopPropagation(),this.importExport.exportDashboard(i.id.id)}addDashboardsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(ze,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.config.componentsData.customerId,entityType:E.DASHBOARD}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}makePublic(e,i){e&&e.stopPropagation(),this.dashboardService.makeDashboardPublic(i.id.id).subscribe(t=>{this.dialog.open(ai,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{dashboard:t}}).afterClosed().subscribe(()=>{this.config.updateData()})})}makePrivate(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.make-private-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.make-private-dashboard-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.dashboardService.makeDashboardPrivate(i.id.id).subscribe(()=>{this.config.updateData()})})}manageAssignedCustomers(e,i){let t=i.assignedCustomers?i.assignedCustomers.map(a=>a.customerId.id):[];this.showManageAssignedCustomersDialog(e,[i.id.id],"manage",t)}assignDashboardsToCustomers(e,i){this.showManageAssignedCustomersDialog(e,i,"assign")}unassignDashboardsFromCustomers(e,i){this.showManageAssignedCustomersDialog(e,i,"unassign")}showManageAssignedCustomersDialog(e,i,t,a){e&&e.stopPropagation(),this.dialog.open(ei,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{dashboardIds:i,actionType:t,assignedCustomersIds:a}}).afterClosed().subscribe(r=>{r&&this.config.updateData()})}unassignFromCustomer(e,i,t){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.unassign-dashboard-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(a=>{a&&this.dashboardService.unassignDashboardFromCustomer(t,i.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.dashboardScope!=="tenant")})})}unassignDashboardsFromCustomer(e,i,t){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboards-title",{count:i.length}),this.translate.instant("dashboard.unassign-dashboards-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(a=>{if(a){let r=[];i.forEach(v=>{r.push(this.dashboardService.unassignDashboardFromCustomer(t,v))}),et(r).subscribe(()=>{this.config.updateData()})}})}onDashboardAction(e){switch(e.action){case"open":return this.openDashboard(e.event,e.entity),!0;case"export":return this.exportDashboard(e.event,e.entity),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"makePrivate":return this.makePrivate(e.event,e.entity),!0;case"manageAssignedCustomers":return this.manageAssignedCustomers(e.event,e.entity),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity,this.config.componentsData.customerId),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addDashboardsToEdge(e){e&&e.stopPropagation(),this.dialog.open(Qe,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:E.DASHBOARD}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}unassignFromEdge(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.unassign-dashboard-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.dashboardService.unassignDashboardFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.dashboardScope!=="tenant")})})}unassignDashboardsFromEdge(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboards-from-edge-title",{count:i.length}),this.translate.instant("dashboard.unassign-dashboards-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let a=[];i.forEach(r=>{a.push(this.dashboardService.unassignDashboardFromEdge(this.config.componentsData.edgeId,r.id.id))}),et(a).subscribe(()=>{this.config.updateData()})}})}saveAndAssignDashboard(e){let a=e,{assignedCustomerIds:i}=a,t=Ot(a,["assignedCustomerIds"]);return this.dashboardService.saveDashboard(t).pipe(tt(r=>i?.length?this.dashboardService.addDashboardCustomers(r.id.id,i):R(r)))}};o.\u0275fac=function(i){return new(i||o)(f(T),f(F),f(Fe),f(ke),f(bt),f(Ve),f(Le),f(L),f(ie),f(Q),f(ue))},o.\u0275prov=V({token:o,factory:o.\u0275fac});let n=o;return n})();var si=(()=>{let o=class o{constructor(e,i,t,a){this.store=e,this.dashboardService=i,this.userSettingService=t,this.dashboardUtils=a}resolve(e){let i=e.params.dashboardId;return this.dashboardService.getDashboard(i).pipe(tt(t=>(rt(this.store).isPublic?R(null):this.userSettingService.reportUserDashboardAction(i,be.VISIT,{ignoreLoading:!0,ignoreErrors:!0})).pipe(Vt(()=>R(t)),x(()=>t))),x(t=>this.dashboardUtils.validateAndUpdateDashboard(t)))}};o.\u0275fac=function(i){return new(i||o)(f(T),f(F),f(fe),f(Ae))},o.\u0275prov=V({token:o,factory:o.\u0275fac});let n=o;return n})(),Ai=(n,o,k)=>k.dashboard.title,Fi=[{path:"dashboards",data:{breadcrumb:{menuId:ye.dashboards}},children:[{path:"",component:Re,data:{auth:[P.TENANT_ADMIN,P.CUSTOMER_USER],title:"dashboard.dashboards",dashboardsType:"tenant"},resolve:{entitiesTableConfig:Nt}},{path:":dashboardId",component:qe,canDeactivate:[Je],data:{breadcrumb:{labelFunction:Ai,icon:"dashboard"},auth:[P.TENANT_ADMIN,P.CUSTOMER_USER],title:"dashboard.dashboard",widgetEditMode:!1},resolve:{dashboard:si}}]}],ki=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=$t({type:o}),o.\u0275inj=Ht({providers:[Nt,si],imports:[J.forChild(Fi),J]});let n=o;return n})();(function(){Zt(ki,{imports:[J],exports:[J]})})();export{Je as a,oi as b,Ze as c,ei as d,ai as e,ni as f,Nt as g,si as h,Ai as i,ki as j};
