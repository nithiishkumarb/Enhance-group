import{E as fn,ca as gn,i as cn,q as mn,r as hn,w as jt}from"./chunk-DKZ3CIFV.js";import{Bj as an,Bm as Gt,Da as Vi,Ec as At,Ga as Pi,Hj as Ot,Ja as Bi,Ka as Ai,L as ve,Mb as Ki,Na as Fe,Nb as Wi,Oc as Yi,Qa as Oi,Va as Gi,Wa as ji,Xa as Ui,Ya as qi,Yc as Ji,cm as pn,ee as L,fa as M,fb as Hi,fc as Xi,fe as nt,fk as ln,g as Mt,gb as zi,ge as ie,ha as Ri,hb as Qi,hk as sn,ka as ki,kc as Pt,ke as tn,la as Li,ld as Zi,le as nn,m as wt,ma as Fi,mb as $i,me as Xt,n as Ii,oc as Bt,od as en,p as Ti,pe as Qe,rj as rn,se as on,sk as dn,t as Ei,tc as Wt,te as ot,ve as Ve,xk as un}from"./chunk-OROXDDCC.js";import{F as It,G as Tt,I as yi,L as Et,M as Rt,P as Dt,Q as Ni,U as Si,V as Vt,Y as it,e as gi,g as De}from"./chunk-6ASH6TVK.js";import{Fa as En,Fc as ke,Ga as Rn,I as St,Lc as He,Mc as le,Nb as vi,Rc as ze,Sc as Ft,Ub as me,Uc as Mi,Vc as wi,Wb as _i,Xb as xi,Yb as Me,Yc as Le,cc as X,fc as Ie,gc as we,jc as Y,mc as K,nc as te,pc as Kt,sa as Tn,sc as Di,tc as Te,vc as kt,wc as re,xc as Lt,yb as Se,zc as ae}from"./chunk-K2POHFPS.js";import{A as z,a as ce,ab as tt,bb as Ci,jc as qe,m as Ce,y as Ue,z as oe}from"./chunk-7OOXQFUB.js";import{Ba as $t,_a as k,q as bi}from"./chunk-2KNKNWMU.js";import{h as Ne}from"./chunk-LKJAU4TK.js";import{Ac as u,Bc as I,C as Re,E as st,Ea as _e,Ec as pi,Ee as fi,Fc as E,Ic as x,Id as je,Jb as Ze,Kb as si,Kc as v,L as dt,Nc as R,O as ni,Oc as ci,Pb as l,Qb as C,Rc as B,Rd as Qt,S as ut,Sc as A,Ta as P,Tc as O,Vb as gt,Wb as Oe,X as oi,Xc as G,Yc as f,Zc as Z,_c as T,ad as Ct,bb as ft,bd as vt,cb as y,cc as ge,cd as yt,da as pt,db as _,dd as ee,ec as di,ed as _t,g as lt,i as ei,ic as S,id as Ge,ie as xt,j as ti,je as W,kd as mi,lb as pe,nc as d,nd as m,oc as zt,od as h,pc as be,pd as xe,pe as ne,q as qt,qa as ri,qd as et,r as Ht,ra as ct,sa as ai,sc as ui,sd as hi,ua as Be,uc as bt,ue as Nt,va as mt,w as H,wa as Ae,x as ii,xa as ht,ya as li,zc as s}from"./chunk-YRZDTKHG.js";import{a as Je,b as Zt,j as Q}from"./chunk-Z4H5XVQJ.js";Q();var Dn=["definedConfigContent"],Mn=["jsonObjectEditComponent"];function wn(o,r){if(o&1&&(s(0,"div",5),f(1),u()),o&2){let a=v();l(),Z(a.definedDirectiveError)}}function kn(o,r){if(o&1&&(I(0,"tb-json-object-edit",6,1),m(2,"translate")),o&2){let a=v();d("label",h(2,3,"rulenode.configuration"))("jsonRequired",a.required)("fillHeight",!0)}}var Cn=(()=>{let r=class r{get required(){return this.requiredValue}set required(e){this.requiredValue=Ne(e)}set nodeDefinition(e){this.nodeDefinitionValue!==e&&(this.nodeDefinitionValue=e,this.nodeDefinitionValue&&this.validateDefinedDirective(),setTimeout(()=>this.initRuleNode.emit()))}get nodeDefinition(){return this.nodeDefinitionValue}constructor(e,i){this.ruleChainService=e,this.fb=i,this.initRuleNode=new pe,this.changeScript=new pe,this.propagateChange=t=>{},this.ruleNodeConfigFormGroup=this.fb.group({configuration:[null,Y.required]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnDestroy(){this.definedConfigComponentRef&&this.definedConfigComponentRef.destroy(),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null)}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeConfigFormGroup.disable({emitEvent:!1}):this.ruleNodeConfigFormGroup.enable({emitEvent:!1}),this.definedConfigComponent&&(this.definedConfigComponent.disabled=this.disabled)}writeValue(e){this.configuration=k(e),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigComponent?(this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(i=>{this.updateModel(i)})):(this.ruleNodeConfigFormGroup.get("configuration").patchValue(this.configuration,{emitEvent:!1}),this.changeSubscription=this.ruleNodeConfigFormGroup.get("configuration").valueChanges.subscribe(i=>{this.updateModel(i)}))}useDefinedDirective(){return this.nodeDefinition&&this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length&&!this.definedDirectiveError}updateModel(e){this.definedConfigComponent||this.ruleNodeConfigFormGroup.valid?this.propagateChange(e):this.propagateChange(this.required?null:e)}validateDefinedDirective(){if(this.definedConfigComponentRef&&(this.definedConfigComponentRef.destroy(),this.definedConfigComponentRef=null),this.nodeDefinition.uiResourceLoadError&&this.nodeDefinition.uiResourceLoadError.length)this.definedDirectiveError=this.nodeDefinition.uiResourceLoadError;else if(this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length){this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null),this.definedConfigContainer.clear();let e=this.ruleChainService.getRuleNodeConfigComponent(this.nodeDefinition.configDirective);this.definedConfigComponentRef=this.definedConfigContainer.createComponent(e),this.definedConfigComponent=this.definedConfigComponentRef.instance,this.definedConfigComponent.ruleNodeId=this.ruleNodeId,this.definedConfigComponent.ruleChainId=this.ruleChainId,this.definedConfigComponent.ruleChainType=this.ruleChainType,this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(i=>{this.updateModel(i)}),this.definedConfigComponent?.changeScript&&(this.changeScriptSubscription=this.definedConfigComponent.changeScript.subscribe(()=>this.changeScript.emit()))}}validate(){this.useDefinedDirective()&&this.definedConfigComponent.validate()}};r.\u0275fac=function(i){return new(i||r)(C(Ve),C(le))},r.\u0275cmp=P({type:r,selectors:[["tb-rule-node-config"]],viewQuery:function(i,t){if(i&1&&(B(Dn,7,Oe),B(Mn,5)),i&2){let n;A(n=O())&&(t.definedConfigContainer=n.first),A(n=O())&&(t.jsonObjectEditComponent=n.first)}},inputs:{required:"required",disabled:"disabled",ruleNodeId:"ruleNodeId",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",nodeDefinition:"nodeDefinition"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[ee([{provide:Ie,useExisting:_e(()=>r),multi:!0}])],decls:5,vars:3,consts:[["definedConfigContent",""],["jsonObjectEditComponent",""],[3,"formGroup"],["class","tb-rulenode-directive-error",4,"ngIf"],["class","tb-rule-node-configuration-json","formControlName","configuration",3,"label","jsonRequired","fillHeight",4,"ngIf"],[1,"tb-rulenode-directive-error"],["formControlName","configuration",1,"tb-rule-node-configuration-json",3,"label","jsonRequired","fillHeight"]],template:function(i,t){i&1&&(s(0,"div",2),pi(1,null,0),S(3,wn,2,1,"div",3)(4,kn,3,5,"tb-json-object-edit",4),u()),i&2&&(d("formGroup",t.ruleNodeConfigFormGroup),l(3),d("ngIf",t.definedDirectiveError),l(),d("ngIf",!t.useDefinedDirective()))},dependencies:[W,en,K,te,re,ae,z],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   tb-json-object-edit.tb-rule-node-configuration-json[_ngcontent-%COMP%]{display:block;height:300px}[_nghost-%COMP%]   .tb-rulenode-directive-error[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#dd2c00}']});let o=r;return o})();Q();Q();var Pn=o=>({time:o}),Bn=(o,r,a)=>({entity:o,msg:r,time:a});function An(o,r){if(o&1&&(f(0),m(1,"translate"),m(2,"milliSecondsToTimeString"),m(3,"translate")),o&2){let a,e=v();T(" ",xe(3,7,"debug-settings.hint.main-limited",mi(10,Bn,(a=e.entityLabel)!==null&&a!==void 0?a:h(1,1,"debug-settings.entity"),e.maxMessagesCount,et(2,3,e.maxTimeFrameDuration,!0,!0)))," ")}}function On(o,r){o&1&&(f(0),m(1,"translate")),o&2&&T(" ",h(1,1,"debug-settings.hint.main")," ")}function Gn(o,r){if(o&1){let a=E();s(0,"button",12),m(1,"translate"),x("click",function(){y(a);let i=v();return _(i.onReset())}),s(2,"mat-icon",13),f(3,"refresh"),u()()}o&2&&R("matTooltip",h(1,1,"action.reset"))}var vn=(()=>{let r=class r extends qe{constructor(e,i){super(),this.fb=e,this.cd=i,this.failuresEnabled=!1,this.allEnabled=!1,this.allEnabledUntil=0,this.onFailuresControl=this.fb.control(!1),this.debugAllControl=this.fb.control(!1),this.isDebugAllActive$=this.debugAllControl.valueChanges.pipe(Be(this.debugAllControl.value),mt(t=>t?H(!0):dt(0,tt).pipe(Re(()=>this.allEnabledUntil>new Date().getTime()),ht(n=>n,!0))),ce(),ct(1)),this.onSettingsApplied=new pe,this.debugAllControl.valueChanges.pipe(ce()).subscribe(t=>{this.allEnabled=t,this.cd.markForCheck()}),this.isDebugAllActive$.pipe(pt(),ce()).subscribe(t=>this.debugAllControl.patchValue(t,{emitEvent:!1}))}ngOnInit(){this.maxMessagesCount=this.debugLimitsConfiguration?.split(":")[0],this.maxTimeFrameDuration=parseInt(this.debugLimitsConfiguration?.split(":")[1])*tt,this.onFailuresControl.patchValue(this.failuresEnabled),this.debugAllControl.patchValue(this.allEnabled),this.initialAllEnabled=this.allEnabled||this.allEnabledUntil>new Date().getTime()}onCancel(){this.popover?.hide()}onApply(){this.initialAllEnabled!==this.debugAllControl.value||this.initialAllEnabled!==this.allEnabledUntil>new Date().getTime()?this.onSettingsApplied.emit({allEnabled:this.allEnabled,failuresEnabled:this.onFailuresControl.value,allEnabledUntil:0}):this.onSettingsApplied.emit({allEnabled:!1,failuresEnabled:this.onFailuresControl.value,allEnabledUntil:this.allEnabledUntil})}onReset(){this.debugAllControl.patchValue(!0),this.debugAllControl.markAsDirty(),this.allEnabledUntil=0,this.cd.markForCheck()}};r.\u0275fac=function(i){return new(i||r)(C(He),C(je))},r.\u0275cmp=P({type:r,selectors:[["tb-entity-debug-settings-panel"]],inputs:{popover:"popover",failuresEnabled:[2,"failuresEnabled","failuresEnabled",Qt],allEnabled:[2,"allEnabled","allEnabled",Qt],entityLabel:"entityLabel",allEnabledUntil:"allEnabledUntil",maxDebugModeDuration:"maxDebugModeDuration",debugLimitsConfiguration:"debugLimitsConfiguration"},standalone:!0,features:[di,ge,_t],decls:32,vars:38,consts:[[1,"flex","max-w-sm","flex-col","gap-3","p-2"],["translate","",1,"tb-form-panel-title"],[1,"hint-container"],[1,"tb-form-hint","tb-primary-fill","tb-flex","center"],[1,"flex","flex-col","gap-3"],[1,"mat-slide",3,"formControl"],[3,"tb-hint-tooltip-icon"],[1,"align-center","flex","justify-between"],["mat-icon-button","","class","tb-mat-20","matTooltipPosition","above","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"flex","justify-end"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["mat-icon-button","","matTooltipPosition","above","color","primary",1,"tb-mat-20",3,"click","matTooltip"],[1,"material-icons"]],template:function(i,t){i&1&&(s(0,"div",0)(1,"div",1),f(2,"debug-settings.label"),u(),s(3,"div",2)(4,"div",3),S(5,An,4,14)(6,On,2,3),u()(),s(7,"div",4)(8,"mat-slide-toggle",5)(9,"div",6),m(10,"translate"),f(11),m(12,"translate"),u()(),s(13,"div",7)(14,"mat-slide-toggle",5)(15,"div",6),m(16,"translate"),f(17),m(18,"async"),m(19,"durationLeft"),m(20,"milliSecondsToTimeString"),m(21,"translate"),u()(),S(22,Gn,4,3,"button",8),m(23,"async"),u()(),s(24,"div",9)(25,"button",10),x("click",function(){return t.onCancel()}),f(26),m(27,"translate"),u(),s(28,"button",11),m(29,"async"),x("click",function(){return t.onApply()}),f(30),m(31,"translate"),u()()()),i&2&&(l(5),bt(t.debugLimitsConfiguration?5:6),l(3),d("formControl",t.onFailuresControl),l(),R("tb-hint-tooltip-icon",h(10,11,"debug-settings.hint.on-failure")),l(2),T(" ",h(12,13,"debug-settings.on-failure")," "),l(3),d("formControl",t.debugAllControl),l(),R("tb-hint-tooltip-icon",h(16,15,"debug-settings.hint.all-messages")),l(2),T(" ",xe(21,25,"debug-settings.all-messages",Ge(36,Pn,h(18,17,t.isDebugAllActive$)&&!t.allEnabled?h(19,19,t.allEnabledUntil):et(20,21,t.maxDebugModeDuration,!0,!0)))," "),l(5),d("ngIf",h(23,28,t.isDebugAllActive$)&&!t.allEnabled),l(4),T(" ",h(27,30,"action.cancel")," "),l(2),d("disabled",h(29,32,t.isLoading$)||!t.onFailuresControl.dirty&&!t.debugAllControl.dirty),l(2),T(" ",h(31,34,"action.apply")," "))},dependencies:[Gt,me,Me,X,Mt,$i,K,kt,oe,Ji,Bt,z,Nt,W,ne,jt],encapsulation:2,changeDetection:0});let o=r;return o})();function Un(o,r){if(o&1&&(f(0),m(1,"async"),m(2,"durationLeft"),m(3,"milliSecondsToTimeString")),o&2){let a=v();T(" ",h(1,1,a.allEnabled$)===!1?h(2,3,a.allEnabledUntil):et(3,5,a.maxDebugModeDuration,!0,!0)," ")}}function qn(o,r){if(o&1&&(f(0),m(1,"translate")),o&2){let a=v();T(" ",h(1,1,a.failuresEnabled?"debug-settings.failures":"common.disabled")," ")}}var _n=(()=>{let r=class r{constructor(e,i,t,n,p,g){this.popoverService=e,this.renderer=i,this.store=t,this.viewContainerRef=n,this.fb=p,this.cd=g,this.debugSettingsFormGroup=this.fb.group({failuresEnabled:[!1],allEnabled:[!1],allEnabledUntil:[]}),this.disabled=!1,this.allEnabledSubject=new ei(!1),this.allEnabled$=this.allEnabledSubject.asObservable(),this.isDebugAllActive$=this.allEnabled$.pipe(mt(c=>c?H(!0):dt(0,tt).pipe(Re(()=>this.allEnabledUntil>new Date().getTime()),ht(N=>N,!0))),ce(),ct(1)),this.maxDebugModeDuration=St(this.store).maxDebugModeDurationMinutes*Ci,this.propagateChange=()=>{},this.debugSettingsFormGroup.valueChanges.pipe(ce()).subscribe(c=>{this.propagateChange(c)}),this.debugSettingsFormGroup.get("allEnabled").valueChanges.pipe(ce()).subscribe(c=>this.allEnabledSubject.next(c))}get failuresEnabled(){return this.debugSettingsFormGroup.get("failuresEnabled").value}get allEnabledUntil(){return this.debugSettingsFormGroup.get("allEnabledUntil").value}openDebugStrategyPanel(e,i){e&&e.stopPropagation();let t=i._elementRef.nativeElement,n=this.debugSettingsFormGroup.value;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let p=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,vn,"bottom",!0,null,Zt(Je({},n),{maxDebugModeDuration:this.maxDebugModeDuration,debugLimitsConfiguration:this.debugLimitsConfiguration,entityLabel:this.entityLabel}),{},{},{},!0);p.tbComponentRef.instance.popover=p,p.tbComponentRef.instance.onSettingsApplied.subscribe(g=>{this.debugSettingsFormGroup.patchValue(g),this.cd.markForCheck(),p.hide()})}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}writeValue(e){this.debugSettingsFormGroup.patchValue(e,{emitEvent:!1}),this.allEnabledSubject.next(e?.allEnabled),this.debugSettingsFormGroup.get("allEnabled").updateValueAndValidity({onlySelf:!0})}setDisabledState(e){this.disabled=e,e?this.debugSettingsFormGroup.disable({emitEvent:!1}):this.debugSettingsFormGroup.enable({emitEvent:!1})}};r.\u0275fac=function(i){return new(i||r)(C(At),C(gt),C(Ce),C(Oe),C(He),C(je))},r.\u0275cmp=P({type:r,selectors:[["tb-entity-debug-settings-button"]],inputs:{debugLimitsConfiguration:"debugLimitsConfiguration",entityLabel:"entityLabel"},standalone:!0,features:[ee([{provide:Ie,useExisting:_e(()=>r),multi:!0}]),_t],decls:8,vars:9,consts:[["matButton",""],["mat-stroked-button","","color","primary",1,"tb-rounded-btn","w-36","flex-1",3,"click","disabled"],[3,"color"]],template:function(i,t){if(i&1){let n=E();s(0,"button",1,0),m(2,"async"),x("click",function(g){y(n);let c=G(1);return _(t.openDebugStrategyPanel(g,c))}),s(3,"mat-icon",2),f(4,"bug_report"),u(),S(5,Un,4,9),m(6,"async"),S(7,qn,2,3),u()}i&2&&(be("active",(h(2,5,t.isDebugAllActive$)||t.failuresEnabled)&&!t.disabled),d("disabled",t.disabled),l(3),d("color",t.debugSettingsFormGroup.disabled?"inherit":"primary"),l(2),bt(h(6,7,t.isDebugAllActive$)?5:7))},dependencies:[Nt,ne,Gt,me,X,Bt,z,jt],encapsulation:2,changeDetection:0});let o=r;return o})();Q();var Qn=["ruleNodeConfigComponent"];function $n(o,r){if(o&1){let a=E();s(0,"div",17)(1,"button",18),x("click",function(i){y(a);let t=v();return _(t.openRuleChain(i))}),f(2),m(3,"translate"),u()()}o&2&&(l(2),T(" ",h(3,1,"rulechain.open-rulechain")," "))}function Kn(o,r){o&1&&(s(0,"mat-error"),f(1),m(2,"translate"),u()),o&2&&(l(),T(" ",h(2,1,"rulenode.name-required")," "))}function Wn(o,r){o&1&&(s(0,"mat-error"),f(1),m(2,"translate"),u()),o&2&&(l(),T(" ",h(2,1,"rulenode.name-max-length")," "))}function Xn(o,r){if(o&1){let a=E();s(0,"button",19),x("click",function(i){y(a);let t=v();return _(t.onSingleModeChange(i))}),s(1,"mat-icon"),f(2,"checkmark"),u(),s(3,"span",5),f(4,"rulenode.singleton"),u(),I(5,"input",20),u()}if(o&2){let a=v();be("active",a.ruleNodeFormGroup.get("singletonMode").value),d("disabled",a.ruleNodeFormGroup.get("singletonMode").disabled||a.disabled),l(),be("invisible",!a.ruleNodeFormGroup.get("singletonMode").value)}}function Yn(o,r){if(o&1&&I(0,"tb-queue-autocomplete",21),o&2){let a=v();d("queueType",a.serviceType)("autocompleteHint",a.isSingleton()?"rulenode.queue-singleton-hint":"rulenode.queue-hint")}}var Ye=class Ye extends qe{constructor(r,a,e){super(r),this.store=r,this.fb=a,this.router=e,this.disabled=!1,this.isAdd=!1,this.initRuleNode=new pe,this.changeScript=new pe,this.ruleNodeType=L,this.entityType=bi,this.serviceType=dn.TB_RULE_ENGINE,this.ruleChainDebugPerTenantLimitsConfiguration=St(this.store).ruleChainDebugPerTenantLimitsConfiguration,this.destroy$=new lt,this.ruleNodeFormGroup=this.fb.group({})}buildForm(){this.ruleNode?(this.ruleNodeFormGroup=this.fb.group({name:[this.ruleNode.name,[Y.required,Y.pattern("(.|\\s)*\\S(.|\\s)*"),Y.maxLength(255)]],debugSettings:[this.ruleNode.debugSettings],singletonMode:[this.ruleNode.singletonMode,[]],configuration:[this.ruleNode.configuration,[Y.required]],additionalInfo:this.fb.group({description:[this.ruleNode.additionalInfo?this.ruleNode.additionalInfo.description:""]})}),this.isAddQueue()&&(this.ruleNodeFormGroup.addControl("queueName",this.fb.control(this.ruleNode?.queueName?this.ruleNode.queueName:null)),this.isSingleton()&&(this.isSingletonEditAllowed()||this.ruleNodeFormGroup.get("singletonMode").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").value||this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").valueChanges.pipe(Ae(this.destroy$)).subscribe(r=>{r?this.ruleNodeFormGroup.get("queueName").enable({emitEvent:!1}):this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1})}))),this.ruleNodeFormGroup.valueChanges.pipe(Ae(this.destroy$)).subscribe(()=>this.updateRuleNode())):this.ruleNodeFormGroup=this.fb.group({}),this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}updateRuleNode(){let r=this.ruleNodeFormGroup.value||{};r.name=r.name.trim(),Object.assign(this.ruleNode,r)}ngOnInit(){this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnChanges(r){for(let a of Object.keys(r)){let e=r[a];e.currentValue!==e.previousValue&&a==="ruleNode"&&this.buildForm()}}validate(){this.ruleNodeConfigComponent.validate()}onSingleModeChange(r){r&&r.stopPropagation();let a=this.ruleNodeFormGroup.get("singletonMode");a.patchValue(!a.value),a.markAsDirty()}openRuleChain(r){r&&r.stopPropagation();let a=this.ruleNodeFormGroup.get("configuration")?.value?.ruleChainId;a&&(this.ruleChainType===ot.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${a}`):this.router.navigateByUrl(`/ruleChains/${a}`))}isAddQueue(){return this.isSingleton()||this.ruleNode.component.hasQueueName}isSingleton(){return this.ruleNode.component.clusteringMode===Qe.SINGLETON||this.ruleNode.component.clusteringMode===Qe.USER_PREFERENCE}isSingletonEditAllowed(){return this.ruleNode.component.clusteringMode===Qe.USER_PREFERENCE}};Ye.\u0275fac=function(a){return new(a||Ye)(C(Ce),C(le),C(De))},Ye.\u0275cmp=P({type:Ye,selectors:[["tb-rule-node"]],viewQuery:function(a,e){if(a&1&&B(Qn,5),a&2){let i;A(i=O())&&(e.ruleNodeConfigComponent=i.first)}},inputs:{ruleNode:"ruleNode",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",disabled:"disabled",isAdd:"isAdd"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[ge,ft],decls:22,vars:14,consts:[["ruleNodeConfigComponent",""],["class","tb-details-buttons",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"title-row","flex","align-center"],[1,"mat-block","flex-1"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],[1,"mb-5","flex","max-w-xs","flex-row"],["formControlName","debugSettings",1,"mr-2",3,"entityLabel","debugLimitsConfiguration"],["mat-stroked-button","","class","tb-rounded-btn flex-1","color","primary",3,"disabled","active","click",4,"ngIf"],["formControlName","configuration",3,"initRuleNode","changeScript","ruleNodeId","ruleChainId","ruleChainType","nodeDefinition"],[1,"description-block"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint",4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","1"],[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click"],["mat-stroked-button","","color","primary",1,"tb-rounded-btn","flex-1",3,"click","disabled"],["formControlName","singletonMode",1,"hidden"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint"]],template:function(a,e){if(a&1){let i=E();S(0,$n,4,3,"div",1),s(1,"form",2)(2,"section",3)(3,"mat-form-field",4)(4,"mat-label",5),f(5,"rulenode.name"),u(),I(6,"input",6),S(7,Kn,3,3,"mat-error",7)(8,Wn,3,3,"mat-error",7),u(),s(9,"section",8),I(10,"tb-entity-debug-settings-button",9),m(11,"translate"),S(12,Xn,6,5,"button",10),u()(),s(13,"tb-rule-node-config",11,0),x("initRuleNode",function(n){return y(i),_(e.initRuleNode.emit(n))})("changeScript",function(n){return y(i),_(e.changeScript.emit(n))}),u(),s(15,"div",12),S(16,Yn,1,2,"tb-queue-autocomplete",13),s(17,"div",14)(18,"mat-form-field",15)(19,"mat-label",5),f(20,"rulenode.rule-node-description"),u(),I(21,"textarea",16),u()()()()}a&2&&(d("ngIf",!e.isAdd&&(e.ruleNode.component==null||e.ruleNode.component.configurationDescriptor==null||e.ruleNode.component.configurationDescriptor.nodeDefinition==null?null:e.ruleNode.component.configurationDescriptor.nodeDefinition.ruleChainNode)),l(),d("formGroup",e.ruleNodeFormGroup),l(6),d("ngIf",e.ruleNodeFormGroup.get("name").hasError("required")||e.ruleNodeFormGroup.get("name").hasError("pattern")),l(),d("ngIf",e.ruleNodeFormGroup.get("name").hasError("maxlength")),l(2),d("entityLabel",h(11,12,"debug-settings.rule-node"))("debugLimitsConfiguration",e.ruleChainDebugPerTenantLimitsConfiguration),l(2),d("ngIf",e.isSingleton()),l(),d("ruleNodeId",e.ruleNode.ruleNodeId==null?null:e.ruleNode.ruleNodeId.id)("ruleChainId",e.ruleChainId)("ruleChainType",e.ruleChainType)("nodeDefinition",e.ruleNode.component.configurationDescriptor.nodeDefinition),l(3),d("ngIf",e.isAddQueue()))},dependencies:[W,un,me,X,Fe,Le,ze,Ft,Te,we,K,te,ke,re,ae,Lt,oe,_n,Cn,z],styles:['@charset "UTF-8";[_nghost-%COMP%]   form[_ngcontent-%COMP%]{overflow-x:hidden!important}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 960px){[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{flex-direction:row;gap:8px;align-items:center}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{margin-top:5px}}[_nghost-%COMP%]   .description-block[_ngcontent-%COMP%]{margin-top:22px}']});var Pe=Ye;qt([Wt(),Ht("design:type",Object)],Pe.prototype,"disabled",void 0);qt([Wt(),Ht("design:type",Object)],Pe.prototype,"isAdd",void 0);Q();var to=["chipList"],io=["labelAutocomplete"],no=["labelInput"],oo=o=>({label:o});function ro(o,r){o&1&&(s(0,"mat-icon",13),f(1,"close"),u())}function ao(o,r){if(o&1){let a=E();s(0,"mat-chip-row",11),x("removed",function(){let i=y(a).$implicit,t=v();return _(t.remove(i))}),f(1),S(2,ro,2,0,"mat-icon",12),u()}if(o&2){let a=r.$implicit,e=v();d("removable",!e.disabled),l(),T(" ",a.name," "),l(),d("ngIf",!e.disabled)}}function lo(o,r){if(o&1&&(s(0,"mat-option",14),I(1,"span",15),m(2,"highlight"),u()),o&2){let a=r.$implicit,e=v();d("value",a),l(),d("innerHTML",xe(2,2,a.name,e.searchText),Ze)}}function so(o,r){o&1&&(s(0,"div")(1,"span",5),f(2,"rulenode.no-link-labels-found"),u()())}function uo(o,r){if(o&1&&(s(0,"span"),f(1),m(2,"async"),u()),o&2){let a=v(2);l(),T(" ",h(2,1,a.translate.get("rulenode.no-link-label-matching",Ge(3,oo,a.truncate.transform(a.searchText,!0,6,"..."))))," ")}}function po(o,r){if(o&1){let a=E();s(0,"span")(1,"a",20),x("click",function(i){y(a);let t=v(2);return _(t.createLinkLabel(i,t.searchText))}),f(2,"rulenode.create-new-link-label"),u()()}}function co(o,r){if(o&1){let a=E();s(0,"mat-option",16)(1,"div",17),x("click",function(i){return y(a),_(i.stopPropagation())}),S(2,so,3,0,"div",18)(3,uo,3,5,"ng-template",null,3,hi)(5,po,3,0,"span",19),u()()}if(o&2){let a=G(4),e=v();d("value",null),l(2),d("ngIf",!e.textIsNotEmpty(e.searchText))("ngIfElse",a),l(3),d("ngIf",e.allowCustom)}}var Sn=(()=>{let r=class r{get required(){return this.requiredValue}set required(e){this.requiredValue=Ne(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=Ne(e),this.separatorKeysCodes=this.allowCustomValue?[13,188,186]:[]}constructor(e,i,t,n){this.fb=e,this.truncate=i,this.translate=t,this.ruleChainService=n,this.labelsList=[],this.separatorKeysCodes=[],this.labels=[],this.searchText="",this.propagateChange=p=>{},this.linksFormGroup=this.fb.group({label:[null]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.filteredLabels=this.linksFormGroup.get("label").valueChanges.pipe(Be(""),Re(e=>e||""),st(e=>this.fetchLabels(e)),ri())}ngOnChanges(e){let i=!1;for(let t of Object.keys(e)){let n=e[t];n.currentValue!==n.previousValue&&["allowCustom","allowedLabels","sourceRuleChainId"].includes(t)&&(i=!0)}i&&this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})}setDisabledState(e){this.disabled=e,this.disabled?this.linksFormGroup.disable({emitEvent:!1}):this.linksFormGroup.enable({emitEvent:!1})}writeValue(e){this.searchText="",this.labelsList.length=0,this.labels.length=0,this.modelValue=e,this.prepareLabelsList().subscribe(i=>{this.labelsList=i,e&&e.forEach(t=>{this.allowedLabels[t]?this.labels.push(k(this.allowedLabels[t])):this.labels.push({name:t,value:t})}),this.chipList&&this.required&&(this.chipList.errorState=!this.labels.length),this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})})}prepareLabelsList(){let e=[];if(this.sourceRuleChainId)return this.ruleChainService.getRuleChainOutputLabels(this.sourceRuleChainId,{ignoreErrors:!0}).pipe(Re(i=>{for(let t of i)e.push({name:t,value:t});return e}),ut(()=>H(e)));for(let i of Object.keys(this.allowedLabels))e.push({name:this.allowedLabels[i].name,value:this.allowedLabels[i].value});return H(e)}displayLabelFn(e){return e?e.name:void 0}textIsNotEmpty(e){return e&&e.length>0}createLinkLabel(e,i){e.preventDefault(),this.transformLinkLabel(i)}add(e){(!this.matAutocomplete.isOpen||this.allowCustom)&&this.transformLinkLabel(e.value)}fetchLabels(e){if(this.searchText=e,this.searchText&&this.searchText.length){let i=this.searchText.toUpperCase();return H(this.labelsList.filter(t=>t.name.toUpperCase().includes(i)))}else return H(this.labelsList)}transformLinkLabel(e){if((e||"").trim()){let i=null,t=e.trim(),n=this.labelsList.find(p=>p.name===t);n?i=k(n):this.allowCustom&&(i={name:t,value:t}),i&&this.addLabel(i)}this.clear("")}remove(e){let i=this.labels.indexOf(e);i>=0&&(this.labels.splice(i,1),this.labels.length||this.required&&(this.chipList.errorState=!0),this.updateModel())}selected(e){this.addLabel(e.option.value),this.clear("")}addLabel(e){this.labels.findIndex(t=>t.value===e.value)===-1&&(this.labels.push(e),this.required&&(this.chipList.errorState=!1),this.updateModel())}onFocus(){this.linksFormGroup.get("label").updateValueAndValidity({onlySelf:!0,emitEvent:!0})}clear(e=""){this.labelInput.nativeElement.value=e,this.linksFormGroup.get("label").patchValue(null,{emitEvent:!0}),setTimeout(()=>{this.labelInput.nativeElement.blur(),this.labelInput.nativeElement.focus()},0)}updateModel(){let e=this.labels.map(i=>i.value);this.propagateChange(e)}};r.\u0275fac=function(i){return new(i||r)(C(le),C(Ot),C(Ue),C(Ve))},r.\u0275cmp=P({type:r,selectors:[["tb-link-labels"]],viewQuery:function(i,t){if(i&1&&(B(to,5),B(io,5),B(no,5)),i&2){let n;A(n=O())&&(t.chipList=n.first),A(n=O())&&(t.matAutocomplete=n.first),A(n=O())&&(t.labelInput=n.first)}},inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ee([{provide:Ie,useExisting:_e(()=>r),multi:!0}]),ft],decls:16,vars:16,consts:[["chipList",""],["labelInput","","origin","matAutocompleteOrigin"],["labelAutocomplete","matAutocomplete"],["searchNotEmpty",""],[2,"width","100%",3,"formGroup"],["translate",""],[3,"removable","removed",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","label","matAutocompleteOrigin","",2,"max-width","200px",3,"focusin","matChipInputTokenEnd","placeholder","matAutocompleteConnectedTo","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],[1,"tb-autocomplete",3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["class","tb-not-found",3,"value",4,"ngIf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"],[3,"innerHTML"],[1,"tb-not-found",3,"value"],[1,"tb-not-found-content",3,"click"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["translate","",3,"click"]],template:function(i,t){if(i&1){let n=E();s(0,"mat-form-field",4)(1,"mat-label",5),f(2,"rulenode.link-labels"),u(),s(3,"mat-chip-grid",null,0),S(5,ao,3,3,"mat-chip-row",6),s(6,"input",7,1),m(9,"translate"),x("focusin",function(){return y(n),_(t.onFocus())})("matChipInputTokenEnd",function(g){return y(n),_(t.add(g))}),u()(),s(10,"mat-autocomplete",8,2),x("optionSelected",function(g){return y(n),_(t.selected(g))}),S(12,lo,3,5,"mat-option",9),m(13,"async"),S(14,co,6,4,"mat-option",10),m(15,"async"),u()()}if(i&2){let n,p=G(4),g=G(8),c=G(11);d("formGroup",t.linksFormGroup),l(5),d("ngForOf",t.labels),l(),R("placeholder",t.disabled?"":h(9,10,"rulenode.link-label")),d("matAutocompleteConnectedTo",g)("matAutocomplete",c)("matChipInputFor",p)("matChipInputSeparatorKeyCodes",t.separatorKeysCodes),l(4),d("displayWith",t.displayLabelFn),l(2),d("ngForOf",h(13,12,t.filteredLabels)),l(2),d("ngIf",((n=h(15,14,t.filteredLabels))==null?null:n.length)===0)}},dependencies:[xt,W,X,Fe,Le,ze,vi,ki,Fi,Li,Bi,Ai,Vi,Pi,we,K,te,re,ae,oe,ne,Yi,z],encapsulation:2});let o=r;return o})();Q();var Jt=(()=>{let r=class r{get required(){return this.requiredValue}set required(e){this.requiredValue=Ne(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=Ne(e)}constructor(e,i,t){this.fb=e,this.truncate=i,this.translate=t,this.propagateChange=n=>{},this.ruleNodeLinkFormGroup=this.fb.group({labels:[[],Y.required]}),this.ruleNodeLinkFormGroup.get("labels").valueChanges.pipe(ce()).subscribe(n=>this.updateModel(n))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeLinkFormGroup.disable({emitEvent:!1}):this.ruleNodeLinkFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let i=this.modelValue&&this.modelValue.labels?this.modelValue.labels:[];this.ruleNodeLinkFormGroup.get("labels").patchValue(i,{emitEvent:!1})}updateModel(e){e&&e.length?(this.modelValue.labels=e,this.modelValue.label=e.join(" / "),this.propagateChange(this.modelValue)):this.propagateChange(this.required?null:this.modelValue)}};r.\u0275fac=function(i){return new(i||r)(C(le),C(Ot),C(Ue))},r.\u0275cmp=P({type:r,selectors:[["tb-rule-node-link"]],inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ee([{provide:Ie,useExisting:_e(()=>r),multi:!0}])],decls:3,vars:4,consts:[[1,"mat-padding","flex","flex-col"],[3,"formGroup"],["required","","formControlName","labels",3,"allowedLabels","allowCustom","sourceRuleChainId"]],template:function(i,t){i&1&&(s(0,"div",0)(1,"form",1),I(2,"tb-link-labels",2),u()()),i&2&&(l(),d("formGroup",t.ruleNodeLinkFormGroup),l(),d("allowedLabels",t.allowedLabels)("allowCustom",t.allowCustom)("sourceRuleChainId",t.sourceRuleChainId))},dependencies:[Te,K,te,ke,re,ae,Sn],encapsulation:2});let o=r;return o})();Q();var fo=["ruleChainCanvas"],go=["ruleChainMenuTrigger"],bo=["drawer"],In=["tbRuleNode"],Co=["tbRuleNodeLink"],vo=["ruleNodeTypeExpansionPanels"],yo=o=>[o];function _o(o,r){if(o&1){let a=E();s(0,"tb-rule-chain-select",38),yt("ngModelChange",function(i){y(a);let t=v();return vt(t.ruleChain,i)||(t.ruleChain=i),_(i)}),x("ngModelChange",function(){y(a);let i=v();return _(i.currentRuleChainIdChanged(i.ruleChain.id==null?null:i.ruleChain.id.id))}),u()}if(o&2){let a=v();d("ruleChainType",a.ruleChainType)("disabled",a.isDirtyValue),Ct("ngModel",a.ruleChain)}}function xo(o,r){if(o&1){let a=E();s(0,"mat-expansion-panel",39,5)(2,"mat-expansion-panel-header",40),x("mouseenter",function(i){let t=y(a).$implicit,n=v();return _(n.typeHeaderMouseEnter(i,t))})("mouseleave",function(){y(a);let i=v();return _(i.destroyTooltips())}),s(3,"mat-panel-title")(4,"mat-icon"),f(5),u(),s(6,"div",41),f(7),u()()(),I(8,"fc-canvas",42),u()}if(o&2){let a=r.$implicit,e=v();d("expanded",!0),l(5),Z(e.ruleNodeTypeDescriptorsMap.get(a).icon),l(2),Z(e.ruleNodeTypeDescriptorsMap.get(a).name),l(),ci("id","tb-rulchain-",a,""),d("model",e.ruleNodeTypesModel[a].model)("selectedObjects",e.ruleNodeTypesModel[a].selectedObjects)("automaticResize",!1)("userCallbacks",e.nodeLibCallbacks)("nodeWidth",170)("nodeHeight",50)("dropTargetId","tb-rulchain-canvas")}}function No(o,r){if(o&1){let a=E();s(0,"mat-tab",47,7),m(2,"translate"),s(3,"tb-event-table",55),x("debugEventSelected",function(i){y(a);let t=v(2);return _(t.onDebugEventSelected(i))}),u()()}if(o&2){let a=G(1),e=v(2);R("label",h(2,7,"rulenode.events")),l(3),d("debugEventTypes",Ge(9,yo,e.debugEventTypes.DEBUG_RULE_NODE))("defaultEventType",e.debugEventTypes.DEBUG_RULE_NODE)("active",a.isActive)("tenantId",e.ruleChain.tenantId.id)("entityId",e.editingRuleNode.ruleNodeId)("functionTestButtonLabel",e.ruleNodeTestButtonLabel)}}function So(o,r){if(o&1){let a=E();s(0,"tb-details-panel",43),m(1,"translate"),x("closeDetails",function(){y(a);let i=v();return _(i.onEditRuleNodeClosed())})("toggleDetailsEditMode",function(){y(a);let i=v();return _(i.onRevertRuleNodeEdit())})("applyDetails",function(){y(a);let i=v();return _(i.saveRuleNode())}),s(2,"div",44),I(3,"div",45),u(),s(4,"mat-tab-group",46),yt("selectedIndexChange",function(i){y(a);let t=v();return vt(t.selectedRuleNodeTabIndex,i)||(t.selectedRuleNodeTabIndex=i),_(i)}),s(5,"mat-tab",47),m(6,"translate"),s(7,"tb-rule-node",48,6),x("initRuleNode",function(){y(a);let i=v();return _(i.onRuleNodeInit())})("changeScript",function(){y(a);let i=v();return _(i.switchToFirstTab())}),u()(),S(9,No,4,11,"mat-tab",49),s(10,"mat-tab",47),m(11,"translate"),s(12,"div",50)(13,"div",51)(14,"div",52),f(15),u(),s(16,"div"),f(17,"\xA0"),u(),I(18,"div",53),m(19,"safe"),s(20,"div"),f(21,"\xA0"),u(),I(22,"div",54),m(23,"safe"),u()()()()()}if(o&2){let a=G(8),e=v();R("headerTitle",e.editingRuleNode.name),R("headerSubtitle",h(1,16,e.ruleNodeTypeDescriptorsMap.get(e.editingRuleNode.component.type).name)+" - "+e.editingRuleNode.component.name),d("isReadOnly",e.selectedRuleNodeTabIndex>0)("isAlwaysEdit",!0)("theForm",a.ruleNodeFormGroup),l(3),d("tb-help",e.helpLinkIdForRuleNodeType()),l(),Ct("selectedIndex",e.selectedRuleNodeTabIndex),l(),R("label",h(6,18,"rulenode.details")),l(2),d("ruleNode",e.editingRuleNode)("ruleChainId",e.ruleChain.id==null?null:e.ruleChain.id.id)("ruleChainType",e.ruleChainType),l(2),d("ngIf",e.editingRuleNode.ruleNodeId),l(),R("label",h(11,20,"rulenode.help")),l(5),Z(e.editingRuleNode.component.name),l(3),d("innerHtml",xe(19,22,e.editingRuleNode.component.configurationDescriptor.nodeDefinition.description,"html"),Ze),l(4),d("innerHtml",xe(23,25,e.editingRuleNode.component.configurationDescriptor.nodeDefinition.details,"html"),Ze)}}function Io(o,r){if(o&1){let a=E();s(0,"tb-details-panel",43),m(1,"translate"),x("closeDetails",function(){y(a);let i=v();return _(i.onEditRuleNodeLinkClosed())})("toggleDetailsEditMode",function(){y(a);let i=v();return _(i.onRevertRuleNodeLinkEdit())})("applyDetails",function(){y(a);let i=v();return _(i.saveRuleNodeLink())}),s(2,"div",44),I(3,"div",45),u(),s(4,"tb-rule-node-link",56,8),yt("ngModelChange",function(i){y(a);let t=v();return vt(t.editingRuleNodeLink,i)||(t.editingRuleNodeLink=i),_(i)}),u()()}if(o&2){let a=G(5),e=v();R("headerTitle",e.editingRuleNodeLink.label),R("headerSubtitle",h(1,10,"rulenode.link-details")),d("isReadOnly",!1)("isAlwaysEdit",!0)("theForm",a.ruleNodeLinkFormGroup),l(3),d("tb-help","ruleEngine"),l(),Ct("ngModel",e.editingRuleNodeLink),d("allowedLabels",e.editingRuleNodeLinkLabels)("allowCustom",e.editingRuleNodeAllowCustomLabels)("sourceRuleChainId",e.editingRuleNodeSourceRuleChainId)}}function To(o,r){if(o&1){let a=E();s(0,"button",57,9),m(2,"translate"),x("click",function(i){y(a);let t=G(1),n=v();return _(n.toggleVersionControl(i,t))}),s(3,"mat-icon"),f(4,"history"),u()()}o&2&&R("matTooltip",h(2,1,"version-control.version-control"))}function Eo(o,r){if(o&1&&(s(0,"mat-icon"),f(1),u()),o&2){let a=v().contextInfo;l(),Z(a.icon)}}function Ro(o,r){if(o&1&&I(0,"img",65),o&2){let a=v().contextInfo;d("src",a.iconUrl,si)}}function Do(o,r){o&1&&I(0,"mat-divider")}function Mo(o,r){if(o&1&&(s(0,"span",70),f(1),m(2,"keyboardShortcut"),u()),o&2){let a=v(2).$implicit;l(),T(" ",h(2,1,a.shortcut),"")}}function wo(o,r){if(o&1&&(s(0,"mat-icon"),f(1),u()),o&2){let a=v(2).$implicit;l(),Z(a.icon)}}function ko(o,r){if(o&1){let a=E();s(0,"button",67),x("click",function(){y(a);let i=v().$implicit,t=v(2);return _(i.action(t.contextMenuEvent))}),S(1,Mo,3,3,"span",68)(2,wo,2,1,"mat-icon",59),s(3,"span",69),f(4),u()()}if(o&2){let a=v().$implicit;d("disabled",!a.enabled),l(),d("ngIf",a.shortcut),l(),d("ngIf",a.icon),l(2),Z(a.value)}}function Lo(o,r){if(o&1&&(s(0,"div"),S(1,Do,1,0,"mat-divider",59)(2,ko,5,4,"button",66),u()),o&2){let a=r.$implicit;l(),d("ngIf",a.divider),l(),d("ngIf",!a.divider)}}function Fo(o,r){if(o&1){let a=E();s(0,"div",58),x("mouseleave",function(){y(a);let i=v();return _(i.onRuleChainContextMenuMouseLeave())}),s(1,"div"),S(2,Eo,2,1,"mat-icon",59)(3,Ro,1,1,"img",60),s(4,"div",61)(5,"div",62),f(6),u(),s(7,"div",63),f(8),u()()(),S(9,Lo,3,2,"div",64),u()}if(o&2){let a=r.contextInfo;l(),ui("tb-context-menu-header ",a.headerClass,""),l(),d("ngIf",!a.iconUrl),l(),d("ngIf",a.iconUrl),l(3),Z(a.title),l(2),Z(a.subtitle),l(),d("ngForOf",a.menuItems)}}function Vo(o,r){o&1&&I(0,"mat-progress-bar",14)}function Po(o,r){o&1&&I(0,"mat-progress-bar",14)}function Bo(o,r){o&1&&I(0,"mat-progress-bar",19)}function Ao(o,r){o&1&&(s(0,"mat-error"),f(1),m(2,"translate"),u()),o&2&&(l(),T(" ",h(2,1,"rulechain.name-required")," "))}function Oo(o,r){o&1&&(s(0,"mat-error"),f(1),m(2,"translate"),u()),o&2&&(l(),T(" ",h(2,1,"rulechain.name-max-length")," "))}var as=(()=>{let r=class r extends qe{get isDirty(){return this.isDirtyValue||this.isImport}set isDirty(e){this.isDirtyValue=e}constructor(e,i,t,n,p,g,c,N,w,j,U,se,F,ye){super(e),this.store=e,this.route=i,this.router=t,this.ruleChainService=n,this.authService=p,this.translate=g,this.itembuffer=c,this.popoverService=N,this.renderer=w,this.viewContainerRef=j,this.changeDetector=U,this.dialog=se,this.dialogService=F,this.fb=ye,this.width="100%",this.height="100%",this.eventTypes=mn,this.debugEventTypes=hn,this.ruleChainMenuPosition={x:"0px",y:"0px"},this.ruleNodeTypeDescriptorsMap=ie,this.ruleNodeTypesLibraryArray=nt,this.isInvalid=!1,this.errorTooltips={},this.isFullscreen=!1,this.selectedRuleNodeTabIndex=0,this.editingRuleNode=null,this.isEditingRuleNode=!1,this.editingRuleNodeIndex=-1,this.editingRuleNodeAllowCustomLabels=!1,this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1,this.editingRuleNodeLinkIndex=-1,this.hotKeys=[],this.enableHotKeys=!0,this.ruleNodeSearch="",this.ruleNodeTypeSearch=this.fb.control("",{nonNullable:!0}),this.ruleChainModel={nodes:[],edges:[]},this.selectedObjects=[],this.editCallbacks={edgeDoubleClick:(he,b)=>{this.openLinkDetails(b)},edgeEdit:(he,b)=>{this.openLinkDetails(b)},nodeCallbacks:{doubleClick:(he,b)=>{this.openNodeDetails(b)},nodeEdit:(he,b)=>{this.openNodeDetails(b)},mouseEnter:this.displayNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)},isValidEdge:(he,b)=>he.type===M.rightConnectorType&&b.type===M.leftConnectorType,createEdge:(he,b)=>{let D=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(b.source);if(D.component.type===L.INPUT){let q=this.ruleChainModel.edges.find(V=>V.source===this.inputConnectorId+"");return q&&this.ruleChainCanvas.modelService.edges.delete(q),H(b)}else{if(b.label)return b.labels||(b.labels=b.label.split(" / ")),H(b);{let q=this.ruleChainService.getRuleNodeSupportedLinks(D.component),V=this.ruleChainService.ruleNodeAllowCustomLinks(D.component),J=this.ruleChainService.ruleNodeSourceRuleChainId(D.component,D.configuration);return this.enableHotKeys=!1,this.addRuleNodeLink(b,q,V,J).pipe(li(()=>{this.enableHotKeys=!0}),st(de=>de?H(de):ni))}}},dropNode:(he,b)=>{this.addRuleNode(b)}},this.ruleNodeTypesModel={},this.nodeLibCallbacks={nodeCallbacks:{mouseEnter:this.displayLibNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)}},this.flowchartConstants=M,this.updateBreadcrumbs=new pe,this.destroy$=new lt,this.route.data.pipe(Ae(this.destroy$)).subscribe(()=>{this.reset(),this.init()})}ngOnInit(){this.ruleNodeTypeSearch.valueChanges.pipe(oi(150),Be(""),pt((e,i)=>e.trim()===i.trim()),ai(1),Ae(this.destroy$)).subscribe(()=>this.updateRuleChainLibrary())}ngAfterViewChecked(){this.changeDetector.detectChanges()}ngAfterViewInit(){this.ruleChainCanvas.adjustCanvasSize(!0)}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}currentRuleChainIdChanged(e){this.ruleChainType===ot.CORE?this.router.navigateByUrl(`ruleChains/${e}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${e}`)}onSearchTextUpdated(e){this.ruleNodeSearch=e,this.updateRuleNodesHighlight()}init(){if(this.initHotKeys(),this.isImport=this.route.snapshot.data.import,this.ruleChainType=this.route.snapshot.data.ruleChainType,this.isImport){let e=this.itembuffer.getRuleChainImport();this.ruleChain=e.ruleChain,this.ruleChainMetaData=e.metadata}else this.ruleChain=this.route.snapshot.data.ruleChain,this.ruleChainMetaData=this.route.snapshot.data.ruleChainMetaData;this.ruleNodeComponents=this.route.snapshot.data.ruleNodeComponents;for(let e of nt)ie.get(e).special||(this.ruleNodeTypesModel[e]={model:{nodes:[],edges:[]},selectedObjects:[]});this.updateRuleChainLibrary(),this.createRuleChainModel()}reset(){this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.ruleNodeTypesModel={},this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isEditingRuleNode=!1,this.isEditingRuleNodeLink=!1,this.updateRuleNodesHighlight()}initHotKeys(){this.hotKeys.length||(this.hotKeys.push(new ve("ctrl+a",e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.selectAll(),!1):!0,[],this.translate.instant("rulenode.select-all-objects"))),this.hotKeys.push(new ve("ctrl+c",e=>this.enableHotKeys?(e.preventDefault(),this.copyRuleNodes(),!1):!0,[],this.translate.instant("rulenode.copy-selected"))),this.hotKeys.push(new ve("ctrl+v",e=>this.enableHotKeys?(e.preventDefault(),this.itembuffer.hasRuleNodes()&&this.pasteRuleNodes(),!1):!0,[],this.translate.instant("action.paste"))),this.hotKeys.push(new ve("esc",e=>this.enableHotKeys?(e.preventDefault(),e.stopPropagation(),this.ruleChainCanvas.modelService.deselectAll(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.deselect-all-objects"))),this.hotKeys.push(new ve("ctrl+s",e=>this.enableHotKeys?(e.preventDefault(),this.saveRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.apply"))),this.hotKeys.push(new ve("ctrl+z",e=>this.enableHotKeys?(e.preventDefault(),this.revertRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.decline-changes"))),this.hotKeys.push(new ve("del",e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.deleteSelected(),!1):!0,[],this.translate.instant("rulenode.delete-selected-objects"))),this.hotKeys.push(new ve("ctrl+r",e=>this.enableHotKeys&&this.canCreateNestedRuleChain()?(e.preventDefault(),this.createNestedRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.create-nested-rulechain"))))}updateRuleChainLibrary(){let e=this.ruleNodeTypeSearch.value.trim().toUpperCase(),i=this.ruleNodeComponents.filter(t=>t.name.toUpperCase().includes(e));this.loadRuleChainLibrary(i)}loadRuleChainLibrary(e){for(let i of Object.keys(this.ruleNodeTypesModel))this.ruleNodeTypesModel[i].model.nodes.length=0;if(e.forEach(i=>{let t=i.type,n=this.ruleNodeTypesModel[t].model,p=ie.get(L[t]),g=p.icon,c=null;i.configurationDescriptor.nodeDefinition.icon&&(g=i.configurationDescriptor.nodeDefinition.icon),i.configurationDescriptor.nodeDefinition.iconUrl&&(c=i.configurationDescriptor.nodeDefinition.iconUrl);let N={id:"node-lib-"+t+"-"+n.nodes.length,component:i,name:"",nodeClass:p.nodeClass,singletonMode:i.clusteringMode!==Qe.ENABLED,icon:g,iconUrl:c,x:30,y:10+50*n.nodes.length,connectors:[]};i.configurationDescriptor.nodeDefinition.inEnabled&&N.connectors.push({type:M.leftConnectorType,id:n.nodes.length*2+""}),i.configurationDescriptor.nodeDefinition.outEnabled&&N.connectors.push({type:M.rightConnectorType,id:n.nodes.length*2+1+""}),n.nodes.push(N)}),this.expansionPanels)for(let i=0;i<nt.length;i++){let t=this.expansionPanels.find((n,p)=>p===i);if(t){let n=nt[i];this.ruleNodeTypesModel[n].model.nodes.length?t.open():t.close()}}}createRuleChainModel(){this.nextNodeID=1,this.nextConnectorID=1,this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.inputConnectorId=this.nextConnectorID++,this.ruleChainModel.nodes.push({id:"rule-chain-node-"+this.nextNodeID++,component:on,name:"",nodeClass:ie.get(L.INPUT).nodeClass,icon:ie.get(L.INPUT).icon,readonly:!0,x:50,y:150,connectors:[{type:M.rightConnectorType,id:this.inputConnectorId+""}]});let e=[];if(this.ruleChainMetaData.nodes.forEach(i=>{let t=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,i.type),n=ie.get(t.type),p=n.icon,g=null;t.configurationDescriptor.nodeDefinition.icon&&(p=t.configurationDescriptor.nodeDefinition.icon),t.configurationDescriptor.nodeDefinition.iconUrl&&(g=t.configurationDescriptor.nodeDefinition.iconUrl);let c={id:"rule-chain-node-"+this.nextNodeID++,ruleNodeId:i.id,additionalInfo:i.additionalInfo,configuration:i.configuration,configurationVersion:$t(i.configurationVersion)?i.configurationVersion:0,debugSettings:i.debugSettings,singletonMode:i.singletonMode,queueName:i.queueName,x:Math.round(i.additionalInfo.layoutX),y:Math.round(i.additionalInfo.layoutY),component:t,name:i.name,nodeClass:n.nodeClass,icon:p,iconUrl:g,connectors:[],ruleChainType:this.ruleChainType};t.configurationDescriptor.nodeDefinition.inEnabled&&c.connectors.push({type:M.leftConnectorType,id:this.nextConnectorID+++""}),t.configurationDescriptor.nodeDefinition.outEnabled&&c.connectors.push({type:M.rightConnectorType,id:this.nextConnectorID+++""}),e.push(c),this.ruleChainModel.nodes.push(c)}),this.ruleChainMetaData.firstNodeIndex>-1){let i=e[this.ruleChainMetaData.firstNodeIndex];if(i){let t=i.connectors.filter(n=>n.type===M.leftConnectorType);if(t&&t.length){let n={source:this.inputConnectorId+"",destination:t[0].id};this.ruleChainModel.edges.push(n)}}}if(this.ruleChainMetaData.connections){let i={};this.ruleChainMetaData.connections.forEach(t=>{let n=e[t.fromIndex],p=e[t.toIndex];if(n&&p){let g=n.connectors.filter(N=>N.type===M.rightConnectorType),c=p.connectors.filter(N=>N.type===M.leftConnectorType);if(g&&g.length&&c&&c.length){let N=g[0].id,w=c[0].id,j=N+"_"+w,U=i[j];U?(U.label+=" / "+t.type,U.labels.push(t.type)):(U={source:N,destination:w,label:t.type,labels:[t.type]},i[j]=U,this.ruleChainModel.edges.push(U))}}})}this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isDirtyValue=!1,this.updateRuleNodesHighlight(),this.validate()}openRuleChainContextMenu(e){if(this.ruleChainCanvas.modelService&&!e.ctrlKey&&!e.metaKey){let i=e.clientX,t=e.clientY,n=this.ruleChainCanvas.modelService.getItemInfoAtPoint(i,t),p=this.prepareContextMenu(n);p.menuItems&&p.menuItems.length>0&&(e.preventDefault(),e.stopPropagation(),this.contextMenuEvent=e,this.ruleChainMenuPosition.x=i+"px",this.ruleChainMenuPosition.y=t+"px",this.ruleChainMenuTrigger.menuData={contextInfo:p},this.ruleChainMenuTrigger.openMenu())}}onRuleChainContextMenuMouseLeave(){this.ruleChainMenuTrigger.closeMenu()}prepareContextMenu(e){if(this.objectsSelected()||!e.node&&!e.edge)return this.prepareRuleChainContextMenu();if(e.node)return this.prepareRuleNodeContextMenu(e.node);if(e.edge)return this.prepareEdgeContextMenu(e.edge)}prepareRuleChainContextMenu(){let e={headerClass:"tb-rulechain-header",icon:"settings_ethernet",title:this.ruleChain.name,subtitle:this.translate.instant("rulechain.rulechain"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length&&e.menuItems.push({action:()=>{this.copyRuleNodes()},enabled:!0,value:"rulenode.copy-selected",icon:"content_copy",shortcut:"M-C"}),e.menuItems.push({action:i=>{this.pasteRuleNodes(i)},enabled:this.itembuffer.hasRuleNodes(),value:"action.paste",icon:"content_paste",shortcut:"M-V"}),e.menuItems.push({divider:!0}),this.objectsSelected()?(e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deselectAll()},enabled:!0,value:"rulenode.deselect-all",icon:"tab_unselected",shortcut:"Esc"}),this.canCreateNestedRuleChain()&&e.menuItems.push({action:()=>{this.createNestedRuleChain()},enabled:!0,value:"rulenode.create-nested-rulechain",icon:"settings_ethernet",shortcut:"M-R"}),e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deleteSelected()},enabled:!0,value:"rulenode.delete-selected",icon:"clear",shortcut:"Del"})):e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.selectAll()},enabled:!0,value:"rulenode.select-all",icon:"select_all",shortcut:"M-A"}),e.menuItems.push({divider:!0}),e.menuItems.push({action:()=>{this.saveRuleChain()},enabled:!(this.isInvalid||!this.isDirty&&!this.isImport),value:"action.apply-changes",icon:"done",shortcut:"M-S"}),e.menuItems.push({action:()=>{this.revertRuleChain()},enabled:this.isDirty,value:"action.decline-changes",icon:"close",shortcut:"M-Z"}),e}prepareRuleNodeContextMenu(e){let i={headerClass:e.nodeClass,icon:e.icon,iconUrl:e.iconUrl,title:e.name,subtitle:e.component.name,menuItems:[]};return e.readonly||(i.menuItems.push({action:()=>{this.openNodeDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),i.menuItems.push({action:()=>{this.copyNode(e)},enabled:!0,value:"action.copy",icon:"content_copy"}),i.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.nodes.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"})),i}prepareEdgeContextMenu(e){let i={headerClass:"tb-link-header",icon:"trending_flat",title:e.label,subtitle:this.translate.instant("rulenode.link"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source).component.type!==L.INPUT&&i.menuItems.push({action:()=>{this.openLinkDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),i.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.edges.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"}),i}canCreateNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges();if(e.length>1){let t=new Set;return i.forEach(p=>{let g=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(p.source),c=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(p.destination),N=e.indexOf(g),w=e.indexOf(c);N>-1&&w>-1&&t.add(w)}),e.filter((p,g)=>!t.has(g)).filter(p=>p.component.configurationDescriptor.nodeDefinition.inEnabled).length<=1}return!1}createNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges();this.dialog.open(Uo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleChainType:this.ruleChainType}}).afterClosed().subscribe(t=>{if(t){this.ruleChainCanvas.modelService.deselectAll();let n={ruleChainId:t.id,nodes:[],connections:[]},p=[],g=null,c=0,N=null,w=0;e.forEach(b=>{let D={type:b.component.clazz,name:b.name,configuration:k(b.configuration),additionalInfo:b.additionalInfo?k(b.additionalInfo):{},debugSettings:b.debugSettings,singletonMode:b.singletonMode,queueName:b.queueName};g===null?g=b.x:g=Math.min(g,b.x),N===null?N=b.y:N=Math.min(N,b.y),c=Math.max(c,b.x),w=Math.max(w,b.y),D.additionalInfo.layoutX=Math.round(b.x),D.additionalInfo.layoutY=Math.round(b.y),n.nodes.push(D),this.ruleChainCanvas.modelService.nodes.getConnectorsByType(b,M.rightConnectorType).forEach(V=>{let de=this.ruleChainCanvas.modelService.model.edges.filter(ue=>ue.source===V.id).filter(ue=>{let fe=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(ue.destination);return e.indexOf(fe)===-1});p=p.concat(de)})});let j=new Set;i.forEach(b=>{let D=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(b.source),q=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(b.destination);if(D.component.type!==L.INPUT){let V=e.indexOf(D),J=e.indexOf(q);if(V>-1&&J>-1){let de={fromIndex:V,toIndex:J};b.labels.forEach(ue=>{let fe=k(de);fe.type=ue,n.connections.push(fe)}),j.add(J)}}});let se=e.filter((b,D)=>!j.has(D)).filter(b=>b.component.configurationDescriptor.nodeDefinition.inEnabled),F=[];if(se.length){let b=se[0],D=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(b,M.leftConnectorType);if(D.length){let q=D[0],V=this.ruleChainCanvas.modelService.model.edges.filter(J=>J.destination===q.id);F=F.concat(V)}n.firstNodeIndex=e.indexOf(b)}p.forEach(b=>{let D=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(b.source),q=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(b.destination),V={type:nn,name:b.label,configuration:{},additionalInfo:{},singletonMode:!1};V.additionalInfo.layoutX=Math.round(q.x),V.additionalInfo.layoutY=Math.round(q.y),n.nodes.push(V);let J=e.indexOf(D),de=n.nodes.length-1,ue={fromIndex:J,toIndex:de};b.labels.forEach(fe=>{let at=k(ue);at.type=fe,n.connections.push(at)})});let ye=Math.round(g-375),he=Math.round(N-150);n.nodes.forEach(b=>{b.additionalInfo.layoutX-=ye,b.additionalInfo.layoutY-=he}),this.ruleChainService.saveRuleChainMetadata(n).subscribe(()=>{let b=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,tn),D=ie.get(b.type),q=D.icon,V=null;b.configurationDescriptor.nodeDefinition.icon&&(q=b.configurationDescriptor.nodeDefinition.icon),b.configurationDescriptor.nodeDefinition.iconUrl&&(V=b.configurationDescriptor.nodeDefinition.iconUrl);let J=(g+c)/2,de=(N+w)/2,ue=this.nextConnectorID+++"",fe=this.nextConnectorID+++"",at={name:t.name,component:b,id:"rule-chain-node-"+this.nextNodeID++,configuration:{ruleChainId:t.id.id},singletonMode:!1,x:Math.round(J),y:Math.round(de),nodeClass:D.nodeClass,icon:q,iconUrl:V,ruleChainType:this.ruleChainType,connectors:[{type:M.leftConnectorType,id:ue},{type:M.rightConnectorType,id:fe}]};this.ruleChainModel.nodes.push(at),F.forEach(Ee=>{Ee.destination=ue}),p.forEach(Ee=>{Ee.source=fe,Ee.labels=[Ee.label]}),e.forEach(Ee=>{this.ruleChainCanvas.modelService.nodes.delete(Ee)}),this.onModelChanged(),this.updateRuleNodesHighlight()})}})}onModelChanged(){this.isDirtyValue=!0,this.validate()}helpLinkIdForRuleNodeType(){let e=null;return this.editingRuleNode&&(e=this.editingRuleNode.component),Xt(e)}openNodeDetails(e){e.component.type!==L.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNodeLink=!1,this.editingRuleNodeLink=null,this.isEditingRuleNode=!0,this.editingRuleNodeIndex=this.ruleChainModel.nodes.indexOf(e),this.editingRuleNode=k(e,["component"]),setTimeout(()=>{this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine()},0))}openLinkDetails(e){let i=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source);i.component.type!==L.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNode=!1,this.editingRuleNode=null,this.editingRuleNodeLinkLabels=this.ruleChainService.getRuleNodeSupportedLinks(i.component),this.editingRuleNodeAllowCustomLabels=this.ruleChainService.ruleNodeAllowCustomLinks(i.component),this.editingRuleNodeSourceRuleChainId=this.ruleChainService.ruleNodeSourceRuleChainId(i.component,i.configuration),this.isEditingRuleNodeLink=!0,this.editingRuleNodeLinkIndex=this.ruleChainModel.edges.indexOf(e),this.editingRuleNodeLink=k(e),setTimeout(()=>{this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine()},0))}copyNode(e){this.itembuffer.copyRuleNodes([e],[])}copyRuleNodes(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),i=this.ruleChainCanvas.modelService.edges.getSelectedEdges(),t=[];i.forEach(n=>{let p=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(n.source),g=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(n.destination),c=p.component.type===L.INPUT,N=e.indexOf(p),w=e.indexOf(g);if((c||N>-1)&&w>-1){let j={isInputSource:c,fromIndex:N,toIndex:w,label:n.label,labels:n.labels};t.push(j)}}),this.itembuffer.copyRuleNodes(e,t)}pasteRuleNodes(e){let i=$(this.ruleChainCanvas.modelService.canvasHtmlElement),t,n;if(e){let g=i.offset();t=Math.round(e.clientX-g.left),n=Math.round(e.clientY-g.top)}else{let g=i.parent(),c=g.scrollTop();t=g.scrollLeft()+g.width()/2,n=c+g.height()/2}let p=this.itembuffer.pasteRuleNodes(t,n);if(p){this.ruleChainCanvas.modelService.deselectAll();let g=[];p.nodes.forEach(c=>{c.id="rule-chain-node-"+this.nextNodeID++;let N=c.component;N.configurationDescriptor.nodeDefinition.inEnabled&&c.connectors.push({type:M.leftConnectorType,id:this.nextConnectorID+++""}),N.configurationDescriptor.nodeDefinition.outEnabled&&c.connectors.push({type:M.rightConnectorType,id:this.nextConnectorID+++""}),g.push(c),this.ruleChainModel.nodes.push(c),this.ruleChainCanvas.modelService.nodes.select(c)}),p.connections.forEach(c=>{let N=g[c.fromIndex],w=g[c.toIndex];if((c.isInputSource||N)&&w){let j,U;if(c.isInputSource){j=this.inputConnectorId+"";let F=this.ruleChainModel.edges.find(ye=>ye.source===this.inputConnectorId+"");F&&this.ruleChainCanvas.modelService.edges.delete(F)}else{let F=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(N,M.rightConnectorType);F&&F.length&&(j=F[0].id)}let se=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(w,M.leftConnectorType);if(se&&se.length&&(U=se[0].id),j&&U){let F={source:j,destination:U,label:c.label,labels:c.labels};this.ruleChainModel.edges.push(F),this.ruleChainCanvas.modelService.edges.select(F)}}}),this.updateRuleNodesHighlight(),this.validate(),this.onModelChanged()}}onDetailsDrawerClosed(){this.onEditRuleNodeClosed(),this.onEditRuleNodeLinkClosed(),this.enableHotKeys=!0,this.updateErrorTooltips(!1)}onEditRuleNodeClosed(){this.editingRuleNode=null,this.isEditingRuleNode=!1}onEditRuleNodeLinkClosed(){this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1}onRevertRuleNodeEdit(){this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine();let e=this.ruleChainModel.nodes[this.editingRuleNodeIndex];this.editingRuleNode=k(e,["component"])}onRevertRuleNodeLinkEdit(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine();let e=this.ruleChainModel.edges[this.editingRuleNodeLinkIndex];this.editingRuleNodeLink=k(e)}onDebugEventSelected(e){let i=this.ruleNodeComponent.ruleNodeConfigComponent,t=i.definedConfigComponent;i.useDefinedDirective()&&t.hasScript&&t.testScript&&t.testScript(e)}onRuleNodeInit(){let e=this.ruleNodeComponent.ruleNodeConfigComponent.definedConfigComponent;this.ruleNodeComponent.ruleNodeConfigComponent.useDefinedDirective()&&e.hasScript?this.ruleNodeTestButtonLabel=e.testScriptLabel:this.ruleNodeTestButtonLabel=""}switchToFirstTab(){this.selectedRuleNodeTabIndex=0}saveRuleNode(){this.ruleNodeComponent.validate(),this.ruleNodeComponent.ruleNodeFormGroup.valid&&(this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine(),this.editingRuleNode.error&&delete this.editingRuleNode.error,this.ruleChainModel.nodes[this.editingRuleNodeIndex]=this.editingRuleNode,this.editingRuleNode=k(this.editingRuleNode,["component"]),this.onModelChanged(),this.updateRuleNodesHighlight())}saveRuleNodeLink(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine(),this.ruleChainModel.edges[this.editingRuleNodeLinkIndex]=this.editingRuleNodeLink,this.editingRuleNodeLink=k(this.editingRuleNodeLink),this.onModelChanged()}typeHeaderMouseEnter(e,i){let t=ie.get(i);this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+this.translate.instant(t.name)+'</div><div class="tb-node-details">'+this.translate.instant(t.details)+"</div></div></div>")}displayLibNodeDescriptionTooltip(e,i){this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+i.component.name+'</div><div class="tb-node-description">'+i.component.configurationDescriptor.nodeDefinition.description+'</div><div class="tb-node-details">'+i.component.configurationDescriptor.nodeDefinition.details+"</div></div></div>")}displayNodeDescriptionTooltip(e,i){if(!this.errorTooltips[i.id]){let t,n,p;i.component.type===L.INPUT?(t=this.translate.instant(ie.get(L.INPUT).name),n=this.translate.instant(ie.get(L.INPUT).details)):(t=i.name,n=this.translate.instant(ie.get(i.component.type).name)+" - "+i.component.name,i.additionalInfo&&(p=i.additionalInfo.description));let g='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+t+'</div><div class="tb-node-description">'+n+"</div>";p&&(g+='<div class="tb-node-details">'+p+"</div>"),g+="</div></div>",this.displayTooltip(e,g)}}destroyTooltips(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),$.tooltipster.instances().forEach(i=>{i.isErrorTooltip||i.destroy()})}updateRuleNodesHighlight(){for(let e of this.ruleChainModel.nodes)e.highlighted=!1;if(this.ruleNodeSearch){let e=this.ruleNodeSearch.toUpperCase(),i=this.ruleChainModel.nodes.filter(t=>t.name.toUpperCase().includes(e));if(i)for(let t of i)t.highlighted=!0}this.ruleChainCanvas&&this.ruleChainCanvas.modelService.detectChanges()}objectsSelected(){return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length>0||this.ruleChainCanvas.modelService.edges.getSelectedEdges().length>0}deleteSelected(){this.ruleChainCanvas.modelService.deleteSelected()}isDebugSettingsEnabled(){return typeof this.ruleChainModel.nodes.find(i=>i?.debugSettings&&this.isDebugSettingsActive(i.debugSettings))<"u"}resetDebugSettingsInAllNodes(){let e=!1;this.ruleChainModel.nodes.forEach(i=>{if(i.component.type!==L.INPUT){let t=i?.debugSettings&&this.isDebugSettingsActive(i.debugSettings);e=e||t,t&&(i.debugSettings={allEnabled:!1,failuresEnabled:!1,allEnabledUntil:0})}}),e&&this.onModelChanged()}isDebugSettingsActive(e){return e.allEnabled||e.failuresEnabled||e.allEnabledUntil>new Date().getTime()}validate(){setTimeout(()=>{this.isInvalid=!1,this.ruleChainModel.nodes.forEach(e=>{e.error&&(this.isInvalid=!0),this.updateNodeErrorTooltip(e)})},0)}saveRuleChain(){let e=new ti,i;return this.isImport?i=this.ruleChainService.saveRuleChain(this.ruleChain):i=H(this.ruleChain),i.subscribe(t=>{this.ruleChain=t;let n={ruleChainId:this.ruleChain.id,nodes:[],connections:[],version:t.version},p=[];this.ruleChainModel.nodes.forEach(c=>{if(c.component.type!==L.INPUT){let N={id:c.ruleNodeId,type:c.component.clazz,name:c.name,configurationVersion:$t(c.configurationVersion)?c.configurationVersion:c.component.configurationVersion,configuration:c.configuration,additionalInfo:c.additionalInfo?c.additionalInfo:{},debugSettings:c.debugSettings,singletonMode:c.singletonMode,queueName:c.queueName};N.additionalInfo.layoutX=Math.round(c.x),N.additionalInfo.layoutY=Math.round(c.y),n.nodes.push(N),p.push(c)}});let g=this.ruleChainModel.edges.find(c=>c.source===this.inputConnectorId+"");if(g){let c=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(g.destination);n.firstNodeIndex=p.indexOf(c)}this.ruleChainModel.edges.forEach(c=>{let N=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.source),w=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.destination);if(N.component.type!==L.INPUT){let j=p.indexOf(N),U=p.indexOf(w),se={fromIndex:j,toIndex:U};c.labels.forEach(F=>{let ye=k(se);ye.type=F,n.connections.push(ye)})}}),this.ruleChainService.saveRuleChainMetadata(n).pipe(ut(c=>c.status===fi.Conflict?this.ruleChainService.getRuleChainMetadata(n.ruleChainId.id):ii(()=>c))).subscribe(c=>{this.ruleChain.version=c.version,this.ruleChainMetaData=c,this.isImport?(this.isDirtyValue=!1,this.isImport=!1,this.ruleChainType!==ot.EDGE?this.router.navigateByUrl(`ruleChains/${this.ruleChain.id.id}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${this.ruleChain.id.id}`)):this.createRuleChainModel(),e.next()})}),e}reloadRuleChain(){this.ruleChainService.getRuleChain(this.ruleChain.id.id).subscribe(e=>{this.ruleChain=e,this.updateBreadcrumbs.emit(),this.ruleChainService.getRuleChainMetadata(this.ruleChain.id.id).subscribe(i=>{this.ruleChainMetaData=i,this.isDirtyValue=!1,this.createRuleChainModel()})})}revertRuleChain(){this.createRuleChainModel()}addRuleNode(e){e.configuration=k(e.component.configurationDescriptor.nodeDefinition.defaultConfiguration);let i=this.ruleChain.id?this.ruleChain.id.id:null;this.enableHotKeys=!1;let t=this.ruleChainType;this.dialog.open(jo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleNode:e,ruleChainId:i,ruleChainType:t}}).afterClosed().subscribe(n=>{n&&(n.id="rule-chain-node-"+this.nextNodeID++,n.connectors=[],n.component.configurationDescriptor.nodeDefinition.inEnabled&&n.connectors.push({id:this.nextConnectorID+++"",type:M.leftConnectorType}),n.component.configurationDescriptor.nodeDefinition.outEnabled&&n.connectors.push({id:this.nextConnectorID+++"",type:M.rightConnectorType}),this.ruleChainModel.nodes.push(n),this.onModelChanged(),this.updateRuleNodesHighlight()),this.enableHotKeys=!0})}addRuleNodeLink(e,i,t,n){return this.dialog.open(Go,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{link:e,labels:i,allowCustomLabels:t,sourceRuleChainId:n}}).afterClosed()}toggleVersionControl(e,i){e&&e.stopPropagation();let t=i._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let n=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,fn,"leftTop",!0,null,{detailsMode:!0,active:!0,singleEntityMode:!0,externalEntityId:this.ruleChain.externalId||this.ruleChain.id,entityId:this.ruleChain.id,entityName:this.ruleChain.name,onBeforeCreateVersion:()=>this.isDirty?this.saveRuleChain():H(null)},{},{},{},!0);n.tbComponentRef.instance.popoverComponent=n,n.tbComponentRef.instance.versionRestored.subscribe(()=>{this.reloadRuleChain()})}}updateNodeErrorTooltip(e){if(e.error){let i=$("#"+e.id),t=this.errorTooltips[e.id];if(!t||!i.hasClass("tooltipstered")){i.tooltipster({theme:"tooltipster-shadow",delay:0,animationDuration:0,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!1,tap:!1,scroll:!1},side:"top",trackOrigin:!0});let n='<div class="tb-rule-node-error-tooltip"><div id="tooltip-content"><div class="tb-node-details">'+e.error+"</div></div></div>",p=$(n);t=i.tooltipster("instance"),t.isErrorTooltip=!0,t.content(p),this.errorTooltips[e.id]=t}setTimeout(()=>{t.open()},0)}else this.errorTooltips[e.id]&&(this.errorTooltips[e.id].destroy(),delete this.errorTooltips[e.id])}updateErrorTooltips(e){for(let i of Object.keys(this.errorTooltips)){let t=this.errorTooltips[i];e?t.close():t.open()}}displayTooltip(e,i){this.destroyTooltips(),this.tooltipTimeout=setTimeout(()=>{let t=$(e.target);t.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0},side:"right",distance:12,trackOrigin:!0});let n=$(i),p=t.tooltipster("instance");p.content(n),p.open()},500)}};r.\u0275fac=function(i){return new(i||r)(C(Ce),C(gi),C(De),C(Ve),C(Si),C(Ue),C(rn),C(At),C(gt),C(Oe),C(je),C(yi),C(Ei),C(He))},r.\u0275cmp=P({type:r,selectors:[["tb-rulechain-page"]],viewQuery:function(i,t){if(i&1&&(B(fo,7),B(go,7),B(bo,5),B(In,5),B(Co,5),B(vo,5,wt)),i&2){let n;A(n=O())&&(t.ruleChainCanvas=n.first),A(n=O())&&(t.ruleChainMenuTrigger=n.first),A(n=O())&&(t.drawer=n.first),A(n=O())&&(t.ruleNodeComponent=n.first),A(n=O())&&(t.ruleNodeLinkComponent=n.first),A(n=O())&&(t.expansionPanels=n)}},hostVars:4,hostBindings:function(i,t){i&2&&zt("width",t.width)("height",t.height)},features:[ge],decls:67,vars:70,consts:[["cheatSheetComponent",""],["drawer",""],["ruleChainMenuTrigger","matMenuTrigger"],["ruleChainMenu","matMenu"],["ruleChainCanvas",""],["ruleNodeTypeExpansionPanels",""],["tbRuleNode",""],["eventsTab","matTab"],["tbRuleNodeLink",""],["versionControlButton",""],["tb-fullscreen","",1,"mat-content","tb-rulechain","flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"tb-rulechain-container","flex","flex-1","flex-col"],[1,"tb-rulechain-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","start",1,"tb-rulechain-library","mat-elevation-z4","flex","flex-col"],["color","primary",1,"tb-dark"],["class","flex-1",3,"ruleChainType","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"mat-toolbar-tools"],[1,"tb-appearance-transparent","flex-1"],["mat-icon-button","","matPrefix","","matTooltipPosition","above",1,"tb-small",3,"matTooltip"],["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matSuffix","","matTooltipPosition","above",1,"tb-small",3,"click","matTooltip"],[1,"tb-rulechain-library-panel-group"],["class","mat-elevation-z2",3,"expanded",4,"ngFor","ngForOf"],["mode","over","position","end",1,"tb-details-drawer",3,"closed","opened"],["class","flex-1",3,"headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm","closeDetails","toggleDetailsEditMode","applyDetails",4,"ngIf"],[1,"tb-rulechain-graph-content"],["color","primary","mat-mini-fab","","matTooltipPosition","above",1,"tb-library-node-btn",3,"click","matTooltip"],[1,"tb-library-node-btn-icon"],["color","primary","type","button","mat-mini-fab","","class","version-control-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button","tb-mat-40",3,"click","matTooltip"],[1,"tb-absolute-fill","tb-rulechain-graph",3,"tbcontextmenu"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[1,"tb-rule-chain-context-menu",3,"overlapTrigger"],["matMenuContent",""],["id","tb-rulchain-canvas","fitModelSizeByDefault","false",3,"modelChanged","model","selectedObjects","edgeStyle","automaticResize","nodeWidth","nodeHeight","dragAnimation","userCallbacks"],[1,"tb-footer-buttons","flex","flex-row","flex-wrap","items-end","justify-start"],["mat-fab","","color","accent","matTooltipPosition","above",1,"tb-btn-footer",3,"click","disabled","matTooltip"],[1,"flex-1",3,"ngModelChange","ruleChainType","disabled","ngModel"],[1,"mat-elevation-z2",3,"expanded"],["expandedHeight","48px",3,"mouseenter","mouseleave"],["translate","",1,"tb-panel-title"],["fitModelSizeByDefault","",3,"id","model","selectedObjects","automaticResize","userCallbacks","nodeWidth","nodeHeight","dropTargetId"],[1,"flex-1",3,"closeDetails","toggleDetailsEditMode","applyDetails","headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm"],[1,"details-buttons"],[3,"tb-help"],["mat-stretch-tabs","false",1,"tb-absolute-fill","tb-rulenode-details","flex-1",3,"selectedIndexChange","selectedIndex"],[3,"label"],[3,"initRuleNode","changeScript","ruleNode","ruleChainId","ruleChainType"],[3,"label",4,"ngIf"],[1,"tb-rule-node-help"],["id","tb-node-content",1,"mat-padding","flex","flex-col"],[1,"tb-node-title"],[1,"tb-node-description",3,"innerHtml"],[1,"tb-node-details",3,"innerHtml"],[3,"debugEventSelected","debugEventTypes","defaultEventType","active","tenantId","entityId","functionTestButtonLabel"],[1,"flex-1",3,"ngModelChange","ngModel","allowedLabels","allowCustom","sourceRuleChainId"],["color","primary","type","button","mat-mini-fab","","matTooltipPosition","above",1,"version-control-button",3,"click","matTooltip"],[1,"tb-rule-chain-context-menu-container",3,"mouseleave"],[4,"ngIf"],[3,"src",4,"ngIf"],[1,"flex-1"],[1,"tb-context-menu-title"],[1,"tb-context-menu-subtitle"],[4,"ngFor","ngForOf"],[3,"src"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["class","tb-alt-text",4,"ngIf"],["translate",""],[1,"tb-alt-text"]],template:function(i,t){if(i&1){let n=E();s(0,"div",10),I(1,"tb-hotkeys-cheatsheet",null,0),s(3,"section",11)(4,"div",12)(5,"mat-drawer-container",13)(6,"mat-drawer",14,1)(8,"mat-toolbar",15),S(9,_o,1,3,"tb-rule-chain-select",16),u(),s(10,"mat-toolbar")(11,"div",17)(12,"mat-form-field",18)(13,"button",19),m(14,"translate"),s(15,"mat-icon"),f(16,"search"),u()(),I(17,"input",20),m(18,"translate"),s(19,"button",21),m(20,"translate"),x("click",function(){return y(n),_(t.ruleNodeTypeSearch.reset())}),s(21,"mat-icon"),f(22,"close"),u()()()()(),s(23,"div",22),S(24,xo,9,12,"mat-expansion-panel",23),u()(),s(25,"mat-drawer",24),x("closed",function(){return y(n),_(t.onDetailsDrawerClosed())}),S(26,So,24,28,"tb-details-panel",25)(27,Io,6,12,"tb-details-panel",25),u(),s(28,"mat-drawer-content",26)(29,"button",27),m(30,"translate"),x("click",function(){y(n);let g=G(7);return _(g.toggle())}),s(31,"mat-icon",28),f(32,"chevron_right"),u()(),S(33,To,5,3,"button",29),s(34,"button",30),m(35,"translate"),x("click",function(){return y(n),_(t.isFullscreen=!t.isFullscreen)}),s(36,"mat-icon"),f(37),u()(),s(38,"div",31),x("tbcontextmenu",function(g){return y(n),_(t.openRuleChainContextMenu(g))}),I(39,"div",32,2),s(41,"mat-menu",33,3),S(43,Fo,10,8,"ng-template",34),u(),s(44,"fc-canvas",35,4),x("modelChanged",function(){return y(n),_(t.onModelChanged())}),u()(),s(46,"section",36)(47,"button",37),m(48,"translate"),m(49,"async"),x("click",function(){return y(n),_(t.deleteSelected())}),s(50,"mat-icon"),f(51,"delete"),u()(),s(52,"button",37),m(53,"translate"),m(54,"async"),x("click",function(){return y(n),_(t.resetDebugSettingsInAllNodes())}),s(55,"mat-icon"),f(56,"bug_report"),u()(),s(57,"button",37),m(58,"translate"),m(59,"async"),x("click",function(){return y(n),_(t.saveRuleChain())}),s(60,"mat-icon"),f(61,"done"),u()(),s(62,"button",37),m(63,"translate"),m(64,"async"),x("click",function(){return y(n),_(t.revertRuleChain())}),s(65,"mat-icon"),f(66,"close"),u()()()()()()()()}if(i&2){let n=G(2),p=G(7),g=G(42);d("fullscreen",t.isFullscreen)("tb-hotkeys",t.hotKeys)("cheatSheet",n),l(9),d("ngIf",!t.isImport),l(4),R("matTooltip",h(14,44,"rulenode.search")),l(4),R("placeholder",h(18,46,"rulenode.search")),d("formControl",t.ruleNodeTypeSearch),l(2),be("!hidden",t.ruleNodeTypeSearch.value===""),R("matTooltip",h(20,48,"action.clear-search")),l(5),d("ngForOf",t.ruleNodeTypesLibraryArray),l(),d("opened",t.isEditingRuleNode||t.isEditingRuleNodeLink),l(),d("ngIf",t.editingRuleNode),l(),d("ngIf",t.editingRuleNodeLink),l(2),R("matTooltip",h(30,50,p.opened?"rulenode.close-node-library":"rulenode.open-node-library")),l(2),be("tb-library-node-btn-icon-toggled",p.opened),l(2),d("ngIf",!t.isImport),l(),R("matTooltip",h(35,52,t.isFullscreen?"fullscreen.exit":"fullscreen.expand")),l(3),Z(t.isFullscreen?"fullscreen_exit":"fullscreen"),l(2),zt("left",t.ruleChainMenuPosition.x)("top",t.ruleChainMenuPosition.y),d("matMenuTriggerFor",g),l(2),d("overlapTrigger",!0),l(3),d("model",t.ruleChainModel)("selectedObjects",t.selectedObjects)("edgeStyle",t.flowchartConstants.curvedStyle)("automaticResize",!0)("nodeWidth",170)("nodeHeight",50)("dragAnimation",t.flowchartConstants.dragAnimationRepaint)("userCallbacks",t.editCallbacks),l(3),be("tb-hide",!t.objectsSelected()),R("matTooltip",h(48,54,"rulenode.delete-selected-objects")),d("disabled",h(49,56,t.isLoading$)),l(5),R("matTooltip",h(53,58,"rulenode.reset-debug-settings")),d("disabled",h(54,60,t.isLoading$)||!t.isDebugSettingsEnabled()),l(5),R("matTooltip",h(58,62,"action.apply-changes")),d("disabled",h(59,64,t.isLoading$)||t.isInvalid||!t.isDirtyValue&&!t.isImport),l(5),R("matTooltip",h(63,66,"action.decline-changes")),d("disabled",h(64,68,t.isLoading$)||!t.isDirtyValue)}},dependencies:[xt,W,Zi,sn,Pt,ln,Me,xi,_i,X,Fe,Le,Mi,wi,zi,Qi,Hi,it,Ui,Gi,ji,qi,Mt,Oi,Ki,Wi,wt,Ii,Ti,we,K,Di,kt,Ri,Xi,oe,pn,cn,gn,Pe,Jt,ne,an,Ni,z],styles:[`@charset "UTF-8";.tb-rulechain{width:100%;height:100%}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-body-wrapper{position:absolute;inset:49px 0 0}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-header .mat-mdc-tab{min-width:40px}.tb-rulechain button.mdc-icon-button.tb-fullscreen-button{position:absolute;top:10px;right:10px;background:#ccc;color:#666;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain button.mdc-fab.version-control-button{position:absolute;top:10px;right:60px;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain .tb-library-node-btn{width:20px;height:90px;position:absolute;top:50%;z-index:1000;opacity:.5;border-radius:0 15px 15px 0!important;transform:translateY(-50%)}.tb-rulechain .tb-library-node-btn-icon{transition:transform .4s!important}.tb-rulechain .tb-library-node-btn-icon-toggled{transform:rotate(180deg)}.tb-rulechain .tb-library-node-btn:before{width:20px;height:30px;top:-28px;left:0;content:"";pointer-events:none;border-radius:0 0 0 15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-library-node-btn:after{position:absolute;width:20px;height:30px;bottom:-28px;left:0;content:"";pointer-events:none;border-top-left-radius:15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-rulechain-library{z-index:1;width:250px;min-width:250px}.tb-rulechain .tb-rulechain-library .mat-toolbar{height:min-content;padding:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools{height:48px;padding:0 6px;font-size:14px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button{margin:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small{width:32px;height:32px;min-height:32px;padding:6px;line-height:20px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small .mat-icon{width:20px;min-width:20px;height:20px;min-height:20px;font-size:20px;line-height:20px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group{overflow-x:hidden;overflow-y:auto}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel{border-radius:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel:last-child{margin-bottom:5px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header{background:#e6e6e6}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header:hover{background:#dadada}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title{line-height:48px;height:48px;overflow:hidden}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .mat-icon{min-width:24px;margin:auto 8px auto 0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .tb-panel-title{min-width:130px;-webkit-user-select:none;user-select:none}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel.mat-expanded .mat-expansion-panel-header{border-bottom:1px solid;border-color:#909090}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel-body{padding:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .fc-canvas{background:#f9f9f9}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content{overflow:hidden;z-index:0}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content .tb-rulechain-graph{z-index:0;overflow:auto}.tb-rulechain .fc-canvas .fc-node{border-radius:8px}.tb-rulechain .fc-canvas .fc-node.fc-selected{z-index:2}.tb-rulechain .fc-canvas .fc-node.fc-selected:not(.fc-edit){margin:-3px;border:solid 3px #f00}.tb-rulechain .fc-canvas .fc-edit .fc-nodeedit,.tb-rulechain .fc-canvas .fc-edit .fc-nodedelete{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}.tb-rulechain .fc-canvas .fc-nodeopen{display:block;position:absolute;top:11px;right:10px;border:1px solid #FFFFFF;border-radius:4px;line-height:18px;height:22px;width:22px;background:#886cb1;color:#fff;text-align:center;cursor:pointer;box-sizing:border-box}.tb-rulechain .fc-canvas .fc-nodeopen .mat-icon{width:16px;min-width:16px;height:16px;min-height:16px;font-size:16px}.tb-rulechain .fc-canvas .fc-nodeopen:hover{background-color:#4e2d7e}.tb-rulechain .fc-canvas .fc-arrow-marker polygon{fill:gray;stroke:gray}.tb-rulechain .fc-canvas .fc-arrow-marker-selected polygon{fill:red;stroke:red}.tb-rulechain .fc-canvas .fc-edge{outline:none;stroke:gray}.tb-rulechain .fc-canvas .fc-edge.fc-selected{stroke:red}.tb-rulechain .fc-canvas .fc-edge.fc-hover{stroke:gray}.tb-rulechain .fc-canvas .edge-endpoint{fill:gray}.tb-rulechain .fc-canvas .fc-edge-label{opacity:1!important}.tb-rulechain .fc-canvas .fc-edge-label:focus{outline:0}.tb-rulechain .fc-canvas .fc-edge-label.fc-selected .fc-edge-label-text span{color:#fff!important;background-color:red!important;border:solid #f00!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text{font-size:14px!important;font-weight:600!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text span{background-color:#fff!important;color:#003a79!important;border:solid 2px #003a79!important}.tb-rule-node-tooltip,.tb-rule-node-help{color:#333}.tb-rule-node-tooltip{max-width:300px;font-size:14px}.tb-rule-node-tooltip.tb-lib-tooltip{width:300px}.tb-rule-node-help{font-size:16px}.tb-rule-node-error-tooltip{font-size:16px;color:#ea0d0d}.tb-rule-node-tooltip #tb-node-content .tb-node-title,.tb-rule-node-error-tooltip #tb-node-content .tb-node-title,.tb-rule-node-help #tb-node-content .tb-node-title{font-weight:600}.tb-rule-node-tooltip #tb-node-content .tb-node-description,.tb-rule-node-error-tooltip #tb-node-content .tb-node-description,.tb-rule-node-help #tb-node-content .tb-node-description{font-style:italic;color:#555}.tb-rule-node-tooltip #tb-node-content .tb-node-details,.tb-rule-node-error-tooltip #tb-node-content .tb-node-details,.tb-rule-node-help #tb-node-content .tb-node-details{padding-top:10px;padding-bottom:10px}.tb-rule-node-tooltip #tb-node-content code,.tb-rule-node-error-tooltip #tb-node-content code,.tb-rule-node-help #tb-node-content code{padding:0 3px 2px;margin:1px;font-size:12px;color:#ad1625;white-space:nowrap;background-color:#f7f7f9;border:1px solid #e1e1e8;border-radius:2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel{min-width:320px;max-height:404px;border-radius:8px;margin-left:-20px}.tb-rule-chain-context-menu.mat-mdc-menu-panel.mat-menu-below{margin-top:-60px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content{padding:0;display:flex;flex-direction:column}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content .tb-rule-chain-context-menu-container{pointer-events:auto;padding:0 0 8px;display:flex;flex-direction:column;overflow-y:auto}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header{display:flex;box-sizing:content-box;flex-direction:row;height:36px;min-height:36px;padding:8px 5px 5px;font-size:14px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-filter-type{background-color:#f1e861}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-enrichment-type{background-color:#cdf14e}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-transformation-type{background-color:#79cef1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-action-type{background-color:#f1928f}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-external-type{background-color:#fbc766}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-flow-type{background-color:#d6c4f1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-unknown-type{background-color:#f16c29}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-rulechain-header,.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-link-header{background-color:#aac7e4}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .mat-icon{margin:auto 10px auto 2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-title{font-weight:500;line-height:normal}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-subtitle{font-size:12px;line-height:normal}
`],encapsulation:2});let o=r;return o})(),Go=(()=>{let r=class r extends Dt{constructor(e,i,t,n,p,g){super(e,i,p),this.store=e,this.router=i,this.data=t,this.errorStateMatcher=n,this.dialogRef=p,this.fb=g,this.submitted=!1,this.link=this.data.link,this.labels=this.data.labels,this.allowCustomLabels=this.data.allowCustomLabels,this.sourceRuleChainId=this.data.sourceRuleChainId,this.ruleNodeLinkFormGroup=this.fb.group({link:[k(this.link),[Y.required]]})}ngOnInit(){}isErrorState(e,i){let t=this.errorStateMatcher.isErrorState(e,i),n=!!(e&&e.invalid&&this.submitted);return t||n}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e=this.ruleNodeLinkFormGroup.get("link").value;this.link=Je(Je({},this.link),e),this.dialogRef.close(this.link)}};r.\u0275fac=function(i){return new(i||r)(C(Ce),C(De),C(Tt),C(Se,4),C(It),C(le))},r.\u0275cmp=P({type:r,selectors:[["tb-add-rule-node-link-dialog"]],features:[ee([{provide:Se,useExisting:r}]),ge],decls:24,vars:23,consts:[[2,"width","480px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["required","","formControlName","link",3,"allowedLabels","allowCustom","sourceRuleChainId"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,t){i&1&&(s(0,"form",0),x("ngSubmit",function(){return t.add()}),s(1,"mat-toolbar",1)(2,"h2",2),f(3,"rulenode.add-link"),u(),I(4,"span",3)(5,"div",4),s(6,"button",5),x("click",function(){return t.cancel()}),s(7,"mat-icon",6),f(8,"close"),u()()(),S(9,Vo,1,0,"mat-progress-bar",7),m(10,"async"),s(11,"div",8)(12,"fieldset",9),m(13,"async"),I(14,"tb-rule-node-link",10),u()(),s(15,"div",11)(16,"button",12),m(17,"async"),x("click",function(){return t.cancel()}),f(18),m(19,"translate"),u(),s(20,"button",13),m(21,"async"),f(22),m(23,"translate"),u()()()),i&2&&(d("formGroup",t.ruleNodeLinkFormGroup),l(5),d("tb-help","ruleEngine"),l(4),d("ngIf",h(10,11,t.isLoading$)),l(3),d("disabled",h(13,13,t.isLoading$)),l(2),d("allowedLabels",t.labels)("allowCustom",t.allowCustomLabels)("sourceRuleChainId",t.sourceRuleChainId),l(2),d("disabled",h(17,15,t.isLoading$)),l(2),T(" ",h(19,17,"action.cancel")," "),l(2),d("disabled",h(21,19,t.isLoading$)||t.ruleNodeLinkFormGroup.invalid||!t.ruleNodeLinkFormGroup.dirty),l(2),T(" ",h(23,21,"action.add")," "))},dependencies:[W,Pt,me,Me,X,Vt,it,Rt,Et,Te,K,te,ke,re,ae,oe,Jt,ne,z],styles:['@charset "UTF-8";[_nghost-%COMP%]     tb-rule-node-link form{overflow:hidden!important}']});let o=r;return o})(),jo=(()=>{let r=class r extends Dt{constructor(e,i,t,n,p){super(e,i,p),this.store=e,this.router=i,this.data=t,this.errorStateMatcher=n,this.dialogRef=p,this.submitted=!1,this.ruleNode=this.data.ruleNode,this.ruleChainId=this.data.ruleChainId,this.ruleChainType=this.data.ruleChainType}ngOnInit(){}isErrorState(e,i){let t=this.errorStateMatcher.isErrorState(e,i),n=!!(e&&e.invalid&&this.submitted);return t||n}helpLinkIdForRuleNodeType(){return Xt(this.ruleNode.component)}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0,this.ruleNodeDetailsComponent.validate(),this.ruleNodeDetailsComponent.ruleNodeFormGroup.valid&&this.dialogRef.close(this.ruleNode)}};r.\u0275fac=function(i){return new(i||r)(C(Ce),C(De),C(Tt),C(Se,4),C(It))},r.\u0275cmp=P({type:r,selectors:[["tb-add-rule-node-dialog"]],viewQuery:function(i,t){if(i&1&&B(In,7),i&2){let n;A(n=O())&&(t.ruleNodeDetailsComponent=n.first)}},features:[ee([{provide:Se,useExisting:r}]),ge],decls:24,vars:20,consts:[["tbRuleNode",""],[1,"dialog-container",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],["isAdd","",3,"ruleNode","ruleChainId","ruleChainType"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,t){if(i&1){let n=E();s(0,"form",1),x("ngSubmit",function(){return y(n),_(t.add())}),s(1,"mat-toolbar",2)(2,"h2",3),f(3,"rulenode.add"),u(),s(4,"span",4),f(5),u(),I(6,"div",5),s(7,"button",6),x("click",function(){return y(n),_(t.cancel())}),s(8,"mat-icon",7),f(9,"close"),u()()(),S(10,Po,1,0,"mat-progress-bar",8),m(11,"async"),s(12,"div",9),I(13,"tb-rule-node",10,0),u(),s(15,"div",11)(16,"button",12),m(17,"async"),x("click",function(){return y(n),_(t.cancel())}),f(18),m(19,"translate"),u(),s(20,"button",13),m(21,"async"),f(22),m(23,"translate"),u()()()}if(i&2){let n=G(14);l(5),T(": ",t.ruleNode.component.name,""),l(),d("tb-help",t.helpLinkIdForRuleNodeType()),l(4),d("ngIf",h(11,10,t.isLoading$)),l(3),d("ruleNode",t.ruleNode)("ruleChainId",t.ruleChainId)("ruleChainType",t.ruleChainType),l(3),d("disabled",h(17,12,t.isLoading$)),l(2),T(" ",h(19,14,"action.cancel")," "),l(2),d("disabled",h(21,16,t.isLoading$)||n.ruleNodeFormGroup.invalid||!n.ruleNodeFormGroup.dirty),l(2),T(" ",h(23,18,"action.add")," ")}},dependencies:[W,Pt,me,Me,X,Vt,it,Rt,Et,Te,te,Kt,oe,Pe,ne,z],styles:['@charset "UTF-8";[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:750px!important;max-width:750px!important}[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:8px}@media screen and (max-width: 959px){[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:100%!important}}']});let o=r;return o})(),Uo=(()=>{let r=class r extends Dt{constructor(e,i,t,n,p,g,c){super(e,i,c),this.store=e,this.router=i,this.data=t,this.errorStateMatcher=n,this.fb=p,this.ruleChainService=g,this.dialogRef=c,this.submitted=!1}ngOnInit(){this.createNestedRuleChainFormGroup=this.fb.group({name:["",[Y.required,Y.maxLength(255)]],additionalInfo:this.fb.group({description:[""]})})}isErrorState(e,i){let t=this.errorStateMatcher.isErrorState(e,i),n=!!(e&&e.invalid&&this.submitted);return t||n}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e={name:this.createNestedRuleChainFormGroup.get("name").value,debugMode:!1,type:this.data.ruleChainType,additionalInfo:{description:this.createNestedRuleChainFormGroup.get("additionalInfo").get("description").value}};this.ruleChainService.saveRuleChain(e).subscribe(i=>{this.dialogRef.close(i)})}};r.\u0275fac=function(i){return new(i||r)(C(Ce),C(De),C(Tt),C(Se,4),C(le),C(Ve),C(It))},r.\u0275cmp=P({type:r,selectors:[["tb-create-nested-rulechain-dialog"]],features:[ee([{provide:Se,useExisting:r}]),ge],decls:34,vars:21,consts:[[2,"min-width","650px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[1,"mat-padding",3,"formGroup"],[3,"disabled"],[1,"mat-block","flex-1"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","2"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(i,t){i&1&&(s(0,"form",0),x("ngSubmit",function(){return t.add()}),s(1,"mat-toolbar",1)(2,"h2",2),f(3,"rulenode.create-nested-rulechain"),u(),I(4,"span",3),s(5,"button",4),x("click",function(){return t.cancel()}),s(6,"mat-icon",5),f(7,"close"),u()()(),S(8,Bo,1,0,"mat-progress-bar",6),m(9,"async"),s(10,"div",7)(11,"form",8)(12,"fieldset",9),m(13,"async"),s(14,"mat-form-field",10)(15,"mat-label",2),f(16,"rulechain.name"),u(),I(17,"input",11),S(18,Ao,3,3,"mat-error",12)(19,Oo,3,3,"mat-error",12),u(),s(20,"div",13)(21,"mat-form-field",14)(22,"mat-label",2),f(23,"rulechain.description"),u(),I(24,"textarea",15),u()()()()(),s(25,"div",16)(26,"button",17),m(27,"async"),x("click",function(){return t.cancel()}),f(28),m(29,"translate"),u(),s(30,"button",18),m(31,"async"),f(32),m(33,"translate"),u()()()),i&2&&(l(8),d("ngIf",h(9,9,t.isLoading$)),l(3),d("formGroup",t.createNestedRuleChainFormGroup),l(),d("disabled",h(13,11,t.isLoading$)),l(6),d("ngIf",t.createNestedRuleChainFormGroup.get("name").hasError("required")),l(),d("ngIf",t.createNestedRuleChainFormGroup.get("name").hasError("maxlength")),l(7),d("disabled",h(27,13,t.isLoading$)),l(2),T(" ",h(29,15,"action.cancel")," "),l(2),d("disabled",h(31,17,t.isLoading$)||t.createNestedRuleChainFormGroup.invalid||!t.createNestedRuleChainFormGroup.dirty),l(2),T(" ",h(33,19,"action.create")," "))},dependencies:[W,me,Me,X,Vt,Fe,Le,ze,Ft,it,Rt,Et,Te,we,K,te,ke,Kt,re,ae,Lt,oe,ne,z],encapsulation:2});let o=r;return o})();export{Cn as a,_n as b,Pe as c,Sn as d,Jt as e,as as f,Go as g,jo as h,Uo as i};
