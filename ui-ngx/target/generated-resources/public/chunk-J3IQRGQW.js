import{f as vo}from"./chunk-573O3SQ7.js";import{a as Ee,b as Vt,c as jf,d as Lf,e as Gf,f as Uf,g as Ps,h as As,i as Ns,j as Id}from"./chunk-EZYPYOV3.js";import{$ as Sd,A as An,Aa as kf,B as lf,Ba as Of,C as Ss,Ca as xd,D as mf,Da as Bf,E as ai,Ea as Ms,F as pf,G as Ts,Ga as Ma,H as ri,Ha as Ed,I as df,Ia as lo,J as cf,Ja as Ds,K as uf,Ka as Rf,L as ff,La as Vf,M as gf,Ma as Fs,N as hf,Na as ye,O as bf,P as vf,Q as ki,R as xs,S as Oi,T as Es,U as Ia,V as yf,W as _d,X as Cd,Y as er,Z as _f,_ as Cf,a as $0,aa as Sf,b as Za,ba as Tf,c as J0,ca as zi,d as xa,da as Ai,e as Pn,ea as yi,f as Q0,fa as _i,g as Y0,h as K0,i as X0,ia as xf,j as Z0,ja as Ef,k as ef,ka as If,l as yd,la as Is,m as tf,ma as wf,n as nf,na as Mf,o as of,oa as Df,pa as Ff,qa as Pf,ra as ws,s as af,sa as Af,t as rf,ta as Nf,u as Ea,ua as Td,v as sf,va as wa,wa as ao,x as Ve,xa as ro,y as oi,ya as so,z as st,za as Ci}from"./chunk-DKZ3CIFV.js";import"./chunk-UKY6W7HD.js";import"./chunk-TOCE5N7N.js";import"./chunk-YBTMWC55.js";import"./chunk-6OEMGNUI.js";import"./chunk-K5GEWY3U.js";import"./chunk-FTP7ICHS.js";import{a as yt,b as Cs}from"./chunk-WM2BVUPA.js";import{$d as es,$i as l0,$k as ya,Aa as zt,Af as Lu,Ah as ss,Ak as oo,Al as R0,B as Xc,Bf as ld,Bk as bs,Bl as bd,Bm as ae,Cf as Gu,Ch as ca,Cl as vd,Dd as Xr,Df as Uu,Dj as y0,Dl as Ca,Ea as oa,Ec as Dn,Ed as ln,Eh as io,El as Sa,Em as Hi,Fl as V0,Fm as pn,Ha as Wr,Hg as md,Hj as _0,Hk as P0,Hm as z0,Ic as Tu,Ig as is,Ih as e0,Jg as Ka,Ji as o0,Jk as vs,Kb as Qr,Kg as ns,Kh as t0,Ki as dd,Kl as j0,L as ta,Lb as Yr,Li as a0,Lj as ga,Mb as St,Mg as Hu,Mh as i0,Na as be,Nb as aa,Nf as Wu,Ng as Wi,Oc as xu,P as Mi,Pl as Ta,Qa as sn,Qh as mn,Qj as C0,Ql as Qt,R as Tn,Rj as S0,Rl as ys,Sa as lu,Sc as Di,Sj as T0,Sl as L0,T as ve,Ta as mu,Ti as Xa,Tj as x0,Uc as Eu,Uj as E0,Va as Hr,Vg as zu,Vi as Yi,Vj as ha,Vl as G0,Wc as Fi,We as ts,Wg as $u,Wi as ms,Wl as U0,X as Zc,Xa as zr,Xe as Ei,Xg as Ju,Xi as ps,Xl as _s,Ya as $r,Yc as Kr,Ye as od,Yg as Qu,Yi as r0,Yl as q0,Zb as yu,Zi as cd,Zj as ba,_ as bi,_d as ma,_i as s0,_k as va,aa as di,ab as to,ae as qi,af as Bu,aj as m0,al as _a,be as Nu,bf as Ru,bj as p0,cb as du,cc as _u,ce as ku,cf as da,cj as ds,da as nd,db as cu,dj as d0,ea as eu,ee as Ou,ef as Vu,eh as si,ei as n0,ej as c0,fb as uu,fd as Iu,fj as u0,fk as I0,g as Mt,ga as tu,gb as fu,gd as Jt,hb as gu,hd as wu,hk as w0,i as tn,ia as iu,id as Mu,ij as f0,ja as nu,ka as au,kc as $t,kd as Du,l as eo,ld as Fu,lf as ju,lj as g0,m as Li,ma as ru,mb as ht,mc as Cu,mh as os,mj as h0,n as nn,nh as Yu,ni as kt,o as Yc,oc as Su,oh as Ku,oi as ua,oj as no,p as on,pf as ad,ph as vi,pi as K,q as Ur,qi as pd,rb as En,rf as rd,rj as us,rl as A0,sb as In,sh as Xu,si as qe,sj as Pi,sk as M0,sl as N0,t as Wt,ta as Zt,tc as ra,te as xi,ti as fa,tl as fd,u as Kc,ua as ci,ub as wn,uh as as,ui as Le,uj as ud,uk as D0,ul as k0,va as ni,vb as Mn,ve as pa,vh as fn,vi as Dt,vj as fs,vl as gd,wa as su,wb as vu,wh as Fn,wk as F0,wl as O0,xa as qr,xb as Jr,xh as Zu,xj as gs,xl as hd,ya as ui,yd as sa,yf as bo,yh as rs,yj as b0,yl as B0,ym as W0,zf as sd,zj as v0,zk as hs,zm as H0}from"./chunk-OROXDDCC.js";import{F as it,G as At,I as je,L as dt,M as Nt,P as nt,U as Zn,V as Ue,Y as at,e as Ri,ea as la,fa as qu,g as pe,ga as ls,h as gc,ha as cs,j as V,l as Cn,q as Nc,u as kc,w as Qo,y as E}from"./chunk-6ASH6TVK.js";import{b as ze,c as Qc,d as hu,e as bu,h as ei,j as Pu,n as Au,w as Zr}from"./chunk-JRGJBYKK.js";import{A as Oc,C as Or,D as Bc,Dc as an,E as Rc,Ec as Ui,Fc as fe,G as Yo,Ga as Lg,I as ji,Ic as rn,J as Pt,Jc as na,Lc as ct,Mc as ce,Nb as gt,Rc as Se,Sc as Fe,Tc as Kt,Ub as te,Vb as ea,Vc as Xt,Ya as Xn,Yb as Ie,Yc as de,ad as vt,bd as pu,cc as re,fc as ot,gc as he,hc as Ht,jc as T,mc as W,nc as X,pc as xn,qc as ia,sa as Jc,sc as Qe,t as kr,tc as ue,uc as Gi,vc as ii,wc as ne,x as Sn,xc as bt,yb as en,yc as ou,zc as le}from"./chunk-K2POHFPS.js";import{a as Xo,k as Gr}from"./chunk-JIUP6ZA4.js";import{A as R,E as Br,G as Ko,I as Vc,J as jc,L as Ya,M as Lc,Md as jr,O as Gc,Od as Ti,Pd as Zo,Ud as Lr,_a as Hc,a as Ne,aa as Uc,ba as qc,bd as zc,ca as Rr,he as $c,ic as Vr,jc as It,m as A,ma as Wc,n as qt,y as ee,z as J}from"./chunk-7OOXQFUB.js";import{Aa as On,B as vc,Ba as Be,C as Qi,Da as $o,Eb as Bn,F as yc,Fb as Fc,Ib as Qa,Ja as wc,L as _c,M as gi,Mb as Pc,N as hi,O as Fr,P as Pr,Q as Wo,R as Ho,Rb as Ac,T as Cc,U as Sc,X as Ar,Xa as Mc,_a as Tt,ab as Nr,c as Uo,g as Ae,gb as Jo,h as qo,i as hc,ib as Dc,j as Vi,k as Mr,l as Yn,m as Dr,ma as zo,n as Kn,o as bc,pa as Tc,q as O,ra as xc,s as Ge,t as tt,x as wi,ya as Ec,za as Ic}from"./chunk-2KNKNWMU.js";import{f as wr,h as pi}from"./chunk-LKJAU4TK.js";import{$c as Ja,Ac as r,Bc as g,C as rt,Cc as Lt,D as ic,Dc as Gt,E as _t,Ea as Re,Ec as Rt,Ee as Er,Fa as Te,Fc as L,Fe as Ir,Ga as H,Ic as C,Id as Je,J as jt,Jb as zn,Kb as $n,Kc as y,Lc as Lo,Ma as P,Mc as Jn,N as nc,Na as Ut,Nc as x,Oc as ho,P as oc,Pb as a,Qb as h,Rb as mc,Rc as we,Rd as Go,S as Hn,Sc as Me,Sd as uc,Ta as F,Tc as De,Ua as z,Va as _r,Vb as bn,Wb as Zi,X as ac,Xc as q,Yc as p,Z as mi,Zc as B,_c as b,ad as Xe,bb as Vo,bd as Ze,cb as I,cc as G,cd as et,da as yr,db as w,dd as He,ec as jo,fd as dc,g as Ft,ga as rc,gd as Q,hd as Bt,ic as v,id as pt,ie as xe,jb as ft,jd as Sr,je as U,kd as vn,ke as yn,lb as wt,le as _n,mb as Cr,nc as m,nd as c,oc as Bi,od as u,oe as Qn,pc as j,pd as Yt,pe as me,q as Bo,qa as sc,qb as hn,qd as cc,qe as fc,r as Ro,rc as id,re as Tr,sa as lc,sc as pc,sd as Et,se as Oe,te as xr,ua as go,ue as oe,v as $a,va as Xi,w as Ct,wa as mt,x as vr,ya as Ot,zc as s}from"./chunk-YRZDTKHG.js";import{a as Ce,b as Ji,d as td,j as S}from"./chunk-Z4H5XVQJ.js";S();S();S();S();function Ug(i,n){i&1&&g(0,"mat-progress-bar",31)}function qg(i,n){i&1&&g(0,"div",32)}function Wg(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.mail-from-required")," "))}function Hg(i,n){if(i&1&&(s(0,"mat-option",25),p(1),r()),i&2){let l,e=n.$implicit,o=y();m("value",e),a(),b(" ",((l=o.templates.get(e))==null?null:l.name)||"Custom"," ")}}function zg(i,n){if(i&1&&(s(0,"mat-option",25),p(1),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l.toUpperCase()," ")}}function $g(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.smtp-host-required")," "))}function Jg(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.smtp-port-required")," "))}function Qg(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.smtp-port-invalid")," "))}function Yg(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.timeout-required")," "))}function Kg(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.timeout-invalid")," "))}function Xg(i,n){if(i&1&&(s(0,"mat-option",25),p(1),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l," ")}}function Zg(i,n){if(i&1&&(s(0,"mat-form-field",44)(1,"mat-label",12),p(2,"admin.tls-version"),r(),s(3,"mat-select",45),v(4,Xg,2,2,"mat-option",16),r()()),i&2){let l=y(2);a(4),m("ngForOf",l.tlsVersions)}}function eh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.proxy-host-required")," "))}function th(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.proxy-port-required")," "))}function ih(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.proxy-port-range")," "))}function nh(i,n){if(i&1&&(s(0,"div")(1,"div",46)(2,"mat-form-field",35)(3,"mat-label",12),p(4,"admin.proxy-host"),r(),g(5,"input",47),v(6,eh,3,3,"mat-error",14),r(),s(7,"mat-form-field",37)(8,"mat-label",12),p(9,"admin.proxy-port"),r(),g(10,"input",48),v(11,th,3,3,"mat-error",14)(12,ih,3,3,"mat-error",14),r()(),s(13,"div",49)(14,"mat-form-field",44)(15,"mat-label",12),p(16,"admin.proxy-user"),r(),g(17,"input",50),r(),s(18,"mat-form-field",44)(19,"mat-label",12),p(20,"admin.proxy-password"),r(),g(21,"input",51)(22,"tb-toggle-password",52),r()()()),i&2){let l=y(2);a(6),m("ngIf",l.mailSettings.get("proxyHost").hasError("required")),a(5),m("ngIf",l.mailSettings.get("proxyPort").hasError("required")),a(),m("ngIf",l.mailSettings.get("proxyPort").hasError("pattern")||l.mailSettings.get("proxyPort").hasError("min")||l.mailSettings.get("proxyPort").hasError("max"))}}function oh(i,n){if(i&1&&(s(0,"mat-form-field",11)(1,"mat-label",12),p(2,"admin.smtp-protocol"),r(),s(3,"mat-select",33),v(4,zg,2,2,"mat-option",16),r()(),s(5,"div",34)(6,"mat-form-field",35)(7,"mat-label",12),p(8,"admin.smtp-host"),r(),g(9,"input",36),v(10,$g,3,3,"mat-error",14),r(),s(11,"mat-form-field",37)(12,"mat-label",12),p(13,"admin.smtp-port"),r(),g(14,"input",38,0),s(16,"mat-hint",39),p(17),r(),v(18,Jg,3,3,"mat-error",14)(19,Qg,3,3,"mat-error",14),r()(),s(20,"mat-form-field",11)(21,"mat-label",12),p(22,"admin.timeout-msec"),r(),g(23,"input",40,1),s(25,"mat-hint",39),p(26),r(),v(27,Yg,3,3,"mat-error",14)(28,Kg,3,3,"mat-error",14),r(),s(29,"mat-slide-toggle",41),p(30),c(31,"translate"),r(),v(32,Zg,5,1,"mat-form-field",42),s(33,"mat-slide-toggle",43),p(34),c(35,"translate"),r(),v(36,nh,23,3,"div",14)),i&2){let l=q(15),e=q(24),o=y();a(4),m("ngForOf",o.smtpProtocols),a(6),m("ngIf",o.mailSettings.get("smtpHost").hasError("required")),a(7),b("",(l.value==null?null:l.value.length)||0,"/5"),a(),m("ngIf",o.mailSettings.get("smtpPort").hasError("required")),a(),m("ngIf",o.mailSettings.get("smtpPort").hasError("pattern")||o.mailSettings.get("smtpPort").hasError("maxlength")),a(7),b("",(e.value==null?null:e.value.length)||0,"/6"),a(),m("ngIf",o.mailSettings.get("timeout").hasError("required")),a(),m("ngIf",o.mailSettings.get("timeout").hasError("pattern")||o.mailSettings.get("timeout").hasError("maxlength")),a(2),b(" ",u(31,12,"admin.enable-tls")," "),a(2),m("ngIf",o.mailSettings.get("enableTls").value),a(2),b(" ",u(35,14,"admin.enable-proxy")," "),a(2),m("ngIf",o.mailSettings.get("enableProxy").value)}}function ah(i,n){if(i&1&&(s(0,"div",53),g(1,"div",54),r()),i&2){let l=y();a(),m("tb-help",l.helpLink)}}function rh(i,n){i&1&&(s(0,"mat-checkbox",57),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.change-password")," "))}function sh(i,n){i&1&&(s(0,"mat-form-field",11)(1,"mat-label",12),p(2,"common.password"),r(),g(3,"input",58),c(4,"translate"),g(5,"tb-toggle-password",52),r()),i&2&&(a(3),x("placeholder",u(4,1,"common.enter-password")))}function lh(i,n){if(i&1&&(s(0,"section"),v(1,rh,3,3,"mat-checkbox",55)(2,sh,6,3,"mat-form-field",56),r()),i&2){let l=y();a(),m("ngIf",l.showChangePassword),a(),m("ngIf",l.mailSettings.get("changePassword").value||!l.showChangePassword)}}function mh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-id-required")," "))}function ph(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-id-max-length")," "))}function dh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-secret-required")," "))}function ch(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-secret-max-length")," "))}function uh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.microsoft-tenant-id-required")," "))}function fh(i,n){if(i&1&&(s(0,"mat-form-field",44)(1,"mat-label",12),p(2,"admin.oauth2.microsoft-tenant-id"),r(),g(3,"input",72),v(4,uh,3,3,"mat-error",14),r()),i&2){let l=y(2);a(4),m("ngIf",l.mailSettings.get("providerTenantId").hasError("required"))}}function gh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.access-token-uri-required")," "))}function hh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function bh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.access-token-uri-required")," "))}function vh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function yh(i,n){if(i&1){let l=L();s(0,"div",49)(1,"mat-form-field",44)(2,"mat-label",12),p(3,"admin.oauth2.authorization-uri"),r(),g(4,"input",73),s(5,"button",74),C("click",function(){I(l);let o=y(2);return w(o.toggleEditMode("authUri"))}),s(6,"mat-icon",75),p(7,"create"),r()(),v(8,gh,3,3,"mat-error",14)(9,hh,3,3,"mat-error",14),r(),s(10,"mat-form-field",44)(11,"mat-label",12),p(12,"admin.oauth2.token-uri"),r(),g(13,"input",76),s(14,"button",74),C("click",function(){I(l);let o=y(2);return w(o.toggleEditMode("tokenUri"))}),s(15,"mat-icon",75),p(16,"create"),r()(),v(17,bh,3,3,"mat-error",14)(18,vh,3,3,"mat-error",14),r()(),g(19,"tb-string-items-list",77),c(20,"translate"),c(21,"translate")}if(i&2){let l=y(2);a(8),m("ngIf",l.mailSettings.get("authUri").hasError("required")),a(),m("ngIf",l.mailSettings.get("authUri").hasError("pattern")),a(8),m("ngIf",l.mailSettings.get("tokenUri").hasError("required")),a(),m("ngIf",l.mailSettings.get("tokenUri").hasError("pattern")),a(),x("label",u(20,6,"admin.oauth2.scope")),x("requiredText",u(21,8,"admin.oauth2.scope-required"))}}function _h(i,n){if(i&1&&(s(0,"mat-option",25),p(1),c(2,"translate"),c(3,"uppercase"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(3,4,u(2,2,e.domainSchemaTranslations.get(l)))," ")}}function Ch(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.error-verification-url")," "))}function Sh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.domain-name-max-length")," "))}function Th(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.domain-name-unique")," "))}function xh(i,n){if(i&1&&(s(0,"section")(1,"div",49)(2,"mat-form-field",44)(3,"mat-label",12),p(4,"admin.oauth2.client-id"),r(),g(5,"input",59),v(6,mh,3,3,"mat-error",14)(7,ph,3,3,"mat-error",14),r(),s(8,"mat-form-field",44)(9,"mat-label",12),p(10,"admin.oauth2.client-secret"),r(),g(11,"input",60),v(12,dh,3,3,"mat-error",14)(13,ch,3,3,"mat-error",14),r()(),v(14,fh,5,1,"mat-form-field",42),s(15,"mat-expansion-panel",61)(16,"mat-expansion-panel-header")(17,"mat-panel-description",62),p(18," tenant-profile.advanced-settings "),r()(),v(19,yh,22,10,"ng-template",19),r(),s(20,"fieldset",20)(21,"legend",21),p(22,"admin.oauth2.redirect-uri"),r(),s(23,"div",63)(24,"div",64)(25,"div",65)(26,"mat-form-field",66)(27,"mat-label",12),p(28,"admin.oauth2.protocol"),r(),s(29,"mat-select",67),v(30,_h,4,6,"mat-option",16),r()(),s(31,"mat-form-field",44)(32,"mat-label",12),p(33,"admin.domain-name"),r(),g(34,"input",68),v(35,Ch,3,3,"mat-error",14)(36,Sh,3,3,"mat-error",14),r()(),v(37,Th,3,3,"mat-error",14),r(),s(38,"div",69)(39,"mat-form-field",44)(40,"mat-label",12),p(41,"admin.oauth2.redirect-uri-template"),r(),g(42,"input",70)(43,"tb-copy-button",71),c(44,"translate"),r()()()()()),i&2){let l=y();a(6),m("ngIf",l.mailSettings.get("clientId").hasError("required")),a(),m("ngIf",l.mailSettings.get("clientId").hasError("maxlen gth")),a(5),m("ngIf",l.mailSettings.get("clientSecret").hasError("required")),a(),m("ngIf",l.mailSettings.get("clientSecret").hasError("maxlength")),a(),m("ngIf",l.mailSettings.get("providerId").value===l.mailServerOauth2Provider.OFFICE_365),a(),m("expanded",l.mailSettings.get("providerId").value===l.mailServerOauth2Provider.CUSTOM),a(9),m("formGroup",l.domainForm),a(6),m("ngForOf",l.protocols),a(5),m("ngIf",l.domainForm.get("name").hasError("pattern")),a(),m("ngIf",l.domainForm.get("name").hasError("maxlength")),a(),m("ngIf",l.domainForm.hasError("unique")),a(6),x("tooltipText",u(44,13,"admin.oauth2.copy-redirect-uri")),m("copyText",l.mailSettings.get("redirectUri").value)}}function Eh(i,n){if(i&1){let l=L();s(0,"section",78)(1,"div")(2,"span",79),p(3,"admin.oauth2.access-token-status"),r(),s(4,"span"),p(5),r()(),s(6,"button",80),c(7,"async"),C("click",function(){I(l);let o=y();return w(o.generateAccessToken())}),p(8),r()()}if(i&2){let l=y();a(5),b(" ",l.accessTokenStatus," "),a(),m("disabled",u(7,3,l.isLoading$)||l.mailSettings.invalid||l.domainForm.invalid||l.mailSettings.dirty||l.domainForm.dirty),a(2),b(" ",l.accessTokenButtonName," ")}}var Os=(()=>{let n=class n extends It{constructor(e,o,t,d,f){super(e),this.store=e,this.adminService=o,this.translate=t,this.fb=d,this.window=f,this.smtpProtocols=Object.values(Za),this.showChangePassword=!1,this.protocols=Object.values(qo).filter(_=>_!==qo.MIXED),this.domainSchemaTranslations=hc,this.mailServerOauth2Provider=J0,this.tlsVersions=["TLSv1","TLSv1.1","TLSv1.2","TLSv1.3"],this.templates=new Map,this.templateProvider=["CUSTOM"],this.destroy$=new Ft,this.DOMAIN_AND_PORT_REGEXP=/^(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?$/,this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.mailSettings=this.fb.group({mailFrom:["",[T.required]],smtpProtocol:[Za.SMTP],smtpHost:["localhost",[T.required]],smtpPort:[25,[T.required,T.pattern($0),T.maxLength(5)]],timeout:[1e4,[T.required,T.pattern(/^[0-9]{1,6}$/),T.maxLength(6)]],enableTls:[!1],tlsVersion:[{value:null,disabled:!0}],enableProxy:[!1],proxyHost:[{value:"",disabled:!0},[T.required]],proxyPort:[{value:null,disabled:!0},[T.required,T.min(1),T.max(65535)]],proxyUser:[{value:"",disabled:!0}],proxyPassword:[{value:"",disabled:!0}],username:[""],changePassword:[!1],password:[""],enableOauth2:[!1],providerId:["CUSTOM",[T.required]],clientId:[{value:"",disabled:!0},[T.required,T.maxLength(255)]],clientSecret:[{value:"",disabled:!0},[T.required,T.maxLength(2048)]],providerTenantId:[{value:"",disabled:!0},[T.required]],authUri:[{value:"",disabled:!0},[T.required,T.pattern(this.URL_REGEXP)]],tokenUri:[{value:"",disabled:!0},[T.required,T.pattern(this.URL_REGEXP)]],scope:this.fb.control({value:[],disabled:!0},T.required),redirectUri:[{value:"",disabled:!0}]}),this.defaultConfiguration={providerId:"CUSTOM",smtpProtocol:Za.SMTP,smtpHost:"",smtpPort:null,timeout:null,enableTls:!1,tlsVersion:null,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",enableOauth2:!1,clientId:"",clientSecret:"",providerTenantId:"",authUri:"",tokenUri:"",scope:[],redirectUri:""},this.domainForm=this.fb.group({name:[this.window.location.hostname,[T.required,T.maxLength(255),T.pattern(this.DOMAIN_AND_PORT_REGEXP)]],scheme:[qo.HTTPS,T.required]})}ngOnInit(){this.mailServerSettingsForm(),this.domainFormConfiguration(),jt({loginProcessingUrl:this.adminService.getLoginProcessingUrl(),mailConfigTemplate:this.adminService.getMailConfigTemplate(),adminSettings:this.adminService.getAdminSettings("mail")}).subscribe(e=>{this.loginProcessingUrl=e.loginProcessingUrl,this.initTemplates(e.mailConfigTemplate),this.adminSettings=e.adminSettings,this.adminSettings.jsonValue&&wc(this.adminSettings.jsonValue.enableTls)&&(this.adminSettings.jsonValue.enableTls=this.adminSettings.jsonValue.enableTls==="true"),this.showChangePassword=Be(this.adminSettings.jsonValue.showChangePassword)?this.adminSettings.jsonValue.showChangePassword:!0,delete this.adminSettings.jsonValue.showChangePassword,this.adminSettings.jsonValue.providerId||(this.adminSettings.jsonValue.providerId="CUSTOM"),this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.enableMailPassword(!this.showChangePassword),this.enableProxyChanged(),this.enableTls(this.adminSettings.jsonValue.enableTls),this.helpLink=this.templates.get(this.adminSettings.jsonValue.providerId)?.helpLink||null,this.adminSettings.jsonValue.enableOauth2?(this.enableOauth2(!!this.adminSettings.jsonValue.enableOauth2),this.enableProviderTenantIdChanged(this.adminSettings.jsonValue.providerId),this.parseUrl(this.adminSettings.jsonValue.redirectUri),this.mailSettings.get("redirectUri").patchValue(this.adminSettings.jsonValue.redirectUri,{emitEvent:!1})):this.mailSettings.get("enableOauth2").patchValue(!1,{emitEvent:!1})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),super.ngOnDestroy()}initTemplates(e){e.map(o=>{delete o.additionalInfo,this.templates.set(o.providerId,o)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort()}mailServerSettingsForm(){this.registerDisableOnLoadFormControl(this.mailSettings.get("smtpProtocol")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableTls")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableProxy")),this.registerDisableOnLoadFormControl(this.mailSettings.get("changePassword")),this.mailSettings.get("enableTls").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>this.enableTls(e)),this.mailSettings.get("enableProxy").valueChanges.pipe(mt(this.destroy$)).subscribe(()=>{this.enableProxyChanged()}),this.mailSettings.get("changePassword").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{this.enableMailPassword(e)}),this.mailSettings.get("enableOauth2").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{this.enableOauth2(e),this.enableProviderTenantIdChanged(this.mailSettings.get("providerId").value),e&&!this.mailSettings.get("redirectUri").value&&this.mailSettings.get("redirectUri").patchValue(this.redirectURI(),{emitEvent:!1})}),this.mailSettings.get("providerTenantId").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{let o=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).authorizationUri.replace("%s",`${e}`),t=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).accessTokenUri.replace("%s",`${e}`);this.mailSettings.get("authUri").patchValue(o,{emitEvent:!1}),this.mailSettings.get("tokenUri").patchValue(t,{emitEvent:!1})}),this.mailSettings.get("providerId").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{if(e===this.mailServerOauth2Provider.CUSTOM||!e)this.mailSettings.reset(Ce(Ce({},this.adminSettings.jsonValue),this.defaultConfiguration),{emitEvent:!1});else{let o=this.templates.get(e);this.helpLink=o.helpLink,this.mailSettings.patchValue({smtpProtocol:Za[o.smtpProtocol],smtpHost:o.smtpHost,smtpPort:o.smtpPort,timeout:o.timeout,enableTls:o.enableTls,tlsVersion:o.tlsVersion,authUri:o.authorizationUri,tokenUri:o.accessTokenUri,scope:o.scope,enableOauth2:!1,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",clientId:"",clientSecret:"",providerTenantId:"",redirectUri:""},{emitEvent:!1})}this.enableTls(this.mailSettings.get("enableTls").value),this.enableOauth2(this.mailSettings.get("enableOauth2").value),this.enableProviderTenantIdChanged(e)})}domainFormConfiguration(){this.domainForm.get("name").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(this.domainForm.get("scheme").value,e),{emitEvent:!1})),this.domainForm.get("scheme").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(e),{emitEvent:!1}))}enableOauth2(e){e?(this.mailSettings.get("clientId").enable({emitEvent:!1}),this.mailSettings.get("clientSecret").enable({emitEvent:!1}),this.mailSettings.get("redirectUri").enable({emitEvent:!1}),this.mailSettings.get("scope").enable({emitEvent:!1}),this.mailSettings.get("providerId").value===this.mailServerOauth2Provider.CUSTOM?(this.mailSettings.get("authUri").enable({emitEvent:!1}),this.mailSettings.get("tokenUri").enable({emitEvent:!1})):(this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))):(this.mailSettings.get("clientId").disable({emitEvent:!1}),this.mailSettings.get("clientSecret").disable({emitEvent:!1}),this.mailSettings.get("redirectUri").disable({emitEvent:!1}),this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}),this.mailSettings.get("scope").disable({emitEvent:!1}))}enableProviderTenantIdChanged(e){e===this.mailServerOauth2Provider.OFFICE_365&&this.mailSettings.get("enableOauth2").value?this.mailSettings.get("providerTenantId").enable({emitEvent:!1}):this.mailSettings.get("providerTenantId").disable({emitEvent:!1})}enableProxyChanged(){this.mailSettings.get("enableProxy").value?(this.mailSettings.get("proxyHost").enable({emitEvent:!1}),this.mailSettings.get("proxyPort").enable({emitEvent:!1}),this.mailSettings.get("proxyUser").enable({emitEvent:!1}),this.mailSettings.get("proxyPassword").enable({emitEvent:!1})):(this.mailSettings.get("proxyHost").disable({emitEvent:!1}),this.mailSettings.get("proxyPort").disable({emitEvent:!1}),this.mailSettings.get("proxyUser").disable({emitEvent:!1}),this.mailSettings.get("proxyPassword").disable({emitEvent:!1}))}enableMailPassword(e){e?this.mailSettings.get("password").enable({emitEvent:!1}):this.mailSettings.get("password").disable({emitEvent:!1})}enableTls(e){e?this.mailSettings.get("tlsVersion").enable({emitEvent:!1}):this.mailSettings.get("tlsVersion").disable({emitEvent:!1})}sendTestMail(){this.adminSettings.jsonValue=Ce(Ce({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.sendTestMail(this.adminSettings).subscribe({next:()=>this.store.dispatch(new ze({message:this.translate.instant("admin.test-mail-sent"),type:"success"})),error:e=>this.store.dispatch(new ze({message:e.error.message,type:"error"}))})}save(){this.adminSettings.jsonValue=Ce(Ce({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.showChangePassword=!0,this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.domainForm.reset(this.domainForm.value),this.parseUrl(this.adminSettings.jsonValue.redirectUri)})}generateAccessToken(){this.adminService.generateAccessToken().subscribe(e=>this.window.location.href=e)}redirectURI(e,o){let t=this.domainForm.value;if(t.name!==""){let d=On(e)?e.toLowerCase():t.scheme.toLowerCase(),f=On(o)?o:t.name;return`${d}://${f}${this.loginProcessingUrl}`}return""}parseUrl(e){if(e){let o=new URL(e);this.domainForm.get("scheme").patchValue(o.protocol.startsWith("https")?qo.HTTPS:qo.HTTP,{emitEvent:!1}),this.domainForm.get("name").patchValue(o.host,{emitEvent:!1})}}get accessTokenButtonName(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.update-access-token":"admin.oauth2.generate-access-token")}get accessTokenStatus(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.token-status-generated":"admin.oauth2.token-status-not-generated")}confirmForm(){return this.mailSettings}get mailSettingsFormValue(){let e=this.mailSettings.getRawValue();return delete e.changePassword,Be(e.password)||delete e.password,e}toggleEditMode(e){this.mailSettings.get(e).disabled?this.mailSettings.get(e).enable():this.mailSettings.get(e).disable()}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Pn),h(ee),h(ct),h(Xo))},n.\u0275cmp=F({type:n,selectors:[["tb-mail-server"]],features:[G],decls:60,vars:42,consts:[["smtpPortInput",""],["timeoutInput",""],["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","outgoingMailSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","mailFrom","required",""],[4,"ngIf"],["formControlName","providerId"],[3,"value",4,"ngFor","ngForOf"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[1,"fields-group","flex","flex-col"],["translate","",1,"group-title"],["matInput","","formControlName","username","autocomplete","new-username",3,"placeholder"],[1,"flex","items-center","justify-between",2,"height","50px","padding-bottom","20px"],["formControlName","enableOauth2","appearance","fill",1,"w-52"],[3,"value"],["class","details-buttons",4,"ngIf"],["class","flex flex-row pb-3 xs:flex-col gt-xs:items-center gt-xs:justify-between",4,"ngIf"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formControlName","smtpProtocol"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2.5"],[1,"mat-block","flex-full","gt-sm:max-w-60%"],["matInput","","formControlName","smtpHost","placeholder","localhost","required",""],[1,"mat-block","flex-full","gt-sm:max-w-40%"],["matInput","","formControlName","smtpPort","placeholder","25","maxlength","5","required",""],["align","end"],["matInput","","formControlName","timeout","placeholder","10000","maxlength","6","required",""],["formControlName","enableTls",1,"flex-1",2,"display","block","padding-bottom","22px"],["class","mat-block flex-1",4,"ngIf"],["formControlName","enableProxy",2,"display","block","padding-bottom","22px"],[1,"mat-block","flex-1"],["formControlName","tlsVersion"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2"],["matInput","","required","","formControlName","proxyHost"],["matInput","","required","","formControlName","proxyPort","type","number","step","1","min","1","max","65535"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","proxyUser"],["matInput","","type","password","formControlName","proxyPassword","autocomplete","new-proxy-password"],["matSuffix",""],[1,"details-buttons"],[3,"tb-help"],["formControlName","changePassword","style","padding-bottom: 16px;",4,"ngIf"],["class","mat-block",4,"ngIf"],["formControlName","changePassword",2,"padding-bottom","16px"],["matInput","","formControlName","password","type","password","autocomplete","new-password",3,"placeholder"],["matInput","","formControlName","clientId","required",""],["matInput","","formControlName","clientSecret","required",""],[1,"mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-stretch","justify-end"],[1,"flex","flex-1","flex-row","gap-2","xs:flex-col"],[1,"flex","flex-col","sm:max-w-60%","sm:flex-full","gt-sm:max-w-50%","gt-sm:flex-full",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col","md:flex-col","md:gap-0"],[1,"mat-block","max-w-30%","flex-full","xs:max-w-full","xs:flex-1","md:max-w-full","md:flex-1"],["formControlName","scheme"],["matInput","","formControlName","name","required",""],[1,"flex","flex-1","flex-col"],["matInput","","formControlName","redirectUri","readonly",""],["matSuffix","","color","primary","tooltipPosition","above","icon","mdi:clipboard-arrow-left",3,"copyText","tooltipText"],["matInput","","formControlName","providerTenantId","required",""],["matInput","","formControlName","authUri","required",""],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"material-icons"],["matInput","","formControlName","tokenUri","required",""],["formControlName","scope","required","",3,"label","requiredText"],[1,"flex","flex-row","pb-3","xs:flex-col","gt-xs:items-center","gt-xs:justify-between"],["translate","",1,"token-status"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"div")(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title")(4,"span",3),p(5,"admin.outgoing-mail-settings"),r()(),g(6,"span",4)(7,"div",5),r(),v(8,Ug,1,0,"mat-progress-bar",6),c(9,"async"),v(10,qg,1,0,"div",7),c(11,"async"),s(12,"mat-card-content",8)(13,"form",9),C("ngSubmit",function(){return t.save()}),s(14,"fieldset",10),c(15,"async"),s(16,"mat-form-field",11)(17,"mat-label",12),p(18,"admin.mail-from"),r(),g(19,"input",13),v(20,Wg,3,3,"mat-error",14),r(),s(21,"mat-form-field",11)(22,"mat-label",12),p(23,"admin.oauth2.smtp-provider"),r(),s(24,"mat-select",15),v(25,Hg,2,2,"mat-option",16),r()(),s(26,"mat-expansion-panel",17)(27,"mat-expansion-panel-header")(28,"mat-panel-title",18),p(29," admin.connection-settings "),r()(),v(30,oh,37,16,"ng-template",19),r(),s(31,"fieldset",20)(32,"legend",21),p(33,"admin.oauth2.authentication"),r(),s(34,"mat-form-field",11)(35,"mat-label",12),p(36,"common.username"),r(),g(37,"input",22),c(38,"translate"),r(),s(39,"div",23)(40,"tb-toggle-select",24)(41,"tb-toggle-option",25),p(42),c(43,"translate"),r(),s(44,"tb-toggle-option",25),p(45),c(46,"translate"),r()(),v(47,ah,2,1,"div",26),r(),v(48,lh,3,2,"section",14)(49,xh,45,15,"section",14)(50,Eh,9,5,"section",27),r(),s(51,"div",28)(52,"button",29),c(53,"async"),C("click",function(){return t.sendTestMail()}),p(54),c(55,"translate"),r(),s(56,"button",30),c(57,"async"),p(58),c(59,"translate"),r()()()()()()()),o&2&&(a(8),m("ngIf",u(9,22,t.isLoading$)),a(2),m("ngIf",!u(11,24,t.isLoading$)),a(3),m("formGroup",t.mailSettings),a(),m("disabled",u(15,26,t.isLoading$)),a(6),m("ngIf",t.mailSettings.get("mailFrom").hasError("required")),a(5),m("ngForOf",t.templateProvider),a(),m("expanded",t.mailSettings.get("providerId").value===t.mailServerOauth2Provider.CUSTOM),a(11),x("placeholder",u(38,28,"common.enter-username")),a(2),j("!hidden",t.mailSettings.get("providerId").value==="SENDGRID"),a(2),m("value",!1),a(),B(u(43,30,"admin.oauth2.basic")),a(2),m("value",!0),a(),B(u(46,32,"admin.oauth2.oauth2")),a(2),m("ngIf",t.helpLink&&t.mailSettings.get("enableOauth2").value),a(),m("ngIf",!t.mailSettings.get("enableOauth2").value),a(),m("ngIf",t.mailSettings.get("enableOauth2").value),a(),m("ngIf",t.mailSettings.get("enableOauth2").value),a(2),m("disabled",u(53,34,t.isLoading$)||t.mailSettings.get("enableOauth2").value?t.mailSettings.invalid||t.domainForm.invalid||t.mailSettings.dirty||t.domainForm.dirty:t.mailSettings.invalid),a(2),b(" ",u(55,36,"admin.send-test-mail")," "),a(2),m("disabled",u(57,38,t.isLoading$)||t.mailSettings.invalid||t.domainForm.invalid||!t.mailSettings.dirty&&!t.domainForm.dirty),a(2),b("",u(59,40,"action.save")," "))},dependencies:[xe,U,$t,mn,te,Ie,zt,re,Zt,ni,ui,ci,Ue,be,de,Se,Kt,Fe,Xt,vt,gt,ht,Li,nn,on,Yc,eo,ue,he,Gi,W,X,fe,rn,Ui,an,ne,le,J,ga,vs,Di,Fi,me,Tr,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 8px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .token-status[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;color:#0009;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();S();var Da=i=>({protocol:i});function wh(i,n){i&1&&g(0,"mat-progress-bar",25)}function Mh(i,n){i&1&&g(0,"div",26)}function Dh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.base-url-required")," "))}function Fh(i,n){i&1&&g(0,"mat-progress-bar",25)}function Ph(i,n){i&1&&g(0,"div",26)}function Ah(i,n){i&1&&Rt(0)}function Nh(i,n){i&1&&Rt(0)}function kh(i,n){if(i&1&&(Lt(0),v(1,Ah,1,0,"ng-container",27)(2,Nh,1,0,"ng-container",27),Gt()),i&2){let l=y(),e=q(63);a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(4,Da,l.protocol)),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(6,Da,l.protocol+"s"))}}function Oh(i,n){i&1&&Rt(0)}function Bh(i,n){i&1&&Rt(0)}function Rh(i,n){if(i&1&&(Lt(0),v(1,Oh,1,0,"ng-container",27)(2,Bh,1,0,"ng-container",27),Gt()),i&2){let l=y(),e=q(63);a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(4,Da,l.protocol)),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(6,Da,l.protocol+"s"))}}function Vh(i,n){i&1&&Rt(0)}function jh(i,n){i&1&&Rt(0)}function Lh(i,n){if(i&1&&(Lt(0),v(1,Vh,1,0,"ng-container",27)(2,jh,1,0,"ng-container",27),Gt()),i&2){let l=y(),e=q(63);a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(4,Da,l.protocol)),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(6,Da,l.protocol+"s"))}}function Gh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.device-connectivity.port-pattern")," "))}function Uh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.device-connectivity.port-range")," "))}function qh(i,n){if(i&1&&(s(0,"div",28)(1,"mat-slide-toggle",29),p(2),c(3,"translate"),r(),s(4,"div",30)(5,"mat-form-field",31)(6,"mat-label",9),p(7,"admin.device-connectivity.host"),r(),g(8,"input",32),r(),s(9,"mat-form-field",31)(10,"mat-label",9),p(11,"admin.device-connectivity.port"),r(),g(12,"input",33),v(13,Gh,3,3,"mat-error",11)(14,Uh,3,3,"mat-error",11),r()()()),i&2){let l=n.protocol,e=y();m("formGroupName",l),a(2),b(" ",u(3,4,"admin.device-connectivity."+l)," "),a(11),m("ngIf",e.deviceConnectivitySettingsForm.get(l+".port").hasError("pattern")),a(),m("ngIf",e.deviceConnectivitySettingsForm.get(l+".port").hasError("min")||e.deviceConnectivitySettingsForm.get(l+".port").hasError("max"))}}var Bs=(()=>{let n=class n extends It{constructor(e,o,t){super(e),this.store=e,this.adminService=o,this.fb=t,this.protocol="http",this.destroy$=new Ft,this.buildGeneralServerSettingsForm(),this.adminService.getAdminSettings("general").subscribe(d=>this.processGeneralSettings(d)),this.buildDeviceConnectivitySettingsForm(),this.adminService.getAdminSettings("connectivity").subscribe(d=>this.processDeviceConnectivitySettings(d))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildGeneralServerSettingsForm(){this.generalSettings=this.fb.group({baseUrl:["",[T.required]],prohibitDifferentUrl:["",[]]})}buildDeviceConnectivitySettingsForm(){this.deviceConnectivitySettingsForm=this.fb.group({http:this.buildDeviceConnectivityInfoForm(),https:this.buildDeviceConnectivityInfoForm(),mqtt:this.buildDeviceConnectivityInfoForm(),mqtts:this.buildDeviceConnectivityInfoForm(),coap:this.buildDeviceConnectivityInfoForm(),coaps:this.buildDeviceConnectivityInfoForm()})}buildDeviceConnectivityInfoForm(){let e=this.fb.group({enabled:[!1,[]],host:[{value:"",disabled:!0}],port:[{value:null,disabled:!0},[T.min(1),T.max(65535),T.pattern("[0-9]*")]]});return e.get("enabled").valueChanges.pipe(mt(this.destroy$)).subscribe(o=>{o?(e.get("host").enable({emitEvent:!1}),e.get("port").enable({emitEvent:!1})):(e.get("host").disable({emitEvent:!1}),e.get("port").disable({emitEvent:!1}))}),e}save(){this.adminSettings.jsonValue=Ce(Ce({},this.adminSettings.jsonValue),this.generalSettings.value),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>this.processGeneralSettings(e))}saveDeviceConnectivitySettings(){this.deviceConnectivitySettings.jsonValue=Ce(Ce({},this.deviceConnectivitySettings.jsonValue),this.deviceConnectivitySettingsForm.getRawValue()),this.adminService.saveAdminSettings(this.deviceConnectivitySettings).subscribe(e=>this.processDeviceConnectivitySettings(e))}discardGeneralSettings(){this.generalSettings.reset(this.adminSettings.jsonValue)}discardDeviceConnectivitySettings(){this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}processGeneralSettings(e){this.adminSettings=e,this.generalSettings.reset(this.adminSettings.jsonValue)}processDeviceConnectivitySettings(e){this.deviceConnectivitySettings=e,this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}confirmForm(){return this.generalSettings.dirty?this.generalSettings:this.deviceConnectivitySettingsForm}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Pn),h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-general-settings"]],features:[G],decls:72,vars:60,consts:[["connectivitySettings",""],["appearance","outlined",1,"settings-card"],[1,"flex","flex-row"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[1,"tb-form-panel","no-border","no-padding",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","baseUrl","required",""],[4,"ngIf"],[1,"tb-form-row",3,"tb-hint-tooltip-icon"],["formControlName","prohibitDifferentUrl",1,"mat-slide","margin"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-panel","no-border","no-padding","toggle-group"],["appearance","fill",3,"ngModelChange","ngModel"],["value","http"],["value","mqtt"],["value","coap"],[1,"tb-form-hint","tb-primary-fill"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tb-form-panel","stroked","no-padding-bottom",3,"formGroupName"],["formControlName","enabled",1,"mat-slide"],[1,"tb-form-row","column-xs","no-border","no-padding","tb-standard-fields"],[1,"flex-1"],["matInput","","formControlName","host"],["matInput","","type","number","min","0","max","65535","formControlName","port"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"span",3),p(5,"admin.general-settings"),r()()()(),v(6,wh,1,0,"mat-progress-bar",4),c(7,"async"),v(8,Mh,1,0,"div",5),c(9,"async"),s(10,"mat-card-content")(11,"form",6),C("ngSubmit",function(){return I(d),w(t.save())}),s(12,"fieldset",7),c(13,"async"),s(14,"div")(15,"mat-form-field",8)(16,"mat-label",9),p(17,"admin.base-url"),r(),g(18,"input",10),v(19,Dh,3,3,"mat-error",11),r(),s(20,"div",12),c(21,"translate"),s(22,"mat-slide-toggle",13),p(23),c(24,"translate"),r()()()(),s(25,"div",14)(26,"button",15),C("click",function(){return I(d),w(t.discardGeneralSettings())}),p(27),c(28,"translate"),r(),s(29,"button",16),c(30,"async"),p(31),c(32,"translate"),r()()()()(),s(33,"mat-card",1)(34,"mat-card-header")(35,"mat-card-title")(36,"div",3),p(37,"admin.device-connectivity.device-connectivity"),r()()(),v(38,Fh,1,0,"mat-progress-bar",4),c(39,"async"),v(40,Ph,1,0,"div",5),c(41,"async"),s(42,"mat-card-content")(43,"section",17)(44,"div",18)(45,"tb-toggle-select",19),et("ngModelChange",function(_){return I(d),Ze(t.protocol,_)||(t.protocol=_),w(_)}),s(46,"tb-toggle-option",20),p(47),c(48,"translate"),r(),s(49,"tb-toggle-option",21),p(50),c(51,"translate"),r(),s(52,"tb-toggle-option",22),p(53),c(54,"translate"),r()(),s(55,"div",23),p(56),c(57,"translate"),r()(),s(58,"form",6),C("ngSubmit",function(){return I(d),w(t.saveDeviceConnectivitySettings())}),v(59,kh,3,8,"ng-container",11)(60,Rh,3,8,"ng-container",11)(61,Lh,3,8,"ng-container",11)(62,qh,15,6,"ng-template",null,0,Et),s(64,"div",14)(65,"button",15),C("click",function(){return I(d),w(t.discardDeviceConnectivitySettings())}),p(66),c(67,"translate"),r(),s(68,"button",24),c(69,"async"),p(70),c(71,"translate"),r()()()()()()}o&2&&(a(6),m("ngIf",u(7,26,t.isLoading$)),a(2),m("ngIf",!u(9,28,t.isLoading$)),a(3),m("formGroup",t.generalSettings),a(),m("disabled",u(13,30,t.isLoading$)),a(7),m("ngIf",t.generalSettings.get("baseUrl").hasError("required")),a(),x("tb-hint-tooltip-icon",u(21,32,"admin.prohibit-different-url-hint")),a(3),b(" ",u(24,34,"admin.prohibit-different-url")," "),a(3),m("disabled",t.generalSettings.pristine),a(),b("",u(28,36,"action.undo")," "),a(2),m("disabled",u(30,38,t.isLoading$)||t.generalSettings.invalid||!t.generalSettings.dirty),a(2),b("",u(32,40,"action.save")," "),a(7),m("ngIf",u(39,42,t.isLoading$)),a(2),m("ngIf",!u(41,44,t.isLoading$)),a(5),Xe("ngModel",t.protocol),a(2),B(u(48,46,"admin.device-connectivity.http-s")),a(3),B(u(51,48,"admin.device-connectivity.mqtt-s")),a(3),B(u(54,50,"admin.device-connectivity.coap-s")),a(3),B(u(57,52,"admin.device-connectivity.hint")),a(2),m("formGroup",t.deviceConnectivitySettingsForm),a(),m("ngIf",t.protocol==="http"),a(),m("ngIf",t.protocol==="mqtt"),a(),m("ngIf",t.protocol==="coap"),a(4),m("disabled",t.deviceConnectivitySettingsForm.pristine),a(),b("",u(67,54,"action.undo")," "),a(2),m("disabled",u(69,56,t.isLoading$)||t.deviceConnectivitySettingsForm.invalid||!t.deviceConnectivitySettingsForm.dirty),a(2),b("",u(71,58,"action.save")," "))},dependencies:[U,Qn,te,Zt,ni,ui,ci,Ue,be,de,Se,Fe,ht,ue,he,Gi,W,X,fe,Ui,an,Qe,ne,le,bt,J,Di,Fi,Kr,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]{max-width:670px;width:100%;margin:0 auto}[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]   .tb-form-hint[_ngcontent-%COMP%]{text-align:center}@media screen and (max-width: 599px){[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .tb-form-row[_ngcontent-%COMP%]{gap:0}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();S();function Wh(i,n){i&1&&g(0,"mat-progress-bar",47)}function Hh(i,n){i&1&&g(0,"div",48)}function zh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-max-failed-login-attempts-range")," "))}function $h(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.user-activation-token-ttl-range")," "))}function Jh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.user-activation-token-ttl-range")," "))}function Qh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.password-reset-token-ttl-range")," "))}function Yh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.password-reset-token-ttl-range")," "))}function Kh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.mobile-secret-key-length-range")," "))}function Xh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-password-length-required")," "))}function Zh(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-password-length-range")," "))}function eb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-password-length-range")," "))}function tb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.maximum-password-length-min")," "))}function ib(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.maximum-password-length-less-min")," "))}function nb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-uppercase-letters-range")," "))}function ob(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-lowercase-letters-range")," "))}function ab(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-digits-range")," "))}function rb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.minimum-special-characters-range")," "))}function sb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.password-expiration-period-days-range")," "))}function lb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.password-reuse-frequency-days-range")," "))}function mb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.issuer-name-required")," "))}function pb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.signings-key-required")," "))}function db(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.signings-key-base64")," "))}function cb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.signings-key-min-length")," "))}function ub(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.expiration-time-required")," "))}function fb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.expiration-time-max")," "))}function gb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.expiration-time-min")," "))}function hb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.refresh-expiration-time-required")," "))}function bb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.refresh-expiration-time-max")," "))}function vb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.refresh-expiration-time-min")," "))}function yb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.jwt.refresh-expiration-time-less-token")," "))}var Rs=(()=>{let n=class n extends It{constructor(e,o,t,d,f,_,D,M){super(e),this.store=e,this.router=o,this.adminService=t,this.authService=d,this.dialogService=f,this.translate=_,this.fb=D,this.destroyRef=M,this.showMainLoadingBar=!1,this.buildSecuritySettingsForm(),this.buildJwtSecuritySettingsForm(),this.adminService.getSecuritySettings().subscribe(Y=>this.processSecuritySettings(Y)),this.adminService.getJwtSettings().subscribe(Y=>this.processJwtSettings(Y))}buildSecuritySettingsForm(){this.securitySettingsFormGroup=this.fb.group({maxFailedLoginAttempts:[null,[T.min(0)]],userLockoutNotificationEmail:["",[]],userActivationTokenTtl:[24,[T.required,T.min(1),T.max(24)]],passwordResetTokenTtl:[24,[T.required,T.min(1),T.max(24)]],mobileSecretKeyLength:[null,[T.min(1)]],passwordPolicy:this.fb.group({minimumLength:[null,[T.required,T.min(6),T.max(50)]],maximumLength:[null,[T.min(6),this.maxPasswordValidation()]],minimumUppercaseLetters:[null,T.min(0)],minimumLowercaseLetters:[null,T.min(0)],minimumDigits:[null,T.min(0)],minimumSpecialCharacters:[null,T.min(0)],passwordExpirationPeriodDays:[null,T.min(0)],passwordReuseFrequencyDays:[null,T.min(0)],allowWhitespaces:[!0],forceUserToResetPasswordIfNotValid:[!1]})})}buildJwtSecuritySettingsForm(){this.jwtSecuritySettingsFormGroup=this.fb.group({tokenIssuer:["",T.required],tokenSigningKey:["",[T.required,this.base64Format]],tokenExpirationTime:[0,[T.required,T.min(60),T.max(2147483647)]],refreshTokenExpTime:[0,[T.required,T.min(900),T.max(2147483647)]]},{validators:this.refreshTokenTimeGreatTokenTime.bind(this)}),this.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>this.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").updateValueAndValidity({onlySelf:!0}))}save(){this.securitySettings=Ce(Ce({},this.securitySettings),this.securitySettingsFormGroup.value),this.adminService.saveSecuritySettings(this.securitySettings).subscribe(e=>this.processSecuritySettings(e))}saveJwtSettings(){let e=this.jwtSecuritySettingsFormGroup.value;this.confirmChangeJWTSettings().pipe(_t(o=>o?this.adminService.saveJwtSettings(e).pipe(Ot(t=>this.authService.setUserFromJwtToken(t.token,t.refreshToken,!1)),_t(()=>this.adminService.getJwtSettings()),Ot(t=>this.processJwtSettings(t))):Ct(null))).subscribe(()=>{})}maxPasswordValidation(){return e=>{let o=e.value;return o&&o<e.parent.value?.minimumLength?{lessMin:!0}:null}}discardSetting(){this.securitySettingsFormGroup.reset(this.securitySettings)}discardJwtSetting(){this.jwtSecuritySettingsFormGroup.reset(this.jwtSettings)}markAsTouched(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched()}confirmChangeJWTSettings(){return this.jwtSecuritySettingsFormGroup.get("tokenIssuer").value!==(this.jwtSettings?.tokenIssuer||"")||this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").value!==(this.jwtSettings?.tokenSigningKey||"")?this.dialogService.confirm(this.translate.instant("admin.jwt.info-header"),`<div style="max-width: 640px">${this.translate.instant("admin.jwt.info-message")}</div>`,this.translate.instant("action.discard-changes"),this.translate.instant("action.confirm")):Ct(!0)}generateSigningKey(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").setValue(btoa(Qa(64))),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").pristine&&(this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsDirty(),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched())}processSecuritySettings(e){this.securitySettings=e,this.securitySettingsFormGroup.reset(this.securitySettings)}processJwtSettings(e){this.jwtSettings=e,this.jwtSecuritySettingsFormGroup.reset(e)}refreshTokenTimeGreatTokenTime(e){if(e){let o=e.value.tokenExpirationTime,t=e.value.refreshTokenExpTime;if(o>=t)return e.get("refreshTokenExpTime").untouched&&e.get("refreshTokenExpTime").markAsTouched(),e.get("refreshTokenExpTime").setErrors({lessToken:!0}),{lessToken:!0}}return null}base64Format(e){if(e.value===""||e.value==="thingsboardDefaultSigningKey")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}confirmForm(){return this.securitySettingsFormGroup.dirty?this.securitySettingsFormGroup:this.jwtSecuritySettingsFormGroup}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Pn),h(Zn),h(Wt),h(ee),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-security-settings"]],features:[G],decls:168,vars:71,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","securitySettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["autocomplete","off",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"fields-group"],["translate","",1,"group-title"],[1,"mat-block"],["translate",""],["matInput","","type","number","formControlName","maxFailedLoginAttempts","step","1","min","0"],[4,"ngIf"],["matInput","","type","email","formControlName","userLockoutNotificationEmail"],["matInput","","type","number","formControlName","userActivationTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","passwordResetTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","mobileSecretKeyLength","step","1","min","1"],["formGroupName","passwordPolicy"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["matInput","","type","number","formControlName","minimumLength","step","1","min","6","max","50","required",""],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["matInput","","type","number","formControlName","maximumLength","step","1","min","6"],["matInput","","type","number","formControlName","minimumUppercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumLowercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumDigits","step","1","min","0"],["matInput","","type","number","formControlName","minimumSpecialCharacters","step","1","min","0"],["matInput","","type","number","formControlName","passwordExpirationPeriodDays","step","1","min","0"],["matInput","","type","number","formControlName","passwordReuseFrequencyDays","step","1","min","0"],["formControlName","allowWhitespaces",1,"flex-1",2,"margin-bottom","16px"],["formControlName","forceUserToResetPasswordIfNotValid",1,"flex-1",2,"margin-bottom","16px"],[3,"tb-hint-tooltip-icon"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2",2,"margin-top","16px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["tb-help","jwtSecuritySettings"],[2,"padding-top","16px"],[1,"flex","flex-col","gap-2",3,"disabled"],[1,"flex","flex-row","gap-2","xs:flex-col"],["matInput","","required","","formControlName","tokenIssuer"],["matInput","","required","","formControlName","tokenSigningKey",3,"focus"],["type","button","matSuffix","","mat-button","","color","primary",2,"line-height","32px",3,"click"],["matInput","","type","number","required","","formControlName","tokenExpirationTime","step","1","min","60"],["matInput","","type","number","required","","formControlName","refreshTokenExpTime","step","1","min","900"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){o&1&&(s(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),p(4,"admin.security-settings"),r()(),g(5,"span",2)(6,"div",3),r(),v(7,Wh,1,0,"mat-progress-bar",4),c(8,"async"),v(9,Hh,1,0,"div",5),c(10,"async"),s(11,"mat-card-content")(12,"form",6),C("ngSubmit",function(){return t.save()}),s(13,"fieldset",7),c(14,"async"),s(15,"fieldset",8)(16,"legend",9),p(17,"admin.general-policy"),r(),s(18,"mat-form-field",10)(19,"mat-label",11),p(20,"admin.max-failed-login-attempts"),r(),g(21,"input",12),v(22,zh,3,3,"mat-error",13),r(),s(23,"mat-form-field",10)(24,"mat-label",11),p(25,"admin.user-lockout-notification-email"),r(),g(26,"input",14),r(),s(27,"mat-form-field",10)(28,"mat-label",11),p(29,"admin.user-activation-token-ttl"),r(),g(30,"input",15),v(31,$h,3,3,"mat-error",13)(32,Jh,3,3,"mat-error",13),r(),s(33,"mat-form-field",10)(34,"mat-label",11),p(35,"admin.password-reset-token-ttl"),r(),g(36,"input",16),v(37,Qh,3,3,"mat-error",13)(38,Yh,3,3,"mat-error",13),r(),s(39,"mat-form-field",10)(40,"mat-label",11),p(41,"admin.mobile-secret-key-length"),r(),g(42,"input",17),v(43,Kh,3,3,"mat-error",13),r()(),s(44,"fieldset",8)(45,"legend",9),p(46,"admin.password-policy"),r(),s(47,"section",18)(48,"div",19)(49,"mat-form-field",20)(50,"mat-label",11),p(51,"admin.minimum-password-length"),r(),g(52,"input",21),v(53,Xh,3,3,"mat-error",13)(54,Zh,3,3,"mat-error",13)(55,eb,3,3,"mat-error",13),r(),s(56,"mat-form-field",22)(57,"mat-label",11),p(58,"admin.maximum-password-length"),r(),g(59,"input",23)(60,"mat-hint"),v(61,tb,3,3,"mat-error",13)(62,ib,3,3,"mat-error",13),r()(),s(63,"div",19)(64,"mat-form-field",20)(65,"mat-label",11),p(66,"admin.minimum-uppercase-letters"),r(),g(67,"input",24),v(68,nb,3,3,"mat-error",13),r(),s(69,"mat-form-field",20)(70,"mat-label",11),p(71,"admin.minimum-lowercase-letters"),r(),g(72,"input",25),v(73,ob,3,3,"mat-error",13),r()(),s(74,"div",19)(75,"mat-form-field",20)(76,"mat-label",11),p(77,"admin.minimum-digits"),r(),g(78,"input",26),v(79,ab,3,3,"mat-error",13),r(),s(80,"mat-form-field",20)(81,"mat-label",11),p(82,"admin.minimum-special-characters"),r(),g(83,"input",27),v(84,rb,3,3,"mat-error",13),r()(),s(85,"div",19)(86,"mat-form-field",20)(87,"mat-label",11),p(88,"admin.password-expiration-period-days"),r(),g(89,"input",28),v(90,sb,3,3,"mat-error",13),r(),s(91,"mat-form-field",20)(92,"mat-label",11),p(93,"admin.password-reuse-frequency-days"),r(),g(94,"input",29),v(95,lb,3,3,"mat-error",13),r()(),s(96,"div",19)(97,"mat-checkbox",30)(98,"mat-label",11),p(99,"admin.allow-whitespace"),r()(),s(100,"mat-checkbox",31)(101,"mat-label",32),c(102,"translate"),p(103),c(104,"translate"),r()()()()(),s(105,"div",33)(106,"button",34),C("click",function(){return t.discardSetting()}),p(107),c(108,"translate"),r(),s(109,"button",35),c(110,"async"),p(111),c(112,"translate"),r()()()()()(),s(113,"mat-card",0)(114,"mat-card-header")(115,"mat-card-title")(116,"span",1),p(117,"admin.jwt.security-settings"),r()(),g(118,"span",2)(119,"div",36),r(),s(120,"mat-card-content",37)(121,"form",6),C("ngSubmit",function(){return t.saveJwtSettings()}),s(122,"fieldset",38),c(123,"async"),s(124,"div",39)(125,"mat-form-field",22)(126,"mat-label",11),p(127,"admin.jwt.issuer-name"),r(),g(128,"input",40),v(129,mb,3,3,"mat-error",13),r(),s(130,"mat-form-field",22)(131,"mat-label",11),p(132,"admin.jwt.signings-key"),r(),s(133,"input",41),C("focus",function(){return t.markAsTouched()}),r(),s(134,"button",42),C("click",function(){return t.generateSigningKey()}),p(135),c(136,"translate"),r(),s(137,"mat-hint",11),p(138,"admin.jwt.signings-key-hint"),r(),v(139,pb,3,3,"mat-error",13)(140,db,3,3,"mat-error",13)(141,cb,3,3,"mat-error",13),r()(),s(142,"div",39)(143,"mat-form-field",22)(144,"mat-label",11),p(145,"admin.jwt.expiration-time"),r(),g(146,"input",43)(147,"mat-hint"),v(148,ub,3,3,"mat-error",13)(149,fb,3,3,"mat-error",13)(150,gb,3,3,"mat-error",13),r(),s(151,"mat-form-field",22)(152,"mat-label",11),p(153,"admin.jwt.refresh-expiration-time"),r(),g(154,"input",44)(155,"mat-hint"),v(156,hb,3,3,"mat-error",13)(157,bb,3,3,"mat-error",13)(158,vb,3,3,"mat-error",13)(159,yb,3,3,"mat-error",13),r()(),s(160,"div",45)(161,"button",34),C("click",function(){return t.discardJwtSetting()}),p(162),c(163,"translate"),r(),s(164,"button",46),c(165,"async"),p(166),c(167,"translate"),r()()()()()()),o&2&&(a(7),m("ngIf",u(8,45,t.isLoading$)),a(2),m("ngIf",!u(10,47,t.isLoading$)),a(3),m("formGroup",t.securitySettingsFormGroup),a(),m("disabled",u(14,49,t.isLoading$)),a(9),m("ngIf",t.securitySettingsFormGroup.get("maxFailedLoginAttempts").hasError("min")),a(9),m("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("min")),a(),m("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("max")),a(5),m("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("min")),a(),m("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("max")),a(5),m("ngIf",t.securitySettingsFormGroup.get("mobileSecretKeyLength").hasError("min")),a(10),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("required")),a(),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("min")),a(),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("max")),a(6),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("min")),a(),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("lessMin")),a(6),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumUppercaseLetters").hasError("min")),a(5),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLowercaseLetters").hasError("min")),a(6),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumDigits").hasError("min")),a(5),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumSpecialCharacters").hasError("min")),a(6),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordExpirationPeriodDays").hasError("min")),a(5),m("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordReuseFrequencyDays").hasError("min")),a(6),x("tb-hint-tooltip-icon",u(102,51,"admin.force-reset-password-if-no-valid-hint")),a(2),b(" ",u(104,53,"admin.force-reset-password-if-no-valid")," "),a(3),m("disabled",t.securitySettingsFormGroup.pristine),a(),b("",u(108,55,"action.undo")," "),a(2),m("disabled",u(110,57,t.isLoading$)||t.securitySettingsFormGroup.invalid||!t.securitySettingsFormGroup.dirty),a(2),b("",u(112,59,"action.save")," "),a(10),m("formGroup",t.jwtSecuritySettingsFormGroup),a(),m("disabled",u(123,61,t.isLoading$)),a(7),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenIssuer").hasError("required")),a(6),b(" ",u(136,63,"admin.jwt.generate-key")," "),a(4),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("required")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("base64")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("minLength")),a(7),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("required")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("max")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("min")),a(6),m("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("required")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("max")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("min")),a(),m("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("lessToken")),a(2),m("disabled",t.jwtSecuritySettingsFormGroup.pristine),a(),b("",u(163,65,"action.undo")," "),a(2),m("disabled",u(165,67,t.isLoading$)||t.jwtSecuritySettingsFormGroup.invalid||!t.jwtSecuritySettingsFormGroup.dirty),a(2),b("",u(167,69,"action.save")," "))},dependencies:[U,$t,te,zt,Zt,ni,ui,ci,Ue,be,de,Se,Kt,Fe,Xt,ue,he,Gi,W,X,fe,Ui,an,ne,le,bt,J,Kr,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:8px 16px 0;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();S();S();function _b(i,n){i&1&&g(0,"mat-progress-bar",17)}function Cb(i,n){i&1&&g(0,"div",18)}function Sb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.sms-message-required")," "))}function Tb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.sms-message-max-length")," "))}var Vs=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D){super(e,o,_),this.store=e,this.router=o,this.data=t,this.adminService=d,this.translate=f,this.dialogRef=_,this.fb=D,this.phoneNumberPattern=xa,this.smsProviderConfiguration=this.data.smsProviderConfiguration}ngOnInit(){this.sendTestSmsFormGroup=this.fb.group({numberTo:[null,[T.required,T.pattern(xa)]],message:[null,[T.required,T.maxLength(1600)]]})}close(){this.dialogRef.close()}sendTestSms(){let e={providerConfiguration:this.smsProviderConfiguration,numberTo:this.sendTestSmsFormGroup.value.numberTo,message:this.sendTestSmsFormGroup.value.message};this.adminService.sendTestSms(e).subscribe(()=>{this.store.dispatch(new ze({message:this.translate.instant("admin.test-sms-sent"),target:"sendTestSmsDialogContent",verticalPosition:"bottom",horizontalPosition:"left",type:"success"}))})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(Pn),h(ee),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-send-test-sms-dialog"]],features:[G],decls:32,vars:29,consts:[[2,"min-width","500px","position","relative",3,"formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","sendTestSmsDialogContent"],[3,"disabled"],["required","","formControlName","numberTo",3,"enableFlagsSelect","label"],[1,"mat-block"],["required","","matInput","","rows","3","formControlName","message",3,"maxLength"],[4,"ngIf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){o&1&&(s(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"admin.send-test-sms"),r(),g(4,"span",3),s(5,"button",4),C("click",function(){return t.close()}),s(6,"mat-icon",5),p(7,"close"),r()()(),v(8,_b,1,0,"mat-progress-bar",6),c(9,"async"),v(10,Cb,1,0,"div",7),c(11,"async"),s(12,"div",8)(13,"fieldset",9),c(14,"async"),g(15,"tb-phone-input",10),c(16,"translate"),s(17,"mat-form-field",11)(18,"mat-label",2),p(19,"admin.sms-message"),r(),g(20,"textarea",12),v(21,Sb,3,3,"mat-error",13)(22,Tb,3,3,"mat-error",13),r()()(),s(23,"div",14)(24,"button",15),c(25,"async"),C("click",function(){return t.close()}),p(26),c(27,"translate"),r(),s(28,"button",16),c(29,"async"),C("click",function(){return t.sendTestSms()}),p(30),c(31,"translate"),r()()()),o&2&&(m("formGroup",t.sendTestSmsFormGroup),a(8),m("ngIf",u(9,13,t.isLoading$)),a(2),m("ngIf",!u(11,15,t.isLoading$)),a(3),m("disabled",u(14,17,t.isLoading$)),a(2),x("label",u(16,19,"admin.number-to")),m("enableFlagsSelect",!1),a(5),m("maxLength",1600),a(),m("ngIf",t.sendTestSmsFormGroup.get("message").hasError("required")),a(),m("ngIf",t.sendTestSmsFormGroup.get("message").hasError("maxLength")),a(2),m("disabled",u(25,21,t.isLoading$)),a(2),b(" ",u(27,23,"action.close")," "),a(2),m("disabled",u(29,25,t.isLoading$)||t.sendTestSmsFormGroup.invalid),a(2),b(" ",u(31,27,"admin.send-test-sms")," "))},dependencies:[U,Mi,te,Ie,re,Ue,be,de,Se,Fe,at,Nt,dt,ue,he,W,X,fe,ne,le,J,oo,me,R],encapsulation:2});let i=n;return i})();function xb(i,n){i&1&&g(0,"mat-progress-bar",22)}function Eb(i,n){i&1&&g(0,"div",23)}function Ib(i,n){if(i&1){let l=L();s(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title")(3,"span",3),p(4,"admin.sms-provider-settings"),r()(),g(5,"span",4)(6,"div",17),r(),v(7,xb,1,0,"mat-progress-bar",6),c(8,"async"),v(9,Eb,1,0,"div",7),c(10,"async"),s(11,"mat-card-content")(12,"form",1),C("ngSubmit",function(){I(l);let o=y();return w(o.save())}),g(13,"tb-sms-provider-configuration",18),s(14,"div",19)(15,"button",20),c(16,"async"),C("click",function(){I(l);let o=y();return w(o.sendTestSms())}),p(17),c(18,"translate"),r(),s(19,"button",21),c(20,"async"),p(21),c(22,"translate"),r()()()()()}if(i&2){let l=y();a(7),m("ngIf",u(8,7,l.isLoading$)),a(2),m("ngIf",!u(10,9,l.isLoading$)),a(3),m("formGroup",l.smsProvider),a(3),m("disabled",u(16,11,l.isLoading$)||l.smsProvider.invalid),a(2),b(" ",u(18,13,"admin.send-test-sms")," "),a(2),m("disabled",u(20,15,l.isLoading$)||l.smsProvider.invalid||!l.smsProvider.dirty),a(2),b("",u(22,17,"action.save")," ")}}function wb(i,n){i&1&&g(0,"mat-progress-bar",22)}function Mb(i,n){i&1&&g(0,"div",23)}function Db(i,n){i&1&&(s(0,"mat-card-header")(1,"mat-card-title")(2,"span",3),p(3,"admin.mobile-settings"),r()(),g(4,"span",4),r())}function Fb(i,n){if(i&1){let l=L();s(0,"mat-card-content",24)(1,"tb-file-input",25),c(2,"translate"),c(3,"translate"),C("fileNameChanged",function(o){I(l);let t=y();return w(t.notificationSettingsForm==null?null:t.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName").patchValue(o))}),r()()}if(i&2){let l,e=y();a(),x("dropLabel",u(2,3,"admin.select-firebase-service-account-file")),x("label",u(3,5,"admin.firebase-service-account-file")),m("existingFileName",(l=e.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName"))==null?null:l.value)}}var js=(()=>{let n=class n extends It{constructor(e,o,t,d,f,_){super(e),this.store=e,this.router=o,this.adminService=t,this.notificationService=d,this.dialog=f,this.fb=_,this.authUser=Pt(this.store),this.buildSmsProviderForm(),this.buildGeneralServerSettingsForm(),this.notificationService.getNotificationSettings().subscribe(D=>{this.notificationSettings=D,this.notificationSettingsForm.reset(this.notificationSettings)}),this.isSysAdmin()&&this.adminService.getAdminSettings("sms",{ignoreErrors:!0}).subscribe({next:D=>{this.adminSettings=D,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})},error:()=>{this.adminSettings={key:"sms",jsonValue:null},this.smsProvider.reset({configuration:this.adminSettings.jsonValue})}})}buildSmsProviderForm(){this.smsProvider=this.fb.group({configuration:[null,[T.required]]}),this.registerDisableOnLoadFormControl(this.smsProvider.get("configuration"))}sendTestSms(){this.dialog.open(Vs,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{smsProviderConfiguration:this.smsProvider.value.configuration}})}save(){this.adminSettings.jsonValue=this.smsProvider.value.configuration,this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})})}confirmForm(){return this.smsProvider.dirty?this.smsProvider:this.notificationSettingsForm}buildGeneralServerSettingsForm(){this.notificationSettingsForm=this.fb.group({deliveryMethodsConfigs:this.fb.group({SLACK:this.fb.group({botToken:[""]}),MOBILE_APP:this.fb.group({firebaseServiceAccountCredentialsFileName:[""],firebaseServiceAccountCredentials:[""]})})}),this.registerDisableOnLoadFormControl(this.notificationSettingsForm.get("deliveryMethodsConfigs"))}saveNotification(){this.notificationSettings=Bn(Ce(Ce({},this.notificationSettings),this.notificationSettingsForm.value));for(let e in this.notificationSettings.deliveryMethodsConfigs)Object.keys(this.notificationSettings.deliveryMethodsConfigs[e]).some(t=>!$o(this.notificationSettings.deliveryMethodsConfigs[e][t]))?delete this.notificationSettings.deliveryMethodsConfigs[e]:this.notificationSettings.deliveryMethodsConfigs[e].method=e;this.notificationService.saveNotificationSettings(this.notificationSettings).subscribe(e=>{this.notificationSettings=e,this.notificationSettingsForm.reset(this.notificationSettings)})}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Pn),h(vi),h(je),h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-sms-provider"]],features:[G],decls:25,vars:16,consts:[["appearance","outlined","class","settings-card",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outlined","formGroupName","deliveryMethodsConfigs",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","slackSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["formGroupName","SLACK"],["subscriptSizing","dynamic",1,"mat-block"],["translate",""],["matInput","","formControlName","botToken"],[4,"ngIf"],["formGroupName","MOBILE_APP",4,"ngIf"],[1,"flex","items-center","justify-end","xs:flex-col","xs:items-stretch"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined",1,"settings-card"],["tb-help","smsProviderSettings"],["required","","formControlName","configuration"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formGroupName","MOBILE_APP"],["formControlName","firebaseServiceAccountCredentials","accept",".json,application/json","allowedExtensions","json",3,"fileNameChanged","dropLabel","label","existingFileName"]],template:function(o,t){o&1&&(v(0,Ib,23,19,"mat-card",0),s(1,"form",1),C("ngSubmit",function(){return t.saveNotification()}),s(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title")(5,"span",3),p(6,"admin.slack-settings"),r()(),g(7,"span",4)(8,"div",5),r(),v(9,wb,1,0,"mat-progress-bar",6),c(10,"async"),v(11,Mb,1,0,"div",7),c(12,"async"),s(13,"mat-card-content",8)(14,"mat-form-field",9)(15,"mat-label",10),p(16,"admin.slack-api-token"),r(),g(17,"input",11),r()(),v(18,Db,5,0,"mat-card-header",12)(19,Fb,4,7,"mat-card-content",13),s(20,"mat-card-actions",14)(21,"button",15),c(22,"async"),p(23),c(24,"translate"),r()()()()),o&2&&(m("ngIf",t.isSysAdmin()),a(),m("formGroup",t.notificationSettingsForm),a(8),m("ngIf",u(10,8,t.isLoading$)),a(2),m("ngIf",!u(12,10,t.isLoading$)),a(7),m("ngIf",t.isSysAdmin()),a(),m("ngIf",t.isSysAdmin()),a(2),m("disabled",u(22,12,t.isLoading$)||t.notificationSettingsForm.invalid||!t.notificationSettingsForm.dirty),a(2),b("",u(24,14,"action.save")," "))},dependencies:[U,$t,te,Zt,qr,ni,ui,ci,Ue,be,de,Se,ue,he,W,X,fe,ne,le,bt,no,J,Q0,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center;min-height:64px}[_nghost-%COMP%]   .mdc-card__actions[_ngcontent-%COMP%]{padding:16px}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();S();function Pb(i,n){i&1&&g(0,"mat-progress-bar",13)}function Ab(i,n){i&1&&g(0,"div",14)}var Ls=(()=>{let n=class n extends It{constructor(e,o,t,d){super(e),this.store=e,this.router=o,this.dashboardService=t,this.fb=d}ngOnInit(){this.homeSettings=this.fb.group({dashboardId:[null],hideDashboardToolbar:[!0]}),this.dashboardService.getTenantHomeDashboardInfo().subscribe(e=>{this.setHomeDashboardInfo(e)})}save(){let e=this.homeSettings.get("dashboardId").value,o=e?new Y0(e):null,t=this.homeSettings.get("hideDashboardToolbar").value,d={dashboardId:o,hideDashboardToolbar:t};this.dashboardService.setTenantHomeDashboardInfo(d).subscribe(()=>{this.setHomeDashboardInfo(d)})}confirmForm(){return this.homeSettings}setHomeDashboardInfo(e){this.homeSettings.reset({dashboardId:e?.dashboardId?.id,hideDashboardToolbar:Be(e?.hideDashboardToolbar)?e?.hideDashboardToolbar:!0})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Xr),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-home-settings"]],features:[G],decls:26,vars:24,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","dashboardId",1,"flex-1",3,"label","dashboardsScope","selectFirstDashboard"],["formControlName","hideDashboardToolbar",1,"flex-1"],[1,"flex","w-full","flex-row","flex-wrap","items-center","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){o&1&&(s(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.home-settings"),r()()(),v(6,Pb,1,0,"mat-progress-bar",2),c(7,"async"),v(8,Ab,1,0,"div",3),c(9,"async"),s(10,"mat-card-content",4)(11,"form",5),C("ngSubmit",function(){return t.save()}),s(12,"fieldset",6),c(13,"async"),s(14,"section",7)(15,"section",8),g(16,"tb-dashboard-autocomplete",9),c(17,"translate"),s(18,"mat-checkbox",10),p(19),c(20,"translate"),r()()(),s(21,"div",11)(22,"button",12),c(23,"async"),p(24),c(25,"translate"),r()()()()()()()),o&2&&(a(6),m("ngIf",u(7,10,t.isLoading$)),a(2),m("ngIf",u(9,12,t.isLoading$)===!1),a(3),m("formGroup",t.homeSettings),a(),m("disabled",u(13,14,t.isLoading$)),a(4),x("label",u(17,16,"dashboard.home-dashboard")),m("dashboardsScope","tenant")("selectFirstDashboard",!1),a(3),b(" ",u(20,18,"dashboard.home-dashboard-hide-toolbar")," "),a(3),m("disabled",u(23,20,t.isLoading$)||t.homeSettings.invalid||!t.homeSettings.dirty),a(2),b("",u(25,22,"action.save")," "))},dependencies:[U,ln,te,zt,Zt,ni,ui,ci,Ue,ue,W,X,ne,le,J,me,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();S();S();function Nb(i,n){if(i&1&&(s(0,"mat-option",15),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.resourceTypesTranslationMap.get(l))," ")}}function kb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"resource.title-required")," "))}function Ob(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"resource.title-max-length")," "))}function Bb(i,n){if(i&1&&(s(0,"mat-form-field",9)(1,"mat-label",5),p(2,"resource.title"),r(),g(3,"input",16),v(4,kb,3,3,"mat-error",17)(5,Ob,3,3,"mat-error",17),r()),i&2){let l=y();a(4),m("ngIf",l.entityForm.get("title").hasError("required")),a(),m("ngIf",l.entityForm.get("title").hasError("maxlength"))}}function Rb(i,n){if(i&1){let l=L();s(0,"tb-file-input",18),c(1,"translate"),c(2,"translate"),C("fileNameChanged",function(o){I(l);let t=y();return w(t.entityForm==null?null:t.entityForm.get("fileName").patchValue(o))}),r()}if(i&2){let l,e=y();x("label",u(1,9,e.entityForm.get("resourceType").value===e.resourceType.LWM2M_MODEL?"resource.resource-files":"resource.resource-file")),x("dropLabel",u(2,11,"resource.drop-resource-file-or")),m("readAsBinary",!0)("maxSizeByte",e.maxResourceSize)("allowedExtensions",e.getAllowedExtensions())("contentConvertFunction",e.convertToBase64File)("accept",e.getAcceptType())("multipleFile",e.entityForm.get("resourceType").value===e.resourceType.LWM2M_MODEL)("existingFileName",(l=e.entityForm.get("fileName"))==null?null:l.value)}}function Vb(i,n){i&1&&(s(0,"div",19)(1,"mat-form-field",20)(2,"mat-label",5),p(3,"resource.file-name"),r(),g(4,"input",21),r()())}var Gs=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.resourceType=gi,this.resourceTypes=[gi.LWM2M_MODEL,gi.PKCS_12,gi.JKS],this.resourceTypesTranslationMap=Wo,this.maxResourceSize=ji(this.store).maxResourceSize,this.destroy$=new Ft}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({title:[e?e.title:"",[T.required,T.maxLength(255)]],resourceType:[e?.resourceType?e.resourceType:gi.LWM2M_MODEL,T.required],fileName:[e?e.fileName:null,T.required],data:[e?e.data:null,this.isAdd?[T.required]:[]]})}updateForm(e){this.entityForm.patchValue(e)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceType").disable({emitEvent:!1}),this.entityForm.get("fileName").disable({emitEvent:!1}))}prepareFormValue(e){return this.isEdit&&!Be(e.data)&&delete e.data,super.prepareFormValue(e)}getAllowedExtensions(){try{return Pr.get(this.entityForm.get("resourceType").value)}catch{return""}}getAcceptType(){try{return Fr.get(this.entityForm.get("resourceType").value)}catch{return"*/*"}}convertToBase64File(e){return window.btoa(e)}onResourceIdCopied(){this.store.dispatch(new ze({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}observeResourceTypeChange(){this.entityForm.get("resourceType").valueChanges.pipe(go(gi.LWM2M_MODEL),mt(this.destroy$)).subscribe(e=>this.onResourceTypeChange(e))}onResourceTypeChange(e){e===this.resourceType.LWM2M_MODEL?(this.entityForm.get("title").disable({emitEvent:!1}),this.entityForm.patchValue({title:""},{emitEvent:!1})):this.entityForm.get("title").enable({emitEvent:!1}),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ct),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-resources-library"]],features:[G],decls:30,vars:35,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceType","required",""],[3,"value",4,"ngFor","ngForOf"],["class","mat-block",4,"ngIf"],["formControlName","data","required","",3,"label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data","required","",3,"fileNameChanged","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"downloadResource")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(11),c(12,"translate"),r(),s(13,"div",2)(14,"button",3),C("cbOnSuccess",function(){return t.onResourceIdCopied()}),g(15,"mat-icon",4),s(16,"span",5),p(17,"resource.copyId"),r()()()(),s(18,"div",6)(19,"form",7)(20,"fieldset",8),c(21,"async"),s(22,"mat-form-field",9)(23,"mat-label",5),p(24,"resource.resource-type"),r(),s(25,"mat-select",10),v(26,Nb,3,4,"mat-option",11),r()(),v(27,Bb,6,2,"mat-form-field",12)(28,Rb,3,13,"tb-file-input",13)(29,Vb,5,0,"div",14),r()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,21,t.isLoading$)),a(2),b(" ",u(4,23,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(6,25,t.isLoading$)),a(2),b(" ",u(8,27,"resource.download")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(10,29,t.isLoading$)),a(2),b(" ",u(12,31,"resource.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),m("formGroup",t.entityForm),a(),m("disabled",u(21,33,t.isLoading$)||!t.isEdit),a(6),m("ngForOf",t.resourceTypes),a(),m("ngIf",t.entityForm.get("resourceType").value!==t.resourceType.LWM2M_MODEL||!t.isAdd),a(),m("ngIf",t.isAdd),a(),m("ngIf",!t.isAdd))},dependencies:[xe,U,te,re,be,de,Se,Fe,vt,gt,Jt,ue,he,W,X,fe,ne,le,no,J,me,R],encapsulation:2});let i=n;return i})();S();function jb(i,n){if(i&1&&(s(0,"mat-option",5),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.resourceTypesTranslationMap.get(l))," ")}}var Us=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.resourceTypes=[gi.LWM2M_MODEL,gi.PKCS_12,gi.JKS],this.resourceTypesTranslationMap=Wo}resourceTypeChanged(e){this.entitiesTableConfig.componentsData.resourceType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-resources-table-header"]],features:[G],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,t){o&1&&(s(0,"mat-form-field",0)(1,"mat-label",1),p(2,"resource.resource-type"),r(),s(3,"mat-select",2),c(4,"translate"),C("ngModelChange",function(f){return t.resourceTypeChanged(f)}),s(5,"mat-option",3),p(6),c(7,"translate"),r(),v(8,jb,3,4,"mat-option",4),r()()),o&2&&(a(3),x("placeholder",u(4,4,"resource.resource-type")),m("ngModel",t.entitiesTableConfig.componentsData.resourceType),a(3),b(" ",u(7,6,"resource.all-types")," "),a(2),m("ngForOf",t.resourceTypes))},dependencies:[xe,de,Se,vt,gt,W,Qe,J,R],encapsulation:2});let i=n;return i})();var qs=(()=>{let n=class n{constructor(e,o,t,d,f){this.store=e,this.resourceService=o,this.translate=t,this.router=d,this.datePipe=f,this.config=new Le,this.resourceTypesTranslationMap=Wo,this.config.entityType=O.TB_RESOURCE,this.config.entityComponent=Gs,this.config.entityTranslations=Ge.get(O.TB_RESOURCE),this.config.entityResources=tt.get(O.TB_RESOURCE),this.config.headerComponent=Us,this.config.entityTitle=_=>_?_.title:"",this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","resource.title","60%"),new K("resourceType","resource.resource-type","40%",_=>this.translate.instant(this.resourceTypesTranslationMap.get(_.resourceType))),new K("tenantId","resource.system","60px",_=>Dt(_.tenantId.id===Ae))),this.config.cellActionDescriptors.push({name:this.translate.instant("resource.download"),icon:"file_download",isEnabled:()=>!0,onAction:(_,D)=>this.downloadResource(_,D)}),this.config.deleteEntityTitle=_=>this.translate.instant("resource.delete-resource-title",{resourceTitle:_.title}),this.config.deleteEntityContent=()=>this.translate.instant("resource.delete-resource-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("resource.delete-resources-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("resource.delete-resources-text"),this.config.entitiesFetchFunction=_=>this.resourceService.getResources(_,this.config.componentsData.resourceType),this.config.loadEntity=_=>this.resourceService.getResourceInfoById(_.id),this.config.saveEntity=_=>this.saveResource(_),this.config.deleteEntity=_=>this.resourceService.deleteResource(_.id),this.config.onEntityAction=_=>this.onResourceAction(_)}saveResource(e){if(Array.isArray(e.data)){let o=[];return e.data.forEach((t,d)=>{o.push({resourceType:e.resourceType,data:t,fileName:e.fileName[d],title:e.title})}),this.resourceService.saveResources(o,{resendRequest:!0}).pipe(rt(t=>t[0]))}else return this.resourceService.saveResource(e)}resolve(){this.config.tableTitle=this.translate.instant("resource.resources-library"),this.config.componentsData={resourceType:""};let e=Pt(this.store);return this.config.deleteEnabled=o=>this.isResourceEditable(o,e.authority),this.config.entitySelectionEnabled=o=>this.isResourceEditable(o,e.authority),this.config.detailsReadonly=o=>this.detailsReadonly(o,e.authority),this.config}openResource(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["resources","resources-library",o.id.id]);this.router.navigateByUrl(t).then(()=>{})}downloadResource(e,o){e&&e.stopPropagation(),this.resourceService.downloadResource(o.id.id).subscribe()}onResourceAction(e){switch(e.action){case"open":return this.openResource(e.event,e.entity),!0;case"downloadResource":return this.downloadResource(e.event,e.entity),!0}return!1}detailsReadonly(e,o){return e?.resourceType===gi.LWM2M_MODEL?!0:!this.isResourceEditable(e,o)}isResourceEditable(e,o){return o===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:o===E.SYS_ADMIN}};n.\u0275fac=function(o){return new(o||n)(P(A),P(as),P(ee),P(pe),P(Oe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();var lt=(i,n,l)=>{switch(l.entitiesTableConfig.entityType){case O.TB_RESOURCE:case O.OTA_PACKAGE:return l.entity?.title;default:return l.entity?.name}};S();S();var Ws=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,_,t,d,f),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.cd=f,this.fb=_,this.entityType=O,this.submitStrategies=[],this.processingStrategies=[]}ngOnInit(){super.ngOnInit()}buildForm(e){return this.fb.group({queue:[e]})}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}updateForm(e){this.entityForm.patchValue({queue:e},{emitEvent:!1})}prepareFormValue(e){return super.prepareFormValue(e.queue)}onQueueIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("queue.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(Je),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-queue"]],features:[G],decls:16,vars:22,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["formControlName","queue",3,"newQueue","systemQueue"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(7),c(8,"translate"),r(),s(9,"div",2)(10,"button",3),C("cbOnSuccess",function(f){return t.onQueueIdCopied(f)}),g(11,"mat-icon",4),s(12,"span",5),p(13,"queue.copyId"),r()()()(),s(14,"div",6),g(15,"tb-queue-form",7),r()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,14,t.isLoading$)),a(2),b(" ",u(4,16,"common.open-details-page")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(6,18,t.isLoading$)),a(2),b(" ",u(8,20,"queue.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(4),m("formGroup",t.entityForm),a(),m("newQueue",t.isAdd)("systemQueue",!0))},dependencies:[te,re,Jt,W,X,ne,le,J,lf,me,R],encapsulation:2});let i=n;return i})();var $s=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M){this.store=e,this.broadcast=o,this.queueService=t,this.customerService=d,this.dialogService=f,this.homeDialogs=_,this.router=D,this.translate=M,this.queueType=M0.TB_RULE_ENGINE,this.config=new Le,this.config.entityType=O.QUEUE,this.config.entityComponent=Ws,this.config.entityTranslations=Ge.get(O.QUEUE),this.config.entityResources=tt.get(O.QUEUE),this.config.deleteEntityTitle=Y=>this.translate.instant("queue.delete-queue-title",{queueName:Y.name}),this.config.deleteEntityContent=()=>this.translate.instant("queue.delete-queue-text"),this.config.deleteEntitiesTitle=Y=>this.translate.instant("queue.delete-queues-title",{count:Y}),this.config.deleteEntitiesContent=()=>this.translate.instant("queue.delete-queues-text"),this.config.onEntityAction=Y=>this.onQueueAction(Y)}resolve(e){return this.config.componentsData={queueType:this.queueType},this.store.pipe(qt(Sn),mi(1)).pipe(rt(()=>(this.config.tableTitle=this.translate.instant("admin.queues"),this.config.columns=this.configureColumns(),this.configureEntityFunctions(),this.config)))}configureColumns(){return[new K("name","admin.queue-name","25%"),new K("partitions","admin.queue-partitions","25%"),new K("submitStrategy","admin.queue-submit-strategy","25%",e=>this.translate.instant(D0.get(e.submitStrategy.type).label),()=>({}),!1),new K("processingStrategy","admin.queue-processing-strategy","25%",e=>this.translate.instant(F0.get(e.processingStrategy.type).label),()=>({}),!1)]}configureEntityFunctions(){this.config.entitiesFetchFunction=e=>this.queueService.getTenantQueuesByServiceType(e,this.queueType),this.config.loadEntity=e=>this.queueService.getQueueById(e.id),this.config.saveEntity=e=>this.queueService.saveQueue(e,this.queueType).pipe(_t(o=>this.queueService.getQueueById(o.id.id))),this.config.deleteEntity=e=>this.queueService.deleteQueue(e.id),this.config.deleteEnabled=e=>e&&e.name!=="Main",this.config.entitySelectionEnabled=e=>e&&e.name!=="Main"}onQueueAction(e){switch(e.action){case"open":return this.openQueue(e.event,e.entity),!0}return!1}openQueue(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["settings","queues",o.id.id]);this.router.navigateByUrl(t)}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Tn),P(Yu),P(qi),P(Wt),P(An),P(pe),P(ee))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();var Ub=["repositorySettingsComponent"],Js=(()=>{let n=class n extends It{constructor(e){super(e),this.store=e}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?.repositorySettingsForm}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-repository-admin-settings"]],viewQuery:function(o,t){if(o&1&&we(Ub,5),o&2){let d;Me(d=De())&&(t.repositorySettingsComponent=d.first)}},features:[G],decls:2,vars:0,consts:[["repositorySettingsComponent",""]],template:function(o,t){o&1&&g(0,"tb-repository-settings",null,0)},dependencies:[Ss],encapsulation:2});let i=n;return i})();S();var qb=["repositorySettingsComponent"],Wb=["autoCommitSettingsComponent"];function Hb(i,n){i&1&&g(0,"tb-repository-settings",null,1)}function zb(i,n){i&1&&g(0,"tb-auto-commit-settings",null,2)}var Qs=(()=>{let n=class n extends It{constructor(e){super(e),this.store=e,this.hasRepository$=this.store.pipe(qt(Oc))}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?this.repositorySettingsComponent?.repositorySettingsForm:this.autoCommitSettingsComponent?.autoCommitSettingsForm}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-auto-commit-admin-settings"]],viewQuery:function(o,t){if(o&1&&(we(qb,5),we(Wb,5)),o&2){let d;Me(d=De())&&(t.repositorySettingsComponent=d.first),Me(d=De())&&(t.autoCommitSettingsComponent=d.first)}},features:[G],decls:4,vars:4,consts:[["autoCommitSettings",""],["repositorySettingsComponent",""],["autoCommitSettingsComponent",""],[4,"ngIf","ngIfElse"]],template:function(o,t){if(o&1&&(v(0,Hb,2,0,"tb-repository-settings",3),c(1,"async"),v(2,zb,2,0,"ng-template",null,0,Et)),o&2){let d=q(3);m("ngIf",!u(1,2,t.hasRepository$))("ngIfElse",d)}},dependencies:[U,Ss,mf,me],encapsulation:2});let i=n;return i})();S();function $b(i,n){i&1&&g(0,"mat-progress-bar",25)}function Jb(i,n){i&1&&g(0,"div",26)}function Qb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.issuer-name-required")," "))}function Yb(i,n){if(i&1&&(Lt(0),s(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.issuer-name"),r(),g(4,"input",32),v(5,Qb,3,3,"mat-error",16),r(),Gt()),i&2){let l=y(2).$implicit;a(5),m("ngIf",l.get("issuerName").hasError("required")||l.get("issuerName").hasError("pattern"))}}function Kb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-message-template-required")," "))}function Xb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-message-template-pattern")," "))}function Zb(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function e1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function t1(i,n){if(i&1&&(s(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-message-template"),r(),g(4,"input",34),v(5,Kb,3,3,"mat-error",16)(6,Xb,3,3,"mat-error",16),r(),s(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.verification-code-lifetime"),r(),g(10,"input",35),v(11,Zb,3,3,"mat-error",16)(12,e1,3,3,"mat-error",16),r()()),i&2){let l=y(2).$implicit;a(5),m("ngIf",l.get("smsVerificationMessageTemplate").hasError("required")),a(),m("ngIf",l.get("smsVerificationMessageTemplate").hasError("pattern")),a(5),m("ngIf",l.get("verificationCodeLifetime").hasError("required")),a(),m("ngIf",l.get("verificationCodeLifetime").hasError("min")||l.get("verificationCodeLifetime").hasError("pattern"))}}function i1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function n1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function o1(i,n){if(i&1&&(s(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-code-lifetime"),r(),g(4,"input",35),v(5,i1,3,3,"mat-error",16)(6,n1,3,3,"mat-error",16),r()()),i&2){let l=y(2).$implicit;a(5),m("ngIf",l.get("verificationCodeLifetime").hasError("required")),a(),m("ngIf",l.get("verificationCodeLifetime").hasError("min")||l.get("verificationCodeLifetime").hasError("pattern"))}}function a1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.number-of-codes-required")," "))}function r1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.number-of-codes-pattern")," "))}function s1(i,n){if(i&1&&(s(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-codes"),r(),g(4,"input",36),v(5,a1,3,3,"mat-error",16)(6,r1,3,3,"mat-error",16),r()()),i&2){let l=y(2).$implicit;a(5),m("ngIf",l.get("codesQuantity").hasError("required")),a(),m("ngIf",l.get("codesQuantity").hasError("min")||l.get("codesQuantity").hasError("pattern"))}}function l1(i,n){if(i&1&&(Lt(0,29),v(1,Yb,6,1,"ng-container",30)(2,t1,13,4,"div",31)(3,o1,7,2,"div",30)(4,s1,7,2,"div",30),Gt()),i&2){let l=y().$implicit,e=y();m("ngSwitch",l.get("providerType").value),a(),m("ngSwitchCase",e.twoFactorAuthProviderType.TOTP),a(),m("ngSwitchCase",e.twoFactorAuthProviderType.SMS),a(),m("ngSwitchCase",e.twoFactorAuthProviderType.EMAIL),a(),m("ngSwitchCase",e.twoFactorAuthProviderType.BACKUP_CODE)}}function m1(i,n){i&1&&g(0,"mat-divider")}function p1(i,n){if(i&1){let l=L();Lt(0),s(1,"mat-expansion-panel",27)(2,"mat-expansion-panel-header")(3,"mat-panel-title",20)(4,"mat-slide-toggle",28),C("mousedown",function(o){let t=I(l),d=t.$implicit,f=t.index,_=y();return w(_.toggleExtensionPanel(o,f,d.get("enable").value))}),p(5),c(6,"translate"),r()()(),v(7,l1,5,5,"ng-template",22),r(),v(8,m1,1,0,"mat-divider",16),Gt()}if(i&2){let l=n.$implicit,e=n.index,o=n.last,t=y();a(),m("formGroupName",e),a(4),b(" ",u(6,3,t.twoFactorAuthProvidersData.get(l.value.providerType).name)," "),a(3),m("ngIf",!o)}}function d1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.total-allowed-time-for-verification-required")," "))}function c1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.total-allowed-time-for-verification-pattern")," "))}function u1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.retry-verification-code-period-required")," "))}function f1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.retry-verification-code-period-pattern")," "))}function g1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.max-verification-failures-before-user-lockout-pattern")," "))}function h1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.number-of-checking-attempts-required")," "))}function b1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.number-of-checking-attempts-pattern")," "))}function v1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.within-time-required")," "))}function y1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.2fa.within-time-pattern")," "))}function _1(i,n){if(i&1&&(s(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-checking-attempts"),r(),g(4,"input",37),v(5,h1,3,3,"mat-error",16)(6,b1,3,3,"mat-error",16),r(),s(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.within-time"),r(),g(10,"input",38),v(11,v1,3,3,"mat-error",16)(12,y1,3,3,"mat-error",16),r()()),i&2){let l=y();a(5),m("ngIf",l.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("required")),a(),m("ngIf",l.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("pattern")||l.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("min")),a(5),m("ngIf",l.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("required")),a(),m("ngIf",l.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("pattern")||l.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("min"))}}var Ys=(()=>{let n=class n extends It{constructor(e,o,t){super(e),this.store=e,this.twoFaService=o,this.fb=t,this.destroy$=new Ft,this.posIntValidation=[T.required,T.min(1),T.pattern(/^\d*$/)],this.twoFactorAuthProviderType=yt,this.twoFactorAuthProvidersData=Cs,this.showMainLoadingBar=!1}ngOnInit(){this.build2faSettingsForm(),this.twoFaService.getTwoFaSettings().subscribe(e=>{this.setAuthConfigFormValue(e)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}confirmForm(){return this.twoFaFormGroup}save(){if(this.twoFaFormGroup.valid){let e=this.twoFaFormGroup.getRawValue();this.joinRateLimit(e,"verificationCodeCheckRateLimit");let o=e.providers.filter(d=>d.enable);o.forEach(d=>delete d.enable);let t=Object.assign(e,{providers:o});this.twoFaService.saveTwoFaSettings(t).subscribe(d=>{this.setAuthConfigFormValue(d),this.twoFaFormGroup.markAsUntouched(),this.twoFaFormGroup.markAsPristine()})}else Object.keys(this.twoFaFormGroup.controls).forEach(e=>{this.twoFaFormGroup.get(e).markAsTouched({onlySelf:!0})})}toggleExtensionPanel(e,o,t){e&&e.stopPropagation(),t?this.getByIndexPanel(o).open():this.getByIndexPanel(o).close()}trackByElement(e,o){return o}get providersForm(){return this.twoFaFormGroup.get("providers")}build2faSettingsForm(){this.twoFaFormGroup=this.fb.group({maxVerificationFailuresBeforeUserLockout:[30,[T.pattern(/^\d*$/),T.min(0),T.max(65535)]],totalAllowedTimeForVerification:[3600,[T.required,T.min(60),T.pattern(/^\d*$/)]],verificationCodeCheckRateLimitEnable:[!1],verificationCodeCheckRateLimitNumber:[{value:3,disabled:!0},this.posIntValidation],verificationCodeCheckRateLimitTime:[{value:900,disabled:!0},this.posIntValidation],minVerificationCodeSendPeriod:["30",[T.required,T.min(5),T.pattern(/^\d*$/)]],providers:this.fb.array([])}),Object.values(yt).forEach(e=>{this.buildProvidersSettingsForm(e)}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{e?(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").enable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").enable({emitEvent:!1})):(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").disable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").disable({emitEvent:!1}))}),this.providersForm.valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{let o=e.filter(d=>d.enable),t=Object.values(yt).indexOf(yt.BACKUP_CODE);!o.length||o.length===1&&o[0].providerType===yt.BACKUP_CODE?(this.providersForm.at(t).get("enable").setValue(!1,{emitEvent:!1}),this.providersForm.at(t).disable({emitEvent:!1}),this.providersForm.at(t).get("providerType").enable({emitEvent:!1})):this.providersForm.at(t).get("enable").enable({emitEvent:!1})})}setAuthConfigFormValue(e){let[o,t]=this.splitRateLimit(e?.verificationCodeCheckRateLimit),d=e?.providers.map(_=>_.providerType)||[],f=Object.assign({},e,{verificationCodeCheckRateLimitEnable:o>0,verificationCodeCheckRateLimitNumber:o||3,verificationCodeCheckRateLimitTime:t||900,providers:[]});o>0&&this.getByIndexPanel(this.providersForm.length).open(),Object.values(yt).forEach((_,D)=>{let M=d.indexOf(_);M>-1?(f.providers.push(Object.assign(e.providers[M],{enable:!0})),this.getByIndexPanel(D).open()):f.providers.push({enable:!1})}),this.twoFaFormGroup.patchValue(f)}buildProvidersSettingsForm(e){let o={providerType:[e],enable:[!1]};switch(e){case yt.TOTP:o.issuerName=[{value:"ThingsBoard",disabled:!0},[T.required,T.pattern(/^(?!^\s+$).*$/)]];break;case yt.SMS:o.smsVerificationMessageTemplate=[{value:"Verification code: ${code}",disabled:!0},[T.required,T.pattern(/\${code}/)]],o.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case yt.EMAIL:o.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case yt.BACKUP_CODE:o.codesQuantity=[{value:10,disabled:!0},this.posIntValidation];break}let t=this.fb.group(o);t.get("enable").valueChanges.pipe(mt(this.destroy$)).subscribe(d=>{d?t.enable({emitEvent:!1}):(t.disable({emitEvent:!1}),t.get("enable").enable({emitEvent:!1}),t.get("providerType").enable({emitEvent:!1}))}),this.providersForm.push(t,{emitEvent:!1})}getByIndexPanel(e){return this.expansionPanel.find((o,t)=>t===e)}splitRateLimit(e){if($o(e)){let[o,t]=e.split(":");return[parseInt(o,10),parseInt(t,10)]}return[0,0]}joinRateLimit(e,o){e[`${o}Enable`]&&(e[o]=[e[`${o}Number`],e[`${o}Time`]].join(":")),delete e[`${o}Enable`],delete e[`${o}Number`],delete e[`${o}Time`]}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Hi),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-2fa-settings"]],viewQuery:function(o,t){if(o&1&&we(Li,5),o&2){let d;Me(d=De())&&(t.expansionPanel=d)}},features:[G],decls:54,vars:26,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","twoFactorAuthentication"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[3,"ngSubmit","formGroup"],[3,"disabled"],["formArrayName","providers",1,"fields-group"],["translate","",1,"group-title"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fields-group"],[1,"input-row","flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["translate",""],["matInput","","required","","formControlName","totalAllowedTimeForVerification","type","number","step","1","min","60"],[4,"ngIf"],["matInput","","required","","formControlName","minVerificationCodeSendPeriod","type","number","step","1","min","5"],["matInput","","formControlName","maxVerificationFailuresBeforeUserLockout","type","number","step","1","min","0","max","65535"],[1,"provider"],[1,"flex","items-center","justify-start"],["formControlName","verificationCodeCheckRateLimitEnable",3,"mousedown"],["matExpansionPanelContent",""],[1,"flex","flex-row","items-center","justify-end","gap-2"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"provider",3,"formGroupName"],["formControlName","enable",3,"mousedown"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex flex-row xs:flex-col gt-xs:gap-2",4,"ngSwitchCase"],["matInput","","formControlName","issuerName","required",""],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","smsVerificationMessageTemplate","required",""],["matInput","","formControlName","verificationCodeLifetime","type","number","step","1","min","1","required",""],["matInput","","formControlName","codesQuantity","type","number","step","1","min","1","required",""],["matInput","","formControlName","verificationCodeCheckRateLimitNumber","required","","type","number","step","1","min","1"],["matInput","","formControlName","verificationCodeCheckRateLimitTime","required","","type","number","step","1","min","1"]],template:function(o,t){o&1&&(s(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.2fa.2fa"),r()(),g(6,"span",2)(7,"div",3),r(),v(8,$b,1,0,"mat-progress-bar",4),c(9,"async"),v(10,Jb,1,0,"div",5),c(11,"async"),s(12,"mat-card-content")(13,"form",6),C("ngSubmit",function(){return t.save()}),s(14,"fieldset",7),c(15,"async"),s(16,"div")(17,"fieldset",8)(18,"legend",9),p(19,"admin.2fa.available-providers"),r(),v(20,p1,9,5,"ng-container",10),r(),s(21,"fieldset",11)(22,"legend",9),p(23,"admin.2fa.verification-limitations"),r(),s(24,"div",12)(25,"mat-form-field",13)(26,"mat-label",14),p(27,"admin.2fa.total-allowed-time-for-verification"),r(),g(28,"input",15),v(29,d1,3,3,"mat-error",16)(30,c1,3,3,"mat-error",16),r(),s(31,"mat-form-field",13)(32,"mat-label",14),p(33,"admin.2fa.retry-verification-code-period"),r(),g(34,"input",17),v(35,u1,3,3,"mat-error",16)(36,f1,3,3,"mat-error",16),r(),s(37,"mat-form-field",13)(38,"mat-label",14),p(39,"admin.2fa.max-verification-failures-before-user-lockout"),r(),g(40,"input",18),v(41,g1,3,3,"mat-error",16),r()(),s(42,"mat-expansion-panel",19)(43,"mat-expansion-panel-header")(44,"mat-panel-title",20)(45,"mat-slide-toggle",21),C("mousedown",function(f){return t.toggleExtensionPanel(f,t.providersForm.length,t.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").value)}),r(),p(46),c(47,"translate"),r()(),v(48,_1,13,4,"ng-template",22),r()()(),s(49,"div",23)(50,"button",24),c(51,"async"),p(52),c(53,"translate"),r()()()()()()()),o&2&&(a(8),m("ngIf",u(9,14,t.isLoading$)),a(2),m("ngIf",!u(11,16,t.isLoading$)),a(3),m("formGroup",t.twoFaFormGroup),a(),m("disabled",u(15,18,t.isLoading$)),a(6),m("ngForOf",t.providersForm.controls)("ngForTrackBy",t.trackByElement),a(9),m("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("required")),a(),m("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("pattern")||t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("min")),a(5),m("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("required")),a(),m("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("pattern")||t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("min")),a(5),m("ngIf",t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("pattern")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("min")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("max")),a(5),b(" ",u(47,20,"admin.2fa.verification-code-check-rate-limit")," "),a(4),m("disabled",u(51,22,t.isLoading$)||t.twoFaFormGroup.invalid||!t.twoFaFormGroup.dirty),a(2),b(" ",u(53,24,"action.save")," "))},dependencies:[xe,U,yn,_n,$t,te,Zt,ni,ui,ci,Ue,be,de,Se,Fe,sn,ht,Li,nn,on,eo,ue,he,Gi,W,X,fe,Ui,an,ne,le,bt,ou,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}','@charset "UTF-8";@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:90%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{margin:8px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px;position:relative;padding-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3;width:fit-content;margin:0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{padding:8px 8px 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:none;margin:1px 0 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]{overflow:inherit}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{padding:0 24px 0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-content{font-size:16px}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-header>.mat-content{overflow:inherit}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-body{padding:0 16px 8px 8px}']});let i=n;return i})();S();S();S();function C1(i,n){if(i&1){let l=L();s(0,"mat-tab",2,0),c(2,"translate"),s(3,"tb-version-control",3),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.title)("externalEntityId",e.entity.externalId||e.entity.id)}}var Ks=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}isTenantWidgetsBundle(){return this.entity&&this.entity.tenantId.id!==Ae}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-widgets-bundle-tabs"]],features:[G],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,C1,4,7,"mat-tab",1),o&2&&m("ngIf",t.isTenantWidgetsBundle()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[U,St,ai,R],encapsulation:2});let i=n;return i})();var Xs=(()=>{let n=class n{constructor(e,o,t,d,f,_,D){this.store=e,this.dialogService=o,this.widgetsService=t,this.translate=d,this.importExport=f,this.datePipe=_,this.router=D,this.config=new Le,this.config.entityType=O.WIDGETS_BUNDLE,this.config.entityComponent=gs,this.config.entityTabsComponent=Ks,this.config.entityTranslations=Ge.get(O.WIDGETS_BUNDLE),this.config.entityResources=tt.get(O.WIDGETS_BUNDLE),this.config.defaultSortOrder={property:"title",direction:ei.ASC},this.config.rowPointer=!0,this.config.entityTitle=M=>M?M.title:"",this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","widgets-bundle.title","100%"),new K("tenantId","widgets-bundle.system","60px",M=>Dt(M.tenantId.id===Ae))),this.config.addActionDescriptors.push({name:this.translate.instant("widgets-bundle.create-new-widgets-bundle"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:M=>this.config.getTable().addEntity(M)},{name:this.translate.instant("widgets-bundle.import"),icon:"file_upload",isEnabled:()=>!0,onAction:M=>this.importWidgetsBundle(M)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widgets-bundle.export"),icon:"file_download",isEnabled:()=>!0,onAction:(M,Y)=>this.exportWidgetsBundle(M,Y)},{name:this.translate.instant("widgets-bundle.widgets-bundle-details"),icon:"edit",isEnabled:()=>!0,onAction:(M,Y)=>this.config.toggleEntityDetails(M,Y)}),this.config.deleteEntityTitle=M=>this.translate.instant("widgets-bundle.delete-widgets-bundle-title",{widgetsBundleTitle:M.title}),this.config.deleteEntityContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundle-text"),this.config.deleteEntitiesTitle=M=>this.translate.instant("widgets-bundle.delete-widgets-bundles-title",{count:M}),this.config.deleteEntitiesContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundles-text"),this.config.loadEntity=M=>this.widgetsService.getWidgetsBundle(M.id),this.config.saveEntity=M=>this.widgetsService.saveWidgetsBundle(M),this.config.deleteEntity=M=>this.widgetsService.deleteWidgetsBundle(M.id),this.config.onEntityAction=M=>this.onWidgetsBundleAction(M,this.config),this.config.handleRowClick=(M,Y)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(M,Y):this.openWidgetsBundle(M,Y),!0),this.config.entityAdded=M=>{this.openWidgetsBundle(null,M)}}resolve(){this.config.tableTitle=this.translate.instant("widgets-bundle.widgets-bundles");let e=Pt(this.store);this.config.deleteEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.entitySelectionEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.detailsReadonly=t=>!this.isWidgetsBundleEditable(t,e.authority);let o=ji(this.store);return this.config.entitiesFetchFunction=t=>this.widgetsService.getWidgetBundles(t),this.config}isWidgetsBundleEditable(e,o){return o===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:o===E.SYS_ADMIN}importWidgetsBundle(e){this.importExport.importWidgetsBundle().subscribe(o=>{o&&this.config.updateData()})}openWidgetsBundle(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-bundles/${o.id.id}/widgetTypes`)}openWidgetsBundleDetails(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree(["details",o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}exportWidgetsBundle(e,o){e&&e.stopPropagation(),this.importExport.exportWidgetsBundle(o.id.id)}onWidgetsBundleAction(e,o){switch(e.action){case"open":return this.openWidgetsBundle(e.event,e.entity),!0;case"openDetails":return this.openWidgetsBundleDetails(e.event,e.entity,o),!0;case"export":return this.exportWidgetsBundle(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Wt),P(si),P(ee),P(Pi),P(Oe),P(pe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();function S1(i,n){i&1&&g(0,"mat-progress-bar",16)}function T1(i,n){i&1&&g(0,"div",17)}function x1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"widget.title-required")," "))}var Aa=(()=>{let n=class n extends nt{constructor(e,o,t,d,f){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.fb=f,this.dialogTitle="widget.save-widget-as",this.saveAsActionTitle="action.saveAs",Pt(e).authority===E.TENANT_ADMIN?this.bundlesScope="tenant":this.bundlesScope="system",this.data?.dialogTitle&&(this.dialogTitle=this.data.dialogTitle),this.data?.saveAsActionTitle&&(this.saveAsActionTitle=this.data.saveAsActionTitle)}ngOnInit(){this.saveWidgetTypeAsFormGroup=this.fb.group({title:[this.data?.title,[T.required]],widgetsBundle:[null]})}cancel(){this.dialogRef.close(null)}saveAs(){let e=this.saveWidgetTypeAsFormGroup.get("title").value,o=this.saveWidgetTypeAsFormGroup.get("widgetsBundle").value?.id?.id,t={widgetName:e,widgetBundleId:o};this.dialogRef.close(t)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it),h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-save-widget-type-as-dialog"]],features:[G],decls:30,vars:23,consts:[[2,"min-width","360px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","widgetsBundle","createNew","",3,"bundlesScope"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){o&1&&(s(0,"form",0),C("ngSubmit",function(){return t.saveAs()}),s(1,"mat-toolbar",1)(2,"h2",2),p(3),r(),g(4,"span",3),s(5,"button",4),C("click",function(){return t.cancel()}),s(6,"mat-icon",5),p(7,"close"),r()()(),v(8,S1,1,0,"mat-progress-bar",6),c(9,"async"),v(10,T1,1,0,"div",7),c(11,"async"),s(12,"div",8)(13,"span",2),p(14),r(),s(15,"mat-form-field",9)(16,"mat-label",2),p(17,"widget.title"),r(),g(18,"input",10),v(19,x1,3,3,"mat-error",11),r(),g(20,"tb-widgets-bundle-select",12),r(),s(21,"div",13)(22,"button",14),c(23,"async"),C("click",function(){return t.cancel()}),p(24),c(25,"translate"),r(),s(26,"button",15),c(27,"async"),p(28),c(29,"translate"),r()()()),o&2&&(m("formGroup",t.saveWidgetTypeAsFormGroup),a(3),B(t.dialogTitle),a(5),m("ngIf",u(9,11,t.isLoading$)),a(2),m("ngIf",!u(11,13,t.isLoading$)),a(4),B(t.dialogTitle),a(5),m("ngIf",t.saveWidgetTypeAsFormGroup.get("title").hasError("required")),a(),x("bundlesScope",t.bundlesScope),a(2),m("disabled",u(23,15,t.isLoading$)),a(2),b(" ",u(25,17,"action.cancel")," "),a(2),m("disabled",u(27,19,t.isLoading$)||t.saveWidgetTypeAsFormGroup.invalid||!t.saveWidgetTypeAsFormGroup.dirty),a(2),b(" ",u(29,21,t.saveAsActionTitle)," "))},dependencies:[U,v0,te,Ie,re,Ue,be,de,Se,Fe,at,Nt,dt,ue,he,W,X,fe,ne,le,J,me,R],encapsulation:2});let i=n;return i})();S();var E1=i=>({self:{description:"Built-in variable <b>self</b> that is a reference to the widget instance",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L350" target="_blank">WidgetTypeInstance</a>',meta:"object",children:Ce({onInit:{description:"The first function which is called when widget is ready for initialization.<br>Should be used to prepare widget DOM, process widget settings and initial subscription information.",meta:"function"},onDataUpdated:{description:'Called when the new data is available from the widget subscription.<br>Latest data can be accessed from the <code>defaultSubscription</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onResize:{description:'Called when widget container is resized. Latest <code>width</code> and <code>height</code> can be obtained from <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onEditModeChanged:{description:'Called when dashboard editing mode is changed. Latest mode is handled by <code>isEdit</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onMobileModeChanged:{description:'Called when dashboard view width crosses mobile breakpoint. Latest state is handled by <code>isMobile</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onDestroy:{description:"Called when widget element is destroyed. Should be used to cleanup all resources if necessary.",meta:"function"},getSettingsForm:{description:"Optional function returning widget settings form array as alternative to <b>Settings form</b> tab of settings section.",meta:"function",return:{description:"An array of widget settings form properties",type:"Array&lt;FormProperty&gt;"}},getDataKeySettingsForm:{description:"Optional function returning particular data key settings form array as alternative to <b>Data key settings form</b> tab of settings section.",meta:"function",return:{description:"An array of data key settings form properties",type:"Array&lt;FormProperty&gt;"}},getSettingsSchema:{description:"<b>Deprecated</b>. Use getSettingsForm() function.",meta:"function",return:{description:"An widget settings schema json",type:"object"}},getDataKeySettingsSchema:{description:"<b>Deprecated</b>. Use getDataKeySettingsForm() function.",meta:"function",return:{description:"A particular data key settings schema json",type:"object"}},typeParameters:{description:"Returns object describing widget datasource parameters.",meta:"function",return:{description:"An object describing widget datasource parameters.",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L146" target="_blank">WidgetTypeParameters</a>'}},actionSources:{description:"Returns map describing available widget action sources used to define user actions.",meta:"function",return:{description:"A map of action sources by action source id.",type:'{[actionSourceId: string]: <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L118" target="_blank">WidgetActionSource</a>}'}}},pf(i))}}),Wf=i=>new zo(E1(i));var F1=["topPanel"],P1=["topLeftPanel"],A1=["topRightPanel"],N1=["bottomPanel"],k1=["javascriptPanel"],O1=["framePanel"],B1=["htmlInput"],R1=["cssInput"],V1=["javascriptInput"],j1=["widgetIFrame"];function L1(i,n){if(i&1&&(s(0,"mat-option",69),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.widgetTypesDataMap.get(e.widgetTypes[l]).name)," ")}}function G1(i,n){if(i&1){let l=L();s(0,"button",27),c(1,"translate"),c(2,"async"),C("click",function(){I(l);let o=y();return w(o.saveWidget())}),s(3,"mat-icon"),p(4,"save"),r(),s(5,"span",24),p(6,"action.save"),r()()}if(i&2){let l=y();ho("matTooltip","",u(1,4,"widget.save")," (CTRL + S)"),m("disabled",u(2,6,l.isLoading$)||l.saveDisabled())("tb-circular-progress",l.saveWidgetPending)}}function U1(i,n){if(i&1){let l=L();s(0,"button",32),c(1,"async"),C("click",function(){I(l);let o=y();return w(o.saveWidget())}),s(2,"mat-icon"),p(3,"save"),r(),s(4,"span",24),p(5,"action.save"),r()()}if(i&2){let l=y();m("disabled",u(1,1,l.isLoading$)||l.saveDisabled())}}function q1(i,n){if(i&1){let l=L();s(0,"div",70)(1,"tb-resource-autocomplete",71),c(2,"translate"),et("ngModelChange",function(o){let t=I(l).$implicit;return Ze(t.url,o)||(t.url=o),w(o)}),C("ngModelChange",function(){I(l);let o=y();return w(o.isDirty=!0)}),r(),s(3,"mat-checkbox",72),et("ngModelChange",function(o){let t=I(l).$implicit;return Ze(t.isModule,o)||(t.isModule=o),w(o)}),C("ngModelChange",function(){I(l);let o=y();return w(o.isDirty=!0)}),p(4),c(5,"translate"),r(),s(6,"button",73),c(7,"translate"),c(8,"async"),C("click",function(){let o=I(l).index,t=y();return w(t.removeResource(o))}),s(9,"mat-icon"),p(10,"close"),r()()()}if(i&2){let l=n.$implicit,e=y();a(),x("placeholder",u(2,7,"widget.resource-url")),m("allowAutocomplete",l.isModule),Xe("ngModel",l.url),a(2),Xe("ngModel",l.isModule),a(),b(" ",u(5,9,"widget.resource-is-extension")," "),a(2),x("matTooltip",u(7,11,"widget.remove-resource")),m("disabled",u(8,13,e.isLoading$))}}function W1(i,n){if(i&1){let l=L();s(0,"mat-form-field",52)(1,"mat-label",24),p(2,"widget.latest-data-key-settings-form-selector"),r(),s(3,"input",58),et("ngModelChange",function(o){I(l);let t=y();return Ze(t.widget.latestDataKeySettingsDirective,o)||(t.widget.latestDataKeySettingsDirective=o),w(o)}),C("ngModelChange",function(){I(l);let o=y();return w(o.isDirty=!0)}),r()()}if(i&2){let l=y();a(3),Xe("ngModel",l.widget.latestDataKeySettingsDirective)}}function H1(i,n){if(i&1){let l=L();s(0,"mat-form-field",52)(1,"mat-label",24),p(2,"widget.basic-mode-form-selector"),r(),s(3,"input",58),et("ngModelChange",function(o){I(l);let t=y();return Ze(t.widget.basicModeDirective,o)||(t.widget.basicModeDirective=o),w(o)}),C("ngModelChange",function(){I(l);let o=y();return w(o.isDirty=!0)}),r()()}if(i&2){let l=y();a(3),Xe("ngModel",l.widget.basicModeDirective)}}function z1(i,n){i&1&&(s(0,"div",74),g(1,"mat-spinner",75),r())}var el=(()=>{let n=class n extends It{get isDirty(){return this._isDirty||this.isEditModeWidget}set isDirty(e){e||(this.isEditModeWidget=!1),this._isDirty=e}constructor(e,o,t,d,f,_,D,M,Y,ke,Ke,xt,za){super(e),this.store=e,this.window=o,this.route=t,this.router=d,this.widgetService=f,this.translate=_,this.raf=D,this.dialog=M,this.popoverService=Y,this.renderer=ke,this.viewContainerRef=Ke,this.customTranslate=xt,this.http=za,this.widgetTypes=Ti,this.allWidgetTypes=Object.keys(Ti),this.widgetTypesDataMap=Zo,this.isEditModeWidget=!1,this._isDirty=!1,this.fullscreen=!1,this.htmlFullscreen=!1,this.cssFullscreen=!1,this.javascriptFullscreen=!1,this.iFrameFullscreen=!1,this.aceEditors=[],this.editorsResizeCafs={},this.onWindowMessageListener=this.onWindowMessage.bind(this),this.iframeWidgetEditModeInited=!1,this.saveWidgetPending=!1,this.saveWidgetAsPending=!1,this.gotError=!1,this.errorMarkers=[],this.errorAnnotationId=-1,this.hotKeys=[],this.updateBreadcrumbs=new wt,this.rxSubscriptions=new Array,this.authUser=Pt(e),this.rxSubscriptions.push(this.route.data.subscribe(jg=>{this.init(jg)})),this.initHotKeys()}init(e){if(this.widgetTypeDetails=e.widgetEditorData.widgetTypeDetails,this.widget=e.widgetEditorData.widget,this.authUser.authority===E.TENANT_ADMIN?this.isReadOnly=this.widgetTypeDetails&&this.widgetTypeDetails.tenantId.id===Ae:this.isReadOnly=this.authUser.authority!==E.SYS_ADMIN,this.widgetTypeDetails){let o=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(o)}this.origWidget=Tt(this.widget),this.widgetTypeDetails||(this.isDirty=!0)}ngOnInit(){this.initSplitLayout(),this.initAceEditors(),this.iframe=$(this.widgetIFrameElmRef.nativeElement),this.window.addEventListener("message",this.onWindowMessageListener),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe.attr("src","/widget-editor")}ngOnDestroy(){this.window.removeEventListener("message",this.onWindowMessageListener),this.aceEditors.forEach(e=>e.destroy()),this.aceResize$.disconnect(),this.rxSubscriptions.forEach(e=>{e.unsubscribe()}),this.rxSubscriptions.length=0}initHotKeys(){this.hotKeys.push(new ta("ctrl+q",e=>(!Vr(this.store)&&!this.undoDisabled()&&(e.preventDefault(),this.undoWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.undo"))),this.hotKeys.push(new ta("ctrl+s",e=>(!Vr(this.store)&&!this.saveDisabled()&&(e.preventDefault(),this.saveWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.save"))),this.hotKeys.push(new ta("shift+ctrl+s",e=>(!Vr(this.store)&&!this.saveAsDisabled()&&(e.preventDefault(),this.saveWidgetAs()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.saveAs"))),this.hotKeys.push(new ta("shift+ctrl+f",e=>(e.preventDefault(),this.fullscreen=!this.fullscreen,!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.toggle-fullscreen"))),this.hotKeys.push(new ta("ctrl+enter",e=>(e.preventDefault(),this.applyWidgetScript(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.run")))}initSplitLayout(){Split([this.topPanelElmRef.nativeElement,this.bottomPanelElmRef.nativeElement],{sizes:[35,65],gutterSize:8,cursor:"row-resize",direction:"vertical"}),Split([this.topLeftPanelElmRef.nativeElement,this.topRightPanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"}),Split([this.javascriptPanelElmRef.nativeElement,this.framePanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"})}initAceEditors(){this.aceResize$=new ResizeObserver(o=>{o.forEach(t=>{let d=this.aceEditors.find(f=>f.container===t.target);this.onAceEditorResize(d)})});let e=[];e.push(this.createAceEditor(this.htmlInputElmRef,"html").pipe(Ot(o=>{this.htmlEditor=o,this.htmlEditor.on("input",()=>{let t=this.htmlEditor.getValue();this.widget.templateHtml!==t&&(this.widget.templateHtml=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.cssInputElmRef,"css").pipe(Ot(o=>{this.cssEditor=o,this.cssEditor.on("input",()=>{let t=this.cssEditor.getValue();this.widget.templateCss!==t&&(this.widget.templateCss=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.javascriptInputElmRef,"javascript").pipe(Ot(o=>{this.jsEditor=o,this.jsEditor.on("input",()=>{let t=this.jsEditor.getValue();this.controllerScriptBody!==t&&(this.controllerScriptBody=t,this.isDirty=!0)}),this.jsEditor.on("change",()=>{this.cleanupJsErrors()}),this.jsEditor.completer||(this.jsEditor.execCommand("startAutocomplete"),this.jsEditor.completer.detach()),this.jsEditor.completer.popup.container.style.width="500px",this.initialCompleters=this.jsEditor.completers||[]}))),jt(e).subscribe(()=>{this.setAceEditorValues()})}setAceEditorValues(){this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1),this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1),this.jsEditor.setValue(this.controllerScriptBody?this.controllerScriptBody:"",-1),this.updateControllerScriptCompleters()}createAceEditor(e,o){let t=e.nativeElement,d={mode:`ace/mode/${o}`,showGutter:!0,showPrintMargin:!0},f={enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0};return d=Ce(Ce({},d),f),Mu().pipe(rt(_=>{let D=_.edit(t,d);return D.session.setUseWrapMode(!0),this.aceEditors.push(D),this.aceResize$.observe(t),D}))}onAceEditorResize(e){this.editorsResizeCafs[e.id]&&(this.editorsResizeCafs[e.id](),delete this.editorsResizeCafs[e.id]),this.editorsResizeCafs[e.id]=this.raf.raf(()=>{e.resize(),e.renderer.updateFull()})}onWindowMessage(e){let o;if(e.data)try{o=JSON.parse(e.data)}catch{}if(o)switch(o.type){case"widgetException":this.onWidgetException(o.data);break;case"widgetEditModeInited":this.onWidgetEditModeInited();break;case"widgetEditUpdated":this.onWidgetEditUpdated(o.data),this.onWidgetEditModeToggled(!1);break;case"widgetEditModeToggle":this.onWidgetEditModeToggled(o.data);break}}onWidgetEditModeInited(){this.iframeWidgetEditModeInited=!0,(this.saveWidgetPending||this.saveWidgetAsPending)&&(this.saveWidgetTimeout||(this.saveWidgetTimeout=setTimeout(()=>{this.gotError?(this.store.dispatch(new ze({message:this.translate.instant("widget.unable-to-save-widget-error"),type:"error"})),this.saveWidgetPending=!1,this.saveWidgetAsPending=!1):this.saveWidgetPending?this.commitSaveWidget():this.saveWidgetAsPending&&this.commitSaveWidgetAs(),this.saveWidgetTimeout=void 0},1500)))}onWidgetEditUpdated(e){this.widget.sizeX=e.sizeX/2,this.widget.sizeY=e.sizeY/2,this.widget.defaultConfig=JSON.stringify(e.config),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.isDirty=!0}onWidgetEditModeToggled(e){this.isEditModeWidget=e}onWidgetException(e){if(!this.gotError){this.gotError=!0;let o="Error:";if(e.message&&(o+=" "+e.message),e.lineNumber&&(o+="<br>Line "+e.lineNumber,e.columnNumber&&(o+=" column "+e.columnNumber),o+=" of script."),!this.saveWidgetPending&&!this.saveWidgetAsPending&&this.store.dispatch(new ze({message:o,type:"error",target:"javascriptPanel"})),e.lineNumber){let t=e.lineNumber-1,d=0;e.columnNumber&&(d=e.columnNumber);let f=this.jsEditor.session.addMarker(new Du(t,0,t,1/0),"ace_active-line","screenLine");this.errorMarkers.push(f);let _=this.jsEditor.session.getAnnotations(),D={row:t,column:d,text:e.message,type:"error"};this.errorAnnotationId=_.push(D)-1,this.jsEditor.session.setAnnotations(_)}}}cleanupJsErrors(){if(this.store.dispatch(new Qc({})),this.errorMarkers.forEach(e=>{this.jsEditor.session.removeMarker(e)}),this.errorMarkers.length=0,this.errorAnnotationId>-1){let e=this.jsEditor.session.getAnnotations();e.splice(this.errorAnnotationId,1),this.jsEditor.session.setAnnotations(e),this.errorAnnotationId=-1}}commitSaveWidget(){let e=this.widgetTypeDetails&&this.widgetTypeDetails.id?this.widgetTypeDetails.id:void 0,o=this.widgetTypeDetails?.version??null,t=this.widgetTypeDetails&&this.widgetTypeDetails.createdTime?this.widgetTypeDetails.createdTime:void 0;this.saveWidgetPending=!1,this.widgetService.saveWidgetTypeDetails(this.widget,e,t,o).pipe(_t(d=>{this.saveWidgetPending=!0;let f=this.route.snapshot.params.widgetsBundleId;return f&&!e?this.widgetService.addWidgetFqnToWidgetBundle(f,d.fqn).pipe(rt(()=>d)):Ct(d)}),Hn(d=>e&&d.status===Er.Conflict?this.widgetService.getWidgetTypeById(e.id).pipe(rt(f=>Lr(f))):vr(()=>d))).subscribe({next:d=>{this.saveWidgetPending=!1,this.widgetTypeDetails?.id?this.setWidgetTypeDetails(d):(this.isDirty=!1,this.router.navigate(["..",d.id.id],{relativeTo:this.route})),this.store.dispatch(new ze({message:this.translate.instant("widget.widget-saved"),type:"success",duration:500}))},error:()=>{this.saveWidgetPending=!1}})}commitSaveWidgetAs(){this.dialog.open(Aa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(e=>{if(e){this.widget.widgetName=e.widgetName,this.widget.fullFqn=void 0;let o=JSON.parse(this.widget.defaultConfig);o.title=this.widget.widgetName,this.widget.defaultConfig=JSON.stringify(o),this.isDirty=!1,this.widgetService.saveWidgetTypeDetails(this.widget,void 0,void 0,void 0).pipe(_t(t=>e.widgetBundleId?this.widgetService.addWidgetFqnToWidgetBundle(e.widgetBundleId,t.fqn).pipe(rt(()=>t)):Ct(t))).subscribe({next:t=>{this.saveWidgetAsPending=!1,e.widgetBundleId?this.router.navigate(["resources","widgets-library","widgets-bundles",e.widgetBundleId,t.id.id]):this.router.navigate(["resources","widgets-library","widget-types",t.id.id])},error:()=>{this.saveWidgetAsPending=!1}})}else this.saveWidgetAsPending=!1})}setWidgetTypeDetails(e){this.widgetTypeDetails=e,this.widget=Zr(this.widgetTypeDetails);let o=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(o),this.origWidget=Tt(this.widget),this.isDirty=!1,this.updateBreadcrumbs.emit()}applyWidgetScript(){this.cleanupJsErrors(),this.gotError=!1,this.iframeWidgetEditModeInited=!1;let e=JSON.parse(this.widget.defaultConfig);e.title||(e.title=this.widget.widgetName),this.widget.defaultConfig=JSON.stringify(e),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe[0].contentWindow.location.reload(!0)}undoWidget(){this.widget=Tt(this.origWidget),this.setAceEditorValues(),this.isDirty=!1,this.applyWidgetScript()}saveWidget(){this.widget.widgetName?(this.saveWidgetPending=!0,this.applyWidgetScript()):this.store.dispatch(new ze({message:this.translate.instant("widget.missing-widget-title-error"),type:"error"}))}saveWidgetAs(){this.saveWidgetAsPending=!0,this.applyWidgetScript()}undoDisabled(){return!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveDisabled(){return this.isReadOnly||!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveAsDisabled(){return!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}beautifyCss(){S0(this.widget.templateCss,{indent_size:4}).subscribe(e=>{this.widget.templateCss!==e&&(this.isDirty=!0,this.widget.templateCss=e,this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1))})}beautifyHtml(){T0(this.widget.templateHtml,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.widget.templateHtml!==e&&(this.isDirty=!0,this.widget.templateHtml=e,this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1))})}beautifyJs(){C0(this.controllerScriptBody,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.controllerScriptBody!==e&&(this.isDirty=!0,this.controllerScriptBody=e,this.jsEditor.setValue(this.controllerScriptBody?this.controllerScriptBody:"",-1))})}removeResource(e){e>-1&&this.widget.resources.splice(e,1).length>0&&(this.isDirty=!0)}addResource(){this.widget.resources.push({url:""}),this.isDirty=!0}widgetTypeChanged(){let e=JSON.parse(this.widget.defaultConfig);this.widget.type!==Ti.rpc&&this.widget.type!==Ti.alarm?(e.targetDevice&&delete e.targetDevice,e.alarmSource&&delete e.alarmSource,e.datasources||(e.datasources=[]),e.timewindow||(e.timewindow={realtime:{timewindowMs:6e4}})):this.widget.type===Ti.rpc?(e.datasources&&delete e.datasources,e.alarmSource&&delete e.alarmSource,e.timewindow&&delete e.timewindow,e.targetDevice||(e.targetDevice={type:$c.device})):(e.datasources&&delete e.datasources,e.targetDevice&&delete e.targetDevice,e.alarmSource||(e.alarmSource={}),e.timewindow||(e.timewindow={realtime:{timewindowMs:24*60*60*1e3}})),this.widget.defaultConfig=JSON.stringify(e),this.isDirty=!0}settingsFormUpdated(){this.isDirty=!0,this.updateControllerScriptCompleters()}dataKeySettingsFormUpdated(){this.isDirty=!0}latestDataKeySettingsFormUpdated(){this.isDirty=!0}editControllerScriptModules(e,o){e&&e.stopPropagation();let t=o._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let d={modules:Tt(this.controllerScriptModules)},f=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,E0,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,d,{},{},{},!0);f.tbComponentRef.instance.popover=f,f.tbComponentRef.instance.modulesApplied.subscribe(_=>{f.hide(),this.controllerScriptModules=_,this.updateControllerScriptCompleters(),this.isDirty=!0})}}get controllerScriptBody(){return typeof this.widget.controllerScript=="string"?this.widget.controllerScript:this.widget.controllerScript.body}set controllerScriptBody(e){typeof this.widget.controllerScript=="string"?this.widget.controllerScript=e:this.widget.controllerScript.body=e}get controllerScriptModules(){return typeof this.widget.controllerScript=="string"?null:this.widget.controllerScript.modules}set controllerScriptModules(e){e&&Object.keys(e).length?typeof this.widget.controllerScript=="string"?this.widget.controllerScript={body:this.widget.controllerScript,modules:e}:this.widget.controllerScript.modules=e:typeof this.widget.controllerScript!="string"&&(this.widget.controllerScript=this.widget.controllerScript.body)}get confirmOnExitMessage(){return this.isEditModeWidget&&!this._isDirty?this.translate.instant("widget.confirm-to-exit-editor-html"):""}updateControllerScriptCompleters(){xc(this.http,this.controllerScriptModules).subscribe(o=>{let t=[],d=jr(this.widget.settingsForm||[],this.customTranslate);t.push(Wf(d)),o&&t.push(o),t.push(...this.initialCompleters),this.jsEditor.completers=t})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Xo),h(Ri),h(pe),h(si),h(ee),h(wu),h(je),h(Dn),h(bn),h(Zi),h(di),h(Ir))},n.\u0275cmp=F({type:n,selectors:[["tb-widget-editor"]],viewQuery:function(o,t){if(o&1&&(we(F1,7),we(P1,7),we(A1,7),we(N1,7),we(k1,7),we(O1,7),we(B1,7),we(R1,7),we(V1,7),we(j1,7)),o&2){let d;Me(d=De())&&(t.topPanelElmRef=d.first),Me(d=De())&&(t.topLeftPanelElmRef=d.first),Me(d=De())&&(t.topRightPanelElmRef=d.first),Me(d=De())&&(t.bottomPanelElmRef=d.first),Me(d=De())&&(t.javascriptPanelElmRef=d.first),Me(d=De())&&(t.framePanelElmRef=d.first),Me(d=De())&&(t.htmlInputElmRef=d.first),Me(d=De())&&(t.cssInputElmRef=d.first),Me(d=De())&&(t.javascriptInputElmRef=d.first),Me(d=De())&&(t.widgetIFrameElmRef=d.first)}},features:[G],decls:193,vars:148,consts:[["cheatSheetComponent",""],["widgetEditMenu","matMenu"],["topPanel",""],["topLeftPanel",""],["htmlInput",""],["cssInput",""],["topRightPanel",""],["descriptionInput",""],["bottomPanel",""],["javascriptPanel",""],["editModulesButton",""],["javascriptInput",""],["framePanel",""],["widgetIFrame",""],[1,"flex","flex-1","flex-col"],["tb-fullscreen","",1,"flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"mat-elevation-z1","tb-edit-toolbar","mat-hue-3","gap-4","lt-xl:gap-2"],[1,"tb-widget-title","tb-appearance-transparent"],["matInput","","required","","maxlength","255",3,"ngModelChange","disabled","ngModel","placeholder"],[1,"tb-appearance-transparent"],[3,"ngModelChange","disabled","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1"],["mat-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["translate",""],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["mat-raised-button","","class","lt-md:!hidden","matTooltipPosition","below",3,"disabled","tb-circular-progress","matTooltip","click",4,"ngIf"],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","tb-circular-progress","matTooltip"],["mat-button","","matTooltipPosition","below",1,"lt-lg:!hidden",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","below",1,"lt-md:!hidden","gt-md:!hidden",3,"click","matTooltip"],["mat-icon-button","",1,"gt-md:!hidden",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],[1,"flex-1",2,"position","relative"],[1,"tb-editor","tb-absolute-fill"],[1,"tb-split","tb-split-vertical"],[1,"tb-split","tb-content"],["mat-stretch-tabs","false","selectedIndex","1","dynamicHeight","true",2,"width","100%","height","100%"],[3,"label"],[1,"tb-resize-container",2,"background-color","#fff"],[1,"mat-padding"],["class","flex flex-1 flex-row items-center justify-start","style","max-height: 40px",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","matTooltipPosition","above",2,"margin-top","8px",3,"click","disabled","matTooltip"],["tb-fullscreen","",1,"tb-resize-container",3,"fullscreen"],[1,"tb-editor-area-title-panel"],["mat-button","",3,"click"],["mat-icon-button","","matTooltipPosition","above",1,"tb-mat-32",3,"click","matTooltip"],["mat-stretch-tabs","false","dynamicHeight","true",2,"width","100%","height","100%"],["importExport","","noBorder","","fillHeight","",3,"ngModelChange","exportFileName","ngModel"],[3,"aria-labelledby","label"],[1,"flex-1",3,"ngModelChange","label","ngModel"],[1,"mat-block"],["matInput","","rows","2","maxlength","255",3,"ngModelChange","ngModel"],["align","end"],[3,"ngModelChange","label","ngModel"],[1,"flex","flex-col","gap-4",2,"padding-bottom","16px"],[1,"mat-block",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel"],["class","mat-block",4,"ngIf"],[1,"mat-block",2,"padding-bottom","16px",3,"ngModelChange","ngModel"],["tb-toast","","toastTarget","javascriptPanel",1,"tb-split","tb-content"],["color","primary","matButtonIcon",""],[1,"tb-split","tb-content",2,"overflow-y","hidden","position","relative"],["class","mat-content tb-progress-cover flex flex-1 flex-col items-center justify-center",4,"ngIf"],["tb-fullscreen","",2,"width","100%","height","100%",3,"fullscreen"],["height","100%","width","100%",2,"border","0"],[2,"position","absolute","top","10px","left","10px","bottom","initial"],["mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button-style",3,"click","matTooltip"],[3,"value"],[1,"flex","flex-1","flex-row","items-center","justify-start",2,"max-height","40px"],["hideRequiredMarker","","required","","subscriptSizing","dynamic",1,"mat-block","resource-field","flex-1",3,"ngModelChange","allowAutocomplete","ngModel","placeholder"],[3,"ngModelChange","ngModel"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","disabled","matTooltip"],[1,"mat-content","tb-progress-cover","flex","flex-1","flex-col","items-center","justify-center"],["diameter","100","mode","indeterminate","color","warn"]],template:function(o,t){if(o&1){let d=L();s(0,"div",14)(1,"div",15),g(2,"tb-hotkeys-cheatsheet",null,0),s(4,"mat-toolbar",16)(5,"mat-form-field",17)(6,"input",18),c(7,"translate"),et("ngModelChange",function(_){return I(d),Ze(t.widget.widgetName,_)||(t.widget.widgetName=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r()(),s(8,"mat-form-field",19)(9,"mat-select",20),c(10,"translate"),et("ngModelChange",function(_){return I(d),Ze(t.widget.type,_)||(t.widget.type=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.widgetTypeChanged())}),v(11,L1,3,4,"mat-option",21),r()(),g(12,"span",22),s(13,"button",23),c(14,"translate"),C("click",function(){return I(d),w(t.applyWidgetScript())}),s(15,"mat-icon"),p(16,"play_arrow"),r(),s(17,"span",24),p(18,"action.run"),r()(),s(19,"button",25),c(20,"translate"),c(21,"async"),C("click",function(){return I(d),w(t.undoWidget())}),s(22,"mat-icon"),p(23,"undo"),r(),s(24,"span",24),p(25,"action.undo"),r()(),v(26,G1,7,8,"button",26),s(27,"button",27),c(28,"translate"),c(29,"async"),C("click",function(){return I(d),w(t.saveWidgetAs())}),s(30,"mat-icon"),p(31,"save_as"),r(),s(32,"span",24),p(33,"action.saveAs"),r()(),s(34,"button",28),c(35,"translate"),C("click",function(){return I(d),w(t.fullscreen=!t.fullscreen)}),s(36,"mat-icon"),p(37),r(),s(38,"span",24),p(39,"widget.toggle-fullscreen"),r()(),s(40,"button",29),c(41,"translate"),C("click",function(){return I(d),w(t.fullscreen=!t.fullscreen)}),s(42,"mat-icon"),p(43),r()(),s(44,"button",30)(45,"mat-icon"),p(46,"more_vert"),r()(),s(47,"mat-menu",31,1)(49,"button",32),C("click",function(){return I(d),w(t.applyWidgetScript())}),s(50,"mat-icon"),p(51,"play_arrow"),r(),s(52,"span",24),p(53,"action.run"),r()(),s(54,"button",32),c(55,"async"),C("click",function(){return I(d),w(t.undoWidget())}),s(56,"mat-icon"),p(57,"undo"),r(),s(58,"span",24),p(59,"action.undo"),r()(),v(60,U1,6,3,"button",33),s(61,"button",32),c(62,"async"),C("click",function(){return I(d),w(t.saveWidgetAs())}),s(63,"mat-icon"),p(64,"save_as"),r(),s(65,"span",24),p(66,"action.saveAs"),r()()()(),s(67,"div",34)(68,"div",35)(69,"div",36,2)(71,"div",37,3)(73,"mat-tab-group",38)(74,"mat-tab",39),c(75,"translate"),s(76,"div",40)(77,"div",41),v(78,q1,11,15,"div",42),s(79,"button",43),c(80,"translate"),c(81,"async"),C("click",function(){return I(d),w(t.addResource())}),s(82,"span",24),p(83,"action.add"),r()()()()(),s(84,"mat-tab",39),c(85,"translate"),s(86,"div",44)(87,"div",45)(88,"button",46),C("click",function(){return I(d),w(t.beautifyHtml())}),p(89),c(90,"translate"),r(),s(91,"button",47),c(92,"translate"),C("click",function(){return I(d),w(t.htmlFullscreen=!t.htmlFullscreen)}),s(93,"mat-icon"),p(94),r()()(),g(95,"div",null,4),r()(),s(97,"mat-tab",39),c(98,"translate"),s(99,"div",44)(100,"div",45)(101,"button",46),C("click",function(){return I(d),w(t.beautifyCss())}),p(102),c(103,"translate"),r(),s(104,"button",47),c(105,"translate"),C("click",function(){return I(d),w(t.cssFullscreen=!t.cssFullscreen)}),s(106,"mat-icon"),p(107),r()()(),g(108,"div",null,5),r()()()(),s(110,"div",37,6)(112,"mat-tab-group",48)(113,"mat-tab",39),c(114,"translate"),s(115,"div",40)(116,"tb-dynamic-form-properties",49),et("ngModelChange",function(_){return I(d),Ze(t.widget.settingsForm,_)||(t.widget.settingsForm=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.settingsFormUpdated())}),r()()(),s(117,"mat-tab",39),c(118,"translate"),s(119,"div",40)(120,"tb-dynamic-form-properties",49),et("ngModelChange",function(_){return I(d),Ze(t.widget.dataKeySettingsForm,_)||(t.widget.dataKeySettingsForm=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.dataKeySettingsFormUpdated())}),r()()(),s(121,"mat-tab",50),c(122,"translate"),s(123,"div",40)(124,"tb-dynamic-form-properties",49),et("ngModelChange",function(_){return I(d),Ze(t.widget.latestDataKeySettingsForm,_)||(t.widget.latestDataKeySettingsForm=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.latestDataKeySettingsFormUpdated())}),r()()(),s(125,"mat-tab",39),c(126,"translate"),s(127,"div",40)(128,"div",41)(129,"tb-gallery-image-input",51),c(130,"translate"),et("ngModelChange",function(_){return I(d),Ze(t.widget.image,_)||(t.widget.image=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r(),s(131,"mat-form-field",52)(132,"mat-label",24),p(133,"widget.description"),r(),s(134,"textarea",53,7),et("ngModelChange",function(_){return I(d),Ze(t.widget.description,_)||(t.widget.description=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r(),s(136,"mat-hint",54),p(137),r()(),s(138,"tb-string-items-list",55),c(139,"translate"),et("ngModelChange",function(_){return I(d),Ze(t.widget.tags,_)||(t.widget.tags=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r(),s(140,"div",56)(141,"mat-slide-toggle",57),et("ngModelChange",function(_){return I(d),Ze(t.widget.scada,_)||(t.widget.scada=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),p(142),c(143,"translate"),r(),s(144,"mat-slide-toggle",57),et("ngModelChange",function(_){return I(d),Ze(t.widget.deprecated,_)||(t.widget.deprecated=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),p(145),c(146,"translate"),r()(),s(147,"mat-form-field",52)(148,"mat-label",24),p(149,"widget.settings-form-selector"),r(),s(150,"input",58),et("ngModelChange",function(_){return I(d),Ze(t.widget.settingsDirective,_)||(t.widget.settingsDirective=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r()(),s(151,"mat-form-field",52)(152,"mat-label",24),p(153,"widget.data-key-settings-form-selector"),r(),s(154,"input",58),et("ngModelChange",function(_){return I(d),Ze(t.widget.dataKeySettingsDirective,_)||(t.widget.dataKeySettingsDirective=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),r()(),v(155,W1,4,1,"mat-form-field",59),s(156,"mat-slide-toggle",60),et("ngModelChange",function(_){return I(d),Ze(t.widget.hasBasicMode,_)||(t.widget.hasBasicMode=_),w(_)}),C("ngModelChange",function(){return I(d),w(t.isDirty=!0)}),p(157),c(158,"translate"),r(),v(159,H1,4,1,"mat-form-field",59),r()()()()()(),s(160,"div",36,8)(162,"div",61,9)(164,"div",44)(165,"div",45)(166,"label",24),p(167,"widget.javascript"),r(),s(168,"button",47,10),c(170,"translate"),C("click",function(_){I(d);let D=q(169);return w(t.editControllerScriptModules(_,D))}),s(171,"tb-icon",62),p(172,"mdi:application-braces-outline"),r()(),s(173,"button",46),C("click",function(){return I(d),w(t.beautifyJs())}),p(174),c(175,"translate"),r(),s(176,"button",47),c(177,"translate"),C("click",function(){return I(d),w(t.javascriptFullscreen=!t.javascriptFullscreen)}),s(178,"mat-icon"),p(179),r()()(),g(180,"div",null,11),r()(),s(182,"div",63,12),v(184,z1,2,0,"div",64),s(185,"div",65),g(186,"iframe",66,13),s(188,"div",67)(189,"button",68),c(190,"translate"),C("click",function(){return I(d),w(t.iFrameFullscreen=!t.iFrameFullscreen)}),s(191,"mat-icon"),p(192),r()()()()()()()()()()}if(o&2){let d=q(3),f=q(48),_=q(135);a(),m("fullscreen",t.fullscreen)("tb-hotkeys",t.hotKeys)("cheatSheet",d),a(5),x("placeholder",u(7,82,"widget.widget-title")),m("disabled",t.isReadOnly),Xe("ngModel",t.widget.widgetName),a(3),x("placeholder",u(10,84,"widget.type")),m("disabled",t.isReadOnly),Xe("ngModel",t.widget.type),a(2),m("ngForOf",t.allWidgetTypes),a(2),ho("matTooltip","",u(14,86,"widget.run")," (CTRL + Return)"),m("disabled",!t.iframeWidgetEditModeInited),a(6),ho("matTooltip","",u(20,88,"widget.undo")," (CTRL + Q)"),m("disabled",u(21,90,t.isLoading$)||t.undoDisabled()),a(7),m("ngIf",!t.isReadOnly),a(),ho("matTooltip","",u(28,92,"widget.saveAs")," (Shift + CTRL + S)"),m("disabled",u(29,94,t.isLoading$)||t.saveAsDisabled())("tb-circular-progress",t.saveWidgetAsPending),a(7),ho("matTooltip","",u(35,96,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),a(3),B(t.fullscreen?"fullscreen_exit":"fullscreen"),a(3),ho("matTooltip","",u(41,98,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),a(3),B(t.fullscreen?"fullscreen_exit":"fullscreen"),a(),m("matMenuTriggerFor",f),a(5),m("disabled",!t.iframeWidgetEditModeInited),a(5),m("disabled",u(55,100,t.isLoading$)||t.undoDisabled()),a(6),m("ngIf",!t.isReadOnly),a(),m("disabled",u(62,102,t.isLoading$)||t.saveAsDisabled()),a(13),x("label",u(75,104,"widget.resources")),a(4),m("ngForOf",t.widget.resources),a(),x("matTooltip",u(80,106,"widget.add-resource")),m("disabled",u(81,108,t.isLoading$)),a(5),x("label",u(85,110,"widget.html")),a(2),m("fullscreen",t.htmlFullscreen),a(3),b(" ",u(90,112,"widget.tidy")," "),a(2),x("matTooltip",u(92,114,t.htmlFullscreen?"fullscreen.exit":"fullscreen.expand")),a(3),B(t.htmlFullscreen?"fullscreen_exit":"fullscreen"),a(3),x("label",u(98,116,"widget.css")),a(2),m("fullscreen",t.cssFullscreen),a(3),b(" ",u(103,118,"widget.tidy")," "),a(2),x("matTooltip",u(105,120,t.cssFullscreen?"fullscreen.exit":"fullscreen.expand")),a(3),B(t.cssFullscreen?"fullscreen_exit":"fullscreen"),a(6),x("label",u(114,122,"widget.settings-form")),a(3),m("exportFileName",(t.widget.widgetName||"widget")+"-settings-form"),Xe("ngModel",t.widget.settingsForm),a(),x("label",u(118,124,"widget.data-key-settings-form")),a(3),m("exportFileName",(t.widget.widgetName||"widget")+"-data-key-settings-form"),Xe("ngModel",t.widget.dataKeySettingsForm),a(),x("label",u(122,126,"widget.latest-data-key-settings-form")),m("aria-labelledby",t.widget.type!==t.widgetTypes.timeseries?"hidden":""),a(3),m("exportFileName",(t.widget.widgetName||"widget")+"-latest-data-key-settings-form"),Xe("ngModel",t.widget.latestDataKeySettingsForm),a(),x("label",u(126,128,"widget.widget-settings")),a(4),x("label",u(130,130,"widget.image-preview")),Xe("ngModel",t.widget.image),a(5),Xe("ngModel",t.widget.description),a(3),b("",(_.value==null?null:_.value.length)||0,"/255"),a(),x("label",u(139,132,"widget.tags")),Xe("ngModel",t.widget.tags),a(3),Xe("ngModel",t.widget.scada),a(),b(" ",u(143,134,"widget.scada")," "),a(2),Xe("ngModel",t.widget.deprecated),a(),b(" ",u(146,136,"widget.deprecated")," "),a(5),Xe("ngModel",t.widget.settingsDirective),a(4),Xe("ngModel",t.widget.dataKeySettingsDirective),a(),m("ngIf",t.widget.type===t.widgetTypes.timeseries),a(),Xe("ngModel",t.widget.hasBasicMode),a(),b(" ",u(158,138,"widget.has-basic-mode")," "),a(2),m("ngIf",t.widget.hasBasicMode),a(5),m("fullscreen",t.javascriptFullscreen),a(4),x("matTooltip",u(170,140,"js-func.modules")),a(6),b(" ",u(175,142,"widget.tidy")," "),a(2),x("matTooltip",u(177,144,t.javascriptFullscreen?"fullscreen.exit":"fullscreen.expand")),a(3),B(t.javascriptFullscreen?"fullscreen_exit":"fullscreen"),a(5),m("ngIf",!t.iframeWidgetEditModeInited),a(),m("fullscreen",t.iFrameFullscreen),a(4),x("matTooltip",u(190,146,t.iFrameFullscreen?"fullscreen.exit":"fullscreen.expand")),a(3),B(t.iFrameFullscreen?"fullscreen_exit":"fullscreen")}},dependencies:[xe,U,Mi,Fu,n0,w0,I0,mn,te,Ie,zt,re,be,de,Se,Kt,at,zr,Hr,$r,vt,gt,Mt,to,St,aa,ht,he,W,fe,rn,Qe,J,x0,bi,fs,Ts,me,R],styles:[`@charset "UTF-8";tb-widget-editor{flex:1;display:flex;flex-direction:column}.tb-editor .tb-split{box-sizing:border-box;overflow-x:hidden;overflow-y:auto}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper{padding-bottom:0;height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{max-height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{border:0;padding-top:7px;padding-bottom:7px;min-height:32px}.tb-editor .ace_editor{font-size:14px!important}.tb-editor .tb-content{border:1px solid #c0c0c0}.tb-editor .gutter{background-color:transparent;background-repeat:no-repeat;background-position:50%}.tb-editor .gutter.gutter-horizontal{cursor:col-resize;background-image:url("./vertical-6GFVMCUE.png")}.tb-editor .gutter.gutter-vertical{cursor:row-resize;background-image:url("./horizontal-2FDVWMXP.png")}.tb-editor .tb-split.tb-split-horizontal,.tb-editor .gutter.gutter-horizontal{float:left;height:100%}.tb-editor .tb-split.tb-split-vertical{display:flex}.tb-editor .tb-split.tb-split-vertical .tb-split.tb-content{height:100%}.tb-editor .container{width:100%;height:100%}.tb-editor .mdc-tab[aria-labelledby=hidden]{width:0!important;min-width:0;padding:0;overflow:hidden}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper{height:calc(100% - 49px)}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body{height:100%}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body>div{height:100%}div.tb-editor-area-title-panel{position:absolute;top:5px;right:20px;z-index:5;font-size:.8rem;font-weight:500}div.tb-editor-area-title-panel>*:not(:last-child){margin-right:4px}div.tb-editor-area-title-panel label{padding:4px;color:#00acc1;background:#dcdcdc59;border-radius:5px}div.tb-editor-area-title-panel button.mat-mdc-button-base,div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32{align-items:center;vertical-align:middle;min-width:32px;min-height:15px;padding:4px;font-size:.8rem;line-height:15px;background:#dcdcdc59}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.tb-help-popup-button),div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32:not(.tb-help-popup-button){color:#7b7b7b}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.mat-mdc-icon-button){height:23px}div.tb-editor-area-title-panel .tb-help-popup-button-loading{background:#f3f3f3}.tb-resize-container{position:relative;width:100%;height:100%;overflow-y:auto}.tb-resize-container .ace_editor{height:100%}mat-toolbar.tb-edit-toolbar{min-height:40px!important;max-height:40px!important}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button){font-size:12px;line-height:28px;padding:0 8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:28px}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button) .mat-icon{height:20px;width:20px;font-size:20px}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field input,mat-toolbar.tb-edit-toolbar .mat-mdc-form-field .mat-mdc-select{font-size:1.1rem;font-weight:400;letter-spacing:.005em}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:250px}@media screen and (max-width: 1279px){mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:0}}
`],encapsulation:2});let i=n;return i})();S();S();function $1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"widget.title-required")," "))}function J1(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"widget.title-max-length")," "))}var tl=(()=>{let n=class n extends kt{constructor(e,o,t,d,f){super(e,d,o,t,f),this.store=e,this.entityValue=o,this.entitiesTableConfigValue=t,this.fb=d,this.cd=f}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],image:[e?e.image:""],description:[e?e.description:"",T.maxLength(1024)],tags:[e?e.tags:[]],scada:[e?e.scada:!1],deprecated:[e?e.deprecated:!1]})}updateForm(e){this.entityForm.patchValue({name:e.name,image:e.image,description:e.description,tags:e.tags,scada:e.scada,deprecated:e.deprecated})}};n.\u0275fac=function(o){return new(o||n)(h(A),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-widget-type"]],features:[G],decls:45,vars:51,consts:[["descriptionInput",""],[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","image",1,"flex-1",3,"label"],["matInput","","formControlName","description","rows","2","maxlength","1024"],["align","end"],["formControlName","tags",3,"label"],[1,"flex","flex-col","gap-4"],["formControlName","scada"],["formControlName","deprecated"]],template:function(o,t){if(o&1){let d=L();s(0,"div",1)(1,"button",2),c(2,"async"),C("click",function(_){return I(d),w(t.onEntityAction(_,"edit"))}),p(3),c(4,"translate"),r(),s(5,"button",2),c(6,"async"),C("click",function(_){return I(d),w(t.onEntityAction(_,"openDetails"))}),p(7),c(8,"translate"),r(),s(9,"button",2),c(10,"async"),C("click",function(_){return I(d),w(t.onEntityAction(_,"export"))}),p(11),c(12,"translate"),r(),s(13,"button",2),c(14,"async"),C("click",function(_){return I(d),w(t.onEntityAction(_,"delete"))}),p(15),c(16,"translate"),r()(),s(17,"div",3)(18,"form",4)(19,"fieldset",5),c(20,"async"),s(21,"mat-form-field",6)(22,"mat-label",7),p(23,"widget.title"),r(),g(24,"input",8),v(25,$1,3,3,"mat-error",9)(26,J1,3,3,"mat-error",9),r(),g(27,"tb-gallery-image-input",10),c(28,"translate"),s(29,"mat-form-field",6)(30,"mat-label",7),p(31,"widget.description"),r(),g(32,"textarea",11,0),s(34,"mat-hint",12),p(35),r()(),g(36,"tb-string-items-list",13),c(37,"translate"),s(38,"div",14)(39,"mat-slide-toggle",15),p(40),c(41,"translate"),r(),s(42,"mat-slide-toggle",16),p(43),c(44,"translate"),r()()()()()}if(o&2){let d=q(33);a(),j("!hidden",t.isEdit),m("disabled",u(2,25,t.isLoading$)),a(2),b(" ",u(4,27,"widget.edit")," "),a(2),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(6,29,t.isLoading$)),a(2),b(" ",u(8,31,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(10,33,t.isLoading$)),a(2),b(" ",u(12,35,"widget.export")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(14,37,t.isLoading$)),a(2),b(" ",u(16,39,"widget.delete-widget")," "),a(3),m("formGroup",t.entityForm),a(),m("disabled",u(20,41,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(),x("label",u(28,43,"widget.image-preview")),a(8),b("",(d.value==null?null:d.value.length)||0,"/1024"),a(),x("label",u(37,45,"widget.tags")),a(4),b(" ",u(41,47,"widget.scada")," "),a(3),b(" ",u(44,49,"widget.deprecated")," ")}},dependencies:[U,mn,te,be,de,Se,Kt,Fe,ht,ue,he,W,X,fe,rn,ne,le,J,fs,me,R],encapsulation:2});let i=n;return i})();S();function Q1(i,n){if(i&1){let l=L();s(0,"mat-tab",2,0),c(2,"translate"),s(3,"tb-version-control",3),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var il=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}isTenantWidgetType(){return this.entity&&this.entity.tenantId.id!==Ae}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-widget-type-tabs"]],features:[G],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,Q1,4,7,"mat-tab",1),o&2&&m("ngIf",t.isTenantWidgetType()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[U,St,ai,R],encapsulation:2});let i=n;return i})();S();function Y1(i,n){i&1&&g(0,"mat-progress-bar",14)}function K1(i,n){i&1&&g(0,"div",15)}function X1(i,n){if(i&1){let l=L();s(0,"button",16),C("click",function(){let o=I(l).$implicit,t=y();return w(t.typeSelected(t.widgetTypes[o]))}),s(1,"tb-icon",17),p(2),r(),s(3,"span",2),p(4),r()()}if(i&2){let l=n.$implicit,e=y();a(2),b(" ",e.widgetTypesDataMap.get(e.widgetTypes[l]).icon," "),a(2),B(e.widgetTypesDataMap.get(e.widgetTypes[l]).name)}}var Na=(()=>{let n=class n extends nt{constructor(e,o,t){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.widgetTypes=Ti,this.allWidgetTypes=Object.keys(Ti),this.widgetTypesDataMap=Zo}cancel(){this.dialogRef.close(null)}typeSelected(e){this.dialogRef.close(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it))},n.\u0275cmp=F({type:n,selectors:[["tb-select-widget-type-dialog"]],features:[G],decls:22,vars:16,consts:[[2,"width","800px"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],[1,"flex","flex-col","items-center","justify-center","gap-4","gt-sm:flex-row"],["class","tb-card-button","mat-raised-button","","color","primary","type","button",3,"click",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["mat-raised-button","","color","primary","type","button",1,"tb-card-button",3,"click"],["matButtonIcon","",1,"tb-mat-96"]],template:function(o,t){o&1&&(s(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"widget.select-widget-type"),r(),g(4,"span",3),s(5,"button",4),C("click",function(){return t.cancel()}),s(6,"mat-icon",5),p(7,"close"),r()()(),v(8,Y1,1,0,"mat-progress-bar",6),c(9,"async"),v(10,K1,1,0,"div",7),c(11,"async"),s(12,"div",8)(13,"fieldset",9),c(14,"async"),s(15,"div",10),v(16,X1,5,2,"button",11),r()()(),s(17,"div",12)(18,"button",13),c(19,"async"),C("click",function(){return t.cancel()}),p(20),c(21,"translate"),r()()()),o&2&&(a(8),m("ngIf",u(9,6,t.isLoading$)),a(2),m("ngIf",!u(11,8,t.isLoading$)),a(3),m("disabled",u(14,10,t.isLoading$)),a(3),m("ngForOf",t.allWidgetTypes),a(2),m("disabled",u(19,12,t.isLoading$)),a(2),b(" ",u(21,14,"action.cancel")," "))},dependencies:[xe,U,te,Ie,re,Ue,at,Nt,dt,ue,X,xn,J,bi,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button span.mdc-button__label{height:18px;min-height:18px;max-height:18px;margin:0 0 20px;font-size:18px;font-weight:400;line-height:18px;white-space:normal}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}']});let i=n;return i})();var nl=(()=>{let n=class n{constructor(e,o,t,d,f,_,D){this.store=e,this.dialog=o,this.widgetsService=t,this.translate=d,this.importExport=f,this.datePipe=_,this.router=D,this.config=new Le,this.config.entityType=O.WIDGETS_BUNDLE,this.config.entityComponent=tl,this.config.entityTabsComponent=il,this.config.entityTranslations=Ge.get(O.WIDGET_TYPE),this.config.entityResources=tt.get(O.WIDGET_TYPE),this.config.defaultSortOrder={property:"name",direction:ei.ASC},this.config.rowPointer=!0,this.config.entityTitle=M=>M?M.name:"",this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","widget.title","100%"),new K("widgetType","widget.type","150px",M=>M?.widgetType?this.translate.instant(Zo.get(M.widgetType).name):"",void 0,!1),new K("tenantId","widget.system","60px",M=>Dt(M.tenantId.id===Ae)),new K("deprecated","widget.deprecated","60px",M=>Dt(M.deprecated))),this.config.addActionDescriptors.push({name:this.translate.instant("dashboard.create-new-widget"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:M=>this.addWidgetType(M)},{name:this.translate.instant("widget.import"),icon:"file_upload",isEnabled:()=>!0,onAction:M=>this.importWidgetType(M)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widget.export"),icon:"file_download",isEnabled:()=>!0,onAction:(M,Y)=>this.exportWidgetType(M,Y)},{name:this.translate.instant("widget.widget-details"),icon:"edit",isEnabled:()=>!0,onAction:(M,Y)=>this.config.toggleEntityDetails(M,Y)}),this.config.groupActionDescriptors.push({name:this.translate.instant("widget.export-widgets"),icon:"file_download",isEnabled:!0,onAction:(M,Y)=>this.exportWidgetTypes(M,Y)}),this.config.deleteEntityTitle=M=>this.translate.instant("widget.delete-widget-title",{widgetName:M.name}),this.config.deleteEntityContent=()=>this.translate.instant("widget.delete-widget-text"),this.config.deleteEntitiesTitle=M=>this.translate.instant("widget.delete-widgets-title",{count:M}),this.config.deleteEntitiesContent=()=>this.translate.instant("widget.delete-widgets-text"),this.config.loadEntity=M=>this.widgetsService.getWidgetTypeById(M.id),this.config.saveEntity=M=>this.widgetsService.saveWidgetType(M),this.config.deleteEntity=M=>this.widgetsService.deleteWidgetType(M.id),this.config.onEntityAction=M=>this.onWidgetTypeAction(M,this.config),this.config.handleRowClick=(M,Y)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(M,Y):this.openWidgetEditor(M,Y),!0)}resolve(){this.config.tableTitle=this.translate.instant("widget.widgets");let e=Pt(this.store);return this.config.deleteEnabled=o=>this.isWidgetTypeEditable(o,e.authority),this.config.entitySelectionEnabled=o=>this.isWidgetTypeEditable(o,e.authority),this.config.detailsReadonly=o=>!this.isWidgetTypeEditable(o,e.authority),this.config.entitiesFetchFunction=o=>this.widgetsService.getWidgetTypes(o),this.config}isWidgetTypeEditable(e,o){return o===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:o===E.SYS_ADMIN}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(Na,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(o=>{o&&this.router.navigateByUrl(`resources/widgets-library/widget-types/${o}`)})}importWidgetType(e){this.importExport.importWidgetType().subscribe(o=>{o&&this.config.updateData()})}openWidgetEditor(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-library/widget-types/${o.id.id}`)}openWidgetTypeDetails(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree(["details",o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}exportWidgetType(e,o){e&&e.stopPropagation(),this.importExport.exportWidgetType(o.id.id)}exportWidgetTypes(e,o){e&&e.stopPropagation(),this.importExport.exportWidgetTypes(o.map(t=>t.id.id)).subscribe(()=>{this.config.getTable().clearSelection()})}onWidgetTypeAction(e,o){switch(e.action){case"edit":return this.openWidgetEditor(e.event,e.entity),!0;case"openDetails":return this.openWidgetTypeDetails(e.event,e.entity,o),!0;case"export":return this.exportWidgetType(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(A),P(je),P(si),P(ee),P(Pi),P(Oe),P(pe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();var ev=["widgetTypeInput"],tv=[[["","tb-error",""]],[["","tb-hint",""]]],iv=["[tb-error]","[tb-hint]"],nv=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"}),ov=i=>({entity:i});function av(i,n){if(i&1&&(s(0,"mat-label"),p(1),r()),i&2){let l=y();a(),B(l.label)}}function rv(i,n){if(i&1){let l=L();s(0,"button",10),C("click",function(){I(l);let o=y();return w(o.clear())}),s(1,"mat-icon",11),p(2,"close"),r()()}}function sv(i,n){i&1&&(s(0,"div",18),p(1),c(2,"translate"),r()),i&2&&(a(),B(u(2,1,"widget.deprecated")))}function lv(i,n){if(i&1&&(s(0,"mat-option",12)(1,"div",13),g(2,"img",14),c(3,"image"),c(4,"async"),s(5,"div",15),g(6,"div",16),c(7,"highlight"),v(8,sv,3,3,"div",17),r()()()),i&2){let l=n.$implicit,e=y();m("value",l),a(2),x("alt",l.name),m("src",u(4,8,Yt(3,5,l.image,Bt(14,nv))),$n),a(4),m("innerHTML",cc(7,10,l.name,e.searchText,!0),zn),a(2),m("ngIf",l.deprecated)}}function mv(i,n){i&1&&(s(0,"div")(1,"span"),p(2),c(3,"translate"),r()()),i&2&&(a(2),B(u(3,1,"widget.no-widgets-text")))}function pv(i,n){if(i&1&&(s(0,"span"),p(1),c(2,"async"),r()),i&2){let l=y(2);a(),b(" ",u(2,1,l.translate.get("widget.no-widgets-matching",pt(3,ov,l.searchText)))," ")}}function dv(i,n){if(i&1){let l=L();s(0,"mat-option",12)(1,"div",19),C("click",function(o){return I(l),w(o.stopPropagation())}),v(2,mv,4,3,"div",20)(3,pv,3,5,"ng-template",null,2,Et),r()()}if(i&2){let l=q(4),e=y();m("value",null),a(2),m("ngIf",!e.textIsNotEmpty(e.searchText))("ngIfElse",l)}}var Eo=class Eo{constructor(n,l,e){this.translate=n,this.widgetService=l,this.fb=e,this.dirty=!1,this.label=this.translate.instant("widget.widget"),this.floatLabel="auto",this.appearance="fill",this.subscriptSizing="fixed",this.searchText="",this.propagateChange=o=>{},this.selectWidgetTypeFormGroup=this.fb.group({widgetType:[null]})}registerOnChange(n){this.propagateChange=n}registerOnTouched(n){}ngOnInit(){this.filteredWidgetTypes=this.selectWidgetTypeFormGroup.get("widgetType").valueChanges.pipe(ac(150),Ot(n=>{let l;typeof n=="string"||!n?l=null:l=n,this.updateView(l)}),rt(n=>n?typeof n=="string"?n:n.name:""),yr(),Xi(n=>this.fetchWidgetTypes(n)),sc())}ngAfterViewInit(){}setDisabledState(n){this.disabled=n,this.disabled?this.selectWidgetTypeFormGroup.disable({emitEvent:!1}):this.selectWidgetTypeFormGroup.enable({emitEvent:!1})}writeValue(n){this.searchText="",n!=null?typeof n=="string"?this.widgetService.getWidgetTypeInfoById(n).subscribe(l=>{this.modelValue=l,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(l,{emitEvent:!1})}):(this.modelValue=n,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(n,{emitEvent:!1})):(this.modelValue=null,this.selectWidgetTypeFormGroup.get("widgetType").patchValue("",{emitEvent:!1})),this.dirty=!0}updateView(n){this.modelValue!==n&&(this.modelValue=n,this.propagateChange(this.modelValue))}displayWidgetTypeFn(n){return n?n.name:void 0}fetchWidgetTypes(n){this.searchText=n;let l=new Au(10,0,n,{property:"name",direction:ei.ASC});return this.getWidgetTypes(l)}getWidgetTypes(n,l=[]){return this.widgetService.getWidgetTypes(n,!0).pipe(Hn(()=>Ct(Pu())),Xi(e=>{if(this.excludeWidgetTypeIds?.length){let o=e.data.filter(t=>!this.excludeWidgetTypeIds.includes(t.id.id));l=l.concat(o)}else l=e.data;return l.length>=n.pageSize||!this.excludeWidgetTypeIds?.length||!e.hasNext?Ct(l):this.getWidgetTypes(n.nextPageLink(),l)}))}onFocus(){this.dirty&&(this.selectWidgetTypeFormGroup.get("widgetType").updateValueAndValidity({onlySelf:!0}),this.dirty=!1)}clear(){this.selectWidgetTypeFormGroup.get("widgetType").patchValue(""),setTimeout(()=>{this.widgetTypeInput.nativeElement.blur(),this.widgetTypeInput.nativeElement.focus()},0)}textIsNotEmpty(n){return n&&n.length>0}};Eo.\u0275fac=function(l){return new(l||Eo)(h(ee),h(si),h(ce))},Eo.\u0275cmp=F({type:Eo,selectors:[["tb-widget-type-autocomplete"]],viewQuery:function(l,e){if(l&1&&we(ev,7),l&2){let o;Me(o=De())&&(e.widgetTypeInput=o.first)}},inputs:{label:"label",placeholder:"placeholder",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",required:"required",disabled:"disabled",excludeWidgetTypeIds:"excludeWidgetTypeIds"},features:[He([{provide:ot,useExisting:Re(()=>Eo),multi:!0}])],ngContentSelectors:iv,decls:15,vars:16,consts:[["widgetTypeInput",""],["widgetTypeAutocomplete",""],["searchNotEmpty",""],[1,"mat-block",3,"formGroup","floatLabel","appearance","subscriptSizing"],[4,"ngIf"],["matInput","","type","text","formControlName","widgetType",3,"focusin","placeholder","required","matAutocomplete"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],[1,"tb-autocomplete","tb-widget-type-autocomplete",3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"material-icons"],[3,"value"],[1,"tb-widget-type-option-container"],[1,"tb-widget-type-option-image-preview",3,"src","alt"],[1,"tb-widget-type-option-details"],[1,"tb-widget-type-option-text",3,"innerHTML"],["class","tb-widget-type-option-deprecated",4,"ngIf"],[1,"tb-widget-type-option-deprecated"],[3,"click"],[4,"ngIf","ngIfElse"]],template:function(l,e){if(l&1){let o=L();Lo(tv),s(0,"mat-form-field",3),v(1,av,2,1,"mat-label",4),s(2,"input",5,0),C("focusin",function(){return I(o),w(e.onFocus())}),r(),v(4,rv,3,0,"button",6),s(5,"mat-autocomplete",7,1),v(7,lv,9,15,"mat-option",8),c(8,"async"),v(9,dv,5,3,"mat-option",9),c(10,"async"),r(),s(11,"mat-error"),Jn(12),r(),s(13,"mat-hint"),Jn(14,1),r()()}if(l&2){let o,t=q(6);m("formGroup",e.selectWidgetTypeFormGroup)("floatLabel",e.floatLabel)("appearance",e.appearance)("subscriptSizing",e.subscriptSizing),a(),m("ngIf",e.label),a(),x("placeholder",e.placeholder),m("required",e.required)("matAutocomplete",t),a(2),m("ngIf",e.selectWidgetTypeFormGroup.get("widgetType").value&&!e.disabled),a(),m("displayWith",e.displayWidgetTypeFn),a(2),m("ngForOf",u(8,12,e.filteredWidgetTypes)),a(2),m("ngIf",!((o=u(10,14,e.filteredWidgetTypes))!=null&&o.length))}},dependencies:[xe,U,Ie,re,be,de,Se,Kt,Fe,Xt,gt,au,ru,he,W,X,fe,ne,le,me,xu,cs,R],styles:[`@charset "UTF-8";.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text{width:100%}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-container{display:flex;gap:8px;align-items:center}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-image-preview{width:36px;max-height:100%;object-fit:contain;border-radius:6px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details{flex:1;display:flex;align-items:center;justify-content:space-between}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-text{font-size:14px;font-weight:400;letter-spacing:.2px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-deprecated{font-size:13px;font-weight:400;color:#0000008a}
`],encapsulation:2});var Io=Eo;Bo([ra(),Ro("design:type",Boolean)],Io.prototype,"required",void 0);var uv=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"});function fv(i,n){if(i&1&&(s(0,"button",19),c(1,"translate"),c(2,"async"),s(3,"mat-icon"),p(4,"add"),r()()),i&2){let l=y(),e=q(14);x("matTooltip",u(1,3,"widget.add-new-widget")),m("disabled",u(2,5,l.isLoading$))("matMenuTriggerFor",e)}}function gv(i,n){i&1&&g(0,"mat-progress-bar",20)}function hv(i,n){i&1&&g(0,"div",21)}function bv(i,n){i&1&&(s(0,"div",30),p(1),c(2,"translate"),r()),i&2&&(a(),B(u(2,1,"widget.deprecated")))}function vv(i,n){if(i&1){let l=L();s(0,"button",3),c(1,"translate"),C("click",function(o){I(l);let t=y().$implicit,d=y();return w(d.openWidgetEditor(o,t))}),s(2,"mat-icon"),p(3,"edit"),r()()}i&2&&x("matTooltip",u(1,1,"widget.edit"))}function yv(i,n){if(i&1){let l=L();s(0,"button",3),c(1,"translate"),C("click",function(o){I(l);let t=y().$implicit,d=y();return w(d.exportWidgetType(o,t))}),s(2,"mat-icon"),p(3,"file_download"),r()()}i&2&&x("matTooltip",u(1,1,"widget.export"))}function _v(i,n){if(i&1){let l=L();s(0,"button",3),c(1,"translate"),C("click",function(o){I(l);let t=y().$implicit,d=y();return w(d.removeWidgetType(o,t))}),s(2,"mat-icon"),p(3,"delete"),r()()}i&2&&x("matTooltip",u(1,1,"widget.remove"))}function Cv(i,n){if(i&1&&(s(0,"button",31),c(1,"translate"),s(2,"tb-icon"),p(3,"drag_indicator"),r()()),i&2){let l=y(2);j("!hidden",!l.widgets||l.widgets.length<=1),x("matTooltip",u(1,3,"action.drag"))}}function Sv(i,n){if(i&1&&(s(0,"div",22)(1,"div",23),g(2,"img",24),c(3,"image"),c(4,"async"),s(5,"div",25)(6,"div",26),p(7),r(),v(8,bv,3,3,"div",27),r()(),v(9,vv,4,3,"button",28)(10,yv,4,3,"button",28)(11,_v,4,3,"button",28)(12,Cv,4,5,"button",29),r()),i&2){let l=n.$implicit,e=y();a(2),x("alt",l.name),m("src",u(4,11,Yt(3,8,l.image,Bt(13,uv))),$n),a(5),B(l.name),a(),m("ngIf",l.deprecated),a(),m("ngIf",!e.editMode),a(),m("ngIf",!e.editMode),a(),m("ngIf",e.editMode&&!e.addMode),a(),m("ngIf",e.editMode)}}function Tv(i,n){if(i&1){let l=L();s(0,"div",32),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.addWidgetMode())}),s(2,"tb-icon",33),p(3,"add"),r()()}i&2&&x("matTooltip",u(1,1,"widget.add-existing-widget"))}function xv(i,n){if(i&1){let l=L();s(0,"div",34)(1,"div",35),C("click",function(){I(l);let o=y();return w(o.addWidgetMode())}),s(2,"tb-icon",33),p(3,"add"),r(),s(4,"div",36),p(5,"widget.add-existing-widget"),r()()()}}function Ev(i,n){i&1&&(s(0,"div",37),g(1,"div",38),s(2,"div",39),p(3,"widget.no-widgets"),r()())}function Iv(i,n){if(i&1){let l=L();s(0,"div",40),g(1,"tb-widget-type-autocomplete",41),c(2,"translate"),s(3,"div",42)(4,"button",43),c(5,"async"),C("click",function(){I(l);let o=y();return w(o.cancelAddWidgetMode())}),p(6),c(7,"translate"),r()()()}if(i&2){let l=y();a(),x("placeholder",u(2,5,"widget.select-widget")),m("excludeWidgetTypeIds",l.excludeWidgetTypeIds)("formControl",l.addWidgetFormControl),a(3),m("disabled",u(5,7,l.isLoading$)),a(2),b("",u(7,9,"action.cancel")," ")}}function wv(i,n){if(i&1){let l=L();s(0,"button",43),c(1,"async"),C("click",function(){I(l);let o=y();return w(o.cancel())}),p(2),c(3,"translate"),r()}if(i&2){let l=y();m("disabled",u(1,2,l.isLoading$)),a(2),b("",u(3,4,"action.cancel")," ")}}function Mv(i,n){if(i&1){let l=L();s(0,"button",44),c(1,"async"),C("click",function(){I(l);let o=y();return w(o.save())}),p(2),c(3,"translate"),r()}if(i&2){let l=y();m("disabled",u(1,2,l.isLoading$)||!l.isDirty),a(2),b("",u(3,4,"action.save")," ")}}function Dv(i,n){if(i&1){let l=L();s(0,"button",44),c(1,"async"),C("click",function(){I(l);let o=y();return w(o.edit())}),p(2),c(3,"translate"),r()}if(i&2){let l=y();m("disabled",u(1,2,l.isLoading$)),a(2),b("",u(3,4,"action.edit")," ")}}var ol=(()=>{let n=class n extends It{constructor(e,o,t,d,f,_,D){super(e),this.store=e,this.router=o,this.route=t,this.widgetsService=d,this.importExport=f,this.cd=_,this.dialog=D,this.editMode=!1,this.addMode=!1,this.isDirty=!1,this.addWidgetFormControl=new ia(null,[T.required]),this.authUser=Pt(this.store),this.widgetsBundle=this.route.snapshot.data.widgetsBundle,this.widgets=[...this.route.snapshot.data.widgets],this.authUser.authority===E.TENANT_ADMIN?this.isReadOnly=!this.widgetsBundle||this.widgetsBundle.tenantId.id===Ae:this.isReadOnly=this.authUser.authority!==E.SYS_ADMIN,!this.isReadOnly&&!this.widgets.length&&(this.editMode=!0),this.addWidgetFormControl.valueChanges.pipe(Ne()).subscribe(M=>{M&&this.addWidget(M)})}ngOnInit(){}trackByWidget(e,o){return o}widgetDrop(e){let o=this.widgets[e.previousIndex];this.widgets.splice(e.previousIndex,1),this.widgets.splice(e.currentIndex,0,o),this.isDirty=!0}addWidgetMode(){this.addWidgetFormControl.patchValue(null,{emitEvent:!1}),this.excludeWidgetTypeIds=this.widgets.map(e=>e.id.id),this.addMode=!0}cancelAddWidgetMode(){this.addMode=!1}addWidget(e){this.widgets.push(e),this.isDirty=!0,this.addMode=!1}openWidgetEditor(e,o){e&&e.stopPropagation(),this.router.navigate([o.id.id],{relativeTo:this.route}).then(()=>{})}exportWidgetType(e,o){e&&e.stopPropagation(),this.importExport.exportWidgetType(o.id.id)}removeWidgetType(e,o){e&&e.stopPropagation();let t=this.widgets.indexOf(o);this.widgets.splice(t,1),this.isDirty=!0}goBack(){this.router.navigate([".."],{relativeTo:this.route})}exportWidgetsBundle(){this.importExport.exportWidgetsBundle(this.widgetsBundle.id.id)}edit(){this.editMode=!0}cancel(){this.isDirty?this.widgetsService.getBundleWidgetTypeInfosList(this.widgetsBundle.id.id).subscribe(e=>{this.widgets=[...e],this.isDirty=!1,this.addMode=!1,this.editMode=!this.widgets.length,this.cd.markForCheck()}):(this.addMode=!1,this.editMode=!this.widgets.length)}save(){let e=this.widgets.map(o=>o.id.id);this.widgetsService.updateWidgetsBundleWidgetTypes(this.widgetsBundle.id.id,e).subscribe(()=>{this.isDirty=!1,this.editMode=!1,this.addMode=!1})}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(Na,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(o=>{o&&this.router.navigate([o],{relativeTo:this.route}).then(()=>{})})}importWidgetType(){this.importExport.importWidgetType().subscribe(e=>{if(e){let o=this.widgets.some(t=>t.id.id===e.id.id);o&&(this.widgets=this.widgets.map(t=>t.id.id!==e.id.id?t:e)),this.editMode?(this.widgets.push(e),this.isDirty=!0,this.cd.markForCheck()):o||this.widgetsService.addWidgetFqnToWidgetBundle(this.widgetsBundle.id.id,e.fqn).subscribe(()=>{this.widgets.push(e),this.cd.markForCheck()})}})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Ri),h(si),h(Pi),h(Je),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-widgets-bundle-widget"]],features:[G],decls:46,vars:33,consts:[["addWidgetMenu","matMenu"],["appearance","outlined",1,"tb-bundle-widgets-card"],[1,"title-container"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"mat-headline-5"],[1,"flex-1"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["xPosition","before"],["mat-menu-item","",3,"click"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-bundle-widgets-container",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","","class","tb-draggable tb-bundle-widget-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","tb-add-widget-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["class","tb-add-widget-button-panel",4,"ngIf"],["class","tb-no-data-available",4,"ngIf"],["class","tb-add-bundle-widget-form",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor"],["color","warn","mode","indeterminate"],[2,"height","4px"],["cdkDrag","",1,"tb-draggable","tb-bundle-widget-row"],[1,"tb-bundle-widget-row-details"],[1,"tb-bundle-widget-image-preview",3,"src","alt"],[1,"tb-bundle-widget-details"],[1,"tb-bundle-widget-title"],["class","tb-bundle-widget-deprecated",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-drag-handle",3,"!hidden","matTooltip",4,"ngIf"],[1,"tb-bundle-widget-deprecated"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-drag-handle",3,"matTooltip"],["matTooltipPosition","above",1,"tb-add-widget-button",3,"click","matTooltip"],["color","primary",1,"tb-add-widget-icon"],[1,"tb-add-widget-button-panel"],[1,"tb-add-widget-button-with-text",3,"click"],["translate","",1,"tb-add-widget-button-text"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],["translate","",1,"tb-no-data-text"],[1,"tb-add-bundle-widget-form"],["required","",3,"placeholder","excludeWidgetTypeIds","formControl"],[1,"tb-add-bundle-widget-actions"],["mat-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"button",3),c(5,"translate"),C("click",function(){return I(d),w(t.goBack())}),s(6,"mat-icon"),p(7,"arrow_back"),r()(),s(8,"span",4),p(9),c(10,"translate"),r(),g(11,"span",5),v(12,fv,5,7,"button",6),s(13,"mat-menu",7,0)(15,"button",8),C("click",function(_){return I(d),w(t.addWidgetType(_))}),s(16,"mat-icon"),p(17,"insert_drive_file"),r(),s(18,"span"),p(19),c(20,"translate"),r()(),s(21,"button",8),C("click",function(){return I(d),w(t.importWidgetType())}),s(22,"mat-icon"),p(23,"file_upload"),r(),s(24,"span"),p(25),c(26,"translate"),r()()(),s(27,"button",3),c(28,"translate"),C("click",function(){return I(d),w(t.exportWidgetsBundle())}),s(29,"mat-icon"),p(30,"file_download"),r()()()()(),v(31,gv,1,0,"mat-progress-bar",9),c(32,"async"),v(33,hv,1,0,"div",10),c(34,"async"),s(35,"mat-card-content")(36,"div",11),C("cdkDropListDropped",function(_){return I(d),w(t.widgetDrop(_))}),v(37,Sv,13,14,"div",12),r(),v(38,Tv,4,3,"div",13)(39,xv,6,0,"div",14)(40,Ev,4,0,"div",15)(41,Iv,8,11,"div",16),r(),s(42,"mat-card-actions"),v(43,wv,4,6,"button",17)(44,Mv,4,6,"button",18)(45,Dv,4,6,"button",18),r()()}o&2&&(a(4),x("matTooltip",u(5,19,"action.back")),a(5),Ja("",t.widgetsBundle.title,": ",u(10,21,"widget.widgets"),""),a(3),m("ngIf",!t.isReadOnly),a(7),B(u(20,23,"dashboard.create-new-widget")),a(6),B(u(26,25,"widget.import")),a(2),x("matTooltip",u(28,27,"widgets-bundle.export")),a(4),m("ngIf",u(32,29,t.isLoading$)),a(2),m("ngIf",u(34,31,t.isLoading$)===!1),a(3),m("cdkDropListDisabled",!t.editMode||(t.widgets==null?null:t.widgets.length)<2),a(),m("ngForOf",t.widgets)("ngForTrackBy",t.trackByWidget),a(),m("ngIf",t.editMode&&!t.addMode&&(t.widgets==null?null:t.widgets.length)),a(),m("ngIf",t.editMode&&!t.addMode&&!(t.widgets!=null&&t.widgets.length)),a(),m("ngIf",t.isReadOnly&&!(t.widgets!=null&&t.widgets.length)),a(),m("ngIf",t.addMode),a(2),m("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),a(),m("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),a(),m("ngIf",!t.isReadOnly&&!t.editMode))},dependencies:[xe,U,te,Ie,re,Zt,qr,ni,ui,ci,Ue,zr,Hr,$r,Mt,_a,ya,va,W,fe,ii,J,bi,Io,me,cs,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%;padding:8px}[_nghost-%COMP%]     .tb-bundle-widgets-card .mat-mdc-card-header-text{flex:1}.tb-bundle-widgets-card[_ngcontent-%COMP%]{padding:0;width:100%;height:100%;display:flex;flex-direction:column}@media screen and (min-width: 960px) and (max-width: 1279px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:60%}}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{flex:1;padding:16px;min-height:0;overflow:hidden;display:flex;flex-direction:column;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button[_ngcontent-%COMP%]{min-height:56px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:8px;border:2px dashed rgba(0,0,0,.08);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]{cursor:pointer;display:flex;padding:24px 40px 24px 24px;justify-content:center;align-items:center;gap:8px;border:2px dashed rgba(0,0,0,.12);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]   .tb-add-widget-button-text[_ngcontent-%COMP%]{font-size:16px;font-style:normal;font-weight:500;line-height:24px;letter-spacing:.25px;color:#305680}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-form[_ngcontent-%COMP%]{display:flex;padding:16px;flex-direction:column;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-start;gap:16px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:8px}.tb-bundle-widgets-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}.tb-bundle-widget-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:6px 12px 6px 6px;background:#fff;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:12px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-image-preview[_ngcontent-%COMP%]{width:64px;max-height:52px;height:100%;object-fit:contain;border-radius:6px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]{padding:18px 0;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-title[_ngcontent-%COMP%]{font-size:14px;font-weight:400;letter-spacing:.2px;color:#000000c2}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-deprecated[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#0000008a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#0000008a}']});let i=n;return i})();var Fv=i=>{let n=i.params.widgetsBundleId;return Ut(si).getWidgetsBundle(n)},Pv=i=>{let n=i.params.widgetsBundleId;return Ut(si).getBundleWidgetTypeInfosList(n)},Av=i=>{let n=i.params.widgetTypeId;if(!n||Object.keys(Ti).includes(n)){let l=n;return l||(l=Ti.timeseries),Ut(si).getWidgetTemplate(l).pipe(rt(e=>(e.widgetName=null,{widgetTypeDetails:null,widget:e})))}else return Ut(si).getWidgetTypeById(n).pipe(rt(l=>(l=Lr(l),{widgetTypeDetails:l,widget:Zr(l)})))},Nv=i=>i.data.widgetsBundle.title,kv=(i,n,l)=>l?.widget?.widgetName?l.widget.widgetName+(l.widget.deprecated?` (${n.instant("widget.deprecated")})`:""):"",zf=[{path:":widgetTypeId",component:el,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.editor",breadcrumb:{labelFunction:kv,icon:"insert_chart"},hideTabs:!0},resolve:{widgetEditorData:Av}}],Ov=[{path:"widget-types",data:{breadcrumb:{menuId:ve.widget_types}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.widgets"},resolve:{entitiesTableConfig:nl}},{path:"details",children:[{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"now_widgets"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.widgets",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:nl}}]},...zf]}],Bv=[{path:"widgets-bundles",data:{breadcrumb:{menuId:ve.widgets_bundles}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles"},resolve:{entitiesTableConfig:Xs}},{path:"details",children:[{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"now_widgets"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Xs}}]},{path:":widgetsBundleId",data:{breadcrumb:{labelFunction:Nv,icon:"now_widgets"}},resolve:{widgetsBundle:Fv},children:[{path:"",component:ol,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundle-widgets",hideTabs:!0},resolve:{widgets:Pv}},...zf]}]}],$f=[{path:"widgets-library",component:pn,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:ve.widget_library}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:"/resources/widgets-library/widget-types"}},...Ov,...Bv]}],Rv=[{path:"widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"resources/widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"}],al=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[nl,Xs],imports:[V.forChild(Rv),V]});let i=n;return i})();(function(){Q(al,{imports:[V],exports:[V]})})();S();var Jf=[{path:"auditLogs",component:ri,data:{auth:[E.TENANT_ADMIN],title:"audit-log.audit-logs",breadcrumb:{menuId:ve.audit_log},isPage:!0}}],Vv=[{path:"auditLogs",redirectTo:"/security-settings/auditLogs"}],rl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(Vv),V]});let i=n;return i})();(function(){Q(rl,{imports:[V],exports:[V]})})();S();S();S();var jv=()=>({standalone:!0});function Lv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-title-required")," "))}function Gv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-title-max-length")," "))}function Uv(i,n){if(i&1&&(s(0,"mat-option",17),p(1),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l," ")}}function qv(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.platformTypeTranslations.get(l))," ")}}function Wv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-id-required")," "))}function Hv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-id-max-length")," "))}function zv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-secret-required")," "))}function $v(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.client-secret-max-length")," "))}function Jv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.access-token-uri-required")," "))}function Qv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function Yv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.authorization-uri-required")," "))}function Kv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function Xv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function Zv(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.uri-pattern-error")," "))}function ey(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"uppercase"),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",u(2,2,l)," ")}}function ty(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.login-button-label-required")," "))}function iy(i,n){if(i&1&&(s(0,"div",6)(1,"mat-form-field",10)(2,"mat-label",3),p(3,"admin.oauth2.login-button-label"),r(),g(4,"input",35),c(5,"translate"),v(6,ty,3,3,"mat-error",5),r(),s(7,"mat-form-field",2)(8,"mat-label",3),p(9,"admin.oauth2.login-button-icon"),r(),g(10,"input",36),r()()),i&2){let l=y(3);a(4),x("placeholder",u(5,2,"admin.oauth2.login-button-label-placeholder")),a(2),m("ngIf",l.entityForm.get("loginButtonLabel").hasError("required"))}}function ny(i,n){if(i&1&&(s(0,"section",23)(1,"div",6)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.access-token-uri"),r(),g(5,"input",24),v(6,Jv,3,3,"mat-error",5)(7,Qv,3,3,"mat-error",5),r(),s(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.authorization-uri"),r(),g(11,"input",25),v(12,Yv,3,3,"mat-error",5)(13,Kv,3,3,"mat-error",5),r()(),s(14,"div",6)(15,"mat-form-field",2)(16,"mat-label",3),p(17,"admin.oauth2.jwk-set-uri"),r(),g(18,"input",26),v(19,Xv,3,3,"mat-error",5),r(),s(20,"mat-form-field",2)(21,"mat-label",3),p(22,"admin.oauth2.user-info-uri"),r(),g(23,"input",27),v(24,Zv,3,3,"mat-error",5),r()(),s(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.client-authentication-method"),r(),s(29,"mat-select",28),v(30,ey,3,4,"mat-option",9),r()()(),v(31,iy,11,4,"div",29),s(32,"section",30)(33,"div",31)(34,"mat-slide-toggle",32),p(35),c(36,"translate"),r()(),s(37,"div",31)(38,"mat-slide-toggle",33),p(39),c(40,"translate"),r()()(),g(41,"tb-string-items-list",34),c(42,"translate"),c(43,"translate"),r()),i&2){let l=y(2);a(6),m("ngIf",l.entityForm.get("accessTokenUri").hasError("required")),a(),m("ngIf",l.entityForm.get("accessTokenUri").hasError("pattern")),a(5),m("ngIf",l.entityForm.get("authorizationUri").hasError("required")),a(),m("ngIf",l.entityForm.get("authorizationUri").hasError("pattern")),a(6),m("ngIf",l.entityForm.get("jwkSetUri").hasError("pattern")),a(5),m("ngIf",l.entityForm.get("userInfoUri").hasError("pattern")),a(6),m("ngForOf",l.clientAuthenticationMethods),a(),m("ngIf",l.isCustomProvider()),a(4),b(" ",u(36,12,"admin.oauth2.allow-user-creation")," "),a(4),b(" ",u(40,14,"admin.oauth2.activate-user")," "),a(2),x("label",u(42,16,"admin.oauth2.scope")),x("requiredText",u(43,18,"admin.oauth2.scope-required"))}}function oy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.user-name-attribute-name-required")," "))}function ay(i,n){if(i&1&&(s(0,"mat-option",17),p(1),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l," ")}}function ry(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.email-attribute-key-required")," "))}function sy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.email-attribute-key-max-length")," "))}function ly(i,n){if(i&1&&(s(0,"div",1)(1,"mat-form-field",2)(2,"mat-label",3),p(3,"admin.oauth2.email-attribute-key"),r(),g(4,"input",52),v(5,ry,3,3,"mat-error",5)(6,sy,3,3,"mat-error",5),r()()),i&2){let l=y(4);a(5),m("ngIf",l.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("required")),a(),m("ngIf",l.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("maxlength"))}}function my(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.first-name-attribute-key-max-length")," "))}function py(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.last-name-attribute-key-max-length")," "))}function dy(i,n){if(i&1&&(s(0,"mat-option",17),p(1),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l," ")}}function cy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.tenant-name-pattern-required")," "))}function uy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.tenant-name-pattern-max-length")," "))}function fy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.customer-name-pattern-max-length")," "))}function gy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.default-dashboard-name-max-length")," "))}function hy(i,n){if(i&1&&(s(0,"section",43),v(1,ly,7,2,"div",44),s(2,"div",6)(3,"mat-form-field",2)(4,"mat-label",3),p(5,"admin.oauth2.first-name-attribute-key"),r(),g(6,"input",45),v(7,my,3,3,"mat-error",5),r(),s(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.last-name-attribute-key"),r(),g(11,"input",46),v(12,py,3,3,"mat-error",5),r()(),s(13,"div",6)(14,"mat-form-field",2)(15,"mat-label",3),p(16,"admin.oauth2.tenant-name-strategy"),r(),s(17,"mat-select",47),v(18,dy,2,2,"mat-option",9),r()(),s(19,"mat-form-field",2)(20,"mat-label",3),p(21,"admin.oauth2.tenant-name-pattern"),r(),g(22,"input",48),v(23,cy,3,3,"mat-error",5)(24,uy,3,3,"mat-error",5),r()(),s(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.customer-name-pattern"),r(),g(29,"input",49),v(30,fy,3,3,"mat-error",5),r()(),s(31,"div",6)(32,"mat-form-field",2)(33,"mat-label",3),p(34,"admin.oauth2.default-dashboard-name"),r(),g(35,"input",50),v(36,gy,3,3,"mat-error",5),r(),s(37,"mat-slide-toggle",51),p(38),c(39,"translate"),r()()()),i&2){let l=y(3);a(),m("ngIf",l.entityForm.get("mapperConfig.type").value!==l.mapperType.GITHUB),a(6),m("ngIf",l.entityForm.get("mapperConfig.basic.firstNameAttributeKey").hasError("maxlength")),a(5),m("ngIf",l.entityForm.get("mapperConfig.basic.lastNameAttributeKey").hasError("maxlength")),a(6),m("ngForOf",l.tenantNameStrategies),a(),j("!hidden",l.entityForm.get("mapperConfig.basic.tenantNameStrategy").value!=="CUSTOM"),a(3),m("required",l.entityForm.get("mapperConfig.basic.tenantNameStrategy").value==="CUSTOM"),a(),m("ngIf",l.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("required")),a(),m("ngIf",l.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("maxlength")),a(6),m("ngIf",l.entityForm.get("mapperConfig.basic.customerNamePattern").hasError("maxlength")),a(6),m("ngIf",l.entityForm.get("mapperConfig.basic.defaultDashboardName").hasError("maxlength")),a(2),b(" ",u(39,12,"admin.oauth2.always-fullscreen")," ")}}function by(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.url-required")," "))}function vy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.url-pattern")," "))}function yy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.url-max-length")," "))}function _y(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.username-max-length")," "))}function Cy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.password-max-length")," "))}function Sy(i,n){if(i&1&&(s(0,"section",53)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.url"),r(),g(5,"input",54),v(6,by,3,3,"mat-error",5)(7,vy,3,3,"mat-error",5)(8,yy,3,3,"mat-error",5),r()(),s(9,"div",6)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"common.username"),r(),g(13,"input",55),v(14,_y,3,3,"mat-error",5),r(),s(15,"mat-form-field",2)(16,"mat-label",3),p(17,"common.password"),r(),g(18,"input",56),v(19,Cy,3,3,"mat-error",5),r()(),s(20,"mat-slide-toggle",57),p(21),c(22,"translate"),r()()),i&2){let l=y(3);a(6),m("ngIf",l.entityForm.get("mapperConfig.custom.url").hasError("required")),a(),m("ngIf",l.entityForm.get("mapperConfig.custom.url").hasError("pattern")),a(),m("ngIf",l.entityForm.get("mapperConfig.custom.url").hasError("maxlength")),a(6),m("ngIf",l.entityForm.get("mapperConfig.custom.username").hasError("maxlength")),a(5),m("ngIf",l.entityForm.get("mapperConfig.custom.password").hasError("maxlength")),a(2),b(" ",u(22,6,"admin.oauth2.send-token")," ")}}function Ty(i,n){if(i&1&&(s(0,"section",37)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.user-name-attribute-name"),r(),g(5,"input",38),v(6,oy,3,3,"mat-error",5),r()(),s(7,"section",39)(8,"div",1)(9,"mat-form-field",2)(10,"mat-label",3),p(11,"admin.oauth2.type"),r(),s(12,"mat-select",40),v(13,ay,2,2,"mat-option",9),r()()(),v(14,hy,40,14,"section",41)(15,Sy,23,8,"section",42),r()()),i&2){let l=y(2);a(6),m("ngIf",l.entityForm.get("userNameAttributeName").hasError("required")),a(7),m("ngForOf",l.mapperTypes),a(),m("ngIf",l.entityForm.get("mapperConfig.type").value!==l.mapperType.CUSTOM&&l.entityForm.get("mapperConfig.basic")),a(),m("ngIf",l.entityForm.get("mapperConfig.type").value===l.mapperType.CUSTOM&&l.entityForm.get("mapperConfig.custom"))}}function xy(i,n){if(i&1){let l=L();s(0,"section",18)(1,"div",19),g(2,"span"),s(3,"tb-toggle-select",20),et("ngModelChange",function(o){I(l);let t=y();return Ze(t.generalSettingsMode,o)||(t.generalSettingsMode=o),w(o)}),s(4,"tb-toggle-option",17),p(5),c(6,"translate"),r(),s(7,"tb-toggle-option",17),p(8),c(9,"translate"),r()()(),v(10,ny,44,20,"section",21)(11,Ty,16,4,"section",22),r()}if(i&2){let l=y();a(3),Xe("ngModel",l.generalSettingsMode),m("ngModelOptions",Bt(12,jv)),a(),m("value",!0),a(),B(u(6,8,"admin.oauth2.general")),a(2),m("value",!1),a(),B(u(9,10,"admin.oauth2.mapper")),a(2),m("ngIf",l.generalSettingsMode),a(),m("ngIf",!l.generalSettingsMode)}}var ka=class ka extends kt{constructor(n,l,e,o,t,d,f){super(n,f,o,t,d),this.store=n,this.translate=l,this.oauth2Service=e,this.entityValue=o,this.entitiesTableConfigValue=t,this.cd=d,this.fb=f,this.createNewDialog=!1,this.templateProvider=["Custom"],this.templates=new Map,this.defaultProvider={additionalInfo:{providerName:"Custom"},clientAuthenticationMethod:Mr.POST,userNameAttributeName:"email",mapperConfig:{allowUserCreation:!0,activateUser:!1,type:Yn.BASIC,basic:{emailAttributeKey:"email",tenantNameStrategy:Dr.DOMAIN,alwaysFullScreen:!1}}},this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.subscriptions=[],this.separatorKeysCodes=[13,188],this.clientAuthenticationMethods=Object.keys(Mr),this.mapperType=Yn,this.mapperTypes=Object.keys(Yn),this.tenantNameStrategies=Object.keys(Dr),this.platformTypes=Object.values(Vi),this.platformTypeTranslations=Kn,this.generalSettingsMode=!0,this.advancedExpanded=!1,this.oauth2Service.getOAuth2Template().subscribe(_=>{this.initTemplates(_)}),Pt(this.store).authority===E.TENANT_ADMIN&&(this.platformTypes=this.platformTypes.filter(_=>_!==Vi.WEB))}ngOnDestroy(){super.ngOnDestroy(),this.subscriptions.forEach(n=>{n.unsubscribe()})}buildForm(n){return this.fb.group({title:[n?.title?n.title:"",[T.required,T.maxLength(100)]],additionalInfo:this.fb.group({providerName:[n?.additionalInfo?.providerName?n?.additionalInfo?.providerName:"",T.required]}),platforms:[n?.platforms?n.platforms:[]],clientId:[n?.clientId?n.clientId:"",[T.required,T.maxLength(255)]],clientSecret:[n?.clientSecret?n.clientSecret:"",[T.required,T.maxLength(2048)]],accessTokenUri:[n?.accessTokenUri?n.accessTokenUri:"",[T.required,T.pattern(this.URL_REGEXP)]],authorizationUri:[n?.authorizationUri?n.authorizationUri:"",[T.required,T.pattern(this.URL_REGEXP)]],jwkSetUri:[n?.jwkSetUri?n.jwkSetUri:"",T.pattern(this.URL_REGEXP)],userInfoUri:[n?.userInfoUri?n.userInfoUri:"",[T.pattern(this.URL_REGEXP)]],clientAuthenticationMethod:[n?.clientAuthenticationMethod?n.clientAuthenticationMethod:Mr.POST,T.required],loginButtonLabel:[n?.loginButtonLabel?n.loginButtonLabel:null,T.required],loginButtonIcon:[n?.loginButtonIcon?n.loginButtonIcon:null],userNameAttributeName:[n?.userNameAttributeName?n.userNameAttributeName:"email",T.required],scope:[n?.scope?n.scope:[],T.required],mapperConfig:this.fb.group({allowUserCreation:[Be(n?.mapperConfig?.allowUserCreation)?n.mapperConfig.allowUserCreation:!0],activateUser:[Be(n?.mapperConfig?.activateUser)?n.mapperConfig.activateUser:!1],type:[n?.mapperConfig?.type?n.mapperConfig.type:Yn.BASIC,T.required]})})}updateForm(n){this.entityForm.patchValue({title:n.title,additionalInfo:{providerName:n.additionalInfo.providerName},platforms:n.platforms,clientId:n.clientId,clientSecret:n.clientSecret,accessTokenUri:n.accessTokenUri,scope:n.scope,authorizationUri:n.authorizationUri,jwkSetUri:n.jwkSetUri,userInfoUri:n.userInfoUri,clientAuthenticationMethod:n.clientAuthenticationMethod,loginButtonLabel:n.loginButtonLabel,loginButtonIcon:n.loginButtonIcon,userNameAttributeName:n.userNameAttributeName,mapperConfig:{allowUserCreation:n.mapperConfig.allowUserCreation,activateUser:n.mapperConfig.activateUser,type:n.mapperConfig.type}},{emitEvent:!1}),this.changeMapperConfigType(this.entityForm,this.entityValue.mapperConfig.type,this.entityValue.mapperConfig)}getProviderName(){return this.entityForm.get("additionalInfo.providerName").value}isCustomProvider(){return this.getProviderName()==="Custom"}initTemplates(n){n.map(o=>{delete o.additionalInfo,this.templates.set(o.name,o)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort();let l=null;Be(this.entityValue?.additionalInfo)&&(l=this.entityValue.additionalInfo,this.templateProvider.indexOf(l.providerName)===-1&&(l.providerName="Custom"));let e="Custom";this.templateProvider.indexOf("Google")&&(e="Google"),this.entityForm.get("additionalInfo.providerName").setValue(l?.providerName?l?.providerName:e),this.changeMapperConfigType(this.entityForm,Yn.BASIC),(this.createNewDialog||this.isAdd)&&this.setProviderDefaultValue(e,this.entityForm),this.subscriptions.push(this.entityForm.get("mapperConfig.type").valueChanges.subscribe(o=>{this.changeMapperConfigType(this.entityForm,o)})),this.subscriptions.push(this.entityForm.get("additionalInfo.providerName").valueChanges.subscribe(o=>{this.entityForm.get("scope").setValue([]),this.setProviderDefaultValue(o,this.entityForm)}))}changeMapperConfigType(n,l,e){let o=n.get("mapperConfig");l===Yn.CUSTOM?(o.removeControl("basic"),o.get("custom")?o.get("custom").patchValue(e.custom,{emitEvent:!1}):o.addControl("custom",this.formCustomGroup(e?.custom))):(o.removeControl("custom"),o.get("basic")?e?.basic&&(o.get("basic").patchValue(e.basic,{emitEvent:!1}),o.get("basic.tenantNameStrategy").updateValueAndValidity({onlySelf:!0})):o.addControl("basic",this.formBasicGroup(e?.basic)),l===Yn.GITHUB?(o.get("basic.emailAttributeKey").disable(),o.get("basic.emailAttributeKey").patchValue(null,{emitEvent:!1})):(this.createNewDialog||this.isEdit||this.isAdd)&&o.get("basic.emailAttributeKey").enable())}formCustomGroup(n){let l=this.fb.group({url:[n?.url?n.url:null,[T.required,T.pattern(this.URL_REGEXP),T.maxLength(255)]],username:[n?.username?n.username:null,T.maxLength(255)],password:[n?.password?n.password:null,T.maxLength(255)],sendToken:[Be(n?.sendToken)?n.sendToken:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&l.disable(),l}formBasicGroup(n){let l;n?.tenantNamePattern?l=n.tenantNamePattern:l={value:null,disabled:!0};let e=this.fb.group({emailAttributeKey:[n?.emailAttributeKey?n.emailAttributeKey:"email",[T.required,T.maxLength(31)]],firstNameAttributeKey:[n?.firstNameAttributeKey?n.firstNameAttributeKey:"",T.maxLength(31)],lastNameAttributeKey:[n?.lastNameAttributeKey?n.lastNameAttributeKey:"",T.maxLength(31)],tenantNameStrategy:[n?.tenantNameStrategy?n.tenantNameStrategy:Dr.DOMAIN],tenantNamePattern:[l,[T.required,T.maxLength(255)]],customerNamePattern:[n?.customerNamePattern?n.customerNamePattern:null,T.maxLength(255)],defaultDashboardName:[n?.defaultDashboardName?n.defaultDashboardName:null,T.maxLength(255)],alwaysFullScreen:[Be(n?.alwaysFullScreen)?n.alwaysFullScreen:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&e.disable(),this.subscriptions.push(e.get("tenantNameStrategy").valueChanges.subscribe(o=>{o==="CUSTOM"&&(this.createNewDialog||this.isEdit||this.isAdd)?e.get("tenantNamePattern").enable():e.get("tenantNamePattern").disable()})),e}setProviderDefaultValue(n,l){if(n==="Custom"){let e=l.get("title").value;l.reset(this.defaultProvider,{emitEvent:!1}),l.patchValue({title:e},{emitEvent:!1}),this.advancedExpanded=!0}else{let e=this.templates.get(n);e.clientId="",e.clientSecret="",l.patchValue(e)}}};ka.\u0275fac=function(l){return new(l||ka)(h(A),h(ee),h(fn),h("entity",8),h("entitiesTableConfig",8),h(Je),h(ce))},ka.\u0275cmp=F({type:ka,selectors:[["tb-client"]],inputs:{createNewDialog:"createNewDialog"},features:[G],decls:39,vars:15,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","title"],[4,"ngIf"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding","column-xs"],["formGroupName","additionalInfo",1,"tb-flex"],["formControlName","providerName"],[3,"value",4,"ngFor","ngForOf"],["floatLabel","always",1,"flex"],["formControlName","platforms","multiple","",3,"placeholder"],["matInput","","formControlName","clientId"],["matInput","","formControlName","clientSecret"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[3,"value"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["appearance","fill",3,"ngModelChange","ngModel","ngModelOptions"],["class","tb-form-panel no-gap no-border no-padding","style","padding-bottom: 16px",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap",4,"ngIf"],[1,"tb-form-panel","no-gap","no-border","no-padding",2,"padding-bottom","16px"],["matInput","","formControlName","accessTokenUri"],["matInput","","formControlName","authorizationUri","required",""],["matInput","","formControlName","jwkSetUri"],["matInput","","formControlName","userInfoUri"],["formControlName","clientAuthenticationMethod"],["class","tb-form-row tb-standard-fields no-border no-padding column-xs",4,"ngIf"],["formGroupName","mapperConfig",2,"margin-bottom","22px"],[1,"tb-form-row","no-border","no-padding"],["formControlName","allowUserCreation",1,"mat-slide"],["formControlName","activateUser",1,"mat-slide"],["formControlName","scope","required","",3,"label","requiredText"],["matInput","","formControlName","loginButtonLabel",3,"placeholder"],["matInput","","formControlName","loginButtonIcon"],[1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","userNameAttributeName"],["formGroupName","mapperConfig",1,"tb-form-panel","no-border","no-padding","no-gap"],["formControlName","type"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","basic",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","custom",4,"ngIf"],["formGroupName","basic",1,"tb-form-panel","no-border","no-padding","no-gap"],["class","tb-form-row tb-standard-fields no-border no-padding",4,"ngIf"],["matInput","","formControlName","firstNameAttributeKey"],["matInput","","formControlName","lastNameAttributeKey"],["formControlName","tenantNameStrategy"],["matInput","","formControlName","tenantNamePattern",3,"required"],["matInput","","formControlName","customerNamePattern"],["matInput","","formControlName","defaultDashboardName"],["formControlName","alwaysFullScreen",1,"tb-flex","mat-slide",2,"margin-bottom","16px"],["matInput","","formControlName","emailAttributeKey"],["formGroupName","custom",1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","url"],["matInput","","formControlName","username","autocomplete","new-username"],["matInput","","formControlName","password","autocomplete","new-password"],["formControlName","sendToken",1,"tb-flex","mat-slide",2,"margin-bottom","16px"]],template:function(l,e){l&1&&(s(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.title"),r(),g(5,"input",4),v(6,Lv,3,3,"mat-error",5)(7,Gv,3,3,"mat-error",5),r()(),s(8,"div",6)(9,"div",7)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.provider"),r(),s(13,"mat-select",8),v(14,Uv,2,2,"mat-option",9),r()()(),s(15,"mat-form-field",10)(16,"mat-label",3),p(17,"admin.oauth2.allowed-platforms"),r(),s(18,"mat-select",11),c(19,"translate"),v(20,qv,3,4,"mat-option",9),r()()(),s(21,"div",6)(22,"mat-form-field",2)(23,"mat-label",3),p(24,"admin.oauth2.client-id"),r(),g(25,"input",12),v(26,Wv,3,3,"mat-error",5)(27,Hv,3,3,"mat-error",5),r(),s(28,"mat-form-field",2)(29,"mat-label",3),p(30,"admin.oauth2.client-secret"),r(),g(31,"input",13),v(32,zv,3,3,"mat-error",5)(33,$v,3,3,"mat-error",5),r()(),s(34,"mat-expansion-panel",14)(35,"mat-expansion-panel-header")(36,"mat-panel-title",15),p(37," admin.oauth2.advanced-settings "),r()(),v(38,xy,12,13,"ng-template",16),r()()),l&2&&(j("no-padding",e.isAdd),m("formGroup",e.entityForm),a(6),m("ngIf",e.entityForm.get("title").hasError("required")),a(),m("ngIf",e.entityForm.get("title").hasError("maxlength")),a(7),m("ngForOf",e.templateProvider),a(4),x("placeholder",u(19,13,"admin.oauth2.all-platforms")),a(2),m("ngForOf",e.platformTypes),a(6),m("ngIf",e.entityForm.get("clientId").hasError("required")),a(),m("ngIf",e.entityForm.get("clientId").hasError("maxlength")),a(5),m("ngIf",e.entityForm.get("clientSecret").hasError("required")),a(),m("ngIf",e.entityForm.get("clientSecret").hasError("maxlength")),a(),m("expanded",e.advancedExpanded))},dependencies:[xe,U,mn,be,de,Se,Fe,vt,gt,ht,Li,nn,on,eo,he,W,X,fe,Qe,ne,le,bt,J,Di,Fi,Tr,R],styles:['@charset "UTF-8";  .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}  .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}  .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}  .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}']});var jn=ka;Bo([ra(),Ro("design:type",Object)],jn.prototype,"createNewDialog",void 0);S();var sl=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.width="100%"}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-client-table-header"]],hostVars:2,hostBindings:function(o,t){o&2&&Bi("width",t.width)},features:[G],decls:4,vars:1,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],[3,"tb-help"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1),p(2,"admin.oauth2.clients"),r(),g(3,"div",2),r()),o&2&&(a(3),m("tb-help",t.entitiesTableConfig.entityResources.helpLinkId))},dependencies:[$t,tn,J],encapsulation:2});let i=n;return i})();var ll=(()=>{let n=class n{constructor(e,o,t){this.translate=e,this.datePipe=o,this.oauth2Service=t,this.config=new Le,this.config.selectionEnabled=!1,this.config.entityType=O.OAUTH2_CLIENT,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.OAUTH2_CLIENT),this.config.entityResources=tt.get(O.OAUTH2_CLIENT),this.config.entityComponent=jn,this.config.headerComponent=sl,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("title","admin.oauth2.title","350px"),new K("platforms","admin.oauth2.allowed-platforms","100%",d=>d.platforms&&d.platforms.length?d.platforms.map(f=>this.translate.instant(Kn.get(f))).join(", "):this.translate.instant("admin.oauth2.all-platforms"),()=>({}),!1)),this.config.deleteEntityTitle=d=>this.translate.instant("admin.oauth2.delete-client-title",{clientName:d.title}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-client-text"),this.config.entitiesFetchFunction=d=>this.oauth2Service.findTenantOAuth2ClientInfos(d),this.config.loadEntity=d=>this.oauth2Service.getOAuth2ClientById(d.id),this.config.saveEntity=d=>this.oauth2Service.saveOAuth2Client(d),this.config.deleteEntity=d=>this.oauth2Service.deleteOauth2Client(d.id)}resolve(){return this.config}};n.\u0275fac=function(o){return new(o||n)(P(ee),P(Oe),P(fn))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();var Qf=(()=>{let n=class n{constructor(e){this.http=e}saveDomain(e,o,t){let d="/api/domain";return o?.length&&(d+=`?oauth2ClientIds=${o.join(",")}`),this.http.post(d,e,Uo(t))}updateOauth2Clients(e,o,t){return this.http.put(`/api/domain/${e}/oauth2Clients`,o,Uo(t))}getTenantDomainInfos(e,o){return this.http.get(`/api/domain/infos${e.toQuery()}`,Uo(o))}getDomainInfoById(e,o){return this.http.get(`/api/domain/info/${e}`,Uo(o))}deleteDomain(e,o){return this.http.delete(`/api/domain/${e}`,Uo(o))}};n.\u0275fac=function(o){return new(o||n)(P(Ir))},n.\u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();S();S();var wy=["clientComponent"];function My(i,n){i&1&&g(0,"mat-progress-bar",13)}function Dy(i,n){i&1&&g(0,"div",14)}var Oa=(()=>{let n=class n extends nt{constructor(e,o,t,d,f){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.oauth2Service=d,this.errorStateMatcher=f,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.clientComponent.entityForm.markAsDirty()},0)}isErrorState(e,o){let t=this.errorStateMatcher.isErrorState(e,o),d=!!(e&&e.invalid&&this.submitted);return t||d}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.clientComponent.entityForm.valid&&this.oauth2Service.saveOAuth2Client(this.clientComponent.entityFormValue()).subscribe(e=>{this.dialogRef.close(e)})}helpLinkId(){return bc(this.clientComponent.entityForm.get("additionalInfo.providerName")?.value)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(fn),h(en,4))},n.\u0275cmp=F({type:n,selectors:[["tb-client-dialog"]],viewQuery:function(o,t){if(o&1&&we(wy,7),o&2){let d;Me(d=De())&&(t.clientComponent=d.first)}},features:[He([{provide:en,useExisting:n}]),G],decls:25,vars:21,consts:[["clientComponent",""],[2,"width","850px","max-height","100vh",3,"ngSubmit"],["color","primary"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px",4,"ngIf"],["mat-dialog-content","",2,"padding","0"],["createNewDialog",""],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){if(o&1){let d=L();s(0,"form",1),C("ngSubmit",function(){return I(d),w(t.save())}),s(1,"mat-toolbar",2)(2,"h2"),p(3),c(4,"translate"),r(),g(5,"span",3),s(6,"button",4),C("click",function(){return I(d),w(t.cancel())}),s(7,"mat-icon",5),p(8,"close"),r()()(),v(9,My,1,0,"mat-progress-bar",6),c(10,"async"),v(11,Dy,1,0,"div",7),c(12,"async"),s(13,"div",8),g(14,"tb-client",9,0),r(),s(16,"div",10)(17,"button",11),c(18,"async"),C("click",function(){return I(d),w(t.cancel())}),p(19),c(20,"translate"),r(),s(21,"button",12),c(22,"async"),p(23),c(24,"translate"),r()()()}if(o&2){let d=q(15);a(3),B(u(4,7,"admin.oauth2.add-client")),a(6),m("ngIf",u(10,9,t.isLoading$)),a(2),m("ngIf",!u(12,11,t.isLoading$)),a(6),m("disabled",u(18,13,t.isLoading$)),a(2),b(" ",u(20,15,"action.cancel")," "),a(2),m("disabled",u(22,17,t.isLoading$)||(d.entityForm==null?null:d.entityForm.invalid)||!(d.entityForm!=null&&d.entityForm.dirty)),a(2),b(" ",u(24,19,"action.add")," ")}},dependencies:[U,te,Ie,re,Ue,at,Nt,dt,ue,X,xn,jn,me,R],encapsulation:2});let i=n;return i})();function Fy(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.oauth2.domain-name-required")," "))}function Py(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.domain-name-max-length")," "))}function Ay(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"admin.error-verification-url")," "))}var ml=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_,D,M,Y){super(e,D,d,f,_),this.store=e,this.translate=o,this.oauth2Service=t,this.entityValue=d,this.entitiesTableConfigValue=f,this.cd=_,this.fb=D,this.window=M,this.dialog=Y,this.loginProcessingUrl="",this.entityType=O,this.entityForm.get("name").setValue(this.window.location.hostname),this.entityForm.markAsDirty(),this.oauth2Service.getLoginProcessingUrl().subscribe(ke=>{this.loginProcessingUrl=ke})}buildForm(e){return this.fb.group({name:[e?.name?e.name:"",[T.required,T.maxLength(255),T.pattern("^(?:\\w+(?::\\w+)?@)?[^\\s/]+(?::\\d+)?$")]],oauth2Enabled:Be(e?.oauth2Enabled)?e.oauth2Enabled:!0,oauth2ClientInfos:e?.oauth2ClientInfos?e.oauth2ClientInfos.map(o=>o.id.id):[],propagateToEdge:Be(e?.propagateToEdge)?e.propagateToEdge:!1})}updateForm(e){this.entityForm.patchValue({name:e.name,oauth2Enabled:e.oauth2Enabled,oauth2ClientInfos:e.oauth2ClientInfos?.map(o=>o.id?o.id.id:o),propagateToEdge:e.propagateToEdge})}redirectURI(){let e=this.entityForm.get("name").value;return e!==""?`${e}${this.loginProcessingUrl}`:""}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(Oa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(o=>{if(o){let t=this.entityForm.get("oauth2ClientInfos").value?[...this.entityForm.get("oauth2ClientInfos").value]:[];t.push(o.id.id),this.entityForm.get("oauth2ClientInfos").patchValue(t),this.entityForm.get("oauth2ClientInfos").markAsDirty()}})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h(fn),h("entity"),h("entitiesTableConfig"),h(Je),h(ce),h(Xo),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-domain"]],features:[G],decls:31,vars:28,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","readonly","",3,"value"],["matSuffix","","miniButton","false","color","primary","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[1,"tb-form-row","no-border","no-padding",2,"margin-bottom","22px"],["formControlName","oauth2Enabled",1,"mat-slide"],["formControlName","oauth2ClientInfos",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"tb-form-row","no-border","no-padding"],["formControlName","propagateToEdge",1,"mat-slide"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.domain-name"),r(),g(5,"input",4),v(6,Fy,3,3,"mat-error",5)(7,Py,3,3,"mat-error",5)(8,Ay,3,3,"mat-error",5),r()(),s(9,"div",1)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.redirect-url-template"),r(),g(13,"input",6)(14,"tb-copy-button",7),c(15,"translate"),r()(),s(16,"div",8)(17,"mat-slide-toggle",9),p(18),c(19,"translate"),r()(),s(20,"tb-entity-list",10),c(21,"translate"),c(22,"translate"),s(23,"button",11),C("click",function(f){return t.createClient(f)}),s(24,"span",12),p(25),c(26,"translate"),r()()(),s(27,"div",13)(28,"mat-slide-toggle",14),p(29),c(30,"translate"),r()()()),o&2&&(j("no-padding",t.isAdd),m("formGroup",t.entityForm),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(),m("ngIf",t.entityForm.get("name").hasError("pattern")),a(5),m("value",t.redirectURI()),a(),x("tooltipText",u(15,16,"admin.oauth2.copy-redirect-uri")),m("copyText",t.redirectURI()),a(4),b(" ",u(19,18,"admin.oauth2.enable")," "),a(2),x("labelText",u(21,20,"admin.oauth2.clients")),x("placeholderText",u(22,22,"admin.oauth2.add-client")),m("entityType",t.entityType.OAUTH2_CLIENT),a(3),m("disabled",!t.isEdit),a(2),B(u(26,24,"admin.oauth2.create-new")),a(4),b(" ",u(30,26,"admin.oauth2.edge")," "))},dependencies:[U,io,te,be,de,Se,Fe,Xt,ht,he,W,X,ne,le,J,ga,R],encapsulation:2});let i=n;return i})();S();var pl=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.width="100%"}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-domain-table-header"]],hostVars:2,hostBindings:function(o,t){o&2&&Bi("width",t.width)},features:[G],decls:4,vars:1,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],[3,"tb-help"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1),p(2,"admin.oauth2.domains"),r(),g(3,"div",2),r()),o&2&&(a(3),m("tb-help",t.entitiesTableConfig.entityResources.helpLinkId))},dependencies:[$t,tn,J],encapsulation:2});let i=n;return i})();var Ad=(()=>{let n=class n{constructor(e,o,t){this.translate=e,this.datePipe=o,this.domainService=t,this.config=new Le,this.config.selectionEnabled=!1,this.config.entityType=O.DOMAIN,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.DOMAIN),this.config.entityResources=tt.get(O.DOMAIN),this.config.entityComponent=ml,this.config.headerComponent=pl,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("name","admin.oauth2.domain-name","170px"),new fa("oauth2ClientInfos","admin.oauth2.clients","40%"),new pd("oauth2Enabled","admin.oauth2.enable",{name:"",nameFunction:d=>this.translate.instant(d.oauth2Enabled?"admin.oauth2.disable":"admin.oauth2.enable"),icon:"mdi:toggle-switch",iconFunction:d=>d.oauth2Enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(d,f)=>this.toggleEnableOAuth(d,f)}),new pd("propagateToEdge","admin.oauth2.edge",{name:"",nameFunction:d=>this.translate.instant(d.propagateToEdge?"admin.oauth2.edge-disable":"admin.oauth2.edge-enable"),icon:"mdi:toggle-switch",iconFunction:d=>d.propagateToEdge?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(d,f)=>this.togglePropagateToEdge(d,f)})),this.config.deleteEntityTitle=d=>this.translate.instant("admin.oauth2.delete-domain-title",{domainName:d.name}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-domain-text"),this.config.entitiesFetchFunction=d=>this.domainService.getTenantDomainInfos(d),this.config.loadEntity=d=>this.domainService.getDomainInfoById(d.id),this.config.saveEntity=(d,f)=>{let _=d.oauth2ClientInfos||[],D=d.id&&!Nr(d.oauth2ClientInfos?.sort(),f.oauth2ClientInfos?.map(M=>M.id?M.id.id:M).sort());return delete d.oauth2ClientInfos,this.domainService.saveDomain(d,d.id?null:_).pipe(Xi(M=>D?this.domainService.updateOauth2Clients(d.id.id,_).pipe(rt(()=>M)):Ct(M)),rt(M=>(M.oauth2ClientInfos=_,M)))},this.config.deleteEntity=d=>this.domainService.deleteDomain(d.id)}resolve(e){return this.config}toggleEnableOAuth(e,o){e&&e.stopPropagation();let _=o,{oauth2ClientInfos:t,oauth2Enabled:d}=_,f=td(_,["oauth2ClientInfos","oauth2Enabled"]);this.domainService.saveDomain(Ji(Ce({},f),{oauth2Enabled:!d}),null,{ignoreLoading:!0}).subscribe(D=>{o.oauth2Enabled=D.oauth2Enabled,this.config.getTable().detectChanges()})}togglePropagateToEdge(e,o){e&&e.stopPropagation();let _=o,{oauth2ClientInfos:t,propagateToEdge:d}=_,f=td(_,["oauth2ClientInfos","propagateToEdge"]);this.domainService.saveDomain(Ji(Ce({},f),{propagateToEdge:!d}),null,{ignoreLoading:!0}).subscribe(D=>{o.propagateToEdge=D.propagateToEdge,this.config.getTable().detectChanges()})}};n.\u0275fac=function(o){return new(o||n)(P(ee),P(Oe),P(Qf))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Ny=(()=>{let n=class n{constructor(e){this.oauth2Service=e}resolve(){return this.oauth2Service.getLoginProcessingUrl()}};n.\u0275fac=function(o){return new(o||n)(P(fn))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),Nd=[{path:"oauth2",component:pn,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{label:"admin.oauth2.oauth2",icon:"mdi:shield-account"}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/oauth2/domains",TENANT_ADMIN:"/security-settings/oauth2/clients"}}},{path:"domains",component:Ve,data:{auth:[E.SYS_ADMIN],title:"admin.oauth2.domains",breadcrumb:{menuId:ve.domains}},resolve:{entitiesTableConfig:Ad}},{path:"clients",data:{title:"admin.oauth2.clients",breadcrumb:{menuId:ve.clients}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.oauth2.clients"},resolve:{entitiesTableConfig:ll}},{path:"details",children:[{path:":entityId",component:st,data:{breadcrumb:{labelFunction:lt,icon:"public"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.oauth2.clients",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:ll}}]}]}]}],dl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Ny,ll,Ad],imports:[V.forChild(Nd),V]});let i=n;return i})();(function(){Q(dl,{imports:[V],exports:[V]})})();S();S();S();S();var ky=["tagField"],lr=`@charset "UTF-8";.tb-scada-symbol-tooltip-panel{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-scada-symbol-tooltip-panel.column{flex-direction:column}.tb-scada-symbol-tooltip-panel.flex-start{align-items:start}.tb-scada-symbol-tooltip-panel .tb-confirm-text{font-size:14px;line-height:16px;text-align:center;font-weight:400}.tb-scada-symbol-tooltip-panel .mdc-button{line-height:20px;font-size:12px}.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base,.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base .mat-mdc-button-touch-target{height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field{font-size:12px;line-height:12px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper{padding:0 8px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{padding-top:4px;padding-bottom:4px;min-height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix .mat-mdc-input-element{font-size:12px;line-height:12px;height:12px}
`,Oy=["tagSettingsButton"],By=["removeTagButton"];function Ry(i,n){if(i&1){let l=L();s(0,"button",5),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.onUpdateTag())}),s(2,"mat-icon"),p(3,"edit"),r()()}i&2&&x("matTooltip",u(1,1,"scada.tag.update-tag"))}function Vy(i,n){i&1&&(s(0,"button",6,0),c(2,"translate"),s(3,"mat-icon"),p(4,"settings"),r()()),i&2&&x("matTooltip",u(2,1,"scada.tag.tag-settings"))}function jy(i,n){i&1&&(s(0,"button",6,1),c(2,"translate"),s(3,"mat-icon"),p(4,"delete"),r()()),i&2&&x("matTooltip",u(2,1,"scada.tag.remove-tag"))}var Ly=["yesButton"];function Gy(i,n){i&1&&(s(0,"div",3),p(1,"scada.state-render-function"),r())}function Uy(i,n){if(i&1){let l=L();s(0,"button",4),C("click",function(){I(l);let o=y();return w(o.editStateRenderFunction())}),s(1,"mat-icon"),p(2),r(),s(3,"span"),p(4),c(5,"translate"),r()()}if(i&2){let l=y();a(2),B(l.symbolElement!=null&&l.symbolElement.readonly?"visibility":"edit"),a(2),B(u(5,2,l.symbolElement!=null&&l.symbolElement.readonly?"action.view":"action.edit"))}}function qy(i,n){if(i&1){let l=L();s(0,"button",4),C("click",function(){I(l);let o=y();return w(o.editStateRenderFunction())}),s(1,"mat-icon"),p(2,"add"),r(),s(3,"span",3),p(4,"action.add"),r()()}}function Wy(i,n){i&1&&(s(0,"div",3),p(1,"scada.tag.on-click-action"),r())}function Hy(i,n){if(i&1){let l=L();s(0,"button",4),C("click",function(){I(l);let o=y();return w(o.editClickAction())}),s(1,"mat-icon"),p(2),r(),s(3,"span"),p(4),c(5,"translate"),r()()}if(i&2){let l=y();a(2),B(l.symbolElement!=null&&l.symbolElement.readonly?"visibility":"edit"),a(2),B(u(5,2,l.symbolElement!=null&&l.symbolElement.readonly?"action.view":"action.edit"))}}function zy(i,n){if(i&1){let l=L();s(0,"button",4),C("click",function(){I(l);let o=y();return w(o.editClickAction())}),s(1,"mat-icon"),p(2,"add"),r(),s(3,"span",3),p(4,"action.add"),r()()}}var mr=(()=>{let n=class n{constructor(e){this.element=e,this.viewInited=new wt}ngAfterViewInit(){this.viewInited.emit()}};n.\u0275fac=function(o){return new(o||n)(h(hn))},n.\u0275dir=_r({type:n,inputs:{symbolElement:"symbolElement"},outputs:{viewInited:"viewInited"}});let i=n;return i})(),Yf=(()=>{let n=class n extends mr{constructor(e){super(e),this.element=e,this.addTag=new wt}onAddTag(){this.addTag.emit()}};n.\u0275fac=function(o){return new(o||n)(h(hn))},n.\u0275cmp=F({type:n,selectors:[["ng-component"]],outputs:{addTag:"addTag"},features:[G],decls:9,vars:4,consts:[[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(o,t){o&1&&(s(0,"div",0)(1,"span"),p(2),c(3,"translate"),r(),s(4,"button",1),C("click",function(){return t.onAddTag()}),s(5,"mat-icon"),p(6,"add"),r(),s(7,"span",2),p(8,"scada.tag.add-tag"),r()()()),o&2&&(a(2),Ja("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+u(3,2,"scada.hidden")+")":"",""))},dependencies:[te,re,J,R],styles:[lr],encapsulation:2});let i=n;return i})(),Kf=(()=>{let n=class n extends mr{constructor(e){super(e),this.element=e,this.apply=new wt,this.cancel=new wt,this.closed=!1}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{this.tagField.nativeElement.focus()})}ngOnDestroy(){this.blurTimeout&&(clearTimeout(this.blurTimeout),this.blurTimeout=null)}tagEnter(e){e.keyCode===13&&(e.preventDefault(),this.tag&&(this.closed=!0,this.apply.emit(this.tag)))}onApply(){this.closed=!0,this.tag?this.apply.emit(this.tag):this.cancel.emit()}onCancel(){this.closed=!0,this.cancel.emit()}onBlur(){this.blurTimeout=setTimeout(()=>{this.closed||(this.closed=!0,this.cancel.emit())},300)}};n.\u0275fac=function(o){return new(o||n)(h(hn))},n.\u0275cmp=F({type:n,selectors:[["ng-component"]],viewQuery:function(o,t){if(o&1&&we(ky,5),o&2){let d;Me(d=De())&&(t.tagField=d.first)}},inputs:{isAdd:"isAdd",tag:"tag"},outputs:{apply:"apply",cancel:"cancel"},features:[G],decls:16,vars:14,consts:[["tagField",""],[1,"tb-scada-symbol-tooltip-panel"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field"],["matInput","",3,"ngModelChange","keydown","blur","ngModel","placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip","disabled"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"]],template:function(o,t){if(o&1){let d=L();s(0,"div",1)(1,"span"),p(2),c(3,"translate"),r(),s(4,"mat-form-field",2)(5,"input",3,0),c(7,"translate"),et("ngModelChange",function(_){return I(d),Ze(t.tag,_)||(t.tag=_),w(_)}),C("keydown",function(_){return I(d),w(t.tagEnter(_))})("blur",function(){return I(d),w(t.onBlur())}),r()(),s(8,"button",4),c(9,"translate"),C("click",function(){return I(d),w(t.onApply())}),s(10,"mat-icon"),p(11,"done"),r()(),s(12,"button",5),c(13,"translate"),C("click",function(){return I(d),w(t.onCancel())}),s(14,"mat-icon"),p(15,"close"),r()()()}o&2&&(a(2),b("",u(3,6,t.isAdd?"scada.tag.enter-tag":"scada.tag.update-tag"),":"),a(3),x("placeholder",u(7,8,"widget-config.set")),Xe("ngModel",t.tag),a(3),x("matTooltip",u(9,10,"action.apply")),m("disabled",!t.tag),a(4),x("matTooltip",u(13,12,"action.cancel")))},dependencies:[Ie,re,be,de,Mt,he,W,Qe,R],styles:[lr],encapsulation:2});let i=n;return i})(),Xf=(()=>{let n=class n extends mr{constructor(e,o){super(e),this.element=e,this.container=o,this.updateTag=new wt,this.removeTag=new wt,this.displayTagSettings=!0}ngOnInit(){this.symbolElement?.readonly&&(this.displayTagSettings=this.symbolElement?.hasStateRenderFunction()||this.symbolElement?.hasClickAction())}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{if(this.displayTagSettings){let e=$(this.tagSettingsButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let o=e.tooltipster("instance"),t=sr(this.symbolElement,this.container,eg,o);o.on("ready",()=>{t.instance.updateFunctionsState()})}if(!this.symbolElement.readonly){let e=$(this.removeTagButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let o=e.tooltipster("instance"),t=sr(this.symbolElement,this.container,Zf,o);t.instance.removeTag.subscribe(()=>{o.destroy(),this.removeTag.emit()}),t.instance.cancel.subscribe(()=>{o.close()}),o.on("ready",()=>{t.instance.yesButton.focus()})}})}onUpdateTag(){this.updateTag.emit()}};n.\u0275fac=function(o){return new(o||n)(h(hn),h(Zi))},n.\u0275cmp=F({type:n,selectors:[["ng-component"]],viewQuery:function(o,t){if(o&1&&(we(Oy,5,hn),we(By,5,hn)),o&2){let d;Me(d=De())&&(t.tagSettingsButton=d.first),Me(d=De())&&(t.removeTagButton=d.first)}},outputs:{updateTag:"updateTag",removeTag:"removeTag"},features:[G],decls:10,vars:8,consts:[["tagSettingsButton",""],["removeTagButton",""],[1,"tb-scada-symbol-tooltip-panel"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"matTooltip"]],template:function(o,t){o&1&&(s(0,"div",2)(1,"span"),p(2),c(3,"translate"),r(),s(4,"span")(5,"b"),p(6),r()(),v(7,Ry,4,3,"button",3)(8,Vy,5,3,"button",4)(9,jy,5,3,"button",4),r()),o&2&&(a(2),Ja("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+u(3,6,"scada.hidden")+")":"",":"),a(4),B(t.symbolElement==null?null:t.symbolElement.tag),a(),m("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)),a(),m("ngIf",t.displayTagSettings),a(),m("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[U,Ie,re,Mt,R],styles:[lr],encapsulation:2});let i=n;return i})(),Zf=(()=>{let n=class n extends mr{constructor(e,o){super(e),this.element=e,this.translate=o,this.cancel=new wt,this.removeTag=new wt}ngOnInit(){this.deleteText=this.translate.instant("scada.tag.delete-tag-text",{tag:this.symbolElement?.tag,elementType:this.symbolElement?.element?.type})}onCancel(){this.cancel.emit()}onRemoveTag(){this.removeTag.emit()}};n.\u0275fac=function(o){return new(o||n)(h(hn),h(ee))},n.\u0275cmp=F({type:n,selectors:[["ng-component"]],viewQuery:function(o,t){if(o&1&&we(Ly,5),o&2){let d;Me(d=De())&&(t.yesButton=d.first)}},outputs:{cancel:"cancel",removeTag:"removeTag"},features:[G],decls:14,vars:1,consts:[["yesButton",""],[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column"],[1,"tb-confirm-text",3,"innerHTML"],[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(o,t){if(o&1){let d=L();s(0,"div",1),g(1,"div",2),s(2,"div",3)(3,"button",4),C("click",function(){return I(d),w(t.onCancel())}),s(4,"mat-icon"),p(5,"close"),r(),s(6,"span",5),p(7,"action.no"),r()(),s(8,"button",4,0),C("click",function(){return I(d),w(t.onRemoveTag())}),s(10,"mat-icon"),p(11,"done"),r(),s(12,"span",5),p(13,"action.yes"),r()()()()}o&2&&(a(),m("innerHTML",t.deleteText,zn))},dependencies:[te,re,J],styles:[lr],encapsulation:2});let i=n;return i})(),eg=(()=>{let n=class n extends mr{constructor(e){super(e),this.element=e,this.hasStateRenderFunction=!1,this.hasClickAction=!1}ngOnInit(){this.updateFunctionsState()}updateFunctionsState(){this.hasStateRenderFunction=this.symbolElement.hasStateRenderFunction(),this.hasClickAction=this.symbolElement.hasClickAction()}editStateRenderFunction(){this.symbolElement.editStateRenderFunction()}editClickAction(){this.symbolElement.editClickAction()}};n.\u0275fac=function(o){return new(o||n)(h(hn))},n.\u0275cmp=F({type:n,selectors:[["ng-component"]],features:[G],decls:7,vars:6,consts:[[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column","flex-start"],["translate","",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["translate",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(o,t){o&1&&(s(0,"div",0),v(1,Gy,2,0,"div",1)(2,Uy,6,4,"button",2)(3,qy,5,0,"button",2)(4,Wy,2,0,"div",1)(5,Hy,6,4,"button",2)(6,zy,5,0,"button",2),r()),o&2&&(a(),m("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasStateRenderFunction),a(),m("ngIf",t.hasStateRenderFunction),a(),m("ngIf",!t.hasStateRenderFunction&&!(t.symbolElement!=null&&t.symbolElement.readonly)),a(),m("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasClickAction),a(),m("ngIf",t.hasClickAction),a(),m("ngIf",!t.hasClickAction&&!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[U,te,re,J,R],styles:[lr],encapsulation:2});let i=n;return i})(),cl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae]});let i=n;return i})();(function(){Q(cl,{declarations:[Yf,Kf,Xf,Zf,eg],imports:[oe,ae]})})();var kd=(i,n)=>{i.stopEdit(),i.tooltip.off("close");let l=sr(i,n,Yf);l.instance.addTag.subscribe(()=>{l.destroy(),tg(i,n,!0)})},Od=(i,n)=>{i.stopEdit(),i.unhighlight();let l=sr(i,n,Xf);l.instance.updateTag.subscribe(()=>{l.destroy(),tg(i,n,!1)}),l.instance.removeTag.subscribe(()=>{l.destroy(),i.clearTag()}),i.tooltip.open()},tg=(i,n,l)=>{i.startEdit(()=>{l?(i.unhighlight(),i.tooltip.close()):(e.destroy(),Od(i,n))});let e=sr(i,n,Kf);e.instance.isAdd=l,l||(e.instance.tag=i.tag),e.instance.apply.subscribe(o=>{e.destroy(),l&&i.tooltip.off("close"),i.setTag(o)}),e.instance.cancel.subscribe(()=>{i.stopEdit(!0)}),l&&(i.tooltip.option("delay",[0,1e7]),i.tooltip.on("close",()=>{e.destroy(),i.tooltip.option("delay",[0,300]),kd(i,n)}))},sr=(i,n,l,e)=>{e||(e=i.tooltip);let o=n.createComponent(l);o.instance.symbolElement=i,o.instance.viewInited.subscribe(()=>{e.status().open&&e.reposition()}),e.on("destroyed",()=>{o.destroy()});let t=o.instance.element.nativeElement,d=t.firstChild;return t.removeChild(d),t.style.display="none",e.content(d),o};var ul=.75,Bd=4,fl=class{constructor(n,l,e,o,t,d){this.rootElement=n,this.tooltipsContainer=l,this.viewContainerRef=e,this.zone=o,this.callbacks=t,this.readonly=d,this.elements=[],this.performSetup=!1,this.showHidden=!1,this.scale=1,this.tags=[],this.zoomFactor=.34,this.shapeResize$=new ResizeObserver(()=>{this.resize()})}setReadOnly(n){this.readonly=n}setContent(n){this.shapeResize$.unobserve(this.rootElement),this.svgShape&&(this.destroyElements(),this.svgShape.remove()),this.scale=1,this.showHidden=!1;let l=p0(n);this.svgRootNodePart=l.svgRootNode,this.svgShape=dd().svg(l.innerSvg),this.svgShape.node.style.overflow="visible",this.svgShape.node.style["user-select"]="none";let e=dd(`${l.svgRootNode}
${l.innerSvg}
</svg>`);e.type==="svg"?(this.box=e.viewbox(),e.fill()&&this.svgShape.fill(e.fill())):this.box=this.svgShape.bbox(),e.remove(),this.svgShape.size(this.box.width,this.box.height),this.svgShape.viewbox(`0 0 ${this.box.width} ${this.box.height}`),this.svgShape.style().attr("tb:inner",!0).rule(".tb-element",{cursor:"pointer",transition:"0.2s filter ease-in-out"}),this.svgShape.addTo(this.rootElement),this.updateHoverFilterStyle(),this.performSetup=!0,this.shapeResize$.observe(this.rootElement)}getContent(){if(this.svgShape){this.elements.forEach(l=>l.restoreOrigVisibility());let n=this.svgShape.svg(l=>{if(l.node.hasAttribute("tb:inner"))return!1;l.node.classList.remove("tb-element","tooltipstered"),l.node.classList.length||l.node.removeAttribute("class"),l.attr("svgjs:data",null)},!1);return this.showHiddenElements(this.showHidden),`${this.svgRootNodePart}
${n}
</svg>`}else return null}cancelEdit(){this.elements.filter(n=>n.isEditing()).forEach(n=>n.stopEdit(!0))}zoomIn(){let n=Math.min(Math.pow(1+this.zoomFactor,1.2)*this.svgShape.zoom(),Bd);this.zoomAnimate(n)}zoomOut(){let n=Math.max(Math.pow(1+this.zoomFactor,-1.2)*this.svgShape.zoom(),ul);this.zoomAnimate(n)}showHiddenElements(n){this.showHidden=n,this.elements.forEach(l=>n?l.showInvisible():l.hideInvisible())}zoomAnimate(n,l=200){n!==this.svgShape.zoom()&&(this.hideTooltips(),this.svgShape.animate(l).ease("<>").zoom(n).during(()=>{let o=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(o)}).after(()=>{this.postZoom(this.callbacks.onZoom)}))}zoomInDisabled(){return Number(this.svgShape.zoom().toFixed(5))>=Bd}zoomOutDisabled(){return Number(this.svgShape.zoom().toFixed(5))<=ul}doSetup(){this.setupZoomPan(),window.SVG=a0,jt([$a(import("./chunk-ULZHJSWS.js")),$a(import("./chunk-HZ6CYJGR.js"))]).subscribe(()=>{this.zone.run(()=>{this.setupElements()})})}setupZoomPan(){this.svgShape.panZoom({zoomMin:ul,zoomMax:Bd,zoomFactor:this.zoomFactor}),this.svgShape.on("zoom",n=>{let{detail:{level:l,focus:e}}=n;this.svgShape.zoom(l,e),this.postZoom(this.callbacks.onZoom,n)}),this.svgShape.on("panning",n=>{let l=n.detail.box;this.svgShape.viewbox(this.restrictToMargins(l)),n.preventDefault()}),this.svgShape.on("panStart",n=>{this.hideTooltips(),this.svgShape.node.style.cursor="grab"}),this.svgShape.on("panEnd",n=>{this.restoreTooltips(),this.svgShape.node.style.cursor="default"}),this.svgShape.zoom(ul)}postZoom(n,l){let e=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(e),setTimeout(()=>{this.updateTooltipPositions()}),l?.preventDefault(),n&&n()}restrictToMargins(n){let l=Math.max(n.width-this.box.width,0),e=Math.max(n.height-this.box.height,0);return n.x<-l?n.x=-l:n.x+n.width>this.box.width+l&&(n.x=this.box.width+l-n.width),n.y<-e?n.y=-e:n.y+n.height>this.box.height+e&&(n.y=this.box.height+e-n.height),n}setupElements(){this.svgShape.children().forEach(e=>{this.addElement(e)});let n=[];for(let e of this.elements)for(let o of this.elements)if(e!==o&&e.overlappingCenters(o)){let t;for(let d of n)if(d.includes(o)||d.includes(e)){t=d;break}t?t.includes(e)?t.includes(o)||t.push(o):t.push(e):(t=[e,o],n.push(t))}for(let e of n){let o=e.map(D=>D.box.cy),t=o.reduce((D,M)=>D+M,0)/o.length,d=e.find(D=>D.isText()),f=d&&e.length%2===0?e.length+1:e.length;d&&(d.setInnerTooltipOffset(0,t),e.splice(e.indexOf(d),1));let _=-(Ba*f)/2+Ba/2;for(let D of e)d&&_===0&&(_+=Ba),D.setInnerTooltipOffset(_,t),_+=Ba}for(let e of this.elements)e.init();this.updateTags();let l=this.elements.some(e=>e.invisible);this.callbacks.hasHiddenElements&&this.callbacks.hasHiddenElements(l)}addElement(n,l=!1){if($y(n)){let e=l||!n.visible(),o=new Rd(this,n,e);this.elements.push(o),n.children().forEach(t=>{t.type==="tspan"&&n.type==="text"||this.addElement(t,e)},!0)}}destroy(){this.shapeResize$&&this.shapeResize$.disconnect(),this.destroyElements()}destroyElements(){this.elements.forEach(n=>{n.destroy()}),this.elements.length=0}resize(){if(this.svgShape){let n=this.rootElement.getBoundingClientRect().width,l=this.rootElement.getBoundingClientRect().height;if(n&&l){let e=this.box.width/this.box.height,o=n/l,t;e>o?t=n/this.box.width:t=l/this.box.height,this.scale!==t&&(this.scale=t,this.svgShape.node.style.transform=`scale(${this.scale})`,this.updateHoverFilterStyle(),this.updateTooltipPositions()),this.performSetup&&(this.performSetup=!1,this.doSetup())}}}updateHoverFilterStyle(){this.hoverFilterStyle&&this.hoverFilterStyle.remove();let n=(2.8/this.scale).toFixed(2),l=(1.2/this.scale).toFixed(2);this.hoverFilterStyle=this.svgShape.style().attr("tb:inner",!0).rule(".hovered",{filter:`drop-shadow(0px 0px ${n}px white) drop-shadow(0px 0px ${n}px white)
             drop-shadow(0px 0px ${n}px white) drop-shadow(0px 0px ${n}px white)
             drop-shadow(0px 0px ${l}px black)`})}updateTooltipPositions(){for(let n of this.elements)n.updateTooltipPosition()}hideTooltips(){for(let n of this.elements)n.hideTooltip()}restoreTooltips(){for(let n of this.elements)n.restoreTooltip()}updateTags(){this.tags=this.elements.filter(n=>n.hasTag()).map(n=>n.tag).filter((n,l,e)=>e.indexOf(n)===l).sort(),this.callbacks.tagsUpdated(this.tags)}getTags(){return this.tags}tagHasStateRenderFunction(n){return this.callbacks.tagHasStateRenderFunction(n)}tagHasClickAction(n){return this.callbacks.tagHasClickAction(n)}editTagStateRenderFunction(n){this.callbacks.editTagStateRenderFunction(n)}editTagClickAction(n){this.callbacks.editTagClickAction(n)}setDirty(n){this.callbacks.onSymbolEditObjectDirty(n)}},$y=i=>{try{if(i.bbox){let n=i.bbox();return!n.width&&!n.height&&!i.visible()&&(i.show(),n=i.bbox(),i.hide()),!!n.width||!!n.height}else return!1}catch{return!1}},Ba=44,Jy=100,pr=2,wo=2,Rd=class{get readonly(){return this.editObject.readonly}constructor(n,l,e=!1){this.editObject=n,this.element=l,this.invisible=e,this.editing=!1,this.innerTooltipOffset=0,this.highlighted=!1,this.origVisibility=!0,this.tag=l.attr("tb:tag"),this.origVisibility=l.visible(),this.invisible&&l.show(),this.box=l.rbox(this.editObject.svgShape)}init(){this.isGroup()?(this.highlightRect=this.editObject.svgShape.rect(this.box.width+wo*2,this.box.height+wo*2).x(this.box.x-wo).y(this.box.y-wo).attr({"tb:inner":!0,fill:"none",rx:this.unscaled(6),stroke:"rgba(0, 0, 0, 0.38)","stroke-dasharray":"1","stroke-width":this.unscaled(pr),opacity:0}),this.highlightRectTimeline=new o0,this.highlightRect.timeline(this.highlightRectTimeline),this.highlightRect.hide()):this.element.addClass("tb-element"),this.element.on("mouseenter",n=>{this.highlight()}),this.element.on("mouseleave",n=>{this.unhighlight()}),this.invisible||this.setupTooltips(),this.hideInvisible()}setupTooltips(){this.hasTag()?this.createTagTooltip():this.readonly||this.createAddTagTooltip()}showInvisible(){this.invisible&&(this.element.show(),this.tooltip||this.setupTooltips())}hideInvisible(){this.invisible&&(this.element.hide(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null))}restoreOrigVisibility(){this.origVisibility?this.element.show():this.element.hide()}overlappingCenters(n){return this.isGroup()||n.isGroup()?!1:Math.abs(this.box.cx-n.box.cx)*this.editObject.scale<Jy&&Math.abs(this.box.cy-n.box.cy)*this.editObject.scale<Ba}highlight(){this.highlighted||(this.highlighted=!0,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.attr({rx:this.unscaled(6),"stroke-width":this.unscaled(pr)}),this.highlightRect.show(),this.highlightRect.animate(300).attr({opacity:1})):this.element.addClass("hovered"),this.hasTag()&&(this.tooltip.reposition(),$(this.tooltip.elementTooltip()).addClass("tb-active")))}unhighlight(){this.highlighted&&(this.highlighted=!1,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.animate(300).attr({opacity:0}).after(()=>{this.highlightRect.hide()})):this.element.removeClass("hovered"),this.hasTag()&&!this.editing&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}clearTag(){this.tooltip.destroy(),this.tag=null,this.element.attr("tb:tag",null),this.unhighlight(),this.createAddTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}setTag(n){this.tooltip.destroy(),this.tag=n,this.element.attr("tb:tag",n),this.createTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}hasStateRenderFunction(){return this.hasTag()?this.editObject.tagHasStateRenderFunction(this.tag):!1}hasClickAction(){return this.hasTag()?this.editObject.tagHasClickAction(this.tag):!1}editStateRenderFunction(){this.hasTag()&&this.editObject.editTagStateRenderFunction(this.tag)}editClickAction(){this.hasTag()&&this.editObject.editTagClickAction(this.tag)}startEdit(n){this.editing||(this.editObject.cancelEdit(),this.editing=!0,this.onCancelEdit=n)}stopEdit(n=!1){this.editing&&(this.editing=!1,n&&this.onCancelEdit&&this.onCancelEdit(),this.onCancelEdit=null,this.hasTag()&&!this.highlighted&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}isEditing(){return this.editing}updateTooltipPosition(){if(this.tooltip&&!this.tooltip.status().destroyed){this.tooltip.reposition();let n=this.tooltip.elementTooltip();n&&(n.style.visibility=null)}}hideTooltip(){if(this.tooltip&&!this.tooltip.status().destroyed){let n=this.tooltip.elementTooltip();n&&(n.style.visibility="hidden")}}restoreTooltip(){this.updateTooltipPosition()}setInnerTooltipOffset(n,l){this.innerTooltipOffset=n+(l-this.box.cy)*this.editObject.scale}destroy(){this.tooltip&&this.tooltip.destroy()}get tooltipContainer(){return $(this.editObject.tooltipsContainer)}unscaled(n){return n/(this.editObject.scale*this.editObject.svgShape.zoom())}scaled(n){return n*(this.editObject.scale*this.editObject.svgShape.zoom())}createTagTooltip(){let n=$(this.element.node);n.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:this.isGroup(),distance:this.isGroup()?this.scaled(wo)+pr:6,theme:["scada-symbol"],delay:0,animationDuration:0,interactive:!0,trigger:"custom",side:"top",trackOrigin:!1,content:"",functionPosition:(l,e,o)=>this.innerTagTooltipPosition(l,e,o),functionReady:(l,e)=>{let o=$(e.tooltip);o.on("mouseenter",()=>{this.highlight()}),o.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=n.tooltipster("instance"),this.setupTagPanel()}setupTagPanel(){Od(this,this.editObject.viewContainerRef)}createAddTagTooltip(){let n=$(this.element.node);n.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:!0,theme:["scada-symbol","tb-active"],delay:[0,300],interactive:!0,trigger:"hover",side:["top","left","bottom","right"],trackOrigin:!1,content:"",functionBefore:(l,e)=>{let o=e.event;this.tooltipMouseX=o.clientX,this.tooltipMouseY=o.clientY;let t;this.isGroup()?t="top":t=this.calculateTooltipSide(e.origin.getBoundingClientRect(),o.clientX,o.clientY),l.option("side",t)},functionPosition:(l,e,o)=>this.innerAddTagTooltipPosition(l,e,o),functionReady:(l,e)=>{let o=$(e.tooltip);o.on("mouseenter",()=>{this.highlight()}),o.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=n.tooltipster("instance"),this.setupAddTagPanel()}setupAddTagPanel(){kd(this,this.editObject.viewContainerRef)}innerTagTooltipPosition(n,l,e){let o=l.origin.getBoundingClientRect();return this.isGroup()?(e.distance=this.scaled(wo)+pr,e.coord.top=o.top-e.size.height-(this.scaled(wo)+pr)):(e.coord.top=o.top+(o.height-e.size.height)/2+this.innerTooltipOffset*this.editObject.svgShape.zoom(),e.coord.left=o.left+(o.width-e.size.width)/2),e}innerAddTagTooltipPosition(n,l,e){let t=this.tooltipContainer[0].getBoundingClientRect();switch(e.side){case"right":e.coord.top=this.tooltipMouseY-e.size.height/2,e.coord.left=this.tooltipMouseX+10,e.target=this.tooltipMouseY;break;case"top":e.coord.top=this.tooltipMouseY-e.size.height-10,e.coord.left=this.tooltipMouseX-e.size.width/2,e.target=this.tooltipMouseX,this.isGroup()&&(e.coord.top-=Ba);break;case"left":e.coord.top=this.tooltipMouseY-e.size.height/2,e.coord.left=this.tooltipMouseX-e.size.width-10,e.target=this.tooltipMouseY;break;case"bottom":e.coord.top=this.tooltipMouseY+10,e.coord.left=this.tooltipMouseX-e.size.width/2,e.target=this.tooltipMouseX;break}let d=t.right-(e.coord.left+e.size.width);d<0&&(e.coord.left+=d);let f=t.left-e.coord.left;return f>0&&(e.coord.left+=f),e}calculateTooltipSide(n,l,e){let o,t=n.left+n.width/2,d=n.top+n.height/2;return n.width>n.height?Math.abs(t-l)>n.width/4?l<t?o="left":o="right":e<d?o="top":o="bottom":Math.abs(d-e)>n.height/4?e<d?o="top":o="bottom":l<t?o="left":o="right",o}hasTag(){return!!this.tag}isGroup(){return this.element.type==="g"}isText(){return this.element.type==="text"}},po=/[a-zA-Z$_\u00a1-\uffff][a-zA-Z\d$_\u00a1-\uffff]*/,Ln={token:"punctuation.operator",regex:/[.](?![.])/},Gn={regex:"",token:"empty",next:"no_regex"},Vd={token:"tb.scada-symbol-ctx",regex:/\bctx\b/,next:"scadaSymbolCtxApi"},Qy={token:"tb.scada-symbol-svg",regex:/\bsvg\b/,next:"scadaSymbolSVGApi"},ig={token:"tb.scada-symbol-element",regex:/\belement\b/,next:"scadaSymbolElementApi"},Yy={token:"tb.scada-symbol-event",regex:/\bevent\b/,next:"scadaSymbolEventApi"},jd={scadaSymbolCtxApi:[Ln,{token:"tb.scada-symbol-ctx-properties",regex:/properties/,next:"scadaSymbolCtxPropertiesApi"},{token:"tb.scada-symbol-ctx-tags",regex:/tags/,next:"scadaSymbolCtxTagsApi"},{token:"tb.scada-symbol-ctx-values",regex:/values/,next:"scadaSymbolCtxValuesApi"},{token:"tb.scada-symbol-ctx-api",regex:/api/,next:"scadaSymbolCtxApiMethodApi"},{token:"tb.scada-symbol-ctx-svg",regex:/svg/,next:"scadaSymbolCtxSVGMethodApi"},Gn],scadaSymbolCtxPropertiesApi:[Ln,{token:"tb.scada-symbol-ctx-property",regex:po,next:"no_regex"},Gn],scadaSymbolCtxTagsApi:[Ln,{token:"tb.scada-symbol-ctx-tag",regex:po,next:"no_regex"},Gn],scadaSymbolCtxValuesApi:[Ln,{token:"tb.scada-symbol-ctx-value",regex:po,next:"no_regex"},Gn],scadaSymbolCtxApiMethodApi:[Ln,{token:"tb.scada-symbol-ctx-api-method",regex:po,next:"no_regex"},Gn],scadaSymbolCtxSVGMethodApi:[Ln,{token:"tb.scada-symbol-ctx-svg-method",regex:po,next:"no_regex"},Gn]},Ky={scadaSymbolSVGApi:[Ln,{token:"tb.scada-symbol-svg-properties",regex:po,next:"no_regex"},Gn]},ng={scadaSymbolElementApi:[Ln,{token:"tb.scada-symbol-element-properties",regex:po,next:"no_regex"},Gn]},Xy={scadaSymbolEventApi:[Ln,{token:"tb.scada-symbol-event-properties",regex:po,next:"no_regex"},Gn]},gl=Ce(Ce({start:[Vd,Qy]},jd),Ky),og=Ce(Ce({no_regex:[Vd,ig]},jd),ng),ag=Ce(Ce(Ce({start:[Vd,ig,Yy]},jd),ng),Xy),rg=i=>({ctx:i,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}),Ld=i=>({ctx:i,element:{meta:"argument",type:"Element",description:'SVG element.<br>See <a href="https://svgjs.dev/docs/3.2/manipulating/" target="_blank">Manipulating</a> section to manipulate the element.<br>See <a href="https://svgjs.dev/docs/3.2/animating/" target="_blank">Animating</a> section to animate the element.'}}),sg=i=>{let n=Ld(i);return n.event={meta:"argument",type:"Event",description:"DOM event."},n},lg=(i,n,l)=>{let o=`<a href="${vc.linksMap.scadaSymbolDevAnimation}" target="_blank">ScadaSymbolAnimation</a>`,t={meta:"object",type:"object",description:"An object holding all defined SCADA symbol properties.",children:jr(i.properties,l)},d={meta:"object",type:"object",description:'An object holding all values obtained using behaviors of type <b>"Value"</b>',children:{}},f=i.behavior.filter(D=>D.type===Yi.value);for(let D of f)d.children[D.id]=Zy(D,l);let _={meta:"object",type:"object",description:"An object holding all tagged SVG elements grouped by tags (object keys).",children:{}};if(n?.length)for(let D of n)_.children[D]={meta:"property",description:"An array of SVG elements.",type:"Array<Element>"};return{meta:"argument",type:"ScadaSymbolContext",description:"Context of the SCADA symbol.",children:{api:{meta:"object",type:"ScadaSymbolApi",description:"SCADA symbol API",children:{cssAnimate:{meta:"function",description:"Finishes any previous CSS animation and starts new CSS animation for SVG element.",args:[{name:"element",description:"SVG element",type:"Element"},{name:"duration",description:"Animation duration in milliseconds",type:"number"}],return:{description:`Instance of ${o} class with API to setup and control the animation.`,type:o}},cssAnimation:{meta:"function",description:"Get the current CSS animation applied for the SVG element.",args:[{name:"element",description:"SVG element",type:"Element"}],return:{description:`Instance of ${o} class with API to setup and control the animation.`,type:o}},resetCssAnimation:{meta:"function",description:"Stops CSS animation if any and restore SVG element initial state, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},finishCssAnimation:{meta:"function",description:"Finishes CSS animation if any, SVG element state updated according to the end animation values, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},generateElementId:{meta:"function",description:"Generates new unique element id.",args:[],return:{type:"string",description:"Newly generated element id."}},formatValue:{meta:"function",description:"Formats numeric value according to specified decimals and units",args:[{name:"value",description:"Numeric value to be formatted",type:"any"},{name:"dec",description:"Number of decimal digits",type:"number",optional:!0},{name:"units",description:"Units to append to the formatted value",type:"string",optional:!0},{name:"showZeroDecimals",description:"Whether to keep zero decimal digits",type:"boolean",optional:!0}],return:{type:"string",description:"Formatted value"}},text:{meta:"function",description:'Set text to element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"text",description:"Text to be set",type:"string"}]},font:{meta:"function",description:'Set element(s) text font and color. Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"font",description:"Font settings object used to apply text element font",type:"Font"},{name:"color",description:"Color string used to apply text color of the element",type:"string"}]},icon:{meta:"function",description:'Draws icon inside element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-g" target="_blank">SVG.G</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"icon",description:"Icon to draw",type:"string"},{name:"size",description:"Optional icon size in pixels. Default 12 pixels.",type:"number",optional:!0},{name:"color",description:"Optional icon color. Default #0000008A.",type:"string",optional:!0},{name:"center",description:"Whether to center icon inside group element. Default true.",type:"boolean",optional:!0}]},disable:{meta:"function",description:"Disables element(s). Disabled element doesn't accept any user interaction. For ex. if disabled element has click action, no click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},enable:{meta:"function",description:"Enables disabled element(s). Enabled element accepts user interaction. For ex. if element has click action, click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},callAction:{meta:"function",description:'Invokes action specified by behavior of type <b>"Action"</b> found by <b>behaviorId</b>.',args:[{name:"event",description:"DOM event",type:"Event"},{name:"behaviorId",description:'Id of the <b>"Action"</b> behavior',type:"string"},{name:"value",description:"Optional value passed to behavior",type:"any",optional:!0},{name:"observer",description:"Optional observer callback",type:"Partial&lt;Observer&lt;void&gt;&gt;",optional:!0}]},setValue:{meta:"function",description:"Updates value by <b>valueId</b>. See <code>ctx.values</code> for reference. Value update triggers all render functions.",args:[{name:"valueId",description:"Id of the value to be updated",type:"string"},{name:"value",description:"New value to be set",type:"any"}]}}},properties:t,values:d,tags:_,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}}},Zy=(i,n)=>({meta:"property",description:n.transform(i.name,i.name),type:e_(i.valueType)}),e_=i=>{switch(i){case Qi.STRING:return"string";case Qi.INTEGER:case Qi.DOUBLE:return"number";case Qi.BOOLEAN:return"boolean";case Qi.JSON:return"object"}};var t_=["scadaSymbolShape"],i_=["tooltipsContainer"],n_=["tooltipsContainerComponent"];function o_(i,n){if(i&1){let l=L();s(0,"div",13)(1,"button",14),c(2,"translate"),C("click",function(){I(l);let o=y();return w(o.toggleShowHidden())}),s(3,"mat-icon"),p(4),r()()()}if(i&2){let l=y();j("!hidden",l.editorMode!=="svg"),a(),x("matTooltip",u(2,4,l.showHiddenElements?"scada.hide-hidden-elements":"scada.show-hidden-elements")),a(3),B(l.showHiddenElements?"visibility_off":"visibility")}}var hl=(()=>{let n=class n{get editorMode(){return this.editorModeValue}set editorMode(e){this.updateEditorMode(e)}constructor(e,o,t){this.cd=e,this.zone=o,this.destroyRef=t,this.updateScadaSymbol=new wt,this.downloadScadaSymbol=new wt,this.zoomInDisabled=!1,this.zoomOutDisabled=!1,this.showHiddenElements=!1,this.showHiddenElementsChange=new wt,this.displayShowHidden=!1,this.svgContentFormControl=new ia,this.editorModeValue="svg"}ngOnInit(){this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1}),this.svgContentFormControl.valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.svgContent!==e&&(this.svgContent=e,this.editObjectCallbacks.onSymbolEditObjectDirty(!0)),this.editObjectCallbacks.onSymbolEditObjectValid(this.svgContentFormControl.valid)})}ngAfterViewInit(){this.editObjectCallbacks.onZoom=()=>{this.updateZoomButtonsState()},this.editObjectCallbacks.hasHiddenElements=e=>{this.displayShowHidden=e,e&&this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements),this.cd.markForCheck()},this.scadaSymbolEditObject=new fl(this.scadaSymbolShape.nativeElement,this.tooltipsContainer.nativeElement,this.tooltipsContainerComponent.viewContainerRef,this.zone,this.editObjectCallbacks,this.readonly),this.data&&this.updateContent(this.data.scadaSymbolContent)}ngOnChanges(e){for(let o of Object.keys(e)){let t=e[o];!t.firstChange&&t.currentValue!==t.previousValue&&(o==="data"?setTimeout(()=>{this.updateContent(this.data.scadaSymbolContent)}):o==="readonly"&&(this.scadaSymbolEditObject.setReadOnly(this.readonly),this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1})))}}ngOnDestroy(){this.scadaSymbolEditObject.destroy()}getContent(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getContent():this.svgContent}getTags(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getTags():s0(this.svgContent)}zoomIn(){this.scadaSymbolEditObject.zoomIn()}zoomOut(){this.scadaSymbolEditObject.zoomOut()}toggleShowHidden(){this.showHiddenElements=!this.showHiddenElements,this.showHiddenElementsChange.emit(this.showHiddenElements),this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements)}updateEditorMode(e){this.editorModeValue=e,e==="xml"?(this.svgContent=this.scadaSymbolEditObject.getContent(),this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1})):this.updateEditObjectContent(this.svgContent)}updateContent(e){this.svgContent=m0(e),this.editorMode==="xml"?this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1}):this.updateEditObjectContent(this.svgContent)}updateEditObjectContent(e){this.scadaSymbolEditObject&&(this.displayShowHidden=!1,this.scadaSymbolEditObject.setContent(e),setTimeout(()=>{this.updateZoomButtonsState()}))}updateZoomButtonsState(){this.zoomInDisabled=this.scadaSymbolEditObject.zoomInDisabled(),this.zoomOutDisabled=this.scadaSymbolEditObject.zoomOutDisabled(),this.cd.markForCheck()}};n.\u0275fac=function(o){return new(o||n)(h(Je),h(Cr),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-editor"]],viewQuery:function(o,t){if(o&1&&(we(t_,5),we(i_,5),we(n_,7)),o&2){let d;Me(d=De())&&(t.scadaSymbolShape=d.first),Me(d=De())&&(t.tooltipsContainer=d.first),Me(d=De())&&(t.tooltipsContainerComponent=d.first)}},inputs:{data:"data",editObjectCallbacks:"editObjectCallbacks",readonly:"readonly",showHiddenElements:"showHiddenElements"},outputs:{updateScadaSymbol:"updateScadaSymbol",downloadScadaSymbol:"downloadScadaSymbol",showHiddenElementsChange:"showHiddenElementsChange"},features:[Vo],decls:38,vars:32,consts:[["scadaSymbolShape",""],["tooltipsContainer",""],["tooltipsContainerComponent",""],[1,"tb-scada-symbol-editor-shape"],[1,"tb-scada-symbol-editor-tooltips"],[1,"tb-scada-symbol-editor-svg-xml"],["fillHeight","","noLabel","",3,"formControl"],[1,"tb-scada-symbol-editor-buttons"],[1,"tb-scada-symbol-editor-view-buttons"],[1,"tb-scada-symbol-editor-zoom-buttons","tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["class","tb-primary-fill",3,"!hidden",4,"ngIf"],[1,"tb-scada-symbol-editor-right-buttons"],[1,"tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["appearance","fill","fillHeight","","extraPadding","","primaryBackground","",3,"ngModelChange","disabled","ngModel"],["value","svg"],["value","xml"]],template:function(o,t){if(o&1){let d=L();g(0,"div",3,0),s(2,"div",4,1),g(4,"tb-anchor",null,2),r(),s(6,"div",5),g(7,"tb-svg-xml",6),r(),s(8,"div",7)(9,"div",8)(10,"div",9)(11,"button",10),c(12,"translate"),C("click",function(){return I(d),w(t.zoomIn())}),s(13,"mat-icon"),p(14,"add"),r()(),s(15,"button",10),c(16,"translate"),C("click",function(){return I(d),w(t.zoomOut())}),s(17,"mat-icon"),p(18,"remove"),r()()(),v(19,o_,5,6,"div",11),r(),s(20,"div",12)(21,"div",13)(22,"button",14),c(23,"translate"),C("click",function(){return I(d),w(t.updateScadaSymbol.emit())}),s(24,"mat-icon"),p(25,"file_upload"),r()()(),s(26,"div",13)(27,"button",14),c(28,"translate"),C("click",function(){return I(d),w(t.downloadScadaSymbol.emit())}),s(29,"mat-icon"),p(30,"download"),r()()(),s(31,"tb-toggle-select",15),et("ngModelChange",function(_){return I(d),Ze(t.editorMode,_)||(t.editorMode=_),w(_)}),s(32,"tb-toggle-option",16),p(33),c(34,"translate"),r(),s(35,"tb-toggle-option",17),p(36),c(37,"translate"),r()()()()}o&2&&(j("!hidden",t.editorMode!=="svg"),a(2),j("!hidden",t.editorMode!=="svg"),a(4),j("!hidden",t.editorMode!=="xml"),a(),m("formControl",t.svgContentFormControl),a(3),j("!hidden",t.editorMode!=="svg"),a(),x("matTooltip",u(12,20,"scada.zoom-in")),m("disabled",t.zoomInDisabled),a(4),x("matTooltip",u(16,22,"scada.zoom-out")),m("disabled",t.zoomOutDisabled),a(4),m("ngIf",t.displayShowHidden),a(3),x("matTooltip",u(23,24,"scada.update-symbol")),a(5),x("matTooltip",u(28,26,"scada.download-symbol")),a(4),m("disabled",!t.readonly&&!t.svgContentFormControl.valid),Xe("ngModel",t.editorMode),a(2),B(u(34,28,"scada.mode-svg")),a(3),B(u(37,30,"scada.mode-xml")))},dependencies:[U,Cu,H0,Ie,re,Mt,W,Qe,ii,Di,Fi,R],styles:[`@charset "UTF-8";.tb-scada-symbol-editor-shape{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.tb-scada-symbol-editor-tooltips{position:absolute;inset:0;pointer-events:none}.tb-scada-symbol-editor-svg-xml{width:100%;height:100%;padding-top:88px}.tb-scada-symbol-editor-buttons{pointer-events:none;position:absolute;left:20px;top:20px;right:20px;display:flex;justify-content:space-between;align-items:flex-start}.tb-scada-symbol-editor-buttons .tb-primary-fill{background:#fff;border-radius:50%}.tb-scada-symbol-editor-buttons .tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-view-buttons{display:flex;flex-direction:column;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons{display:flex;flex-direction:column;z-index:101;background:#fff;border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill{border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons{display:flex;flex-direction:row;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons tb-toggle-select{pointer-events:auto}.tooltipster-sidetip.scada-symbol{position:fixed}.tooltipster-sidetip.scada-symbol .tooltipster-box{-webkit-user-select:none;user-select:none;background:#0000008a;border:1px solid rgba(0,0,0,0);border-radius:8px;display:flex;align-items:center}.tooltipster-sidetip.scada-symbol .tooltipster-box .tooltipster-content{padding:4px 8px;font-size:12px;line-height:12px;font-weight:500;color:#fff}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box{background:#fff;border:1px solid rgba(0,0,0,.38);box-shadow:0 0 10px 6px #0003}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box .tooltipster-content{color:#000000c2}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-width:12px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow{bottom:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:#fff;left:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow{top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:#fff;left:-2px;top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow{right:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:#fff;top:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow{left:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:#fff;top:-2px;left:-1px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-box,.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-box{min-height:36px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow{bottom:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow{top:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow{right:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow{left:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:transparent}
`],encapsulation:2});let i=n;return i})();S();S();S();S();var r_=["tagFunctionComponent"];function s_(i,n){if(i&1){let l=L();s(0,"button",9),C("click",function(){I(l);let o=y();return w(o.applyTagFunction())}),p(1),c(2,"translate"),r()}if(i&2){let l=y();m("disabled",l.tagFunctionFormGroup.invalid||!l.tagFunctionFormGroup.dirty),a(),b(" ",u(2,2,"action.apply")," ")}}var bl=(()=>{let n=class n{constructor(e,o){this.fb=e,this.widgetService=o,this.tagFunctionApplied=new wt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.tagFunctionFormGroup=this.fb.group({tagFunction:[this.tagFunction,[]]}),this.disabled&&this.tagFunctionFormGroup.disable({emitEvent:!1}),this.tagFunctionType==="renderFunction"?(this.panelTitle="scada.state-render-function",this.tagFunctionArgs=["ctx","element"],this.highlightRules=og,this.tagFunctionHelpId="scada/tag_state_render_fn"):this.tagFunctionType==="clickAction"&&(this.panelTitle="scada.tag.on-click-action",this.tagFunctionArgs=["ctx","element","event"],this.highlightRules=ag,this.tagFunctionHelpId="scada/tag_click_action_fn")}ngAfterViewInit(){this.tagFunctionComponent.focus()}cancel(){this.popover?.hide()}applyTagFunction(){let e=this.tagFunctionFormGroup.get("tagFunction").value;this.tagFunctionApplied.emit(e)}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(si))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata-tag-function-panel"]],viewQuery:function(o,t){if(o&1&&we(r_,5),o&2){let d;Me(d=De())&&(t.tagFunctionComponent=d.first)}},inputs:{tagFunction:"tagFunction",tagFunctionType:"tagFunctionType",tag:"tag",completer:"completer",disabled:"disabled",popover:"popover"},outputs:{tagFunctionApplied:"tagFunctionApplied"},decls:17,vars:13,consts:[["tagFunctionComponent",""],[1,"tb-scada-symbol-metadata-tag-function-panel",3,"formGroup"],[1,"tb-scada-symbol-metadata-tag-function-title-container"],[1,"tb-scada-symbol-metadata-tag-function-title"],[1,"tb-scada-symbol-metadata-tag-function-panel-content"],["minHeight","300px","formControlName","tagFunction",3,"highlightRules","editorCompleter","functionArgs","helpId"],[1,"tb-scada-symbol-metadata-tag-function-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){if(o&1){let d=L();s(0,"div",1)(1,"div",2)(2,"mat-chip-set")(3,"mat-chip")(4,"span"),p(5),r()()(),s(6,"div",3),p(7),c(8,"translate"),r()(),s(9,"div",4),g(10,"tb-js-func",5,0),r(),s(12,"div",6)(13,"button",7),C("click",function(){return I(d),w(t.cancel())}),p(14),c(15,"translate"),r(),v(16,s_,3,4,"button",8),r()()}o&2&&(m("formGroup",t.tagFunctionFormGroup),a(5),b(" ",t.tag," "),a(2),B(u(8,9,t.panelTitle)),a(3),m("highlightRules",t.highlightRules)("editorCompleter",t.completer)("functionArgs",t.tagFunctionArgs)("helpId",t.tagFunctionHelpId),a(4),b(" ",u(15,11,t.disabled?"action.close":"action.cancel")," "),a(2),m("ngIf",!t.disabled))},dependencies:[U,ha,te,oa,Wr,W,X,ne,le,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-function-panel{width:800px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-metadata-tag-function-panel{width:90vw}}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title-container{display:flex;flex-direction:row;gap:16px;align-items:center}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2});let i=n;return i})();var l_=["editStateRenderFunctionButton"],m_=["editClickActionButton"];function p_(i,n){if(i&1){let l=L();s(0,"button",8,0),C("click",function(){I(l);let o=y();return w(o.editTagStateRenderFunction())}),s(2,"mat-icon"),p(3),r(),s(4,"span"),p(5),c(6,"translate"),r()()}if(i&2){let l=y();a(3),B(l.disabled?"visibility":l.tagFormGroup.get("stateRenderFunction").value?"edit":"add"),a(2),B(u(6,2,l.disabled?"action.view":l.tagFormGroup.get("stateRenderFunction").value?"action.edit":"action.add"))}}function d_(i,n){if(i&1){let l=L();s(0,"button",8,1),C("click",function(){I(l);let o=y();return w(o.editClickAction())}),s(2,"mat-icon"),p(3),r(),s(4,"span"),p(5),c(6,"translate"),r()()}if(i&2){let l=y();a(3),B(l.disabled?"visibility":l.tagFormGroup.get("clickAction").value?"edit":"add"),a(2),B(u(6,2,l.disabled?"action.view":l.tagFormGroup.get("clickAction").value?"action.edit":"action.add"))}}var Ra=(()=>{let n=class n{constructor(e,o,t,d){this.fb=e,this.popoverService=o,this.renderer=t,this.viewContainerRef=d,this.propagateChange=f=>{}}ngOnInit(){this.tagFormGroup=this.fb.group({tag:[null,[]],stateRenderFunction:[null,[]],clickAction:[null,[]]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagFormGroup.disable({emitEvent:!1}):this.tagFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let o=e?.actions?.click?.actionFunction;this.tagFormGroup.patchValue({tag:e?.tag,stateRenderFunction:e?.stateRenderFunction,clickAction:o},{emitEvent:!1})}validate(e){return this.tagFormGroup.valid?null:{tag:{valid:!1}}}editTagStateRenderFunction(){this.openTagFunction("renderFunction",this.editStateRenderFunctionButton)}editClickAction(){this.openTagFunction("clickAction",this.editClickActionButton)}openTagFunction(e,o){let t=o._elementRef.nativeElement;if(t.scrollIntoView(),this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let d,f;e==="renderFunction"?(d=this.tagFormGroup.get("stateRenderFunction"),f=this.elementStateRenderFunctionCompleter):e==="clickAction"&&(d=this.tagFormGroup.get("clickAction"),f=this.clickActionFunctionCompleter);let _={tagFunction:d.value,tagFunctionType:e,tag:this.tagFormGroup.get("tag").value,completer:f,disabled:this.disabled},D=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,bl,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,_,{},{},{},!0);D.tbComponentRef.instance.popover=D,D.tbComponentRef.instance.tagFunctionApplied.subscribe(M=>{D.hide(),d.patchValue(M,{emitEvent:!1}),this.updateModel()})}}updateModel(){let e=this.tagFormGroup.value;this.modelValue={tag:e.tag,stateRenderFunction:e.stateRenderFunction},e.clickAction?this.modelValue.actions={click:{actionFunction:e.clickAction}}:this.modelValue.actions=null,this.propagateChange(this.modelValue)}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(Dn),h(bn),h(Zi))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata-tag"]],viewQuery:function(o,t){if(o&1&&(we(l_,5),we(m_,5)),o&2){let d;Me(d=De())&&(t.editStateRenderFunctionButton=d.first),Me(d=De())&&(t.editClickActionButton=d.first)}},inputs:{disabled:"disabled",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:10,vars:4,consts:[["editStateRenderFunctionButton",""],["editClickActionButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-tag-row",3,"formGroup"],[1,"tb-tag-field"],[1,"tb-scada-symbol-metadata-tag-label"],[1,"tb-state-render-function-field"],["mat-button","","color","primary",3,"click",4,"ngIf"],[1,"tb-on-click-action-field"],["mat-button","","color","primary",3,"click"]],template:function(o,t){o&1&&(s(0,"div",2)(1,"div",3)(2,"mat-chip-set")(3,"mat-chip")(4,"span",4),p(5),r()()()(),s(6,"div",5),v(7,p_,7,4,"button",6),r(),s(8,"div",7),v(9,d_,7,4,"button",6),r()()),o&2&&(m("formGroup",t.tagFormGroup),a(5),b(" ",t.tagFormGroup.get("tag").value," "),a(2),m("ngIf",!t.disabled||t.tagFormGroup.get("stateRenderFunction").value),a(2),m("ngIf",!t.disabled||t.tagFormGroup.get("clickAction").value))},dependencies:[U,te,re,oa,Wr,X,ne,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-row .tb-tag-field{flex:1 1 70%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{flex:1 1 15%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field .mdc-button .mat-mdc-button-touch-target,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field .mdc-button .mat-mdc-button-touch-target{height:36px}
`],encapsulation:2});let i=n;return i})();function u_(i,n){i&1&&g(0,"mat-divider")}function f_(i,n){if(i&1&&(s(0,"div"),g(1,"tb-scada-symbol-metadata-tag",10),v(2,u_,1,0,"mat-divider",11),r()),i&2){let l=n.$implicit,e=n.last,o=y(2);a(),m("elementStateRenderFunctionCompleter",o.elementStateRenderFunctionCompleter)("clickActionFunctionCompleter",o.clickActionFunctionCompleter)("formControl",l),a(),m("ngIf",!e)}}function g_(i,n){if(i&1&&(s(0,"div",8),v(1,f_,3,4,"div",9),r()),i&2){let l=y();a(),m("ngForOf",l.tagsFormArray().controls)("ngForTrackBy",l.trackByTag)}}function h_(i,n){i&1&&(s(0,"span",12),p(1),c(2,"translate"),r()),i&2&&(a(),B(u(2,1,"scada.tag.no-tags")))}var dg=i=>!i.stateRenderFunction&&!i.actions?.click?.actionFunction,vl=(()=>{let n=class n{constructor(e,o){this.fb=e,this.destroyRef=o,this.styleDisplay="flex",this.styleOverflow="hidden",this.propagateChange=t=>{}}ngOnInit(){this.tagsFormGroup=this.fb.group({tags:this.fb.array([])});let e=this.setupTags();this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(e.tags),{emitEvent:!1}),this.tagsFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{let o=this.tagsFormGroup.get("tags").value;o&&(o=o.filter(t=>!dg(t))),this.modelValue=o,this.propagateChange(this.modelValue)})}ngOnChanges(e){for(let o of Object.keys(e)){let t=e[o];if(!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(o)){let d=this.setupTags(this.modelValue),f=this.prepareTagsFormArray(d.tags);d.emitEvent?setTimeout(()=>{this.tagsFormGroup.setControl("tags",f,{emitEvent:!0}),this.setDisabledState(this.disabled)}):(this.tagsFormGroup.setControl("tags",f,{emitEvent:!1}),this.setDisabledState(this.disabled))}}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagsFormGroup.disable({emitEvent:!1}):this.tagsFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e||[];let o=this.setupTags(this.modelValue);this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(o.tags),{emitEvent:!1}),this.setDisabledState(this.disabled)}validate(e){return this.tagsFormGroup.valid?null:{tags:{valid:!1}}}tagsFormArray(){return this.tagsFormGroup.get("tags")}trackByTag(e,o){return o}editTagStateRenderFunction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(f=>f.tag===e);this.metadataTags.get(t)?.editTagStateRenderFunction()})}editTagClickAction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(f=>f.tag===e);this.metadataTags.get(t)?.editClickAction()})}setupTags(e){e=(e||[]).filter(d=>!dg(d));let o=(this.tags||[]).sort().map(d=>({tag:d,stateRenderFunction:null,actions:null}));for(let d of e){let f=o.find(_=>_.tag===d.tag);f&&(f.stateRenderFunction=d.stateRenderFunction,d.actions?.click?.actionFunction&&(f.actions={click:{actionFunction:d.actions.click.actionFunction}}))}let t=!!e.find(d=>!o.find(f=>f.tag===d.tag));return{tags:o,emitEvent:t}}prepareTagsFormArray(e){let o=[];return e&&e.forEach(t=>{o.push(this.fb.control(t,[]))}),this.fb.array(o)}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata-tags"]],viewQuery:function(o,t){if(o&1&&we(Ra,5),o&2){let d;Me(d=De())&&(t.metadataTags=d)}},hostVars:4,hostBindings:function(o,t){o&2&&Bi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{disabled:"disabled",tags:"tags",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}]),Vo],decls:12,vars:2,consts:[["noTags",""],[1,"tb-form-panel","tb-scada-symbol-metadata-tags"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-tag-header"],["translate","",1,"tb-form-table-header-cell","tb-state-render-function-header"],["translate","",1,"tb-form-table-header-cell","tb-on-click-action-header"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[1,"tb-form-table-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-1",3,"elementStateRenderFunctionCompleter","clickActionFunctionCompleter","formControl"],[4,"ngIf"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(o,t){if(o&1&&(s(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.tag.tag"),r(),s(5,"div",5),p(6,"scada.state-render-function"),r(),s(7,"div",6),p(8,"scada.tag.on-click-action"),r()(),v(9,g_,2,2,"div",7),r()(),v(10,h_,3,3,"ng-template",null,0,Et)),o&2){let d=q(11);a(9),m("ngIf",t.tagsFormArray().controls.length)("ngIfElse",d)}},dependencies:[xe,U,sn,W,ii,J,Ra,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tags{flex:1;margin:12px}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-tag-header{flex:1 1 70%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{flex:1 1 15%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tags .tb-form-table{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body{overflow:auto}.tb-scada-symbol-metadata-tags .tb-form-table-body tb-scada-symbol-metadata-tag{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body .mat-divider{margin-top:8px}
`],encapsulation:2});let i=n;return i})();S();S();S();var v_=(i,n)=>[i,n];function y_(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.scadaSymbolBehaviorTypeTranslations.get(l))," ")}}function __(i,n){if(i&1&&(s(0,"mat-select-trigger")(1,"div",20),g(2,"mat-icon",21),s(3,"span"),p(4),c(5,"translate"),r()()()),i&2){let l=y(2);a(2),x("svgIcon",l.valueTypesMap.get(l.behaviorFormGroup.get("valueType").value).icon),a(2),B(u(5,2,l.valueTypesMap.get(l.behaviorFormGroup.get("valueType").value).name))}}function C_(i,n){if(i&1&&(s(0,"mat-option",17),g(1,"mat-icon",22),s(2,"span"),p(3),c(4,"translate"),r()()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),x("svgIcon",e.valueTypesMap.get(l).icon),a(2),B(u(4,3,e.valueTypesMap.get(l).name))}}function S_(i,n){if(i&1&&(s(0,"div",3)(1,"div",4),p(2,"scada.behavior.value-type"),r(),s(3,"mat-form-field",18)(4,"mat-select",19),v(5,__,6,4,"mat-select-trigger",13)(6,C_,5,5,"mat-option",11),r()()()),i&2){let l=y();a(5),m("ngIf",l.behaviorFormGroup.get("valueType").value),a(),m("ngForOf",l.valueTypes)}}function T_(i,n){i&1&&(Lt(0),s(1,"div",3)(2,"div",4),p(3,"scada.behavior.true-label"),r(),s(4,"mat-form-field",5),g(5,"input",24),c(6,"translate"),r()(),s(7,"div",3)(8,"div",4),p(9,"scada.behavior.false-label"),r(),s(10,"mat-form-field",5),g(11,"input",25),c(12,"translate"),r()(),s(13,"div",3)(14,"div",4),p(15,"scada.behavior.state-label"),r(),s(16,"mat-form-field",5),g(17,"input",26),c(18,"translate"),r()(),Gt()),i&2&&(a(5),x("placeholder",u(6,3,"widget-config.set")),a(6),x("placeholder",u(12,5,"widget-config.set")),a(6),x("placeholder",u(18,7,"widget-config.set")))}function x_(i,n){if(i&1&&(Lt(0),v(1,T_,19,9,"ng-container",13),s(2,"div",3)(3,"div",4),p(4,"scada.behavior.default-settings"),r(),g(5,"tb-get-value-action-settings",23),c(6,"customTranslate"),c(7,"customTranslate"),c(8,"customTranslate"),c(9,"customTranslate"),r(),Gt()),i&2){let l=y();a(),m("ngIf",l.behaviorFormGroup.get("valueType").value===l.ValueType.BOOLEAN),a(4),x("panelTitle",u(6,8,l.behaviorFormGroup.get("name").value)),m("valueType",l.behaviorFormGroup.get("valueType").value)("trueLabel",u(7,10,l.behaviorFormGroup.get("trueLabel").value))("falseLabel",u(8,12,l.behaviorFormGroup.get("falseLabel").value))("stateLabel",u(9,14,l.behaviorFormGroup.get("stateLabel").value))("aliasController",l.aliasController)("widgetType",l.widgetType.rpc)}}function E_(i,n){if(i&1&&(Lt(0),s(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),r(),g(4,"tb-set-value-action-settings",27),c(5,"customTranslate"),r(),Gt()),i&2){let l=y();a(4),x("panelTitle",u(5,4,l.behaviorFormGroup.get("name").value)),m("valueType",l.behaviorFormGroup.get("valueType").value)("aliasController",l.aliasController)("widgetType",l.widgetType.rpc)}}function I_(i,n){if(i&1&&(Lt(0),s(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),r(),g(4,"tb-widget-action-settings",28),c(5,"customTranslate"),r(),Gt()),i&2){let l=y();a(4),x("panelTitle",u(5,3,l.behaviorFormGroup.get("name").value)),m("callbacks",l.callbacks)("widgetType",l.widgetType.rpc)}}function w_(i,n){if(i&1){let l=L();s(0,"button",29),C("click",function(){I(l);let o=y();return w(o.applyBehaviorSettings())}),p(1),c(2,"translate"),r()}if(i&2){let l=y();m("disabled",l.behaviorFormGroup.invalid||!l.behaviorFormGroup.dirty),a(),b(" ",u(2,2,l.isAdd?"action.add":"action.apply")," ")}}var yl=(()=>{let n=class n{constructor(e,o,t){this.fb=e,this.widgetService=o,this.destroyRef=t,this.widgetType=Ti,this.ScadaSymbolBehaviorType=Yi,this.ValueType=Qi,this.ValueToDataType=Xa,this.scadaSymbolBehaviorTypes=ms,this.scadaSymbolBehaviorTypeTranslations=ps,this.valueTypes=Object.keys(Qi),this.valueTypesMap=yc,this.isAdd=!1,this.behaviorSettingsApplied=new wt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.panelTitle=this.isAdd?"scada.behavior.add-behavior":"scada.behavior.behavior-settings",this.behaviorFormGroup=this.fb.group({id:[this.behavior.id,[T.required]],name:[this.behavior.name,[T.required]],hint:[this.behavior.hint,[]],group:[this.behavior.group,[]],type:[this.behavior.type,[T.required]],valueType:[this.behavior.valueType,[T.required]],trueLabel:[this.behavior.trueLabel,[]],falseLabel:[this.behavior.falseLabel,[]],stateLabel:[this.behavior.stateLabel,[]],defaultGetValueSettings:[this.behavior.defaultGetValueSettings,[T.required]],defaultSetValueSettings:[this.behavior.defaultSetValueSettings,[T.required]],defaultWidgetActionSettings:[this.behavior.defaultWidgetActionSettings,[T.required]]}),this.disabled?this.behaviorFormGroup.disable({emitEvent:!1}):(nc(this.behaviorFormGroup.get("type").valueChanges,this.behaviorFormGroup.get("valueType").valueChanges).pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyBehaviorSettings(){let e=this.behaviorFormGroup.getRawValue();this.behaviorSettingsApplied.emit(e)}updateValidators(){let e=this.behaviorFormGroup.get("type").value,o=this.behaviorFormGroup.get("valueType").value,t=this.behaviorFormGroup.get("defaultGetValueSettings").value,d=this.behaviorFormGroup.get("defaultSetValueSettings").value,f=this.behaviorFormGroup.get("defaultWidgetActionSettings").value;switch(this.behaviorFormGroup.disable({emitEvent:!1}),this.behaviorFormGroup.get("id").enable({emitEvent:!1}),this.behaviorFormGroup.get("name").enable({emitEvent:!1}),this.behaviorFormGroup.get("type").enable({emitEvent:!1}),this.behaviorFormGroup.get("hint").enable({emitEvent:!1}),this.behaviorFormGroup.get("group").enable({emitEvent:!1}),e){case Yi.value:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultGetValueSettings").enable({emitEvent:!1}),o===Qi.BOOLEAN&&(this.behaviorFormGroup.get("trueLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("falseLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("stateLabel").enable({emitEvent:!1})),t||(t=Jo({},ds(o)),this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(t,{emitEvent:!0})),d&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0}),f&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case Yi.action:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultSetValueSettings").enable({emitEvent:!1}),d||(d=Jo({},d0(o)),this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(d,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),f&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case Yi.widgetAction:this.behaviorFormGroup.get("defaultWidgetActionSettings").enable({emitEvent:!1}),f||(f=Jo({},c0),this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(f,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),d&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0});break}}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(si),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-behavior-panel"]],inputs:{isAdd:"isAdd",behavior:"behavior",aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",popover:"popover"},outputs:{behaviorSettingsApplied:"behaviorSettingsApplied"},decls:44,vars:28,consts:[[1,"tb-scada-symbol-behavior-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-behavior-settings-title"],[1,"tb-scada-symbol-behavior-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["matInput","","formControlName","hint",3,"placeholder"],["matInput","","formControlName","group",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["class","tb-form-row",4,"ngIf"],[4,"ngIf"],[1,"tb-scada-symbol-behavior-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["appearance","outline","subscriptSizing","dynamic",1,"tb-value-type","flex"],["formControlName","valueType"],[1,"tb-value-type-row"],[1,"tb-mat-18",3,"svgIcon"],[1,"tb-mat-20",3,"svgIcon"],["formControlName","defaultGetValueSettings",1,"flex-1",3,"panelTitle","valueType","trueLabel","falseLabel","stateLabel","aliasController","widgetType"],["matInput","","formControlName","trueLabel",3,"placeholder"],["matInput","","formControlName","falseLabel",3,"placeholder"],["matInput","","formControlName","stateLabel",3,"placeholder"],["formControlName","defaultSetValueSettings",1,"flex-1",3,"panelTitle","valueType","aliasController","widgetType"],["formControlName","defaultWidgetActionSettings",1,"flex-1",3,"panelTitle","callbacks","widgetType"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1),p(2),c(3,"translate"),r(),s(4,"div",2)(5,"div",3)(6,"div",4),p(7,"scada.behavior.id"),r(),s(8,"mat-form-field",5),g(9,"input",6),c(10,"translate"),r()(),s(11,"div",3)(12,"div",4),p(13,"scada.behavior.name"),r(),s(14,"mat-form-field",5),g(15,"input",7),c(16,"translate"),r()(),s(17,"div",3)(18,"div",4),p(19,"scada.behavior.hint"),r(),s(20,"mat-form-field",5),g(21,"input",8),c(22,"translate"),r()(),s(23,"div",3)(24,"div",4),p(25,"scada.behavior.group-title"),r(),s(26,"mat-form-field",5),g(27,"input",9),c(28,"translate"),r()(),s(29,"div",3)(30,"div",4),p(31,"scada.behavior.type"),r(),s(32,"mat-form-field",5)(33,"mat-select",10),v(34,y_,3,4,"mat-option",11),r()()(),v(35,S_,7,2,"div",12)(36,x_,10,16,"ng-container",13)(37,E_,6,6,"ng-container",13)(38,I_,6,5,"ng-container",13),r(),s(39,"div",14)(40,"button",15),C("click",function(){return t.cancel()}),p(41),c(42,"translate"),r(),v(43,w_,3,4,"button",16),r()()),o&2&&(m("formGroup",t.behaviorFormGroup),a(2),B(u(3,13,t.panelTitle)),a(7),x("placeholder",u(10,15,"widget-config.set")),a(6),x("placeholder",u(16,17,"widget-config.set")),a(6),x("placeholder",u(22,19,"widget-config.set")),a(6),x("placeholder",u(28,21,"widget-config.set")),a(7),m("ngForOf",t.scadaSymbolBehaviorTypes),a(),m("ngIf",Sr(25,v_,t.ScadaSymbolBehaviorType.value,t.ScadaSymbolBehaviorType.action).includes(t.behaviorFormGroup.get("type").value)),a(),m("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.value),a(),m("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.action),a(),m("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.widgetAction),a(3),b(" ",u(42,23,t.disabled?"action.close":"action.cancel")," "),a(2),m("ngIf",!t.disabled))},dependencies:[xe,U,te,re,be,de,vt,pu,gt,he,W,X,fe,ne,le,J,uf,ff,gf,di,R],styles:[`@charset "UTF-8";.tb-scada-symbol-behavior-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-behavior-settings-panel{width:90vw}}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type .mat-mdc-form-field-infix{max-height:40px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row .mat-icon{color:#00000061;vertical-align:bottom}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2});let i=n;return i})();var M_=["idInput"],D_=["editButton"];function F_(i,n){if(i&1&&(s(0,"mat-option",13),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.scadaSymbolBehaviorTypeTranslations.get(l))," ")}}function P_(i,n){if(i&1){let l=L();s(0,"button",11),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.behaviorRemoved.emit())}),s(2,"mat-icon"),p(3,"delete"),r()()}i&2&&x("matTooltip",u(1,1,"scada.behavior.remove-behavior"))}var dr=i=>{if(!i.id||!i.name||!i.type)return!1;switch(i.type){case Yi.value:if(!i.valueType||!i.defaultGetValueSettings)return!1;break;case Yi.action:if(!i.defaultSetValueSettings||i.defaultSetValueSettings.valueToData?.type===Xa.CONSTANT&&Ic(i.defaultSetValueSettings.valueToData?.constantValue)||i.defaultSetValueSettings.valueToData?.type===Xa.FUNCTION&&!Tc(i.defaultSetValueSettings.valueToData?.valueToDataFunction))return!1;break;case Yi.widgetAction:break}return!0},cr=(()=>{let n=class n{constructor(e,o,t,d,f,_,D){this.fb=e,this.cd=o,this.popoverService=t,this.renderer=d,this.viewContainerRef=f,this.behaviorsComponent=_,this.destroyRef=D,this.scadaSymbolBehaviorTypes=ms,this.scadaSymbolBehaviorTypeTranslations=ps,this.behaviorRemoved=new wt,this.propagateChange=M=>{}}ngOnInit(){this.behaviorRowFormGroup=this.fb.group({id:[null,[this.behaviorIdValidator()]],name:[null,[T.required]],type:[null,[T.required]]}),this.behaviorRowFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>this.updateModel()),this.behaviorRowFormGroup.get("type").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.onTypeChanged(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorRowFormGroup.disable({emitEvent:!1}):this.behaviorRowFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.behaviorRowFormGroup.patchValue({id:e?.id,name:e?.name,type:e?.type},{emitEvent:!1}),this.cd.markForCheck()}editBehavior(e,o,t=!1,d=()=>{}){e&&e.stopPropagation();let f=o._elementRef.nativeElement;if(this.popoverService.hasPopover(f))this.popoverService.hidePopover(f);else{let _={isAdd:t,disabled:this.disabled,aliasController:this.aliasController,callbacks:this.callbacks,behavior:Tt(this.modelValue)},D=this.popoverService.displayPopover(f,this.renderer,this.viewContainerRef,yl,["leftOnly","leftTopOnly","leftBottomOnly"],!0,null,_,{},{},{},!0);D.tbComponentRef.instance.popover=D,D.tbComponentRef.instance.behaviorSettingsApplied.subscribe(M=>{D.hide(),this.behaviorRowFormGroup.patchValue({id:M.id,name:M.name,type:M.type},{emitEvent:!1}),this.modelValue=M,this.propagateChange(this.modelValue)}),D.tbDestroy.subscribe(()=>{dr(this.modelValue)||d()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(e){this.idInput.nativeElement.scrollIntoView(),this.editBehavior(null,this.editButton,!0,e)}validate(e){let o=this.behaviorRowFormGroup.get("id");if(o.hasError("behaviorIdNotUnique")&&o.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),o.hasError("behaviorIdNotUnique"))return this.behaviorRowFormGroup.get("id").markAsTouched(),{behaviorIdNotUnique:!0};let t=Ce(Ce({},this.modelValue),this.behaviorRowFormGroup.value);return dr(t)?null:{behavior:!0}}behaviorIdValidator(){return e=>e.value?this.behaviorsComponent.behaviorIdUnique(e.value,this.index)?null:{behaviorIdNotUnique:!0}:{required:!0}}onTypeChanged(e){let o=Tt(this.modelValue);this.modelValue=Ji(Ce({},this.modelValue),{type:e}),this.modelValue=u0(this.modelValue),dr(this.modelValue)||this.editBehavior(null,this.editButton,!1,()=>{this.modelValue=o,this.behaviorRowFormGroup.patchValue({type:o.type},{emitEvent:!0})})}updateModel(){let e=this.behaviorRowFormGroup.value;this.modelValue=Ce(Ce({},this.modelValue),e),this.propagateChange(this.modelValue)}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(Je),h(Dn),h(bn),h(Zi),h(Mo),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata-behavior-row"]],viewQuery:function(o,t){if(o&1&&(we(M_,5),we(D_,5)),o&2){let d;Me(d=De())&&(t.idInput=d.first),Me(d=De())&&(t.editButton=d.first)}},inputs:{disabled:"disabled",index:"index",aliasController:"aliasController",callbacks:"callbacks"},outputs:{behaviorRemoved:"behaviorRemoved"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-behavior-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(o,t){if(o&1){let d=L();s(0,"div",2)(1,"mat-form-field",3),g(2,"input",4,0),c(4,"translate"),r(),s(5,"mat-form-field",5),g(6,"input",6),c(7,"translate"),r(),s(8,"mat-form-field",7)(9,"mat-select",8),v(10,F_,3,4,"mat-option",9),r()(),s(11,"div",10)(12,"button",11,1),c(14,"translate"),C("click",function(_){I(d);let D=q(13);return w(t.editBehavior(_,D))}),s(15,"mat-icon"),p(16,"settings"),r()(),v(17,P_,4,3,"button",12),r()()}o&2&&(m("formGroup",t.behaviorRowFormGroup),a(2),x("placeholder",u(4,6,"widget-config.set")),a(4),x("placeholder",u(7,8,"widget-config.set")),a(4),m("ngForOf",t.scadaSymbolBehaviorTypes),a(2),x("matTooltip",u(14,10,"scada.behavior.behavior-settings")),a(5),m("ngIf",!t.disabled))},dependencies:[xe,U,Ie,re,be,de,vt,gt,Mt,he,W,X,fe,ne,le,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-behavior-row .tb-id-field,.tb-scada-symbol-metadata-behavior-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-behavior-row .tb-type-field{flex:1 1 20%}
`],encapsulation:2});let i=n;return i})();function A_(i,n){if(i&1&&(s(0,"button",17),c(1,"translate"),s(2,"mat-icon"),p(3,"drag_indicator"),r()()),i&2){let l=y(3);j("tb-hidden",!l.dragEnabled),x("matTooltip",u(1,3,"action.drag"))}}function N_(i,n){if(i&1){let l=L();s(0,"div",13)(1,"tb-scada-symbol-metadata-behavior-row",14),C("behaviorRemoved",function(){let o=I(l).index,t=y(2);return w(t.removeBehavior(o))}),r(),s(2,"div",15),v(3,A_,4,5,"button",16),r()()}if(i&2){let l=n.$implicit,e=n.index,o=y(2);j("tb-draggable",!o.disabled)("tb-draggable-form-table-row",!o.disabled),m("cdkDragDisabled",!o.dragEnabled),a(),m("index",e)("formControl",l)("aliasController",o.aliasController)("callbacks",o.callbacks),a(2),m("ngIf",!o.disabled)}}function k_(i,n){if(i&1){let l=L();s(0,"div",11),C("cdkDropListDropped",function(o){I(l);let t=y();return w(t.behaviorDrop(o))}),v(1,N_,4,10,"div",12),r()}if(i&2){let l=y();m("cdkDropListDisabled",!l.dragEnabled),a(),m("ngForOf",l.behaviorsFormArray().controls)("ngForTrackBy",l.trackByBehavior)}}function O_(i,n){if(i&1&&g(0,"tb-error",18),i&2){let l=y();m("error",l.errorText)}}function B_(i,n){if(i&1){let l=L();s(0,"div")(1,"button",19),C("click",function(){I(l);let o=y();return w(o.addBehavior())}),p(2),c(3,"translate"),r()()}i&2&&(a(2),b(" ",u(3,1,"scada.behavior.add-behavior")," "))}function R_(i,n){i&1&&(s(0,"span",20),p(1),c(2,"translate"),r()),i&2&&(a(),B(u(2,1,"scada.behavior.no-behaviors")))}var Mo=(()=>{let n=class n{get dragEnabled(){return!this.disabled&&this.behaviorsFormArray().controls.length>1}constructor(e,o,t){this.fb=e,this.translate=o,this.destroyRef=t,this.styleDisplay="flex",this.styleOverflow="hidden",this.errorText="",this.propagateChange=d=>{}}ngOnInit(){this.behaviorsFormGroup=this.fb.group({behaviors:this.fb.array([])}),this.behaviorsFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{let e=this.behaviorsFormGroup.get("behaviors").value;e&&(e=e.filter(o=>dr(o))),this.propagateChange(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorsFormGroup.disable({emitEvent:!1}):this.behaviorsFormGroup.enable({emitEvent:!1})}writeValue(e){let o=e||[];this.behaviorsFormGroup.setControl("behaviors",this.prepareBehaviorsFormArray(o),{emitEvent:!1})}validate(e){this.errorText="";let t=this.behaviorsFormGroup.get("behaviors").controls.filter(f=>f.hasError("behaviorIdNotUnique"));for(let f of t)f.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),f.hasError("behaviorIdNotUnique")&&(this.errorText=this.translate.instant("scada.behavior.not-unique-behavior-ids-error"));return this.behaviorsFormGroup.valid?null:{behaviors:{valid:!1}}}behaviorIdUnique(e,o){let t=this.behaviorsFormGroup.get("behaviors");for(let d=0;d<t.controls.length;d++)if(d!==o){let f=t.controls[d];if(e===f.value.id)return!1}return!0}behaviorDrop(e){let o=this.behaviorsFormGroup.get("behaviors"),t=o.at(e.previousIndex);o.removeAt(e.previousIndex,{emitEvent:!1}),o.insert(e.currentIndex,t,{emitEvent:!0})}behaviorsFormArray(){return this.behaviorsFormGroup.get("behaviors")}trackByBehavior(e,o){return o}removeBehavior(e,o=!0){this.behaviorsFormGroup.get("behaviors").removeAt(e,{emitEvent:o})}addBehavior(){let e={id:"",name:"",type:Yi.value,valueType:Qi.BOOLEAN,defaultGetValueSettings:Jo({},ds(Qi.BOOLEAN))},o=this.behaviorsFormGroup.get("behaviors"),t=this.fb.control(e,[]);o.push(t),setTimeout(()=>{this.behaviorRows.get(this.behaviorRows.length-1).onAdd(()=>{this.removeBehavior(o.length-1)})})}prepareBehaviorsFormArray(e){let o=[];return e&&e.forEach(t=>{o.push(this.fb.control(t,[]))}),this.fb.array(o)}};n.\u0275fac=function(o){return new(o||n)(h(ce),h(ee),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata-behaviors"]],viewQuery:function(o,t){if(o&1&&we(cr,5),o&2){let d;Me(d=De())&&(t.behaviorRows=d)}},hostVars:4,hostBindings:function(o,t){o&2&&Bi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:15,vars:8,consts:[["noBehaviors",""],[1,"tb-form-panel","tb-scada-symbol-behaviors"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"behaviorRemoved","index","formControl","aliasController","callbacks"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(o,t){if(o&1&&(s(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.behavior.id"),r(),s(5,"div",5),p(6,"scada.behavior.name"),r(),s(7,"div",6),p(8,"scada.behavior.type"),r(),g(9,"div",7),r(),v(10,k_,2,3,"div",8)(11,O_,1,1,"tb-error",9),r(),v(12,B_,4,3,"div",10),r(),v(13,R_,3,3,"ng-template",null,0,Et)),o&2){let d=q(14);a(2),j("no-padding-right",!t.disabled),a(7),j("disabled",t.disabled),a(),m("ngIf",t.behaviorsFormArray().controls.length)("ngIfElse",d),a(),m("ngIf",t.errorText),a(),m("ngIf",!t.disabled)}},styles:[`@charset "UTF-8";.tb-scada-symbol-behaviors{flex:1;margin:12px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-behaviors .tb-form-table{overflow:hidden}.tb-scada-symbol-behaviors .tb-form-table-body{overflow:auto}.tb-scada-symbol-behaviors .tb-form-table-body tb-scada-symbol-metadata-behavior-row{overflow:hidden}
`],encapsulation:2});let i=n;return i})();var V_=["symbolMetadataTags"],j_=[[["",8,"tb-scada-symbol-metadata-header-prefix"]],[["",8,"tb-scada-symbol-metadata-header-suffix"]]],L_=[".tb-scada-symbol-metadata-header-prefix",".tb-scada-symbol-metadata-header-suffix"],G_=()=>["ctx","svg"];function U_(i,n){if(i&1&&g(0,"tb-js-func",28),i&2){let l=y();m("editorCompleter",l.generalStateRenderFunctionCompleter)("highlightRules",l.highlightRules)("functionArgs",Bt(3,G_))}}var ur=(()=>{let n=class n extends It{constructor(e,o,t,d,f){super(e),this.store=e,this.fb=o,this.translate=t,this.customTranslate=d,this.destroyRef=f,this.propagateChange=null,this.headerOptions=[{name:this.translate.instant("scada.general"),value:"general"},{name:this.translate.instant("scada.tags"),value:"tags"},{name:this.translate.instant("scada.behavior.behavior"),value:"behavior"},{name:this.translate.instant("scada.properties"),value:"properties"}],this.selectedOption="general",this.highlightRules=gl}ngOnInit(){this.metadataFormGroup=this.fb.group({title:[null,[T.required]],description:[null],searchTags:[null],widgetSizeX:[null,[T.min(1),T.max(24),T.required]],widgetSizeY:[null,[T.min(1),T.max(24),T.required]],stateRenderFunction:[null],tags:[null],behavior:[null],properties:[null]}),this.updateFunctionCompleters(r0()),this.metadataFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}ngOnChanges(e){for(let o of Object.keys(e)){let t=e[o];!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(o)&&this.updateFunctionCompleters(this.modelValue)}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.metadataFormGroup.disable({emitEvent:!1}):this.metadataFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.metadataFormGroup.patchValue({title:e?.title,description:e?.description,searchTags:e?.searchTags,widgetSizeX:e?.widgetSizeX||3,widgetSizeY:e?.widgetSizeY||3,stateRenderFunction:e?.stateRenderFunction,tags:e?.tags,behavior:e?.behavior,properties:e?.properties},{emitEvent:!1}),this.updateFunctionCompleters(e)}editTagStateRenderFunction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagStateRenderFunction(e)}editTagClickAction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagClickAction(e)}validate(e){return this.metadataFormGroup.valid?null:{metadata:{valid:!1}}}updateModel(){let e=this.metadataFormGroup.getRawValue();this.modelValue=e,this.propagateChange(this.modelValue),this.updateFunctionCompleters(e)}updateFunctionCompleters(e){let o=lg(e,this.tags,this.customTranslate),t=rg(o);this.generalStateRenderFunctionCompleter?this.generalStateRenderFunctionCompleter.updateCompletions(t):this.generalStateRenderFunctionCompleter=new zo(t);let d=Ld(o);this.elementStateRenderFunctionCompleter?this.elementStateRenderFunctionCompleter.updateCompletions(d):this.elementStateRenderFunctionCompleter=new zo(d);let f=sg(o);this.clickActionFunctionCompleter?this.clickActionFunctionCompleter.updateCompletions(f):this.clickActionFunctionCompleter=new zo(f)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ee),h(di),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol-metadata"]],viewQuery:function(o,t){if(o&1&&we(V_,5),o&2){let d;Me(d=De())&&(t.symbolMetadataTags=d.first)}},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",tags:"tags"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}]),G,Vo],ngContentSelectors:L_,decls:55,vars:41,consts:[["symbolMetadataTags",""],[1,"tb-scada-symbol-metadata","tb-absolute-fill"],[1,"tb-scada-symbol-metadata-header"],["appearance","fill",3,"ngModelChange","options","ngModel"],[1,"tb-scada-symbol-metadata-header-components"],[1,"tb-scada-symbol-metadata-content",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","required","","formControlName","title",3,"placeholder"],["matInput","","formControlName","description","rows","2"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["formControlName","searchTags","appearance","outline","subscriptSizing","dynamic",1,"flex-1",2,"display","flex"],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],[1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","widgetSizeX","required","","type","number",3,"min","max","step","placeholder"],["matInput","","formControlName","widgetSizeY","required","","type","number",3,"min","max","step","placeholder"],[1,"tb-form-panel","stroked"],["expanded","",1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"mat-content","overflow-hidden"],["formControlName","tags",3,"tags","clickActionFunctionCompleter","elementStateRenderFunctionCompleter"],["formControlName","behavior",3,"aliasController","callbacks"],["importExport","","formControlName","properties",3,"exportFileName"],["formControlName","stateRenderFunction","minHeight","300px","helpId","scada/symbol_state_render_fn",3,"editorCompleter","highlightRules","functionArgs"]],template:function(o,t){if(o&1){let d=L();Lo(j_),s(0,"div",1)(1,"div",2)(2,"tb-toggle-select",3),et("ngModelChange",function(_){return I(d),Ze(t.selectedOption,_)||(t.selectedOption=_),w(_)}),r(),s(3,"div",4),Jn(4),Jn(5,1),r()(),s(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),p(11,"scada.title"),r(),s(12,"mat-form-field",10),g(13,"input",11),c(14,"translate"),r()(),s(15,"div",8)(16,"div",9),p(17,"scada.description"),r(),s(18,"mat-form-field",10),g(19,"textarea",12),r()(),s(20,"div",8)(21,"div",9),p(22,"scada.search-tags"),r(),s(23,"div",13),g(24,"tb-string-items-list",14),r()(),s(25,"div",8)(26,"div",9),p(27,"scada.widget-size"),r(),s(28,"div",15)(29,"div",16),p(30),c(31,"translate"),r(),s(32,"mat-form-field",17),g(33,"input",18),c(34,"translate"),r(),s(35,"div",16),p(36),c(37,"translate"),r(),s(38,"mat-form-field",17),g(39,"input",19),c(40,"translate"),r()()(),s(41,"div",20)(42,"mat-expansion-panel",21)(43,"mat-expansion-panel-header",22)(44,"mat-panel-title"),p(45),c(46,"translate"),r()(),v(47,U_,1,4,"ng-template",23),r()()()(),s(48,"div",24),g(49,"tb-scada-symbol-metadata-tags",25,0),r(),s(51,"div",24),g(52,"tb-scada-symbol-metadata-behaviors",26),r(),s(53,"div",24),g(54,"tb-dynamic-form-properties",27),r()()()}o&2&&(a(2),m("options",t.headerOptions),Xe("ngModel",t.selectedOption),a(4),m("formGroup",t.metadataFormGroup),a(),j("!hidden",t.selectedOption!=="general"),a(6),x("placeholder",u(14,29,"widget-config.set")),a(17),B(u(31,31,"scada.cols")),a(3),x("placeholder",u(34,33,"widget-config.set")),m("min",1)("max",24)("step",1),a(3),B(u(37,35,"scada.rows")),a(3),x("placeholder",u(40,37,"widget-config.set")),m("min",1)("max",24)("step",1),a(6),b(" ",u(46,39,"scada.state-render-function")," "),a(3),j("!hidden",t.selectedOption!=="tags"),a(),m("tags",t.tags)("clickActionFunctionCompleter",t.clickActionFunctionCompleter)("elementStateRenderFunctionCompleter",t.elementStateRenderFunctionCompleter),a(2),j("!hidden",t.selectedOption!=="behavior"),a(),m("aliasController",t.aliasController)("callbacks",t.callbacks),a(),j("!hidden",t.selectedOption!=="properties"),a(),m("exportFileName",((t.modelValue==null?null:t.modelValue.title)||"scada-symbol")+"-properties"))},dependencies:[mn,ha,be,de,Li,nn,on,eo,he,Gi,W,X,fe,Ui,an,Qe,ne,le,J,Fi,Ts,vl,Mo,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:column-reverse;align-items:flex-start}@media screen and (min-width: 960px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{gap:0;flex-direction:row;align-items:center;justify-content:space-between}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header .tb-scada-symbol-metadata-header-components{width:100%;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content{display:flex;flex:1;overflow:auto}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>div{padding:16px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{gap:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content.overflow-hidden{overflow:hidden}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .tb-form-panel .mat-expansion-panel.tb-settings>.mat-expansion-panel-header{font-weight:400}.tb-js-func .ace_tb.ace_scada-symbol-ctx{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-properties,.tb-js-func .ace_tb.ace_scada-symbol-ctx-property{color:#185f2a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-values,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value{color:#2caa00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-tags,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag{color:#df8600}.tb-js-func .ace_tb.ace_scada-symbol-ctx-api,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{color:#7214d0}.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg,.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg-method{color:#c24c1a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-property,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{font-weight:700}.tb-js-func .ace_tb.ace_scada-symbol-svg,.tb-js-func .ace_tb.ace_scada-symbol-element,.tb-js-func .ace_tb.ace_scada-symbol-event{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-svg-properties,.tb-js-func .ace_tb.ace_scada-symbol-element-properties,.tb-js-func .ace_tb.ace_scada-symbol-event-properties{color:#7214d0;font-weight:700}
`],encapsulation:2});let i=n;return i})();var H_=["symbolEditor"],z_=["symbolMetadata"];function $_(i,n){if(i&1){let l=L();s(0,"div",22)(1,"div",23)(2,"button",24),C("click",function(){I(l);let o=y();return w(o.exitPreviewMode())}),s(3,"mat-icon"),p(4,"chevron_left"),r(),p(5),c(6,"translate"),r(),g(7,"span",25),s(8,"button",26),C("click",function(){I(l);let o=y();return w(o.onRevertPreviewSettings())}),s(9,"mat-icon"),p(10,"close"),r(),p(11),c(12,"translate"),r(),s(13,"button",27),C("click",function(){I(l);let o=y();return w(o.onApplyPreviewSettings())}),s(14,"mat-icon"),p(15,"done"),r(),p(16),c(17,"translate"),r()(),s(18,"div",28)(19,"div",29)(20,"div",30)(21,"div",31),p(22,"scada.symbol.symbol"),r(),g(23,"tb-scada-symbol-input",32),r(),g(24,"tb-scada-symbol-object-settings",33),r()()()}if(i&2){let l=y();a(5),b(" ",u(6,12,"action.back")," "),a(3),m("disabled",!l.scadaPreviewFormGroup.dirty),a(3),b(" ",u(12,14,"action.decline")," "),a(2),m("disabled",!l.scadaPreviewFormGroup.valid||!l.scadaPreviewFormGroup.dirty),a(3),b(" ",u(17,16,"action.apply")," "),a(2),m("formGroup",l.scadaPreviewFormGroup),a(5),m("scadaSymbolContent",l.symbolData.scadaSymbolContent)("scadaSymbolMetadata",l.previewMetadata),a(),m("scadaSymbolMetadata",l.previewMetadata)("aliasController",l.aliasController)("widgetType",l.widgetType.rpc)("callbacks",l.widgetActionCallbacks)}}function J_(i,n){if(i&1){let l=L();s(0,"div",34)(1,"button",26),C("click",function(){I(l);let o=y();return w(o.onRevertScadaSymbolConfig())}),s(2,"mat-icon"),p(3,"close"),r(),p(4),c(5,"translate"),r(),s(6,"button",27),C("click",function(){I(l);let o=y();return w(o.onApplyScadaSymbolConfig())}),s(7,"mat-icon"),p(8,"done"),r(),p(9),c(10,"translate"),r()()}if(i&2){let l=y();a(),m("disabled",!(l.scadaSymbolFormGroup.dirty||l.symbolEditorDirty)),a(3),b(" ",u(5,4,"action.decline")," "),a(2),m("disabled",!l.scadaSymbolFormGroup.valid||!l.symbolEditorValid||!(l.scadaSymbolFormGroup.dirty||l.symbolEditorDirty)),a(3),b(" ",u(10,6,"action.apply")," ")}}function Q_(i,n){if(i&1){let l=L();s(0,"tb-scada-symbol-editor",35,1),et("showHiddenElementsChange",function(o){I(l);let t=y();return Ze(t.showHiddenElements,o)||(t.showHiddenElements=o),w(o)}),C("updateScadaSymbol",function(){I(l);let o=y();return w(o.updateScadaSymbol())})("downloadScadaSymbol",function(){I(l);let o=y();return w(o.downloadScadaSymbol())}),r()}if(i&2){let l=y();m("readonly",l.readonly),Xe("showHiddenElements",l.showHiddenElements),m("data",l.symbolEditorData)("editObjectCallbacks",l.editObjectCallbacks)}}function Y_(i,n){if(i&1&&g(0,"tb-dashboard",36),i&2){let l=y();m("aliasController",l.aliasController)("widgets",l.previewWidgets)("autofillHeight",!1)("gridType",l.previewWidget.sizeX>=l.previewWidget.sizeY?l.GridType.ScrollVertical:l.GridType.ScrollHorizontal)("columns",l.previewWidget.sizeX)("centerVertical",l.previewWidget.sizeX>=l.previewWidget.sizeY)("centerHorizontal",l.previewWidget.sizeX<l.previewWidget.sizeY)("margin",0)("isEdit",!1)("isMobileDisabled",!0)("isEditActionEnabled",!1)("isRemoveActionEnabled",!1)}}var _l=(()=>{let n=class n extends It{get isDirty(){return(this.scadaSymbolFormGroup.dirty||this.symbolEditorDirty)&&!this.forcePristine}set isDirty(e){this.forcePristine=!e}constructor(e,o,t,d,f,_,D,M,Y,ke){super(e),this.store=e,this.route=o,this.fb=t,this.cd=d,this.entityService=f,this.utils=_,this.translate=D,this.imageService=M,this.widgetService=Y,this.dialog=ke,this.widgetType=Ti,this.GridType=yu,this.width="100%",this.height="100%",this.previewMode=!1,this.destroy$=new Ft,this.updateBreadcrumbs=new wt,this.widgetActionCallbacks={fetchDashboardStates:()=>[],fetchCellClickColumns:()=>[]},this.previewWidgets=[],this.editObjectCallbacks=this,this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.forcePristine=!1,this.authUser=Pt(this.store),this.showHiddenElements=!1}ngOnInit(){this.scadaSymbolFormGroup=this.fb.group({metadata:[null]}),this.scadaPreviewFormGroup=this.fb.group({scadaSymbolObjectSettings:[null]});let e={},o={getStateParams:()=>({})},t={};this.aliasController=new df(this.utils,this.entityService,this.translate,()=>o,e,t),this.route.data.pipe(mt(this.destroy$)).subscribe(()=>{this.reset(),this.init(this.route.snapshot.data.symbolData)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}onApplyScadaSymbolConfig(){if(this.scadaSymbolFormGroup.valid){if(this.symbolEditor.editorMode==="xml"){let _=this.symbolEditor.getTags();this.editObjectCallbacks.tagsUpdated(_)}let e=this.scadaSymbolFormGroup.get("metadata").value,o=this.prepareScadaSymbolContent(e),t=Mc(o,this.symbolData.imageResource.fileName,this.symbolData.imageResource.descriptor.mediaType),d=Cc(this.symbolData.imageResource),f=this.imageService.updateImage(d,this.symbolData.imageResource.resourceKey,t);e.title!==this.symbolData.imageResource.title&&(f=f.pipe(Xi(_=>(_.title=e.title,this.imageService.updateImageInfo(_))))),f.pipe(Xi(_=>this.imageService.getImageString(`${Ar}/${d}/${encodeURIComponent(_.resourceKey)}`).pipe(rt(D=>({imageResource:_,scadaSymbolContent:D}))))).subscribe(_=>{this.init(_),this.updateBreadcrumbs.emit()})}}onRevertScadaSymbolConfig(){this.init(this.origSymbolData)}enterPreviewMode(){this.previewMetadata=this.scadaSymbolFormGroup.get("metadata").value,this.symbolData.scadaSymbolContent=this.prepareScadaSymbolContent(this.previewMetadata),this.previewScadaSymbolObjectSettings={behavior:{},properties:{}},this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine();let e=Ji(Ce({},cf),{simulated:!0,scadaSymbolUrl:null,scadaSymbolContent:this.symbolData.scadaSymbolContent,scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings,padding:"0",background:zc("rgba(0,0,0,0)")});this.previewWidget={typeFullFqn:"system.scada_symbol",type:Ti.rpc,sizeX:this.previewMetadata.widgetSizeX||3,sizeY:this.previewMetadata.widgetSizeY||3,row:0,col:0,config:{settings:e,showTitle:!1,dropShadow:!1,padding:"0",margin:"0",backgroundColor:"rgba(0,0,0,0)"}},this.previewWidgets=[this.previewWidget],this.previewMode=!0}exitPreviewMode(){this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.previewMode=!1}onRevertPreviewSettings(){this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine()}onApplyPreviewSettings(){this.scadaPreviewFormGroup.markAsPristine(),this.previewScadaSymbolObjectSettings=this.scadaPreviewFormGroup.get("scadaSymbolObjectSettings").value,this.updatePreviewWidgetSettings()}tagsUpdated(e){this.tags=e}tagHasStateRenderFunction(e){let o=this.scadaSymbolFormGroup.get("metadata").value;return o.tags?!!o.tags.find(d=>d.tag===e)?.stateRenderFunction:!1}tagHasClickAction(e){let o=this.scadaSymbolFormGroup.get("metadata").value;return o.tags?!!o.tags.find(d=>d.tag===e)?.actions?.click?.actionFunction:!1}editTagStateRenderFunction(e){this.symbolMetadata.editTagStateRenderFunction(e)}editTagClickAction(e){this.symbolMetadata.editTagClickAction(e)}onSymbolEditObjectDirty(e){this.symbolEditorDirty=e}onSymbolEditObjectValid(e){this.symbolEditorValid=e}updateScadaSymbol(){this.dialog.open(g0,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{imageSubType:this.symbolData.imageResource.resourceSubType,image:this.symbolData.imageResource}}).afterClosed().subscribe(e=>{e?.scadaSymbolContent&&(this.symbolData.scadaSymbolContent=e.scadaSymbolContent,this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.symbolEditorDirty=!0,this.symbolEditorValid=!0)})}downloadScadaSymbol(){let e;this.scadaSymbolFormGroup.valid?e=this.scadaSymbolFormGroup.get("metadata").value:e=cd(this.origSymbolData.scadaSymbolContent);let o=document.createElement("a"),t=this.prepareScadaSymbolContent(e),d=new Blob([t],{type:this.symbolData.imageResource.descriptor.mediaType}),f=URL.createObjectURL(d);o.setAttribute("href",f),o.setAttribute("download",this.symbolData.imageResource.fileName);let _=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});o.dispatchEvent(_)}createWidget(){let e=this.scadaSymbolFormGroup.get("metadata").value;this.dialog.open(Aa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{title:e.title,dialogTitle:"scada.create-widget-from-symbol",saveAsActionTitle:"action.create"}}).afterClosed().subscribe(o=>{o&&this.widgetService.getWidgetType("system.scada_symbol").subscribe(t=>{let d=Sc+this.symbolData.imageResource.link,f=Ce({image:d,description:e.description,tags:e.searchTags},t);f.fqn=void 0,f.id=void 0,f.name=o.widgetName;let _=f.descriptor;_.sizeX=e.widgetSizeX,_.sizeY=e.widgetSizeY;let D;typeof _.controllerScript=="string"?D=_.controllerScript:D=_.controllerScript.body,D=D.replace(/previewWidth: '\d*px'/gm,`previewWidth: '${e.widgetSizeX*100}px'`),D=D.replace(/previewHeight: '\d*px'/gm,`previewHeight: '${e.widgetSizeY*100+20}px'`),typeof _.controllerScript=="string"?_.controllerScript=D:_.controllerScript.body=D;let M=JSON.parse(_.defaultConfig);M.title=o.widgetName,M.settings=M.settings||{},M.settings.scadaSymbolUrl=d,_.defaultConfig=JSON.stringify(M),this.widgetService.saveWidgetType(f).subscribe(Y=>{o.widgetBundleId&&this.widgetService.addWidgetFqnToWidgetBundle(o.widgetBundleId,Y.fqn).subscribe()})})})}updatePreviewWidgetSettings(){this.previewWidget=Tt(this.previewWidget),this.previewWidget.config.settings.scadaSymbolObjectSettings=this.previewScadaSymbolObjectSettings,this.previewWidgets=[this.previewWidget]}prepareScadaSymbolContent(e){let o=this.symbolEditor.getContent();return l0(o,e)}reset(){this.symbolMetadata&&(this.symbolMetadata.selectedOption="general"),this.previewMode=!1}init(e){this.authUser.authority===E.TENANT_ADMIN?this.readonly=e.imageResource.tenantId.id===Ae:this.readonly=this.authUser.authority!==E.SYS_ADMIN,this.origSymbolData=e,this.symbolData=Tt(e),this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent};let o=cd(this.symbolData.scadaSymbolContent);this.scadaSymbolFormGroup.patchValue({metadata:o},{emitEvent:!1}),this.readonly?this.scadaSymbolFormGroup.disable({emitEvent:!1}):this.scadaSymbolFormGroup.enable({emitEvent:!1}),this.scadaSymbolFormGroup.markAsPristine(),this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.cd.markForCheck()}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Ri),h(ce),h(Je),h(Zu),h(Gr),h(ee),h(ls),h(si),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-scada-symbol"]],viewQuery:function(o,t){if(o&1&&(we(H_,5),we(z_,5)),o&2){let d;Me(d=De())&&(t.symbolEditor=d.first),Me(d=De())&&(t.symbolMetadata=d.first)}},hostVars:4,hostBindings:function(o,t){o&2&&Bi("width",t.width)("height",t.height)},features:[G],decls:31,vars:27,consts:[["symbolMetadata",""],["symbolEditor",""],[1,"tb-scada-symbol-editor","mat-content","flex","flex-col"],[1,"tb-scada-symbol-editor-container","flex","flex-1","flex-col"],[1,"tb-scada-symbol-editor-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","end",1,"tb-scada-symbol-editor-details-drawer","mat-elevation-z4"],["headerHeightPx","64",1,"flex-1",3,"isReadOnly","showCloseDetails","headerTitle"],[1,"details-buttons","flex","flex-row","items-center","justify-start","gap-4"],["tb-help","scadaSymbolDev"],["mat-stroked-button","",3,"click","disabled"],["class","tb-scada-symbol-editor-preview-content tb-absolute-fill",4,"ngIf"],[3,"formGroup"],["formControlName","metadata",3,"tags","aliasController","callbacks"],[1,"tb-scada-symbol-metadata-header-prefix"],["mat-button","","color","primary",1,"gt-sm:!hidden",3,"click","disabled"],[1,"tb-scada-symbol-metadata-header-suffix","flex","flex-row","items-center","justify-end","gap-3","lt-md:flex-1"],["mat-button","","color","primary",1,"lt-md:!hidden",3,"click","disabled"],["class","flex flex-row items-center justify-start gap-3",4,"ngIf"],[1,"tb-scada-symbol-editor-content"],[3,"readonly","showHiddenElements","data","editObjectCallbacks","showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol",4,"ngIf"],["class","tb-absolute-fill","displayGrid","always","setGridSize","",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled",4,"ngIf"],[1,"tb-scada-symbol-editor-preview-content","tb-absolute-fill"],[1,"tb-scada-symbol-editor-preview-header"],["mat-button","",3,"click"],[2,"flex","1"],["mat-stroked-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"tb-scada-symbol-editor-preview-settings",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],["translate","",1,"tb-form-panel-title"],[3,"scadaSymbolContent","scadaSymbolMetadata"],["formControlName","scadaSymbolObjectSettings",3,"scadaSymbolMetadata","aliasController","widgetType","callbacks"],[1,"flex","flex-row","items-center","justify-start","gap-3"],[3,"showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol","readonly","showHiddenElements","data","editObjectCallbacks"],["displayGrid","always","setGridSize","",1,"tb-absolute-fill",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled"]],template:function(o,t){if(o&1){let d=L();s(0,"div",2)(1,"section",3)(2,"div",4)(3,"mat-drawer-container",5)(4,"mat-drawer",6)(5,"tb-details-panel",7)(6,"div",8),g(7,"div",9),s(8,"button",10),C("click",function(){return I(d),w(t.createWidget())}),p(9),c(10,"translate"),r()(),v(11,$_,25,18,"div",11),s(12,"div",12)(13,"tb-scada-symbol-metadata",13,0)(15,"div",14)(16,"button",15),C("click",function(){return I(d),w(t.enterPreviewMode())}),s(17,"mat-icon"),p(18,"visibility"),r(),p(19),c(20,"translate"),r()(),s(21,"div",16)(22,"button",17),C("click",function(){return I(d),w(t.enterPreviewMode())}),s(23,"mat-icon"),p(24,"visibility"),r(),p(25),c(26,"translate"),r(),v(27,J_,11,8,"div",18),r()()()()(),s(28,"mat-drawer-content",19),v(29,Q_,2,4,"tb-scada-symbol-editor",20)(30,Y_,1,12,"tb-dashboard",21),r()()()()()}o&2&&(a(5),x("headerTitle",t.symbolData==null||t.symbolData.imageResource==null?null:t.symbolData.imageResource.title),m("isReadOnly",!0)("showCloseDetails",!1),a(3),m("disabled",t.scadaSymbolFormGroup.invalid),a(),b(" ",u(10,21,"scada.create-widget")," "),a(2),m("ngIf",t.previewMode),a(),j("!hidden",t.previewMode),m("formGroup",t.scadaSymbolFormGroup),a(),m("tags",t.tags)("aliasController",t.aliasController)("callbacks",t.widgetActionCallbacks),a(3),m("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),a(3),b(" ",u(20,23,"scada.preview")," "),a(3),m("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),a(3),b(" ",u(26,25,"scada.preview")," "),a(2),m("ngIf",!t.readonly),a(),j("preview",t.previewMode),a(),m("ngIf",!t.previewMode),a(),m("ngIf",t.previewMode))},dependencies:[U,$t,te,re,fu,gu,uu,W,X,ne,le,J,W0,X0,Sf,ur,Tf,hl,R],styles:[`@charset "UTF-8";.tb-scada-symbol-editor{width:100%;height:100%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer{width:50%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings{flex:1;overflow:auto}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>div{padding:16px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{gap:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-content{flex:1;min-width:0;min-height:0;width:50%;max-width:50%;background:#fff}.tb-scada-symbol-editor .tb-scada-symbol-editor-content.preview #gridster-parent #gridster-background{background-color:#eee}
`],encapsulation:2});let i=n;return i})();S();S();function K_(i,n){if(i&1&&(s(0,"mat-option",5),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.resourceSubTypesTranslationMap.get(l))," ")}}var Cl=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.jsResourceSubTypes=[hi.EXTENSION,hi.MODULE],this.resourceSubTypesTranslationMap=Ho}jsResourceSubTypeChanged(e){this.entitiesTableConfig.componentsData.resourceSubType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-js-library-table-header"]],features:[G],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,t){o&1&&(s(0,"mat-form-field",0)(1,"mat-label",1),p(2,"javascript.javascript-type"),r(),s(3,"mat-select",2),c(4,"translate"),C("ngModelChange",function(f){return t.jsResourceSubTypeChanged(f)}),s(5,"mat-option",3),p(6),c(7,"translate"),r(),v(8,K_,3,4,"mat-option",4),r()()),o&2&&(a(3),x("placeholder",u(4,4,"javascript.javascript-type")),m("ngModel",t.entitiesTableConfig.componentsData.resourceSubType),a(3),b(" ",u(7,6,"javascript.all-types")," "),a(2),m("ngForOf",t.jsResourceSubTypes))},dependencies:[xe,de,Se,vt,gt,W,Qe,J,R],encapsulation:2});let i=n;return i})();S();var X_=()=>({standalone:!0});function Z_(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.ResourceSubTypeTranslationMap.get(l))," ")}}function eC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"resource.title-required")," "))}function tC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"resource.title-max-length")," "))}function iC(i,n){if(i&1){let l=L();s(0,"tb-file-input",18),c(1,"translate"),c(2,"translate"),C("fileNameChanged",function(o){I(l);let t=y();return w(t.entityForm==null?null:t.entityForm.get("fileName").patchValue(o))}),r()}if(i&2){let l,e=y();x("label",u(1,9,"javascript.resource-file")),x("dropLabel",u(2,11,"javascript.drop-resource-file-or")),m("required",e.isAdd)("readAsBinary",!0)("maxSizeByte",e.maxResourceSize)("allowedExtensions",e.getAllowedExtensions())("contentConvertFunction",e.convertToBase64File)("accept",e.getAcceptType())("existingFileName",(l=e.entityForm.get("fileName"))==null?null:l.value)}}function nC(i,n){if(i&1){let l=L();s(0,"tb-file-input",23),c(1,"translate"),C("ngModelChange",function(o){I(l);let t=y(2);return w(t.uploadContentFromFile(o))})("fileNameChanged",function(o){I(l);let t=y(2);return w(t.entityForm==null?null:t.entityForm.get("fileName").patchValue(o))}),r()}if(i&2){let l=y(2);x("uploadButtonText",u(1,5,"javascript.upload-from-file")),m("maxSizeByte",l.maxResourceSize)("allowedExtensions",l.getAllowedExtensions())("accept",l.getAcceptType())("ngModelOptions",Bt(7,X_))}}function oC(i,n){if(i&1&&(s(0,"tb-js-func",19)(1,"div",20)(2,"label",21),p(3),c(4,"translate"),r(),v(5,nC,2,8,"tb-file-input",22),r()()),i&2){let l=y();a(2),j("tb-error",l.entityForm.get("content").invalid&&l.entityForm.get("content").touched),a(),b(" ",u(4,4,"javascript.module-script")," "),a(2),m("ngIf",l.isAdd||l.isEdit)}}function aC(i,n){i&1&&(s(0,"div",24)(1,"mat-form-field",25)(2,"mat-label",5),p(3,"resource.file-name"),r(),g(4,"input",26),r()())}var Sl=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.ResourceSubType=hi,this.jsResourceSubTypes=[hi.EXTENSION,hi.MODULE],this.ResourceSubTypeTranslationMap=Ho,this.maxResourceSize=ji(this.store).maxResourceSize,this.destroy$=new Ft,this.highlightRules=gl}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceSubTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({title:[e?e.title:"",[T.required,T.maxLength(255)]],resourceSubType:[e?.resourceSubType?e.resourceSubType:hi.EXTENSION,T.required],fileName:[e?e.fileName:null,T.required],data:[e?e.data:null,this.isAdd?[T.required]:[]],content:[e?.data?.length?window.atob(e.data):"",T.required]})}updateForm(e){this.entityForm.patchValue(e);let o=e.resourceSubType===hi.MODULE&&e?.data?.length?window.atob(e.data):"";this.entityForm.get("content").patchValue(o)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceSubType").disable({emitEvent:!1}),this.updateResourceSubTypeFieldsState(this.entityForm.get("resourceSubType").value))}prepareFormValue(e){return this.isEdit&&!Be(e.data)&&delete e.data,e.resourceSubType===hi.MODULE&&(e.fileName||(e.fileName=e.title+".js"),e.data=window.btoa(e.content),delete e.content),super.prepareFormValue(e)}getAllowedExtensions(){return Pr.get(gi.JS_MODULE)}getAcceptType(){return Fr.get(gi.JS_MODULE)}convertToBase64File(e){return window.btoa(e)}onResourceIdCopied(){this.store.dispatch(new ze({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}uploadContentFromFile(e){this.entityForm.get("content").patchValue(e),this.entityForm.markAsDirty()}observeResourceSubTypeChange(){this.entityForm.get("resourceSubType").valueChanges.pipe(go(hi.EXTENSION),mt(this.destroy$)).subscribe(e=>this.onResourceSubTypeChange(e))}onResourceSubTypeChange(e){this.updateResourceSubTypeFieldsState(e),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}updateResourceSubTypeFieldsState(e){e===hi.EXTENSION?(this.entityForm.get("data").enable({emitEvent:!1}),this.entityForm.get("fileName").enable({emitEvent:!1}),this.entityForm.get("content").disable({emitEvent:!1})):(this.entityForm.get("data").disable({emitEvent:!1}),this.entityForm.get("fileName").disable({emitEvent:!1}),this.entityForm.get("content").enable({emitEvent:!1}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ct),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-js-resource"]],features:[G],decls:36,vars:37,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceSubType","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data",3,"required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["helpId","resource/js-resource-module_fn","formControlName","content","required","","hideBrackets","","hideLabel","","minHeight","300px",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["formControlName","data",3,"fileNameChanged","required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","dropLabel","existingFileName"],["helpId","resource/js-resource-module_fn","formControlName","content","required","","hideBrackets","","hideLabel","","minHeight","300px"],["toolbarStartButton","",1,"flex","flex-row","gap-4"],[1,"tb-title","no-padding","tb-required",2,"font-size","16px"],["asButton","","uploadButtonClass","tb-ignore-browse-file-button-style",3,"uploadButtonText","maxSizeByte","allowedExtensions","accept","ngModel","ngModelOptions","ngModelChange","fileNameChanged",4,"ngIf"],["asButton","","uploadButtonClass","tb-ignore-browse-file-button-style",3,"ngModelChange","fileNameChanged","uploadButtonText","maxSizeByte","allowedExtensions","accept","ngModel","ngModelOptions"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"downloadResource")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(11),c(12,"translate"),r(),s(13,"div",2)(14,"button",3),C("cbOnSuccess",function(){return t.onResourceIdCopied()}),g(15,"mat-icon",4),s(16,"span",5),p(17,"resource.copyId"),r()()()(),s(18,"div",6)(19,"form",7)(20,"fieldset",8),c(21,"async"),s(22,"mat-form-field",9)(23,"mat-label",5),p(24,"javascript.javascript-type"),r(),s(25,"mat-select",10),v(26,Z_,3,4,"mat-option",11),r()(),s(27,"mat-form-field",9)(28,"mat-label",5),p(29,"resource.title"),r(),g(30,"input",12),v(31,eC,3,3,"mat-error",13)(32,tC,3,3,"mat-error",13),r(),v(33,iC,3,13,"tb-file-input",14)(34,oC,6,6,"tb-js-func",15)(35,aC,5,0,"div",16),r()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,23,t.isLoading$)),a(2),b(" ",u(4,25,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(6,27,t.isLoading$)),a(2),b(" ",u(8,29,"javascript.download")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(10,31,t.isLoading$)),a(2),b(" ",u(12,33,"javascript.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),m("formGroup",t.entityForm),a(),m("disabled",u(21,35,t.isLoading$)||!t.isEdit),a(6),m("ngForOf",t.jsResourceSubTypes),a(5),m("ngIf",t.entityForm.get("title").hasError("required")),a(),m("ngIf",t.entityForm.get("title").hasError("maxlength")),a(),m("ngIf",(t.isAdd||t.isEdit)&&t.entityForm.get("resourceSubType").value===t.ResourceSubType.EXTENSION),a(),m("ngIf",t.entityForm.get("resourceSubType").value===t.ResourceSubType.MODULE),a(),m("ngIf",!t.isAdd&&!t.isEdit&&t.entityForm.get("resourceSubType").value===t.ResourceSubType.EXTENSION))},dependencies:[xe,U,ha,te,re,be,de,Se,Fe,vt,gt,Jt,ue,he,W,X,fe,Qe,ne,le,no,J,me,R],encapsulation:2});let i=n;return i})();S();function rC(i,n){if(i&1&&(s(0,"mat-tab",3,0),c(2,"translate"),g(3,"tb-audit-log-table",4),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function sC(i,n){if(i&1){let l=L();s(0,"mat-tab",3,1),c(2,"translate"),s(3,"tb-version-control",5),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var Tl=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e,this.NULL_UUID=Ae}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-resource-tabs"]],features:[G],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,rC,4,6,"mat-tab",2)(1,sC,4,7,"mat-tab",2),o&2&&(m("ngIf",t.entity&&t.entity.tenantId.id!==t.NULL_UUID&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit),a(),m("ngIf",t.entity&&t.entity.tenantId.id!==t.NULL_UUID&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[U,St,ri,ai,R],encapsulation:2});let i=n;return i})();var xl=(()=>{let n=class n{constructor(e,o,t,d,f){this.store=e,this.resourceService=o,this.translate=t,this.router=d,this.datePipe=f,this.config=new Le,this.config.entityType=O.TB_RESOURCE,this.config.entityComponent=Sl,this.config.entityTabsComponent=Tl,this.config.entityTranslations={details:"javascript.javascript-resource-details",add:"javascript.add",noEntities:"javascript.no-javascript-resource-text",search:"javascript.search",selectedEntities:"javascript.selected-javascript-resources"},this.config.entityResources=tt.get(O.TB_RESOURCE),this.config.headerComponent=Cl,this.config.entityTitle=_=>_?_.title:"",this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","resource.title","60%"),new K("resourceSubType","javascript.javascript-type","40%",_=>this.translate.instant(Ho.get(_.resourceSubType))),new K("tenantId","resource.system","60px",_=>Dt(_.tenantId.id===Ae))),this.config.cellActionDescriptors.push({name:this.translate.instant("javascript.download"),icon:"file_download",isEnabled:()=>!0,onAction:(_,D)=>this.downloadResource(_,D)}),this.config.deleteEntityTitle=_=>this.translate.instant("javascript.delete-javascript-resource-title",{resourceTitle:_.title}),this.config.deleteEntityContent=()=>this.translate.instant("javascript.delete-javascript-resource-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("javascript.delete-javascript-resources-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("javascript.delete-javascript-resources-text"),this.config.entitiesFetchFunction=_=>this.resourceService.getResources(_,gi.JS_MODULE,this.config.componentsData.resourceSubType),this.config.loadEntity=_=>{let D=this.config.getTable()?.dataSource?.currentEntity;return!D||D?.resourceSubType===hi.MODULE?this.resourceService.getResource(_.id):this.resourceService.getResourceInfoById(_.id)},this.config.saveEntity=_=>{_.resourceType=gi.JS_MODULE;let D=this.resourceService.saveResource(_);return _.resourceSubType===hi.MODULE&&(D=D.pipe(Xi(M=>this.resourceService.getResource(M.id.id)))),D},this.config.deleteEntity=_=>this.resourceService.deleteResource(_.id),this.config.onEntityAction=_=>this.onResourceAction(_)}resolve(){this.config.tableTitle=this.translate.instant("javascript.javascript-library"),this.config.componentsData={resourceSubType:""};let e=Pt(this.store);return this.config.deleteEnabled=o=>this.isResourceEditable(o,e.authority),this.config.entitySelectionEnabled=o=>this.isResourceEditable(o,e.authority),this.config.detailsReadonly=o=>this.detailsReadonly(o,e.authority),this.config}openResource(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["resources","javascript-library",o.id.id]);this.router.navigateByUrl(t).then(()=>{})}downloadResource(e,o){e&&e.stopPropagation(),this.resourceService.downloadResource(o.id.id).subscribe()}onResourceAction(e){switch(e.action){case"open":return this.openResource(e.event,e.entity),!0;case"downloadResource":return this.downloadResource(e.event,e.entity),!0}return!1}detailsReadonly(e,o){return!this.isResourceEditable(e,o)}isResourceEditable(e,o){return o===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:o===E.SYS_ADMIN}};n.\u0275fac=function(o){return new(o||n)(P(A),P(as),P(ee),P(pe),P(Oe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var lC=(i,n,l=Ut(pe),e=Ut(ls))=>{let o=i.params.type,t=decodeURIComponent(i.params.key);return jt({imageResource:e.getImageInfo(o,t),scadaSymbolContent:e.getImageString(`${Ar}/${o}/${encodeURIComponent(t)}`)}).pipe(Hn(()=>(l.navigate(["/resources/scada-symbols"]),Ct(null))))},mC=(i,n,l)=>l.symbolData?.imageResource?.title,pC=[{path:"resources",data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:ve.resources}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:"/resources/widgets-library"}},...$f,{path:"images",data:{breadcrumb:{menuId:ve.images}},children:[{path:"",component:ud,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"image.gallery",imageSubType:hi.IMAGE}}]},{path:"scada-symbols",data:{breadcrumb:{menuId:ve.scada_symbols}},children:[{path:"",component:ud,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"scada.symbols",imageSubType:hi.SCADA_SYMBOL}},{path:":type/:key",component:_l,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:mC,icon:"view_in_ar"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"scada.symbol.symbol"},resolve:{symbolData:lC}}]},{path:"resources-library",data:{breadcrumb:{menuId:ve.resources_library}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:qs}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"mdi:rhombus-split"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:qs}}]},{path:"javascript-library",data:{breadcrumb:{menuId:ve.javascript_library}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"javascript.javascript-library"},resolve:{entitiesTableConfig:xl}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"mdi:language-javascript"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"javascript.javascript-library"},resolve:{entitiesTableConfig:xl}}]}]},{path:"settings",component:pn,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],showMainLoadingBar:!1,breadcrumb:{menuId:ve.settings}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/settings/general",TENANT_ADMIN:"/settings/home"}}},{path:"general",component:Bs,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN],title:"admin.general-settings",breadcrumb:{menuId:ve.general}}},{path:"outgoing-mail",component:Os,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN],title:"admin.outgoing-mail-settings",breadcrumb:{menuId:ve.mail_server}}},{path:"notifications",component:js,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.notifications-settings",breadcrumb:{menuId:ve.notification_settings}}},{path:"queues",data:{breadcrumb:{menuId:ve.queues}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:$s}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"swap_calls"},auth:[E.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:$s}}]},{path:"home",component:Ls,canDeactivate:[Ee],data:{auth:[E.TENANT_ADMIN],title:"admin.home-settings",breadcrumb:{menuId:ve.home_settings}}},{path:"repository",component:Js,canDeactivate:[Ee],data:{auth:[E.TENANT_ADMIN],title:"admin.repository-settings",breadcrumb:{menuId:ve.repository_settings}}},{path:"auto-commit",component:Qs,canDeactivate:[Ee],data:{auth:[E.TENANT_ADMIN],title:"admin.auto-commit-settings",breadcrumb:{menuId:ve.auto_commit_settings}}},{path:"security-settings",redirectTo:"/security-settings/general"},{path:"oauth2",redirectTo:"/security-settings/oauth2"},{path:"resources-library",pathMatch:"full",redirectTo:"/resources/resources-library"},{path:"resources-library/:entityId",redirectTo:"/resources/resources-library/:entityId"},{path:"2fa",redirectTo:"/security-settings/2fa"},{path:"sms-provider",redirectTo:"/settings/notifications"}]},{path:"security-settings",data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:ve.security_settings}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/general",TENANT_ADMIN:"/security-settings/auditLogs"}}},{path:"general",component:Rs,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN],title:"admin.general",breadcrumb:{menuId:ve.security_settings_general}}},{path:"2fa",component:Ys,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN],title:"admin.2fa.2fa",breadcrumb:{menuId:ve.two_fa}}},...Nd,...Jf]}],El=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[qs,xl,$s],imports:[V.forChild(pC),V]});let i=n;return i})();(function(){Q(El,{imports:[V],exports:[V]})})();S();var Il=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[dl,oe,ae,ye]});let i=n;return i})();(function(){Q(Il,{declarations:[jn,Oa,sl,ml,pl],imports:[dl,oe,ae,ye]})})();var wl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,El,Il,nd]});let i=n;return i})();(function(){Q(wl,{declarations:[Bs,Os,js,Vs,Rs,Ls,Gs,Tl,Us,Sl,Cl,Ws,Js,Qs,Ys],imports:[oe,ae,ye,El,Il,nd]})})();S();S();S();function dC(i,n){if(i&1&&g(0,"tb-dashboard-page",2),i&2){let l=y();m("embedded",!0)("dashboard",l.homeDashboard)("hideToolbar",l.homeDashboard.hideDashboardToolbar)}}function cC(i,n){if(i&1&&(s(0,"mat-grid-tile")(1,"a",10)(2,"tb-icon",11),p(3),r(),s(4,"span"),p(5),c(6,"customTranslate"),c(7,"translate"),r()()()),i&2){let l=n.$implicit;a(),x("routerLink",l.path),a(2),B(l.icon),a(2),B(l.customTranslate?u(6,3,l.name):u(7,5,l.name))}}function uC(i,n){if(i&1&&(s(0,"mat-grid-tile",5)(1,"mat-card",6)(2,"mat-card-title")(3,"span",7),p(4),r()(),s(5,"mat-card-content")(6,"mat-grid-list",8),v(7,cC,8,7,"mat-grid-tile",9),r()()()()),i&2){let l=n.$implicit,e=y(2);m("colspan",e.sectionColspan(l)),a(4),B(l.name),a(2),m("cols",l.places.length),a(),m("ngForOf",l.places)}}function fC(i,n){if(i&1&&(s(0,"mat-grid-list",3),v(1,uC,8,4,"mat-grid-tile",4),c(2,"async"),r()),i&2){let l=y();m("cols",l.cols),a(),m("ngForOf",u(2,2,l.homeSections$))}}var Ml=(()=>{let n=class n{constructor(e,o,t,d){this.menuService=e,this.breakpointObserver=o,this.cd=t,this.route=d,this.homeSections$=this.menuService.homeSections(),this.cols=2,this.homeDashboard=this.route.snapshot.data.homeDashboard}ngOnInit(){this.homeDashboard||(this.updateColumnCount(),this.breakpointObserver.observe([wi.lg,wi["gt-lg"]]).subscribe(e=>this.updateColumnCount()))}updateColumnCount(){this.cols=2,this.breakpointObserver.isMatched(wi.lg)&&(this.cols=3),this.breakpointObserver.isMatched(wi["gt-lg"])&&(this.cols=4),this.cd.detectChanges()}sectionColspan(e){if(this.breakpointObserver.isMatched(wi["gt-sm"])){let o=this.cols;return e&&e.places&&e.places.length<=o&&(o=e.places.length),o}else return 2}};n.\u0275fac=function(o){return new(o||n)(h(Zc),h(Xn),h(Je),h(Ri))},n.\u0275cmp=F({type:n,selectors:[["tb-home-links"]],decls:3,vars:2,consts:[["homeLinks",""],[3,"embedded","dashboard","hideToolbar",4,"ngIf","ngIfElse"],[3,"embedded","dashboard","hideToolbar"],["rowHeight","280px",1,"tb-home-links",3,"cols"],[3,"colspan",4,"ngFor","ngForOf"],[3,"colspan"],["appearance","outlined",2,"width","100%"],["translate","",1,"mat-headline-5"],["rowHeight","170px",3,"cols"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"tb-card-button",3,"routerLink"],["matButtonIcon","",1,"tb-mat-96"]],template:function(o,t){if(o&1&&v(0,dC,1,3,"tb-dashboard-page",1)(1,fC,3,4,"ng-template",null,0,Et),o&2){let d=q(2);m("ngIf",t.homeDashboard)("ngIfElse",d)}},dependencies:[xe,U,ea,Zt,ni,ci,mu,lu,gc,J,bi,wa,me,di,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:20px}@media screen and (min-width: 1600px){[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:24px}}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card{padding:0;margin:8px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title{margin:0;padding:24px 16px 16px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title+.mat-mdc-card-content{padding-top:0}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-content{padding:16px}[_nghost-%COMP%]     .tb-home-links .tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button:hover{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button:focus{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .tb-home-links .tb-card-button span.mdc-button__label{height:18px;min-height:36px;max-height:36px;padding:0 0 20px;margin:auto;font-size:18px;font-weight:400;line-height:18px;white-space:normal;text-align:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}'],changeDetection:0});let i=n;return i})();var gC="/assets/dashboard/sys_admin_home_page.json",hC="/assets/dashboard/tenant_admin_home_page.json",bC="/assets/dashboard/customer_user_home_page.json",vC=(i,n)=>{let l=Pt(i).authority;switch(l){case E.SYS_ADMIN:return Ud(i,n.loadJsonResource(gC),l);case E.TENANT_ADMIN:return Ud(i,n.loadJsonResource(hC),l);case E.CUSTOMER_USER:return Ud(i,n.loadJsonResource(bC),l);default:return Ct(null)}},Ud=(i,n,l)=>{let e;switch(l){case E.SYS_ADMIN:e=i.pipe(qt(Bc),rt(o=>({mobileQrEnabled:o})));break;case E.TENANT_ADMIN:e=i.pipe(qt(Rc));break;case E.CUSTOMER_USER:e=i.pipe(qt(Or),rt(o=>({persistDeviceStateToTelemetry:o})));break}return e.pipe(_t(o=>n.pipe(rt(t=>{if(o.persistDeviceStateToTelemetry)for(let d of Object.keys(t.configuration.filters))["Active Devices","Inactive Devices"].includes(t.configuration.filters[d].filter)&&(t.configuration.filters[d].keyFilters[0].key.type=Wu.TIME_SERIES);if(Be(o.mobileQrEnabled)){for(let d of Object.keys(t.configuration.widgets))if(t.configuration.widgets[d].config.title==="Select show mobile QR code"){t.configuration.widgets[d].config.settings.markdownTextFunction=t.configuration.widgets[d].config.settings.markdownTextFunction.replace(/\${mobileQrEnabled:([^}]+)}/,`\${mobileQrEnabled:${String(o.mobileQrEnabled)}}`);break}}return t.hideDashboardToolbar=!0,t}))))},yC=(i,n,l=Ut(Xr),e=Ut(la),o=Ut(A))=>l.getHomeDashboard().pipe(_t(t=>t?Ct(t):vC(o,e))),_C=[{path:"home",component:Ml,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"home.home",breadcrumb:{menuId:ve.home}},resolve:{homeDashboard:yC}}],Dl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(_C),V]});let i=n;return i})();(function(){Q(Dl,{imports:[V],exports:[V]})})();var Fl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Dl]});let i=n;return i})();(function(){Q(Fl,{declarations:[Ml],imports:[oe,ae,ye,Dl]})})();S();S();function CC(i,n){i&1&&g(0,"mat-progress-bar",25)}function SC(i,n){i&1&&g(0,"div",26)}function TC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.email-required")," "))}function xC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.invalid-email-format")," "))}function EC(i,n){if(i&1&&(s(0,"mat-option",27),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",l?u(2,2,"language.locales."+l):""," ")}}function IC(i,n){if(i&1&&(s(0,"section",28),g(1,"tb-dashboard-autocomplete",29),c(2,"translate"),s(3,"mat-checkbox",30),p(4),c(5,"translate"),r()()),i&2){let l=y();a(),x("label",u(2,6,"dashboard.home-dashboard")),m("dashboardsScope",(l.user==null?null:l.user.authority)===l.authorities.TENANT_ADMIN?"tenant":"customer")("tenantId",l.user==null||l.user.tenantId==null?null:l.user.tenantId.id)("customerId",l.user==null||l.user.customerId==null?null:l.user.customerId.id)("selectFirstDashboard",!1),a(3),b(" ",u(5,8,"dashboard.home-dashboard-hide-toolbar")," ")}}var Al=(()=>{let n=class n extends It{constructor(e,o,t,d,f,_){super(e),this.store=e,this.route=o,this.userService=t,this.authService=d,this.translate=f,this.fb=_,this.authorities=E,this.languageList=Kc.supportedLangs,this.authUser=Pt(this.store)}ngOnInit(){this.buildProfileForm(),this.userLoaded(this.route.snapshot.data.user)}buildProfileForm(){this.profile=this.fb.group({email:["",[T.required,T.email]],firstName:[""],lastName:[""],phone:[""],language:[""],homeDashboardId:[null],homeDashboardHideToolbar:[!0]})}save(){this.user=Ce(Ce({},this.user),this.profile.value),this.user.additionalInfo||(this.user.additionalInfo={}),this.user.additionalInfo.lang=this.profile.get("language").value,this.user.additionalInfo.homeDashboardId=this.profile.get("homeDashboardId").value,this.user.additionalInfo.homeDashboardHideToolbar=this.profile.get("homeDashboardHideToolbar").value,this.userService.saveUser(this.user).subscribe(e=>{this.userLoaded(e),this.store.dispatch(new Nc({userDetails:{additionalInfo:Ce({},e.additionalInfo),authority:e.authority,createdTime:e.createdTime,tenantId:e.tenantId,customerId:e.customerId,email:e.email,phone:e.phone,firstName:e.firstName,id:e.id,lastName:e.lastName}})),this.store.dispatch(new Xc({userLang:e.additionalInfo.lang})),this.authService.refreshJwtToken(!1)})}userLoaded(e){this.user=e,this.profile.reset(e);let o,t,d=!0;e.additionalInfo&&(e.additionalInfo.lang&&(o=e.additionalInfo.lang),t=e.additionalInfo.homeDashboardId,Be(e.additionalInfo.homeDashboardHideToolbar)&&(d=e.additionalInfo.homeDashboardHideToolbar)),o||(o=this.translate.currentLang),this.profile.get("language").setValue(o),this.profile.get("homeDashboardId").setValue(t),this.profile.get("homeDashboardHideToolbar").setValue(d)}confirmForm(){return this.profile}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Ri),h(Cn),h(Zn),h(ee),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-profile"]],features:[G],decls:50,vars:30,consts:[["appearance","outlined",1,"profile-card"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"profile-email",2,"opacity","0.7"],[1,"flex","flex-col"],["translate","",1,"mat-mdc-subheader"],[1,"profile-last-login-ts",2,"opacity","0.7"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formControlName","language"],[3,"value",4,"ngFor","ngForOf"],["class","tb-home-dashboard flex flex-1 flex-col gt-sm:flex-row",4,"ngIf"],[1,"flex","flex-row","items-start","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],[1,"tb-home-dashboard","flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(o,t){o&1&&(s(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"profile.profile"),r(),s(7,"span",4),p(8),r()(),s(9,"div",5)(10,"span",6),p(11,"profile.last-login-time"),r(),s(12,"span",7),p(13),c(14,"date"),r()()()(),v(15,CC,1,0,"mat-progress-bar",8),c(16,"async"),v(17,SC,1,0,"div",9),c(18,"async"),s(19,"mat-card-content",10)(20,"form",11),C("ngSubmit",function(){return t.save()}),s(21,"fieldset",12),c(22,"async"),s(23,"mat-form-field",13)(24,"mat-label",14),p(25,"user.email"),r(),g(26,"input",15),v(27,TC,3,3,"mat-error",16)(28,xC,3,3,"mat-error",16),r(),s(29,"mat-form-field",13)(30,"mat-label",14),p(31,"user.first-name"),r(),g(32,"input",17),r(),s(33,"mat-form-field",13)(34,"mat-label",14),p(35,"user.last-name"),r(),g(36,"input",18),r(),g(37,"tb-phone-input",19),c(38,"translate"),s(39,"mat-form-field",13)(40,"mat-label",14),p(41,"language.language"),r(),s(42,"mat-select",20),v(43,EC,3,4,"mat-option",21),r()(),v(44,IC,6,10,"section",22),s(45,"div",23)(46,"button",24),c(47,"async"),p(48),c(49,"translate"),r()()()()()()()),o&2&&(a(8),B(t.profile?t.profile.get("email").value:""),a(5),B(Yt(14,15,t.user==null||t.user.additionalInfo==null?null:t.user.additionalInfo.lastLoginTs,"yyyy-MM-dd HH:mm:ss")),a(2),m("ngIf",u(16,18,t.isLoading$)),a(2),m("ngIf",!u(18,20,t.isLoading$)),a(3),m("formGroup",t.profile),a(),m("disabled",u(22,22,t.isLoading$)),a(6),m("ngIf",t.profile.get("email").hasError("required")),a(),m("ngIf",t.profile.get("email").hasError("email")),a(9),x("label",u(38,24,"contact.phone")),m("required",!1)("enableFlagsSelect",!0),a(6),m("ngForOf",t.languageList),a(),m("ngIf",!t.isSysAdmin()),a(2),m("disabled",u(47,26,t.isLoading$)||t.profile.invalid||!t.profile.dirty),a(2),b(" ",u(49,28,"action.save")," "))},dependencies:[xe,U,ln,te,zt,Zt,ni,ui,Ue,be,de,Se,Fe,vt,gt,ue,he,W,X,fe,ne,le,J,oo,me,Oe,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{font-size:16px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-mdc-subheader[_ngcontent-%COMP%]{line-height:24px;color:#0000008a;font-size:14px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-last-login-ts[_ngcontent-%COMP%]{font-size:16px;font-weight:400}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']});let i=n;return i})();S();var ug=(()=>{let n=class n{constructor(e,o){this.store=e,this.userService=o}resolve(){let e=Pt(this.store).userId;return this.userService.getUser(e)}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Cn))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),fg=[{path:"profile",component:Al,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"profile.profile",breadcrumb:{label:"profile.profile",icon:"account_circle"}},resolve:{user:ug}}],wC=[{path:"profile",redirectTo:"account/profile"}],Nl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[ug],imports:[V.forChild(wC),V]});let i=n;return i})();(function(){Q(Nl,{imports:[V],exports:[V]})})();var kl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,Nl]});let i=n;return i})();(function(){Q(kl,{declarations:[Al],imports:[oe,ae,Nl]})})();S();S();S();S();var MC=["stepper"],DC=["canvas"];function FC(i,n){i&1&&g(0,"mat-progress-bar",28)}function PC(i,n){i&1&&g(0,"div",29)}function AC(i,n){i&1&&(s(0,"mat-icon"),p(1,"done"),r())}function NC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.totp-step-label"))}function kC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.verification-step-label"))}function OC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function BC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.activation-step-label"))}var Bl=(()=>{let n=class n extends nt{constructor(e,o,t,d,f){super(e,o,d),this.store=e,this.router=o,this.twoFaService=t,this.dialogRef=d,this.fb=f,this.twoFaService.generateTwoFaAccountConfig(yt.TOTP).subscribe(_=>{this.authAccountConfig=_,this.totpAuthURL=this.authAccountConfig.authUrl,this.authAccountConfig.useByDefault=!0,import("./chunk-A6NW3WEW.js").then(D=>{Ac(D).toCanvas(this.canvasRef.nativeElement,this.totpAuthURL),this.canvasRef.nativeElement.style.width="auto",this.canvasRef.nativeElement.style.height="auto"})}),this.totpConfigForm=this.fb.group({verificationCode:["",[T.required,T.minLength(6),T.maxLength(6),T.pattern(/^\d*$/)]]})}onSaveConfig(){this.totpConfigForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.totpConfigForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):Object.keys(this.totpConfigForm.controls).forEach(e=>{this.totpConfigForm.get(e).markAsTouched({onlySelf:!0})})}closeDialog(){return this.dialogRef.close(this.config)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Hi),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-totp-auth-dialog"]],viewQuery:function(o,t){if(o&1&&(we(MC,5),we(DC,5)),o&2){let d;Me(d=De())&&(t.stepper=d.first),Me(d=De())&&(t.canvasRef=d.first)}},features:[G],decls:55,vars:26,consts:[["stepper",""],["canvas",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],["matStepLabel",""],["translate","",1,"mat-body-2"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary","matStepperNext",""],[3,"stepControl"],[1,"flex","flex-col","items-center","justify-start",3,"ngSubmit","formGroup"],["translate","",1,"mat-body","qr-code-description"],["translate","",1,"mat-body","qr-code-description",2,"margin-top","30px"],[1,"mat-block","code-container","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",2)(1,"h2",3),p(2,"security.2fa.dialog.enable-totp-title"),r(),g(3,"span",4),s(4,"button",5),C("click",function(){return I(d),w(t.closeDialog())}),s(5,"mat-icon",6),p(6,"close"),r()()(),v(7,FC,1,0,"mat-progress-bar",7),c(8,"async"),v(9,PC,1,0,"div",8),c(10,"async"),s(11,"div",9)(12,"mat-stepper",10,0),v(14,AC,2,0,"ng-template",11),s(15,"mat-step"),v(16,NC,2,3,"ng-template",12),s(17,"div")(18,"p",13),p(19,"security.2fa.dialog.totp-step-description-open"),r(),s(20,"p",13),p(21,"security.2fa.dialog.totp-step-description-install"),r(),s(22,"div",14)(23,"button",15),p(24),c(25,"translate"),r()()()(),s(26,"mat-step",16),v(27,kC,2,3,"ng-template",12),s(28,"form",17),C("ngSubmit",function(){return I(d),w(t.onSaveConfig())}),s(29,"p",18),p(30,"security.2fa.dialog.scan-qr-code"),r(),g(31,"canvas",4,1),s(33,"p",19),p(34,"security.2fa.dialog.enter-verification-code"),r(),s(35,"mat-form-field",20),g(36,"input",21),c(37,"translate"),v(38,OC,3,3,"mat-error",22),r()(),s(39,"div",14)(40,"button",23),c(41,"async"),C("click",function(){return I(d),w(t.onSaveConfig())}),p(42),c(43,"translate"),r()()(),s(44,"mat-step"),v(45,BC,2,3,"ng-template",24),s(46,"div")(47,"h3",25),p(48,"security.2fa.dialog.success"),r(),s(49,"p",26),p(50,"security.2fa.dialog.activation-step-description-totp"),r(),s(51,"div",14)(52,"button",27),C("click",function(){return I(d),w(t.closeDialog())}),p(53),c(54,"translate"),r()()()()()()}o&2&&(a(7),m("ngIf",u(8,12,t.isLoading$)),a(2),m("ngIf",!u(10,14,t.isLoading$)),a(15),b(" ",u(25,16,"security.2fa.dialog.next")," "),a(2),m("stepControl",t.totpConfigForm),a(2),m("formGroup",t.totpConfigForm),a(3),Bi("display",t.totpAuthURL?"block":"none"),a(5),x("placeholder",u(37,18,"security.2fa.dialog.verification-code")),a(2),m("ngIf",t.totpConfigForm.get("verificationCode").invalid),a(2),m("disabled",u(41,20,t.isLoading$)||t.totpConfigForm.invalid),a(2),b(" ",u(43,22,"security.2fa.dialog.next")," "),a(11),b(" ",u(54,24,"action.done")," "))},dependencies:[U,Mi,te,Ie,re,Ue,be,de,Fe,at,dt,wn,En,Mn,vu,In,ue,he,W,X,fe,rn,na,ne,le,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']});let i=n;return i})();S();var RC=["stepper"],VC=i=>({address:i});function jC(i,n){i&1&&g(0,"mat-progress-bar",30)}function LC(i,n){i&1&&g(0,"div",31)}function GC(i,n){i&1&&(s(0,"mat-icon"),p(1,"done"),r())}function UC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.sms-step-label"))}function qC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.verification-step-label"))}function WC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function HC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.activation-step-label"))}var Rl=(()=>{let n=class n extends nt{constructor(e,o,t,d,f){super(e,o,d),this.store=e,this.router=o,this.twoFaService=t,this.dialogRef=d,this.fb=f,this.phoneNumberPattern=xa,this.smsConfigForm=this.fb.group({phone:["",[T.required,T.pattern(xa)]]}),this.smsVerificationForm=this.fb.group({verificationCode:["",[T.required,T.minLength(6),T.maxLength(6),T.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.smsConfigForm.valid?(this.authAccountConfig={providerType:yt.SMS,useByDefault:!0,phoneNumber:this.smsConfigForm.get("phone").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.smsConfigForm);break;case 1:this.smsVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.smsVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.smsVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(o=>{e.get(o).markAsTouched({onlySelf:!0})})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Hi),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-sms-auth-dialog"]],viewQuery:function(o,t){if(o&1&&we(RC,5),o&2){let d;Me(d=De())&&(t.stepper=d.first)}},features:[G],decls:58,vars:45,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-3.75"],["formControlName","phone",1,"flex-1",3,"floatLabel","placeholder"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-sms-title"),r(),g(3,"span",3),s(4,"button",4),C("click",function(){return I(d),w(t.closeDialog())}),s(5,"mat-icon",5),p(6,"close"),r()()(),v(7,jC,1,0,"mat-progress-bar",6),c(8,"async"),v(9,LC,1,0,"div",7),c(10,"async"),s(11,"div",8)(12,"mat-stepper",9,0),v(14,GC,2,0,"ng-template",10),s(15,"mat-step",11),v(16,UC,2,3,"ng-template",12),s(17,"form",13),C("ngSubmit",function(){return I(d),w(t.nextStep())}),s(18,"p",14),p(19,"security.2fa.dialog.sms-step-description"),r(),s(20,"div",15),g(21,"tb-phone-input",16),c(22,"translate"),s(23,"button",17),c(24,"async"),p(25),c(26,"translate"),r()()()(),s(27,"mat-step",11),v(28,qC,2,3,"ng-template",12),s(29,"form",13),C("ngSubmit",function(){return I(d),w(t.nextStep())}),s(30,"p",18),p(31),c(32,"translate"),r(),s(33,"div",19)(34,"mat-form-field",20),g(35,"input",21),c(36,"translate"),v(37,WC,3,3,"mat-error",22),r(),s(38,"div",23)(39,"button",24),c(40,"async"),p(41),c(42,"translate"),r(),s(43,"button",17),c(44,"async"),p(45),c(46,"translate"),r()()()()(),s(47,"mat-step"),v(48,HC,2,3,"ng-template",25),s(49,"div")(50,"h3",26),p(51,"security.2fa.dialog.success"),r(),s(52,"p",27),p(53,"security.2fa.dialog.activation-step-description-sms"),r(),s(54,"div",28)(55,"button",29),C("click",function(){return I(d),w(t.closeDialog())}),p(56),c(57,"translate"),r()()()()()()}o&2&&(a(7),m("ngIf",u(8,18,t.isLoading$)),a(2),m("ngIf",!u(10,20,t.isLoading$)),a(6),m("stepControl",t.smsConfigForm),a(2),m("formGroup",t.smsConfigForm),a(4),x("placeholder",u(22,22,"security.2fa.dialog.sms-step-label")),m("floatLabel","never"),a(2),m("disabled",u(24,24,t.isLoading$)||t.smsConfigForm.invalid),a(2),b(" ",u(26,26,"security.2fa.dialog.send-code")," "),a(2),m("stepControl",t.smsVerificationForm),a(2),m("formGroup",t.smsVerificationForm),a(2),b(" ",Yt(32,28,"security.2fa.dialog.verification-step-description",pt(43,VC,t.smsConfigForm.get("phone").value))," "),a(4),x("placeholder",u(36,31,"security.2fa.dialog.verification-code")),a(2),m("ngIf",t.smsVerificationForm.get("verificationCode").invalid),a(2),m("disabled",u(40,33,t.isLoading$)),a(2),b(" ",u(42,35,"action.back")," "),a(2),m("disabled",u(44,37,t.isLoading$)||t.smsVerificationForm.invalid),a(2),b(" ",u(46,39,"action.activate")," "),a(11),b(" ",u(57,41,"action.done")," "))},dependencies:[U,Mi,te,Ie,re,Ue,be,de,Fe,at,dt,wn,En,Mn,Jr,In,ue,he,W,X,fe,rn,na,ne,le,J,oo,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']});let i=n;return i})();S();var zC=["stepper"],$C=i=>({address:i});function JC(i,n){i&1&&g(0,"mat-progress-bar",31)}function QC(i,n){i&1&&g(0,"div",32)}function YC(i,n){i&1&&(s(0,"mat-icon"),p(1,"done"),r())}function KC(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.email-step-label"))}function XC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.email-required")," "))}function ZC(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.invalid-email-format")," "))}function e2(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.verification-step-label"))}function t2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function i2(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"security.2fa.dialog.activation-step-label"))}var Vl=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,f),this.store=e,this.router=o,this.twoFaService=t,this.data=d,this.dialogRef=f,this.fb=_,this.emailConfigForm=this.fb.group({email:[this.data.email,[T.required,T.email]]}),this.emailVerificationForm=this.fb.group({verificationCode:["",[T.required,T.minLength(6),T.maxLength(6),T.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.emailConfigForm.valid?(this.authAccountConfig={providerType:yt.EMAIL,useByDefault:!0,email:this.emailConfigForm.get("email").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.emailConfigForm);break;case 1:this.emailVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.emailVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.emailVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(o=>{e.get(o).markAsTouched({onlySelf:!0})})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Hi),h(At),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-email-auth-dialog"]],viewQuery:function(o,t){if(o&1&&we(zC,5),o&2){let d;Me(d=De())&&(t.stepper=d.first)}},features:[G],decls:61,vars:47,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],[3,"linear"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-2"],[1,"mat-block","input-container","flex-1"],["matInput","","formControlName","email","type","email","required","",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-email-title"),r(),g(3,"span",3),s(4,"button",4),C("click",function(){return I(d),w(t.closeDialog())}),s(5,"mat-icon",5),p(6,"close"),r()()(),v(7,JC,1,0,"mat-progress-bar",6),c(8,"async"),v(9,QC,1,0,"div",7),c(10,"async"),s(11,"div",8)(12,"mat-stepper",9,0),v(14,YC,2,0,"ng-template",10),s(15,"mat-step",11),v(16,KC,2,3,"ng-template",12),s(17,"form",13),C("ngSubmit",function(){return I(d),w(t.nextStep())}),s(18,"p",14),p(19,"security.2fa.dialog.email-step-description"),r(),s(20,"div",15)(21,"mat-form-field",16),g(22,"input",17),c(23,"translate"),v(24,XC,3,3,"mat-error",18)(25,ZC,3,3,"mat-error",18),r(),s(26,"button",19),c(27,"async"),p(28),c(29,"translate"),r()()()(),s(30,"mat-step",11),v(31,e2,2,3,"ng-template",12),s(32,"form",13),C("ngSubmit",function(){return I(d),w(t.nextStep())}),s(33,"p",20),p(34),c(35,"translate"),r(),s(36,"div",21)(37,"mat-form-field",22),g(38,"input",23),c(39,"translate"),v(40,t2,3,3,"mat-error",18),r(),s(41,"div",24)(42,"button",25),c(43,"async"),p(44),c(45,"translate"),r(),s(46,"button",19),c(47,"async"),p(48),c(49,"translate"),r()()()()(),s(50,"mat-step"),v(51,i2,2,3,"ng-template",26),s(52,"div")(53,"h3",27),p(54,"security.2fa.dialog.success"),r(),s(55,"p",28),p(56,"security.2fa.dialog.activation-step-description-email"),r(),s(57,"div",29)(58,"button",30),C("click",function(){return I(d),w(t.closeDialog())}),p(59),c(60,"translate"),r()()()()()()}o&2&&(a(7),m("ngIf",u(8,20,t.isLoading$)),a(2),m("ngIf",!u(10,22,t.isLoading$)),a(3),m("linear",!0),a(3),m("stepControl",t.emailConfigForm),a(2),m("formGroup",t.emailConfigForm),a(5),x("placeholder",u(23,24,"security.2fa.dialog.email-step-label")),a(2),m("ngIf",t.emailConfigForm.get("email").hasError("required")),a(),m("ngIf",t.emailConfigForm.get("email").hasError("email")),a(),m("disabled",u(27,26,t.isLoading$)||t.emailConfigForm.invalid),a(2),b(" ",u(29,28,"security.2fa.dialog.send-code")," "),a(2),m("stepControl",t.emailVerificationForm),a(2),m("formGroup",t.emailVerificationForm),a(2),b(" ",Yt(35,30,"security.2fa.dialog.verification-step-description",pt(45,$C,t.emailConfigForm.get("email").value))," "),a(4),x("placeholder",u(39,33,"security.2fa.dialog.verification-code")),a(2),m("ngIf",t.emailVerificationForm.get("verificationCode").invalid),a(2),m("disabled",u(43,35,t.isLoading$)),a(2),b(" ",u(45,37,"action.back")," "),a(2),m("disabled",u(47,39,t.isLoading$)||t.emailVerificationForm.invalid),a(2),b(" ",u(49,41,"action.activate")," "),a(11),b(" ",u(60,43,"action.done")," "))},dependencies:[U,Mi,te,Ie,re,Ue,be,de,Fe,at,dt,wn,En,Mn,Jr,In,ue,he,W,X,fe,rn,na,ne,le,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']});let i=n;return i})();S();var gg=`<html lang="en">
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Backup code</title>

    <style>
        .code-block {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        .code-row {
            margin: 0 6px 8px;
            display: flex;
            min-width: 130px;
        }
        .code {
            font: 400 16px / 20px Roboto Mono, "Helvetica Neue", monospace;
            margin-left: 6px;
        }
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1em;
            height: 1em;
            border: 0.1em solid currentColor;
            border-radius: 0.15em;
            transform: translateY(0em);
        }
    </style>
</head>

<body style="margin: 0">
    <div style="margin: 8px; max-width: 286px">
        <div style="border: #d0d7de solid 1px; border-radius:4px">
            <h3 style="padding: 16px 24px; margin: 0; font: 500 20px / 24px Roboto, 'Helvetica Neue', sans-serif; text-align: center">
                Backup codes
            </h3>
            <div class="code-block">
                \${codesBlock}
            </div>
        </div>
    </div>
</body>
</html>
`;function o2(i,n){i&1&&g(0,"mat-progress-bar",15)}function a2(i,n){i&1&&g(0,"div",16)}function r2(i,n){if(i&1&&(s(0,"div",17),p(1),r()),i&2){let l=n.$implicit,e=n.even;j("even",e),a(),b(" ",l," ")}}var jl=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,f),this.store=e,this.router=o,this.twoFaService=t,this.importExportService=d,this.dialogRef=f,this.fb=_,this.twoFaService.generateTwoFaAccountConfig(yt.BACKUP_CODE).pipe(Ot(D=>this.backupCode=D),_t(D=>this.twoFaService.verifyAndSaveTwoFaAccountConfig(D,null,{ignoreLoading:!0}))).subscribe(D=>{this.config=D})}closeDialog(){this.dialogRef.close(this.config)}downloadFile(){this.importExportService.exportText(this.backupCode.codes,"backup-codes")}printCode(){let e=Tt(this.backupCode.codes).map(d=>`<div class="code-row"><input type="checkbox"><span class="code">${d}</span></div>`).join(""),o=gg.replace("${codesBlock}",e),t=window.open("","Print backup code");t.document.open(),t.document.write(o),setTimeout(()=>{t.print(),t.document.close(),setTimeout(()=>{t.close()},10)},0)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(Hi),h(Pi),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-backup-code-auth-dialog"]],features:[G],decls:29,vars:16,consts:[["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",1,"backup-code"],["translate","",1,"mat-body-2","description"],[1,"container","flex","flex-row","flex-wrap"],["class","code max-w-50% flex-full",3,"even",4,"ngFor","ngForOf"],[1,"action-buttons","flex","flex-row","items-center","justify-start","gap-4"],["type","button","mat-stroked-button","","color","primary",3,"click"],["type","button","mat-raised-button","","color","primary",3,"click"],[1,"flex","flex-row","items-start","justify-end"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"code","max-w-50%","flex-full"]],template:function(o,t){o&1&&(s(0,"mat-toolbar",0)(1,"h2",1),p(2,"security.2fa.dialog.get-backup-code-title"),r(),g(3,"span",2),s(4,"button",3),C("click",function(){return t.closeDialog()}),s(5,"mat-icon",4),p(6,"close"),r()()(),v(7,o2,1,0,"mat-progress-bar",5),c(8,"async"),v(9,a2,1,0,"div",6),c(10,"async"),s(11,"div",7)(12,"p",8),p(13,"security.2fa.dialog.backup-code-description"),r(),s(14,"div",9),v(15,r2,2,3,"div",10),r(),s(16,"div",11)(17,"button",12),C("click",function(){return t.downloadFile()}),p(18),c(19,"translate"),r(),s(20,"button",13),C("click",function(){return t.printCode()}),p(21),c(22,"translate"),r()(),s(23,"p",8),p(24,"security.2fa.dialog.backup-code-warn"),r(),s(25,"div",14)(26,"button",13),C("click",function(){return t.closeDialog()}),p(27),c(28,"translate"),r()()()),o&2&&(a(7),m("ngIf",u(8,6,t.isLoading$)),a(2),m("ngIf",!u(10,8,t.isLoading$)),a(6),m("ngForOf",t.backupCode==null?null:t.backupCode.codes),a(3),b(" ",u(19,10,"security.2fa.dialog.download-txt")," "),a(3),b(" ",u(22,12,"action.print")," "),a(6),b(" ",u(28,14,"action.done")," "))},dependencies:[xe,U,Mi,te,Ie,re,Ue,at,dt,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']});let i=n;return i})();var hg=new Map([[yt.TOTP,Bl],[yt.SMS,Rl],[yt.EMAIL,Vl],[yt.BACKUP_CODE,jl]]);var Va=i=>({count:i});function s2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.password-requirement.incorrect-password-try-again")," "))}function l2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.password-requirement.password-not-meet-requirements")," "))}function m2(i,n){if(i&1&&(s(0,"mat-error"),p(1),r()),i&2){let l=y();a(),b(" ",l.changePassword.get("newPassword").getError("alreadyUsed")," ")}}function p2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.password-requirement.password-should-difference")," "))}function d2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.password-requirement.password-should-not-contain-spaces")," "))}function c2(i,n){i&1&&Rt(0)}function u2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"security.password-requirement.new-passwords-not-match")," "))}function f2(i,n){i&1&&Rt(0)}function g2(i,n){if(i&1&&(s(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),c(4,"translate"),r()),i&2){let l=y(3);a(2),b(" ",l.changePassword.get("newPassword").hasError("notUpperCase")?"mdi:circle-small":"mdi:check"," "),a(),b(" ",Yt(4,2,"security.password-requirement.uppercase-letter",pt(5,Va,l.passwordPolicy.minimumUppercaseLetters))," ")}}function h2(i,n){if(i&1&&(s(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),c(4,"translate"),r()),i&2){let l=y(3);a(2),b(" ",l.changePassword.get("newPassword").hasError("notLowerCase")?"mdi:circle-small":"mdi:check"," "),a(),b(" ",Yt(4,2,"security.password-requirement.lowercase-letter",pt(5,Va,l.passwordPolicy.minimumLowercaseLetters))," ")}}function b2(i,n){if(i&1&&(s(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),c(4,"translate"),r()),i&2){let l=y(3);a(2),b(" ",l.changePassword.get("newPassword").hasError("notNumeric")?"mdi:circle-small":"mdi:check"," "),a(),b(" ",Yt(4,2,"security.password-requirement.digit",pt(5,Va,l.passwordPolicy.minimumDigits))," ")}}function v2(i,n){if(i&1&&(s(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),c(4,"translate"),r()),i&2){let l=y(3);a(2),b(" ",l.changePassword.get("newPassword").hasError("notSpecial")?"mdi:circle-small":"mdi:check"," "),a(),b(" ",Yt(4,2,"security.password-requirement.special-character",pt(5,Va,l.passwordPolicy.minimumSpecialCharacters))," ")}}function y2(i,n){if(i&1&&(s(0,"p",37)(1,"tb-icon",38),p(2),r(),p(3),c(4,"translate"),r()),i&2){let l=y(3);a(2),b(" ",l.changePassword.get("newPassword").hasError("minLength")?"mdi:circle-small":"mdi:check"," "),a(),b(" ",Yt(4,2,"security.password-requirement.character",pt(5,Va,l.passwordPolicy.minimumLength))," ")}}function _2(i,n){if(i&1&&(s(0,"div",34)(1,"h4",35),p(2,"security.password-requirement.at-most"),r(),s(3,"p",37),g(4,"mat-icon",39),p(5),c(6,"translate"),r()()),i&2){let l=y(3);a(4),m("svgIcon",l.changePassword.get("newPassword").hasError("maxLength")?"mdi:circle-small":"mdi:check"),a(),b(" ",Yt(6,2,"security.password-requirement.character",pt(5,Va,l.passwordPolicy.maximumLength))," ")}}function C2(i,n){if(i&1&&(s(0,"div",34)(1,"h3",15),p(2,"security.password-requirement.password-requirements"),r(),s(3,"h4",35),p(4,"security.password-requirement.at-least"),r(),v(5,g2,5,7,"p",36)(6,h2,5,7,"p",36)(7,b2,5,7,"p",36)(8,v2,5,7,"p",36)(9,y2,5,7,"p",36)(10,_2,7,7,"div",33),r()),i&2){let l=y(2);a(5),m("ngIf",l.passwordPolicy.minimumUppercaseLetters>0),a(),m("ngIf",l.passwordPolicy.minimumLowercaseLetters>0),a(),m("ngIf",l.passwordPolicy.minimumDigits>0),a(),m("ngIf",l.passwordPolicy.minimumSpecialCharacters>0),a(),m("ngIf",l.passwordPolicy.minimumLength>0),a(),m("ngIf",l.passwordPolicy.maximumLength>0)}}function S2(i,n){if(i&1&&v(0,C2,11,6,"div",33),i&2){let l=y();m("ngIf",l.passwordPolicy)}}function T2(i,n){if(i&1&&(s(0,"div",54),p(1),c(2,"translate"),r()),i&2){let l=y().$implicit,e=y(2);a(),b(" ",u(2,1,e.providersData.get(l).description)," ")}}function x2(i,n){if(i&1&&(s(0,"div",54),p(1),c(2,"translate"),r()),i&2){let l=y().$implicit,e=y(2);a(),b(" ",Yt(2,1,e.providersData.get(l).activatedHint,e.providerDataInfo(l))," ")}}function E2(i,n){if(i&1){let l=L();s(0,"mat-checkbox",55),c(1,"async"),C("change",function(o){I(l);let t=y().$implicit,d=y(2);return w(d.changeDefaultProvider(o,t))}),s(2,"span",56),p(3,"security.2fa.main-2fa-method"),r()()}if(i&2){let l=y().$implicit,e=y(2);m("value",l)("checked",e.useByDefault===l)("disabled",u(1,3,e.isLoading$))}}function I2(i,n){if(i&1){let l=L();s(0,"button",57),C("click",function(){I(l);let o=y(3);return w(o.generateNewBackupCode())}),p(1),c(2,"translate"),r()}i&2&&(a(),b(" ",u(2,1,"security.2fa.get-new-code")," "))}function w2(i,n){i&1&&g(0,"mat-divider")}function M2(i,n){if(i&1){let l=L();Lt(0),s(1,"div",47)(2,"h4",48),p(3),c(4,"translate"),r(),s(5,"div",49),v(6,T2,3,3,"div",50)(7,x2,3,4,"ng-template",null,2,Et),s(9,"mat-slide-toggle",51),C("mousedown",function(o){let t=I(l).$implicit,d=y(2);return w(d.confirm2FAChange(o,t))}),r()(),v(10,E2,4,5,"mat-checkbox",52)(11,I2,3,3,"button",53),r(),v(12,w2,1,0,"mat-divider",20),Gt()}if(i&2){let l=n.$implicit,e=n.last,o=q(8),t=y(2);a(3),B(u(4,7,t.providersData.get(l).name)),a(3),m("ngIf",!t.twoFactorAuth.get(l).value)("ngIfElse",o),a(3),m("formControlName",l),a(),m("ngIf",t.twoFactorAuth.get(l).value&&l!==t.twoFactorAuthProviderType.BACKUP_CODE&&!t.activeSingleProvider),a(),m("ngIf",t.twoFactorAuth.get(l).value&&l===t.twoFactorAuthProviderType.BACKUP_CODE),a(),m("ngIf",!e)}}function D2(i,n){if(i&1&&(s(0,"mat-card",40)(1,"mat-card-title",41)(2,"span",6),p(3,"admin.2fa.2fa"),r()(),s(4,"mat-card-subtitle",42)(5,"div",43),p(6,"security.2fa.2fa-description"),r()(),s(7,"h3",44),p(8,"security.2fa.authenticate-with"),r(),s(9,"form",45),v(10,M2,13,9,"ng-container",46),r()()),i&2){let l=y();a(9),m("formGroup",l.twoFactorAuth),a(),m("ngForOf",l.allowTwoFactorProviders)("ngForTrackBy",l.trackByProvider)}}var Ll=(()=>{let n=class n extends It{get jwtToken(){return`Bearer ${localStorage.getItem("jwt_token")}`}get jwtTokenExpiration(){return localStorage.getItem("jwt_token_expiration")}get expirationJwtData(){let e=this.datePipe.transform(this.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss");return this.translate.instant("profile.valid-till",{expirationData:e})}constructor(e,o,t,d,f,_,D,M,Y,ke){super(e),this.store=e,this.route=o,this.translate=t,this.twoFaService=d,this.dialog=f,this.dialogService=_,this.fb=D,this.datePipe=M,this.authService=Y,this.clipboardService=ke,this.destroy$=new Ft,this.allowTwoFactorProviders=[],this.providersData=Cs,this.twoFactorAuthProviderType=yt,this.useByDefault=null,this.activeSingleProvider=!0}ngOnInit(){this.buildTwoFactorForm(),this.user=this.route.snapshot.data.user,this.twoFactorLoad(this.route.snapshot.data.providers),this.buildChangePasswordForm(),this.loadPasswordPolicy()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildTwoFactorForm(){this.twoFactorAuth=this.fb.group({TOTP:[!1],SMS:[!1],EMAIL:[!1],BACKUP_CODE:[{value:!1,disabled:!0}]}),this.twoFactorAuth.valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{let o=Object.keys(e).filter(t=>e[t]&&t!==yt.BACKUP_CODE);this.activeSingleProvider=o.length<2,o.length?this.twoFactorAuth.get("BACKUP_CODE").enable({emitEvent:!1}):this.twoFactorAuth.get("BACKUP_CODE").disable({emitEvent:!1})})}twoFactorLoad(e){e.length&&(this.twoFaService.getAccountTwoFaSettings().subscribe(o=>this.processTwoFactorAuthConfig(o)),Object.values(yt).forEach(o=>{e.includes(o)&&this.allowTwoFactorProviders.push(o)}))}processTwoFactorAuthConfig(e){this.accountConfig=e?.configs||{},Object.values(yt).forEach(o=>{this.accountConfig[o]?(this.twoFactorAuth.get(o).setValue(!0),this.accountConfig[o].useByDefault&&(this.useByDefault=o)):this.twoFactorAuth.get(o).setValue(!1)})}buildChangePasswordForm(){this.changePassword=this.fb.group({currentPassword:[""],newPassword:["",T.required],newPassword2:["",this.samePasswordValidation(!1,"newPassword")]})}loadPasswordPolicy(){this.authService.getUserPasswordPolicy().subscribe(e=>{this.passwordPolicy=e,this.changePassword.get("newPassword").setValidators([this.passwordStrengthValidator(),this.samePasswordValidation(!0,"currentPassword"),T.required]),this.changePassword.get("newPassword").updateValueAndValidity({emitEvent:!1})})}passwordStrengthValidator(){return e=>{let o=e.value,t={};return this.passwordPolicy.minimumUppercaseLetters>0&&!new RegExp(`(?:.*?[A-Z]){${this.passwordPolicy.minimumUppercaseLetters}}`).test(o)&&(t.notUpperCase=!0),this.passwordPolicy.minimumLowercaseLetters>0&&!new RegExp(`(?:.*?[a-z]){${this.passwordPolicy.minimumLowercaseLetters}}`).test(o)&&(t.notLowerCase=!0),this.passwordPolicy.minimumDigits>0&&!new RegExp(`(?:.*?\\d){${this.passwordPolicy.minimumDigits}}`).test(o)&&(t.notNumeric=!0),this.passwordPolicy.minimumSpecialCharacters>0&&!new RegExp(`(?:.*?[\\W_]){${this.passwordPolicy.minimumSpecialCharacters}}`).test(o)&&(t.notSpecial=!0),!this.passwordPolicy.allowWhitespaces&&/\s/.test(o)&&(t.hasWhitespaces=!0),this.passwordPolicy.minimumLength>0&&o.length<this.passwordPolicy.minimumLength&&(t.minLength=!0),(!o.length||this.passwordPolicy.maximumLength>0&&o.length>this.passwordPolicy.maximumLength)&&(t.maxLength=!0),Nr(t,{})?null:t}}samePasswordValidation(e,o){return t=>{let d=t.value,f=t.parent?.value[o];return e?d===f?{samePassword:!0}:null:d!==f?{differencePassword:!0}:null}}trackByProvider(e,o){return o}copyToken(){+this.jwtTokenExpiration<Date.now()?this.store.dispatch(new ze({message:this.translate.instant("profile.tokenCopiedWarnMessage"),type:"warn",duration:1500,verticalPosition:"bottom",horizontalPosition:"right"})):(this.clipboardService.copyFromContent(this.jwtToken),this.store.dispatch(new ze({message:this.translate.instant("profile.tokenCopiedSuccessMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"})))}confirm2FAChange(e,o){if(e.stopPropagation(),e.preventDefault(),!this.twoFactorAuth.get(o).disabled)if(this.twoFactorAuth.get(o).value){let t=this.translate.instant(`security.2fa.provider.${o.toLowerCase()}`);this.dialogService.confirm(this.translate.instant("security.2fa.disable-2fa-provider-title",{name:t}),this.translate.instant("security.2fa.disable-2fa-provider-text",{name:t})).subscribe(d=>{d&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(o).pipe(Ot(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(f=>this.processTwoFactorAuthConfig(f)))})}else this.createdNewAuthConfig(o)}createdNewAuthConfig(e){let o=e===yt.EMAIL?{email:this.user.email}:{};this.dialog.open(hg.get(e),{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:o}).afterClosed().subscribe(t=>{Be(t)&&this.processTwoFactorAuthConfig(t)})}changeDefaultProvider(e,o){this.useByDefault!==o?(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.updateTwoFaAccountConfig(o,!0).pipe(Ot(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(t=>this.processTwoFactorAuthConfig(t))):e.source.checked=!0}generateNewBackupCode(){let e=this.accountConfig[yt.BACKUP_CODE].codesLeft,o;e?o=this.dialogService.confirm("Get new set of backup codes?",`If you get new backup codes, ${e} remaining codes you have left will be unusable.`,"","Get new codes"):o=Ct(!0),o.subscribe(t=>{t&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(yt.BACKUP_CODE).pipe(Ot(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(()=>this.createdNewAuthConfig(yt.BACKUP_CODE)))})}providerDataInfo(e){let o={info:null},t=this.accountConfig[e];if(Be(t))switch(e){case yt.EMAIL:o.info=t.email;break;case yt.SMS:o.info=t.phoneNumber;break;case yt.BACKUP_CODE:o.info=t.codesLeft;break}return o}onChangePassword(e){this.changePassword.valid?this.authService.changePassword(this.changePassword.get("currentPassword").value,this.changePassword.get("newPassword").value,{ignoreErrors:!0}).subscribe(()=>{this.discardChanges(e)},o=>{o.status===400&&o.error.message==="Current password doesn't match!"?this.changePassword.get("currentPassword").setErrors({differencePassword:!0}):o.status===400&&o.error.message.startsWith("Password must")?this.loadPasswordPolicy():o.status===400&&o.error.message.startsWith("Password was already used")?this.changePassword.get("newPassword").setErrors({alreadyUsed:o.error.message}):this.store.dispatch(new ze({message:o.error.message,type:"error",target:"changePassword"}))}):this.changePassword.markAllAsTouched()}discardChanges(e,o){o&&o.stopPropagation(),e.resetForm({currentPassword:"",newPassword:"",newPassword2:""})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Ri),h(ee),h(Hi),h(je),h(Wt),h(ce),h(Oe),h(Zn),h(Iu))},n.\u0275cmp=F({type:n,selectors:[["tb-security"]],features:[G],decls:63,vars:41,consts:[["changePasswordForm","ngForm"],["passwordRequirements",""],["providerInfo",""],[1,"profile-container","flex","flex-col","gap-2"],["appearance","outlined",1,"profile-card","flex","flex-col"],[2,"margin-bottom","8px"],["translate","",1,"mat-headline-5","card-title"],[1,"flex","flex-row","items-center","justify-between"],[1,"token-text"],[1,"date"],["mat-raised-button","","color","primary","type","button",3,"click"],["tb-toast","","toastTarget","changePassword",1,"change-password"],[3,"ngSubmit","formGroup"],[1,"flex","flex-row","gap-6.25","xs:flex-col","xs:gap-0"],[1,"min-w-72.5","max-w-72.5","flex-1","basis-72.5","xs:min-w-0","xs:max-w-full","xs:basis-full","sm:min-w-62.5","sm:max-w-62.5","sm:basis-62.5"],["translate","",1,"card-title"],["appearance","fill","color","primary",1,"mat-block","same-color"],["translate",""],["matInput","","type","password","name","current-password","formControlName","currentPassword","autocomplete","current-password"],["matSuffix",""],[4,"ngIf"],["hideRequiredMarker","","appearance","fill","color","primary","subscriptSizing","dynamic",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword","autocomplete","new-password","required",""],[1,"flex","flex-1","items-center","justify-start","gt-xs:!hidden"],[4,"ngTemplateOutlet"],["hideRequiredMarker","","appearance","fill","color","primary",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword2","autocomplete","new-password","required",""],[3,"vertical"],[1,"flex","flex-1","items-start","justify-start","xs:!hidden"],[1,"flex","flex-row","gap-2",2,"margin-top","18px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined","class","profile-card",4,"ngIf"],["class","password-requirements",4,"ngIf"],[1,"password-requirements"],["translate","",1,"mat-h4"],["class","mat-body",4,"ngIf"],[1,"mat-body"],[1,"tb-mat-20"],[1,"tb-mat-20",3,"svgIcon"],["appearance","outlined",1,"profile-card"],[2,"margin-bottom","20px"],[2,"margin-bottom","40px"],["translate","",1,"mat-body-2","description"],["translate","",1,"mat-h3","auth-title"],[3,"formGroup"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"provider"],[1,"provider-title"],[1,"flex","flex-row","items-start","justify-between"],["class","mat-body-2 description",4,"ngIf","ngIfElse"],[3,"mousedown","formControlName"],[3,"value","checked","disabled","change",4,"ngIf"],["type","button","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"mat-body-2","description"],[3,"change","value","checked","disabled"],["translate","",1,"checkbox-label"],["type","button","mat-stroked-button","","color","primary",3,"click"]],template:function(o,t){if(o&1){let d=L();s(0,"div",3)(1,"mat-card",4)(2,"mat-card-title",5)(3,"span",6),p(4,"profile.jwt-token"),r()(),s(5,"div",7)(6,"div",8),p(7),c(8,"translate"),s(9,"span",9),p(10),c(11,"date"),r()(),s(12,"button",10),C("click",function(){return I(d),w(t.copyToken())}),s(13,"span"),p(14),c(15,"translate"),r()()()(),s(16,"mat-card",4)(17,"div",11)(18,"form",12,0),C("ngSubmit",function(){I(d);let _=q(19);return w(t.onChangePassword(_))}),s(20,"div",13)(21,"div",14)(22,"h3",15),p(23,"profile.change-password"),r(),s(24,"mat-form-field",16)(25,"mat-label",17),p(26,"profile.current-password"),r(),g(27,"input",18)(28,"tb-toggle-password",19),v(29,s2,3,3,"mat-error",20),r(),s(30,"mat-form-field",21)(31,"mat-label",17),p(32,"login.new-password"),r(),g(33,"input",22)(34,"tb-toggle-password",19)(35,"mat-hint"),v(36,l2,3,3,"mat-error",20)(37,m2,2,1,"mat-error",20)(38,p2,3,3,"mat-error",20)(39,d2,3,3,"mat-error",20),r(),s(40,"div",23),v(41,c2,1,0,"ng-container",24),r(),s(42,"mat-form-field",25)(43,"mat-label",17),p(44,"login.new-password-again"),r(),g(45,"input",26)(46,"tb-toggle-password",19),v(47,u2,3,3,"mat-error",20),r()(),g(48,"mat-divider",27),s(49,"div",28),v(50,f2,1,0,"ng-container",24),r()(),v(51,S2,1,1,"ng-template",null,1,Et),s(53,"div",29)(54,"button",30),c(55,"async"),C("click",function(_){I(d);let D=q(19);return w(t.discardChanges(D,_))}),p(56),c(57,"translate"),r(),s(58,"button",31),c(59,"async"),p(60),c(61,"translate"),r()()()()(),v(62,D2,11,3,"mat-card",32),r()}if(o&2){let d=q(52);a(7),b("",u(8,26,"profile.token-valid-till")," "),a(3),B(Yt(11,28,t.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss")),a(4),B(u(15,31,"profile.copy-jwt-token")),a(4),m("formGroup",t.changePassword),a(10),j("!hidden",!t.changePassword.get("currentPassword").dirty&&!t.changePassword.get("currentPassword").touched),a(),m("ngIf",t.changePassword.get("currentPassword").hasError("differencePassword")),a(5),j("!hidden",!t.changePassword.get("newPassword").dirty&&!t.changePassword.get("newPassword").touched),a(2),m("ngIf",t.changePassword.get("newPassword").errors&&!t.changePassword.get("newPassword").hasError("alreadyUsed")&&!t.changePassword.get("newPassword").hasError("hasWhitespaces")&&!t.changePassword.get("newPassword").hasError("samePassword")),a(),m("ngIf",t.changePassword.get("newPassword").hasError("alreadyUsed")),a(),m("ngIf",t.changePassword.get("newPassword").hasError("samePassword")),a(),m("ngIf",t.changePassword.get("newPassword").hasError("hasWhitespaces")),a(2),m("ngTemplateOutlet",d),a(5),j("!hidden",!t.changePassword.get("newPassword2").dirty&&!t.changePassword.get("newPassword2").touched),a(),m("ngIf",t.changePassword.get("newPassword2").hasError("differencePassword")),a(),m("vertical",!0),a(2),m("ngTemplateOutlet",d),a(3),j("!hidden",!t.changePassword.dirty&&!t.changePassword.touched),a(),m("disabled",u(55,33,t.isLoading$)),a(2),b(" ",u(57,35,"action.discard-changes")," "),a(2),m("disabled",u(59,37,t.isLoading$)),a(2),b(" ",u(61,39,"profile.change-password")," "),a(2),m("ngIf",t.allowTwoFactorProviders.length)}},dependencies:[xe,U,Qn,Mi,te,zt,re,Zt,su,ci,be,de,Se,Kt,Fe,Xt,sn,ht,ue,he,W,X,fe,ne,le,J,vs,bi,me,Oe,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .profile-container[_ngcontent-%COMP%]{padding:8px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{padding:24px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:55%}}@media screen and (min-width: 1920px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.15px;margin-top:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-h4[_ngcontent-%COMP%]{font-weight:500;font-size:14px;letter-spacing:.25px;margin:0 0 4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-divider.mat-divider-vertical[_ngcontent-%COMP%]{margin-bottom:25px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .password-requirements[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:0 0 8px;letter-spacing:.25px;color:#000000de}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-icon[data-mat-icon-name=check][_ngcontent-%COMP%]{color:#24a148}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{font-weight:500;margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%] > .date[_ngcontent-%COMP%]{opacity:.7}[_nghost-%COMP%]   .description[_ngcontent-%COMP%]{color:#0000008a;letter-spacing:.25px;margin-right:8px}[_nghost-%COMP%]   .mat-divider-horizontal[_ngcontent-%COMP%]{left:16px;right:16px;width:auto}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]{padding:24px 0}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .provider-title[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;margin:0 0 8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{max-width:85%}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.25px;opacity:.87}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-outlined-button[_ngcontent-%COMP%]{margin-top:8px}']});let i=n;return i})();S();var bg=(()=>{let n=class n{constructor(e,o){this.store=e,this.userService=o}resolve(){let e=Pt(this.store).userId;return this.userService.getUser(e)}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Cn))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),vg=(()=>{let n=class n{constructor(e){this.twoFactorAuthService=e}resolve(){return this.twoFactorAuthService.getAvailableTwoFaProviders()}};n.\u0275fac=function(o){return new(o||n)(P(Hi))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),yg=[{path:"security",component:Ll,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"security.security",breadcrumb:{label:"security.security",icon:"lock"}},resolve:{user:bg,providers:vg}}],F2=[{path:"security",redirectTo:"/account/security"}],Gl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[bg,vg],imports:[V.forChild(F2),V]});let i=n;return i})();(function(){Q(Gl,{imports:[V],exports:[V]})})();var Ul=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,Gl]});let i=n;return i})();(function(){Q(Ul,{declarations:[Ll,Bl,Rl,Vl,jl],imports:[oe,ae,Gl]})})();S();S();S();var ql=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,o,t,d,f),this.store=e,this.fb=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.cd=f,this.countryData=_,this.destroyRef=Ut(ft)}buildForm(e){let o=this.buildEntityForm(e);return o.addControl("country",this.fb.control(e?e.country:"",[T.maxLength(255)])),o.addControl("city",this.fb.control(e?e.city:"",[T.maxLength(255)])),o.addControl("state",this.fb.control(e?e.state:"",[T.maxLength(255)])),o.addControl("zip",this.fb.control(e?e.zip:"",this.zipValidators(e?e.country:""))),o.addControl("address",this.fb.control(e?e.address:"",[])),o.addControl("address2",this.fb.control(e?e.address2:"",[])),o.addControl("phone",this.fb.control(e?e.phone:"",[T.maxLength(255)])),o.addControl("email",this.fb.control(e?e.email:"",[T.email])),o}updateForm(e){this.updateEntityForm(e),this.entityForm.patchValue({country:e.country}),this.entityForm.patchValue({city:e.city}),this.entityForm.patchValue({state:e.state}),this.entityForm.get("zip").setValidators(this.zipValidators(e.country)),this.entityForm.patchValue({zip:e.zip}),this.entityForm.patchValue({address:e.address}),this.entityForm.patchValue({address2:e.address2}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({email:e.email})}ngAfterViewInit(){this.entityForm.get("country").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.entityForm.get("zip").setValidators(this.zipValidators(e)),this.entityForm.get("zip").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("zip").markAsTouched({onlySelf:!0})})}zipValidators(e){let o=[];if(e){let t=this.countryData.allCountries.find(d=>d.name===e)?.postCodePattern;t&&o.push(T.pattern(t))}return o}};n.\u0275fac=function(o){mc()},n.\u0275dir=_r({type:n,features:[G]});let i=n;return i})();function N2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"tenant.title-required")," "))}function k2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"tenant.title-max-length")," "))}function O2(i,n){if(i&1&&(s(0,"section",17)(1,"section",18),g(2,"tb-dashboard-autocomplete",19),c(3,"translate"),s(4,"mat-checkbox",20),p(5),c(6,"translate"),r()()()),i&2){let l=y();a(2),x("label",u(3,5,"dashboard.home-dashboard")),m("dashboardsScope","tenant")("tenantId",l.entity==null?null:l.entity.id.id)("selectFirstDashboard",!1),a(3),b(" ",u(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Wl=(()=>{let n=class n extends ql{constructor(e,o,t,d,f,_,D){super(e,f,t,d,_,D),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.countryData=D}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[T.required,T.maxLength(255)]],tenantProfileId:[e?e.tenantProfileId:null,[T.required]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({tenantProfileId:e.tenantProfileId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}updateFormState(){this.entityForm&&(this.isEditValue?this.entityForm.enable({emitEvent:!1}):this.entityForm.disable({emitEvent:!1}))}onTenantIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("tenant.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onTenantProfileUpdated(){this.entitiesTableConfig.updateData(!1)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je),h(hs))},n.\u0275cmp=F({type:n,selectors:[["tb-tenant"]],features:[G],decls:36,vars:38,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["required","","formControlName","tenantProfileId",3,"tenantProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"manageTenantAdmins")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(11),c(12,"translate"),r(),s(13,"div",2)(14,"button",3),C("cbOnSuccess",function(f){return t.onTenantIdCopied(f)}),g(15,"mat-icon",4),s(16,"span",5),p(17,"tenant.copyId"),r()()()(),s(18,"div",6)(19,"form",7)(20,"fieldset",8),c(21,"async"),s(22,"mat-form-field",9)(23,"mat-label",5),p(24,"tenant.title"),r(),g(25,"input",10),v(26,N2,3,3,"mat-error",11)(27,k2,3,3,"mat-error",11),r(),s(28,"tb-tenant-profile-autocomplete",12),C("tenantProfileUpdated",function(){return t.onTenantProfileUpdated()}),r(),s(29,"div",13)(30,"mat-form-field",9)(31,"mat-label",5),p(32,"tenant.description"),r(),g(33,"textarea",14),r(),v(34,O2,7,9,"section",15),r(),g(35,"tb-contact",16),r()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,24,t.isLoading$)),a(2),b(" ",u(4,26,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(6,28,t.isLoading$)),a(2),b(" ",u(8,30,"tenant.manage-tenant-admins")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(10,32,t.isLoading$)),a(2),b(" ",u(12,34,"tenant.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),m("formGroup",t.entityForm),a(),m("disabled",u(21,36,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("title").hasError("required")),a(),m("ngIf",t.entityForm.get("title").hasError("maxlength")),a(),m("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),a(6),m("ngIf",t.entity==null?null:t.entity.id),a(),m("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[U,ln,te,zt,re,be,de,Se,Fe,Jt,ue,he,W,X,fe,ne,le,bt,J,bs,Ef,me,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']});let i=n;return i})();S();S();S();function B2(i,n){if(i&1&&(s(0,"mat-tab",6,0),c(2,"translate"),g(3,"tb-attribute-table",7),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function R2(i,n){if(i&1&&(s(0,"mat-tab",6,1),c(2,"translate"),g(3,"tb-attribute-table",8),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function V2(i,n){if(i&1&&(s(0,"mat-tab",6,2),c(2,"translate"),g(3,"tb-alarm-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function j2(i,n){if(i&1&&(s(0,"mat-tab",6,3),c(2,"translate"),g(3,"tb-event-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"tenant.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.nullUid)("entityId",e.entity.id)}}function L2(i,n){if(i&1&&(s(0,"mat-tab",6,4),c(2,"translate"),g(3,"tb-relation-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}var Hl=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-tenant-tabs"]],features:[G],decls:5,vars:5,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"]],template:function(o,t){o&1&&v(0,B2,4,7,"mat-tab",5)(1,R2,4,7,"mat-tab",5)(2,V2,4,5,"mat-tab",5)(3,j2,4,7,"mat-tab",5)(4,L2,4,5,"mat-tab",5),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity))},dependencies:[U,St,zi,Ai,yi,_i,R],encapsulation:2});let i=n;return i})();var zl=(()=>{let n=class n{constructor(e,o,t,d){this.tenantService=e,this.translate=o,this.datePipe=t,this.router=d,this.config=new Le,this.config.entityType=O.TENANT,this.config.entityComponent=Wl,this.config.entityTabsComponent=Hl,this.config.entityTranslations=Ge.get(O.TENANT),this.config.entityResources=tt.get(O.TENANT),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","tenant.title","20%"),new K("tenantProfileName","tenant-profile.tenant-profile","20%"),new K("email","contact.email","20%"),new K("country","contact.country","20%"),new K("city","contact.city","20%")),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant.manage-tenant-admins"),icon:"account_circle",isEnabled:()=>!0,onAction:(f,_)=>this.manageTenantAdmins(f,_)}),this.config.deleteEntityTitle=f=>this.translate.instant("tenant.delete-tenant-title",{tenantTitle:f.title}),this.config.deleteEntityContent=()=>this.translate.instant("tenant.delete-tenant-text"),this.config.deleteEntitiesTitle=f=>this.translate.instant("tenant.delete-tenants-title",{count:f}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant.delete-tenants-text"),this.config.entitiesFetchFunction=f=>this.tenantService.getTenantInfos(f),this.config.loadEntity=f=>this.tenantService.getTenantInfo(f.id),this.config.saveEntity=f=>this.tenantService.saveTenant(f).pipe(_t(_=>this.tenantService.getTenantInfo(_.id.id))),this.config.deleteEntity=f=>this.tenantService.deleteTenant(f.id),this.config.onEntityAction=f=>this.onTenantAction(f,this.config)}resolve(){return this.config.tableTitle=this.translate.instant("tenant.tenants"),this.config}openTenant(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}manageTenantAdmins(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`tenants/${o.id.id}/users`)}onTenantAction(e,o){switch(e.action){case"open":return this.openTenant(e.event,e.entity,o),!0;case"manageTenantAdmins":return this.manageTenantAdmins(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(es),P(ee),P(Oe),P(pe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();function U2(i,n){if(i&1){let l=L();s(0,"button",1),c(1,"async"),C("click",function(o){I(l);let t=y();return w(t.onEntityAction(o,"loginAsUser"))}),p(2),c(3,"translate"),r()}if(i&2){let l=y();j("!hidden",l.isEdit),m("disabled",u(1,4,l.isLoading$)),a(2),b(" ",u(3,6,(l.entity==null?null:l.entity.authority)===l.authority.TENANT_ADMIN?"user.login-as-tenant-admin":"user.login-as-customer-user")," ")}}function q2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.invalid-email-format")," "))}function W2(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"user.email-required")," "))}function H2(i,n){if(i&1&&(s(0,"section",19)(1,"section",20),g(2,"tb-dashboard-autocomplete",21),c(3,"translate"),s(4,"mat-checkbox",22),p(5),c(6,"translate"),r()(),s(7,"section",20),g(8,"tb-dashboard-autocomplete",23),c(9,"translate"),s(10,"mat-checkbox",24),p(11),c(12,"translate"),r()()()),i&2){let l=y();a(2),x("label",u(3,12,"user.default-dashboard")),m("dashboardsScope",(l.entity==null?null:l.entity.authority)===l.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",l.entity==null||l.entity.tenantId==null?null:l.entity.tenantId.id)("customerId",l.entity==null||l.entity.customerId==null?null:l.entity.customerId.id)("selectFirstDashboard",!1),a(3),b(" ",u(6,14,"user.always-fullscreen")," "),a(3),x("label",u(9,16,"dashboard.home-dashboard")),m("dashboardsScope",(l.entity==null?null:l.entity.authority)===l.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",l.entity==null||l.entity.tenantId==null?null:l.entity.tenantId.id)("customerId",l.entity==null||l.entity.customerId==null?null:l.entity.customerId.id)("selectFirstDashboard",!1),a(3),b(" ",u(12,18,"dashboard.home-dashboard-hide-toolbar")," ")}}var uo=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,d,o,t,f),this.store=e,this.entityValue=o,this.entitiesTableConfigValue=t,this.fb=d,this.cd=f,this.translate=_,this.authority=E,this.loginAsUserEnabled$=this.store.pipe(qt(kr),rt(D=>D.userTokenAccessEnabled))}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isUserCredentialsEnabled(){return this.entity?.additionalInfo?.userCredentialsEnabled===!0}isUserActivated(){return this.entity?.additionalInfo?.userActivated===!0}buildForm(e){return this.fb.group({email:[e?e.email:"",[T.required,T.email]],firstName:[e?e.firstName:""],lastName:[e?e.lastName:""],phone:[e?e.phone:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],defaultDashboardId:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardId:null],defaultDashboardFullscreen:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateForm(e){this.entityForm.patchValue({email:e.email}),this.entityForm.patchValue({firstName:e.firstName}),this.entityForm.patchValue({lastName:e.lastName}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardId:e.additionalInfo?e.additionalInfo.defaultDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardFullscreen:e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onUserIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("user.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h("entity",8),h("entitiesTableConfig",8),h(ce),h(Je),h(ee))},n.\u0275cmp=F({type:n,selectors:[["tb-user"]],features:[G],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","defaultDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","defaultDashboardFullscreen",1,"flex-1"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"disableAccount")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"enableAccount")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"displayActivationLink")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"resendActivation")}),p(19),c(20,"translate"),r(),v(21,U2,4,8,"button",2),c(22,"async"),s(23,"button",1),c(24,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(25),c(26,"translate"),r(),s(27,"div",3)(28,"button",4),c(29,"async"),C("cbOnSuccess",function(f){return t.onUserIdCopied(f)}),g(30,"mat-icon",5),s(31,"span",6),p(32,"user.copyId"),r()()()(),s(33,"div",7)(34,"form",8)(35,"fieldset",9),c(36,"async"),s(37,"mat-form-field",10)(38,"mat-label",6),p(39,"user.email"),r(),g(40,"input",11),v(41,q2,3,3,"mat-error",12)(42,W2,3,3,"mat-error",12),r(),s(43,"mat-form-field",10)(44,"mat-label",6),p(45,"user.first-name"),r(),g(46,"input",13),r(),s(47,"mat-form-field",10)(48,"mat-label",6),p(49,"user.last-name"),r(),g(50,"input",14),r(),g(51,"tb-phone-input",15),c(52,"translate"),s(53,"div",16)(54,"mat-form-field",10)(55,"mat-label",6),p(56,"user.description"),r(),g(57,"textarea",17),r(),v(58,H2,13,20,"section",18),r()()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,37,t.isLoading$)),a(2),b(" ",u(4,39,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||!t.isUserActivated()||!t.isUserCredentialsEnabled()),m("disabled",u(6,41,t.isLoading$)),a(2),b(" ",u(8,43,"user.disable-account")," "),a(2),j("!hidden",t.isEdit||!t.isUserActivated()||t.isUserCredentialsEnabled()),m("disabled",u(10,45,t.isLoading$)),a(2),b(" ",u(12,47,"user.enable-account")," "),a(2),j("!hidden",t.isEdit||t.isUserActivated()),m("disabled",u(14,49,t.isLoading$)),a(2),b(" ",u(16,51,"user.display-activation-link")," "),a(2),j("!hidden",t.isEdit||t.isUserActivated()),m("disabled",u(18,53,t.isLoading$)),a(2),b(" ",u(20,55,"user.resend-activation")," "),a(2),m("ngIf",u(22,57,t.loginAsUserEnabled$)),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(24,59,t.isLoading$)),a(2),b(" ",u(26,61,"user.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",u(29,63,t.isLoading$)),a(6),m("formGroup",t.entityForm),a(),m("disabled",u(36,65,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("email").hasError("email")),a(),m("ngIf",t.entityForm.get("email").hasError("required")),a(9),x("label",u(52,67,"contact.phone")),m("required",!1)("enableFlagsSelect",!0),a(7),m("ngIf",t.entity==null?null:t.entity.id))},dependencies:[U,ln,te,zt,re,be,de,Se,Fe,Jt,ue,he,W,X,fe,ne,le,bt,J,oo,me,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']});let i=n;return i})();S();S();var $2=(i,n)=>({activationLink:i,activationLinkTtl:n});function J2(i,n){i&1&&g(0,"mat-progress-bar",17)}function Q2(i,n){i&1&&g(0,"div",18)}var La=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.translate=f,this.millisecondsToTimeStringPipe=_,this.activationLink=this.data.activationLinkInfo.value,this.activationLinkTtl=this.millisecondsToTimeStringPipe.transform(this.data.activationLinkInfo.ttlMs)}close(){this.dialogRef.close()}onActivationLinkCopied(){this.store.dispatch(new ze({message:this.translate.instant("user.activation-link-copied-message"),type:"success",target:"activationLinkDialogContent",duration:1200,verticalPosition:"bottom",horizontalPosition:"left"}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it),h(ee),h(Su))},n.\u0275cmp=F({type:n,selectors:[["tb-activation-link-dialog"]],features:[G],decls:28,vars:24,consts:[[2,"min-width","400px","position","relative"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","activationLinkDialogContent"],[1,"mat-content","flex","flex-col"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","color","primary","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(o,t){o&1&&(s(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.activation-link"),r(),g(4,"span",3),s(5,"button",4),C("click",function(){return t.close()}),s(6,"mat-icon",5),p(7,"close"),r()()(),v(8,J2,1,0,"mat-progress-bar",6),c(9,"async"),v(10,Q2,1,0,"div",7),c(11,"async"),s(12,"div",8)(13,"div",9),g(14,"span",10),c(15,"translate"),s(16,"div",11)(17,"pre",12)(18,"code"),p(19),r()(),s(20,"button",13),c(21,"translate"),C("cbOnSuccess",function(){return t.onActivationLinkCopied()}),g(22,"mat-icon",14),r()()()(),s(23,"div",15)(24,"button",16),c(25,"async"),C("click",function(){return t.close()}),p(26),c(27,"translate"),r()()()),o&2&&(a(8),m("ngIf",u(9,8,t.isLoading$)),a(2),m("ngIf",!u(11,10,t.isLoading$)),a(4),m("innerHTML",Yt(15,12,"user.activation-link-text",Sr(21,$2,t.activationLink,t.activationLinkTtl)),zn),a(5),B(t.activationLink),a(),x("cbContent",t.activationLink),x("matTooltip",u(21,15,"user.copy-activation-link")),a(4),m("disabled",u(25,17,t.isLoading$)),a(2),b(" ",u(27,19,"action.ok")," "))},dependencies:[U,Mi,te,Ie,re,Ue,at,Nt,dt,Mt,Jt,ue,X,xn,J,me,R],encapsulation:2});let i=n;return i})();var Y2=()=>({standalone:!0});function K2(i,n){i&1&&g(0,"mat-progress-bar",15)}function X2(i,n){i&1&&g(0,"div",16)}function Z2(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.activationMethodTranslations.get(e.activationMethodEnum[l]))," ")}}var $l=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.userService=f,this.dialog=_,this.activationMethods=Object.keys(Ea),this.activationMethodEnum=Ea,this.activationMethodTranslations=sf,this.activationMethod=Ea.DISPLAY_ACTIVATION_LINK}ngOnInit(){this.user={},this.userComponent.isEdit=!0,this.userComponent.entity=this.user,this.detailsForm=this.userComponent.entityForm}cancel(){this.dialogRef.close(null)}add(){if(this.detailsForm.valid){this.user=Ce(Ce({},this.user),this.userComponent.entityForm.value),this.user.authority=this.data.authority,this.user.tenantId=new Br(this.data.tenantId),this.user.customerId=new Ko(this.data.customerId);let e=this.activationMethod===Ea.SEND_ACTIVATION_MAIL;this.userService.saveUser(this.user,e).subscribe(o=>{this.activationMethod===Ea.DISPLAY_ACTIVATION_LINK?this.userService.getActivationLinkInfo(o.id.id).subscribe(t=>{this.displayActivationLink(t).subscribe(()=>{this.dialogRef.close(o)})}):this.dialogRef.close(o)})}}displayActivationLink(e){return this.dialog.open(La,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:e}}).afterClosed()}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it),h(Cn),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-add-user-dialog"]],viewQuery:function(o,t){if(o&1&&we(uo,7),o&2){let d;Me(d=De())&&(t.userComponent=d.first)}},features:[G],decls:28,vars:22,consts:[[2,"min-width","450px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],[3,"ngModelChange","ngModelOptions","ngModel"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"]],template:function(o,t){o&1&&(s(0,"form",0),C("ngSubmit",function(){return t.add()}),s(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.add"),r(),g(4,"span",3),s(5,"button",4),C("click",function(){return t.cancel()}),s(6,"mat-icon",5),p(7,"close"),r()()(),v(8,K2,1,0,"mat-progress-bar",6),c(9,"async"),v(10,X2,1,0,"div",7),c(11,"async"),s(12,"div",8),g(13,"tb-user"),s(14,"mat-form-field",9)(15,"mat-label",2),p(16,"user.activation-method"),r(),s(17,"mat-select",10),et("ngModelChange",function(f){return Ze(t.activationMethod,f)||(t.activationMethod=f),f}),v(18,Z2,3,4,"mat-option",11),r()()(),s(19,"div",12)(20,"button",13),c(21,"async"),C("click",function(){return t.cancel()}),p(22),c(23,"translate"),r(),s(24,"button",14),c(25,"async"),p(26),c(27,"translate"),r()()()),o&2&&(a(8),m("ngIf",u(9,9,t.isLoading$)),a(2),m("ngIf",!u(11,11,t.isLoading$)),a(7),m("ngModelOptions",Bt(21,Y2)),Xe("ngModel",t.activationMethod),a(),m("ngForOf",t.activationMethods),a(2),m("disabled",u(21,13,t.isLoading$)),a(2),b(" ",u(23,15,"action.cancel")," "),a(2),m("disabled",u(25,17,t.isLoading$)||t.detailsForm.invalid||!t.detailsForm.dirty),a(2),b(" ",u(27,19,"action.add")," "))},dependencies:[xe,U,te,Ie,re,Ue,de,Se,at,Nt,dt,vt,gt,ue,W,X,Qe,xn,J,uo,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-padding{padding:0}']});let i=n;return i})();S();function eS(i,n){if(i&1&&(s(0,"mat-tab",5,0),c(2,"translate"),g(3,"tb-attribute-table",6),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function tS(i,n){if(i&1&&(s(0,"mat-tab",5,1),c(2,"translate"),g(3,"tb-attribute-table",7),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function iS(i,n){if(i&1&&(s(0,"mat-tab",5,2),c(2,"translate"),g(3,"tb-relation-table",8),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function nS(i,n){if(i&1&&(s(0,"mat-tab",5,3),c(2,"translate"),g(3,"tb-audit-log-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.USER)("userId",e.entity.id)}}var Jl=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-user-tabs"]],features:[G],decls:4,vars:4,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],["detailsMode","true",3,"active","auditLogMode","userId"]],template:function(o,t){o&1&&v(0,eS,4,7,"mat-tab",4)(1,tS,4,7,"mat-tab",4)(2,iS,4,5,"mat-tab",4)(3,nS,4,6,"mat-tab",4),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,Ai,_i,R],encapsulation:2});let i=n;return i})();var qn=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y){this.store=e,this.userService=o,this.authService=t,this.tenantService=d,this.customerService=f,this.translate=_,this.datePipe=D,this.router=M,this.dialog=Y,this.config=new Le,this.config.entityType=O.USER,this.config.entityComponent=uo,this.config.entityTabsComponent=Jl,this.config.entityTranslations=Ge.get(O.USER),this.config.entityResources=tt.get(O.USER),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("firstName","user.first-name","33%"),new K("lastName","user.last-name","33%"),new K("email","user.email","33%")),this.config.deleteEnabled=ke=>ke&&ke.id&&ke.id.id!==this.authUser.id.id,this.config.deleteEntityTitle=ke=>this.translate.instant("user.delete-user-title",{userEmail:ke.email}),this.config.deleteEntityContent=()=>this.translate.instant("user.delete-user-text"),this.config.deleteEntitiesTitle=ke=>this.translate.instant("user.delete-users-title",{count:ke}),this.config.deleteEntitiesContent=()=>this.translate.instant("user.delete-users-text"),this.config.loadEntity=ke=>this.userService.getUser(ke.id),this.config.saveEntity=ke=>this.saveUser(ke),this.config.deleteEntity=ke=>this.userService.deleteUser(ke.id),this.config.onEntityAction=ke=>this.onUserAction(ke,this.config),this.config.addEntity=()=>this.addUser()}resolve(e){let o=e.params;return this.store.pipe(qt(kr),mi(1)).pipe(Ot(t=>{this.authUser=t.userDetails,this.authority=o.tenantId?E.TENANT_ADMIN:E.CUSTOMER_USER,this.authority===E.TENANT_ADMIN?(this.tenantId=o.tenantId,this.customerId=Ae,this.config.entitiesFetchFunction=d=>this.userService.getTenantAdmins(this.tenantId,d)):(this.tenantId=this.authUser.tenantId.id,this.customerId=o.customerId,this.config.entitiesFetchFunction=d=>this.userService.getCustomerUsers(this.customerId,d)),this.updateActionCellDescriptors(t)}),_t(()=>this.authority===E.TENANT_ADMIN?this.tenantService.getTenant(this.tenantId):Be(this.customerId)?this.customerService.getCustomer(this.customerId):Ct({title:""})),rt(t=>(this.authority===E.TENANT_ADMIN?this.config.tableTitle=t.title+": "+this.translate.instant("user.tenant-admins"):this.config.tableTitle=t.title+": "+this.translate.instant("user.customer-users"),this.config)))}updateActionCellDescriptors(e){this.config.cellActionDescriptors.splice(0),e.userTokenAccessEnabled&&this.config.cellActionDescriptors.push({name:this.authority===E.TENANT_ADMIN?this.translate.instant("user.login-as-tenant-admin"):this.translate.instant("user.login-as-customer-user"),icon:"mdi:login",isEnabled:()=>!0,onAction:(o,t)=>this.loginAsUser(o,t)})}saveUser(e){return e.tenantId=new Br(this.tenantId),e.customerId=new Ko(this.customerId),e.authority=this.authority,this.userService.saveUser(e)}addUser(){return this.dialog.open($l,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{tenantId:this.tenantId,customerId:this.customerId,authority:this.authority}}).afterClosed()}openUser(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}loginAsUser(e,o){e&&e.stopPropagation(),this.authService.loginAsUser(o.id.id).subscribe()}displayActivationLink(e,o){e&&e.stopPropagation(),this.userService.getActivationLinkInfo(o.id.id).subscribe(t=>{this.dialog.open(La,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:t}})})}resendActivation(e,o){e&&e.stopPropagation(),this.userService.sendActivationEmail(o.email).subscribe(()=>{this.store.dispatch(new ze({message:this.translate.instant("user.activation-email-sent-message"),type:"success"}))})}setUserCredentialsEnabled(e,o,t){e&&e.stopPropagation(),this.userService.setUserCredentialsEnabled(o.id.id,t).subscribe(()=>{o.additionalInfo||(o.additionalInfo={}),o.additionalInfo.userCredentialsEnabled=t,this.store.dispatch(new ze({message:this.translate.instant(t?"user.enable-account-message":"user.disable-account-message"),type:"success"}))})}onUserAction(e,o){switch(e.action){case"open":return this.openUser(e.event,e.entity,o),!0;case"loginAsUser":return this.loginAsUser(e.event,e.entity),!0;case"displayActivationLink":return this.displayActivationLink(e.event,e.entity),!0;case"resendActivation":return this.resendActivation(e.event,e.entity),!0;case"disableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!1),!0;case"enableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!0),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Cn),P(Zn),P(es),P(qi),P(ee),P(Oe),P(pe),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var oS=[{path:"tenants",data:{breadcrumb:{menuId:ve.tenants}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:zl}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"supervisor_account"},auth:[E.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:zl}},{path:":tenantId/users",data:{breadcrumb:{label:"user.tenant-admins",icon:"account_circle"}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:qn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"account_circle"},auth:[E.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:qn}}]}]}],Ql=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[zl],imports:[V.forChild(oS),V]});let i=n;return i})();(function(){Q(Ql,{imports:[V],exports:[V]})})();var Yl=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ql]});let i=n;return i})();(function(){Q(Yl,{declarations:[Wl,Hl],imports:[oe,ae,ye,Ql]})})();S();S();function aS(i,n){if(i&1){let l=L();s(0,"button",1),c(1,"async"),C("click",function(o){I(l);let t=y();return w(t.onEntityAction(o,"manageEdges"))}),p(2),c(3,"translate"),r()}if(i&2){let l=y();j("!hidden",l.isEdit),m("disabled",u(1,4,l.isLoading$)),a(2),b(" ",u(3,6,"customer.manage-edges")," ")}}function rS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"customer.title-required")," "))}function sS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"customer.title-max-length")," "))}function lS(i,n){if(i&1&&(s(0,"section",17)(1,"section",18),g(2,"tb-dashboard-autocomplete",19),c(3,"translate"),s(4,"mat-checkbox",20),p(5),c(6,"translate"),r()()()),i&2){let l=y();a(2),x("label",u(3,5,"dashboard.home-dashboard")),m("dashboardsScope","customer")("customerId",l.entity==null?null:l.entity.id.id)("selectFirstDashboard",!1),a(3),b(" ",u(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Kl=(()=>{let n=class n extends ql{constructor(e,o,t,d,f,_,D){super(e,f,t,d,_,D),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.countryData=D,this.isPublic=!1,this.authState=ji(this.store)}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[T.required,T.maxLength(255)]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.isPublic=e.additionalInfo&&e.additionalInfo.isPublic,this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Be(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onCustomerIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("customer.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}edgesSupportEnabled(){return this.authState.edgesSupportEnabled}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je),h(hs))},n.\u0275cmp=F({type:n,selectors:[["tb-customer"]],features:[G],decls:48,vars:63,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"manageUsers")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"manageAssets")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"manageDevices")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"manageDashboards")}),p(19),c(20,"translate"),r(),v(21,aS,4,8,"button",2),s(22,"button",1),c(23,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(24),c(25,"translate"),r(),s(26,"div",3)(27,"button",4),C("cbOnSuccess",function(f){return t.onCustomerIdCopied(f)}),g(28,"mat-icon",5),s(29,"span",6),p(30,"customer.copyId"),r()()()(),s(31,"div",7)(32,"form",8)(33,"fieldset",9),c(34,"async"),s(35,"mat-form-field",10)(36,"mat-label",6),p(37,"customer.title"),r(),g(38,"input",11),v(39,rS,3,3,"mat-error",12)(40,sS,3,3,"mat-error",12),r(),s(41,"div",13)(42,"mat-form-field",10)(43,"mat-label",6),p(44,"customer.description"),r(),g(45,"textarea",14),r(),v(46,lS,7,9,"section",15),r(),g(47,"tb-contact",16),r()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,37,t.isLoading$)),a(2),b(" ",u(4,39,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||t.isPublic),m("disabled",u(6,41,t.isLoading$)),a(2),b(" ",u(8,43,"customer.manage-users")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(10,45,t.isLoading$)),a(2),b(" ",u(12,47,"customer.manage-assets")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(14,49,t.isLoading$)),a(2),b(" ",u(16,51,"customer.manage-devices")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(18,53,t.isLoading$)),a(2),b(" ",u(20,55,"customer.manage-dashboards")," "),a(2),m("ngIf",t.edgesSupportEnabled()),a(),j("!hidden",t.hideDelete()||t.isEdit||t.isPublic),m("disabled",u(23,57,t.isLoading$)),a(2),b(" ",u(25,59,"customer.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),m("formGroup",t.entityForm),a(),j("!hidden",t.isPublic),m("disabled",u(34,61,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("title").hasError("required")),a(),m("ngIf",t.entityForm.get("title").hasError("maxlength")),a(6),m("ngIf",t.entity==null?null:t.entity.id),a(),m("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[U,ln,te,zt,re,be,de,Se,Fe,Jt,ue,he,W,X,fe,ne,le,bt,J,bs,me,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']});let i=n;return i})();S();S();S();function mS(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function pS(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function dS(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function cS(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"customer.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function uS(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function fS(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.CUSTOMER)("customerId",e.entity.id)}}function gS(i,n){if(i&1){let l=L();s(0,"mat-tab",8,6),c(2,"translate"),s(3,"tb-version-control",14),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var Xl=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-customer-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","customerId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,mS,4,7,"mat-tab",7)(1,pS,4,7,"mat-tab",7)(2,dS,4,5,"mat-tab",7)(3,cS,4,7,"mat-tab",7)(4,uS,4,5,"mat-tab",7)(5,fS,4,6,"mat-tab",7)(6,gS,4,7,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,Ai,yi,_i,ai,R],encapsulation:2});let i=n;return i})();var Zl=(()=>{let n=class n{constructor(e,o,t,d,f,_){this.customerService=e,this.homeDialogs=o,this.translate=t,this.datePipe=d,this.router=f,this.store=_,this.config=new Le,this.config.entityType=O.CUSTOMER,this.config.entityComponent=Kl,this.config.entityTabsComponent=Xl,this.config.entityTranslations=Ge.get(O.CUSTOMER),this.config.entityResources=tt.get(O.CUSTOMER);let D=ji(this.store);this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","customer.title","25%"),new K("email","contact.email","25%"),new K("country","contact.country","25%"),new K("city","contact.city","25%")),this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-users"),icon:"account_circle",isEnabled:M=>!M.additionalInfo||!M.additionalInfo.isPublic,onAction:(M,Y)=>this.manageCustomerUsers(M,Y)},{name:this.translate.instant("customer.manage-customer-assets"),nameFunction:M=>M.additionalInfo&&M.additionalInfo.isPublic?this.translate.instant("customer.manage-public-assets"):this.translate.instant("customer.manage-customer-assets"),icon:"domain",isEnabled:M=>!0,onAction:(M,Y)=>this.manageCustomerAssets(M,Y)},{name:this.translate.instant("customer.manage-customer-devices"),nameFunction:M=>M.additionalInfo&&M.additionalInfo.isPublic?this.translate.instant("customer.manage-public-devices"):this.translate.instant("customer.manage-customer-devices"),icon:"devices_other",isEnabled:M=>!0,onAction:(M,Y)=>this.manageCustomerDevices(M,Y)},{name:this.translate.instant("customer.manage-customer-dashboards"),nameFunction:M=>M.additionalInfo&&M.additionalInfo.isPublic?this.translate.instant("customer.manage-public-dashboards"):this.translate.instant("customer.manage-customer-dashboards"),icon:"dashboard",isEnabled:M=>!0,onAction:(M,Y)=>this.manageCustomerDashboards(M,Y)}),D.edgesSupportEnabled&&this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-edges"),nameFunction:M=>M.additionalInfo&&M.additionalInfo.isPublic?this.translate.instant("customer.manage-public-edges"):this.translate.instant("customer.manage-customer-edges"),icon:"router",isEnabled:M=>!0,onAction:(M,Y)=>this.manageCustomerEdges(M,Y)}),this.config.deleteEntityTitle=M=>this.translate.instant("customer.delete-customer-title",{customerTitle:M.title}),this.config.deleteEntityContent=()=>this.translate.instant("customer.delete-customer-text"),this.config.deleteEntitiesTitle=M=>this.translate.instant("customer.delete-customers-title",{count:M}),this.config.deleteEntitiesContent=()=>this.translate.instant("customer.delete-customers-text"),this.config.entitiesFetchFunction=M=>this.customerService.getCustomers(M),this.config.loadEntity=M=>this.customerService.getCustomer(M.id),this.config.saveEntity=M=>this.customerService.saveCustomer(M),this.config.deleteEntity=M=>this.customerService.deleteCustomer(M.id),this.config.onEntityAction=M=>this.onCustomerAction(M,this.config),this.config.deleteEnabled=M=>M&&(!M.additionalInfo||!M.additionalInfo.isPublic),this.config.entitySelectionEnabled=M=>M&&(!M.additionalInfo||!M.additionalInfo.isPublic),this.config.detailsReadonly=M=>M&&M.additionalInfo&&M.additionalInfo.isPublic}resolve(){return this.config.tableTitle=this.translate.instant("customer.customers"),this.config}openCustomer(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}manageCustomerUsers(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${o.id.id}/users`)}manageCustomerAssets(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${o.id.id}/assets`)}manageCustomerDevices(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${o.id.id}/devices`)}manageCustomerDashboards(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${o.id.id}/dashboards`)}manageCustomerEdges(e,o){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${o.id.id}/edgeInstances`)}onCustomerAction(e,o){switch(e.action){case"open":return this.openCustomer(e.event,e.entity,o),!0;case"manageUsers":return this.manageCustomerUsers(e.event,e.entity),!0;case"manageAssets":return this.manageCustomerAssets(e.event,e.entity),!0;case"manageDevices":return this.manageCustomerDevices(e.event,e.entity),!0;case"manageDashboards":return this.manageCustomerDashboards(e.event,e.entity),!0;case"manageEdges":return this.manageCustomerEdges(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(qi),P(An),P(ee),P(Oe),P(pe),P(A))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();S();S();S();var em=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceConfigurationFormGroup=this.fb.group({configuration:[null,T.required]}),this.defaultDeviceConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceConfigurationFormGroup.valid&&(e=this.defaultDeviceConfigurationFormGroup.getRawValue().configuration,e.type=ts.DEFAULT),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-default-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(o,t){o&1&&g(0,"form",0),o&2&&m("formGroup",t.defaultDeviceConfigurationFormGroup)},dependencies:[ue,X,ne],encapsulation:2});let i=n;return i})();function bS(i,n){if(i&1&&g(0,"tb-default-device-configuration",3),i&2){let l=y();m("required",l.required)}}var tm=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.deviceProfileType=ts,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceConfigurationFormGroup=this.fb.group({configuration:[null,T.required]}),this.deviceConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceConfigurationFormGroup.disable({emitEvent:!1}):this.deviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.type=e?.type;let o=Tt(e);o&&delete o.type,this.deviceConfigurationFormGroup.patchValue({configuration:o},{emitEvent:!1})}updateModel(){let e=null;this.deviceConfigurationFormGroup.valid&&(e=this.deviceConfigurationFormGroup.getRawValue().configuration,e.type=this.type),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:3,vars:3,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1),v(2,bS,1,1,"ng-template",2),r()()),o&2&&(m("formGroup",t.deviceConfigurationFormGroup),a(),m("ngSwitch",t.type),a(),m("ngSwitchCase",t.deviceProfileType.DEFAULT))},dependencies:[yn,_n,W,X,fe,ne,le,em],encapsulation:2});let i=n;return i})();S();S();var im=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,T.required]}),this.defaultDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceTransportConfigurationFormGroup.valid&&(e=this.defaultDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=Ei.DEFAULT),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-default-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(o,t){o&1&&g(0,"form",0),o&2&&m("formGroup",t.defaultDeviceTransportConfigurationFormGroup)},dependencies:[ue,X,ne],encapsulation:2});let i=n;return i})();S();var nm=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.mqttDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,T.required]}),this.mqttDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.mqttDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.mqttDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.mqttDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.mqttDeviceTransportConfigurationFormGroup.valid&&(e=this.mqttDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=Ei.MQTT),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-mqtt-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(o,t){o&1&&g(0,"form",0),o&2&&m("formGroup",t.mqttDeviceTransportConfigurationFormGroup)},dependencies:[ue,X,ne],encapsulation:2});let i=n;return i})();S();var om=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o){this.store=e,this.fb=o,this.destroy$=new Ft,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.coapDeviceTransportForm=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},T.required],psmActivityTimer:[{disabled:!0,value:0},T.required],pagingTransmissionWindow:[{disabled:!0,value:0},T.required]}),this.coapDeviceTransportForm.valueChanges.pipe(mt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.coapDeviceTransportForm.disable({emitEvent:!1}):(this.coapDeviceTransportForm.enable({emitEvent:!1}),this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Be(e)?this.coapDeviceTransportForm.patchValue(e,{emitEvent:!1}):this.coapDeviceTransportForm.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.coapDeviceTransportForm.valid&&(e=this.coapDeviceTransportForm.value,e.type=Ei.COAP),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-coap-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(o,t){o&1&&(s(0,"form",0),g(1,"tb-power-mode-settings",1),r()),o&2&&(m("formGroup",t.coapDeviceTransportForm),a(),m("parentForm",t.coapDeviceTransportForm)("isDeviceSetting",!0))},dependencies:[ue,X,ne,Is],encapsulation:2});let i=n;return i})();S();var am=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o){this.store=e,this.fb=o,this.destroy$=new Ft,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.lwm2mDeviceTransportConfigurationFormGroup=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},T.required],psmActivityTimer:[{disabled:!0,value:0},T.required],pagingTransmissionWindow:[{disabled:!0,value:0},T.required]}),this.lwm2mDeviceTransportConfigurationFormGroup.valueChanges.pipe(mt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.lwm2mDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.lwm2mDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Be(e)?this.lwm2mDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}):this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.lwm2mDeviceTransportConfigurationFormGroup.valid&&(e=this.lwm2mDeviceTransportConfigurationFormGroup.value,e.type=Ei.LWM2M),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-lwm2m-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(o,t){o&1&&(s(0,"form",0),g(1,"tb-power-mode-settings",1),r()),o&2&&(m("formGroup",t.lwm2mDeviceTransportConfigurationFormGroup),a(),m("parentForm",t.lwm2mDeviceTransportConfigurationFormGroup)("isDeviceSetting",!0))},dependencies:[ue,X,ne,Is],encapsulation:2});let i=n;return i})();S();function xS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.host-required")," "))}function ES(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.port-required")," "))}function IS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.port-format")," "))}function wS(i,n){if(i&1&&(s(0,"mat-option",10),p(1),c(2,"lowercase"),r()),i&2){let l=n.$implicit;m("value",l),a(),b(" ",u(2,2,l)," ")}}function MS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.protocol-version-required")," "))}function DS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.community-required")," "))}function FS(i,n){if(i&1&&(s(0,"section")(1,"mat-form-field",11)(2,"mat-label",3),p(3,"device-profile.snmp.community"),r(),g(4,"input",12),v(5,DS,3,3,"mat-error",5),r()()),i&2){let l=y();a(5),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("required")||l.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("pattern"))}}function PS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.user-name-required")," "))}function AS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.security-name-required")," "))}function NS(i,n){if(i&1&&(s(0,"mat-option",10),p(1),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",e.snmpAuthenticationProtocolTranslation.get(l)," ")}}function kS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.authentication-protocol-required")," "))}function OS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.authentication-passphrase-required")," "))}function BS(i,n){if(i&1&&(s(0,"mat-option",10),p(1),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",e.snmpPrivacyProtocolTranslation.get(l)," ")}}function RS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.privacy-protocol-required")," "))}function VS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.snmp.privacy-passphrase-required")," "))}function jS(i,n){if(i&1&&(s(0,"section")(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.user-name"),r(),g(5,"input",13),v(6,PS,3,3,"mat-error",5),r(),s(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.security-name"),r(),g(10,"input",14),v(11,AS,3,3,"mat-error",5),r()(),s(12,"div",1)(13,"mat-form-field",15)(14,"mat-label",3),p(15,"device-profile.snmp.authentication-protocol"),r(),s(16,"mat-select",16),v(17,NS,2,2,"mat-option",9),r(),v(18,kS,3,3,"mat-error",5),r(),s(19,"mat-form-field",2)(20,"mat-label",3),p(21,"device-profile.snmp.authentication-passphrase"),r(),g(22,"input",17),v(23,OS,3,3,"mat-error",5),r()(),s(24,"div",1)(25,"mat-form-field",15)(26,"mat-label",3),p(27,"device-profile.snmp.privacy-protocol"),r(),s(28,"mat-select",18),v(29,BS,2,2,"mat-option",9),r(),v(30,RS,3,3,"mat-error",5),r(),s(31,"mat-form-field",2)(32,"mat-label",3),p(33,"device-profile.snmp.privacy-passphrase"),r(),g(34,"input",19),v(35,VS,3,3,"mat-error",5),r()(),s(36,"div",1)(37,"mat-form-field",2)(38,"mat-label",3),p(39,"device-profile.snmp.context-name"),r(),g(40,"input",20),r(),s(41,"mat-form-field",2)(42,"mat-label",3),p(43,"device-profile.snmp.engine-id"),r(),g(44,"input",21),r()()()),i&2){let l=y();a(6),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("required")||l.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("pattern")),a(5),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("required")||l.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("pattern")),a(6),m("ngForOf",l.snmpAuthenticationProtocols),a(),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").hasError("required")),a(5),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("required")||l.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("pattern")),a(6),m("ngForOf",l.snmpPrivacyProtocols),a(),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").hasError("required")),a(5),m("ngIf",l.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("required")||l.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("pattern"))}}var rm=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.snmpDeviceProtocolVersions=Object.values(bo),this.snmpAuthenticationProtocols=Object.values(sd),this.snmpAuthenticationProtocolTranslation=Lu,this.snmpPrivacyProtocols=Object.values(ld),this.snmpPrivacyProtocolTranslation=Gu,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.snmpDeviceTransportConfigurationFormGroup=this.fb.group({host:["",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],port:[null,[T.required,T.min(0),T.pattern("[0-9]*")]],protocolVersion:[bo.V2C,T.required],community:["public",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],username:["",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],securityName:["public",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],contextName:[null],authenticationProtocol:[sd.SHA_512,T.required],authenticationPassphrase:["",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],privacyProtocol:[ld.DES,T.required],privacyPassphrase:["",[T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]],engineId:[""]}),this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.updateDisabledFormValue(e)}),this.snmpDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}validate(){return this.snmpDeviceTransportConfigurationFormGroup.valid?null:{snmpDeviceTransportConfiguration:!1}}setDisabledState(e){this.disabled=e,this.disabled?this.snmpDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.snmpDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.updateDisabledFormValue(this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value||bo.V2C))}writeValue(e){Be(e)&&(this.snmpDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.enabled&&this.updateDisabledFormValue(e.protocolVersion||bo.V2C))}isV3protocolVersion(){return this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value===bo.V3}updateDisabledFormValue(e){e===bo.V3?(this.snmpDeviceTransportConfigurationFormGroup.get("community").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").enable({emitEvent:!1})):(this.snmpDeviceTransportConfigurationFormGroup.get("community").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").disable({emitEvent:!1}))}updateModel(){let e=null;this.snmpDeviceTransportConfigurationFormGroup.valid&&(e=this.snmpDeviceTransportConfigurationFormGroup.value,e.type=Ei.SNMP),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-snmp-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:21,vars:8,consts:[[1,"flex","flex-col","gap-2","pb-4",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col"],[1,"flex-1"],["translate",""],["matInput","","formControlName","host","required",""],[4,"ngIf"],["matInput","","formControlName","port","type","number","min","0","required",""],["floatLabel","always","hideRequiredMarker","",1,"mat-block"],["formControlName","protocolVersion","required",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-block"],["matInput","","formControlName","community","required",""],["matInput","","formControlName","username","required",""],["matInput","","formControlName","securityName","required",""],["floatLabel","always","hideRequiredMarker","",1,"flex-1"],["formControlName","authenticationProtocol","required",""],["matInput","","formControlName","authenticationPassphrase","required",""],["formControlName","privacyProtocol","required",""],["matInput","","formControlName","privacyPassphrase","required",""],["matInput","","formControlName","contextName"],["matInput","","formControlName","engineId"]],template:function(o,t){o&1&&(s(0,"form",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.host"),r(),g(5,"input",4),v(6,xS,3,3,"mat-error",5),r(),s(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.port"),r(),g(10,"input",6),v(11,ES,3,3,"mat-error",5)(12,IS,3,3,"mat-error",5),r()(),s(13,"mat-form-field",7)(14,"mat-label",3),p(15,"device-profile.snmp.protocol-version"),r(),s(16,"mat-select",8),v(17,wS,3,4,"mat-option",9),r(),v(18,MS,3,3,"mat-error",5),r(),v(19,FS,6,1,"section",5)(20,jS,45,8,"section",5),r()),o&2&&(m("formGroup",t.snmpDeviceTransportConfigurationFormGroup),a(6),m("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("required")||t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("pattern")),a(5),m("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("required")),a(),m("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("pattern")||t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("min")),a(5),m("ngForOf",t.snmpDeviceProtocolVersions),a(),m("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").hasError("required")),a(),m("ngIf",!t.isV3protocolVersion()),a(),m("ngIf",t.isV3protocolVersion()))},dependencies:[xe,U,be,de,Se,Fe,vt,gt,ue,he,Gi,W,X,fe,Ui,ne,le,J,fc,R],encapsulation:2});let i=n;return i})();function GS(i,n){if(i&1&&g(0,"tb-default-device-transport-configuration",3),i&2){let l=y();m("required",l.required)}}function US(i,n){if(i&1&&g(0,"tb-mqtt-device-transport-configuration",3),i&2){let l=y();m("required",l.required)}}function qS(i,n){if(i&1&&g(0,"tb-lwm2m-device-transport-configuration",3),i&2){let l=y();m("required",l.required)}}function WS(i,n){if(i&1&&g(0,"tb-coap-device-transport-configuration",3),i&2){let l=y();m("required",l.required)}}function HS(i,n){if(i&1&&g(0,"tb-snmp-device-transport-configuration",3),i&2){let l=y();m("required",l.required)}}var sm=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.deviceTransportType=Ei,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,T.required]}),this.deviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.deviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.transportType=e?.type;let o=Tt(e);o&&delete o.type,this.deviceTransportConfigurationFormGroup.patchValue({configuration:o},{emitEvent:!1})}validate(){return this.deviceTransportConfigurationFormGroup.valid?null:{deviceTransportConfiguration:!1}}updateModel(){let e=null;this.deviceTransportConfigurationFormGroup.valid&&(e=this.deviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=this.transportType),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:7,vars:7,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1),v(2,GS,1,1,"ng-template",2)(3,US,1,1,"ng-template",2)(4,qS,1,1,"ng-template",2)(5,WS,1,1,"ng-template",2)(6,HS,1,1,"ng-template",2),r()()),o&2&&(m("formGroup",t.deviceTransportConfigurationFormGroup),a(),m("ngSwitch",t.transportType),a(),m("ngSwitchCase",t.deviceTransportType.DEFAULT),a(),m("ngSwitchCase",t.deviceTransportType.MQTT),a(),m("ngSwitchCase",t.deviceTransportType.LWM2M),a(),m("ngSwitchCase",t.deviceTransportType.COAP),a(),m("ngSwitchCase",t.deviceTransportType.SNMP))},dependencies:[yn,_n,W,X,fe,ne,le,im,nm,om,am,rm],encapsulation:2});let i=n;return i})();function $S(i,n){i&1&&(s(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.device-configuration"),r()()(),g(5,"tb-device-configuration",5),r()),i&2&&m("expanded",!0)}function JS(i,n){i&1&&(s(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.transport-configuration"),r()()(),g(5,"tb-device-transport-configuration",6),r()),i&2&&m("expanded",!0)}var lm=(()=>{let n=class n{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,o,t){this.store=e,this.fb=o,this.destroyRef=t,this.propagateChange=d=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceDataFormGroup=this.fb.group({configuration:[null,T.required],transportConfiguration:[null,T.required]}),this.deviceDataFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceDataFormGroup.disable({emitEvent:!1}):this.deviceDataFormGroup.enable({emitEvent:!1})}writeValue(e){let o=e?.configuration?.type;this.displayDeviceConfiguration=o&&Ru.get(o).hasDeviceConfiguration;let t=e?.transportConfiguration?.type;this.displayTransportConfiguration=t&&ju.get(t).hasDeviceConfiguration,this.deviceDataFormGroup.patchValue({configuration:e?.configuration},{emitEvent:!1}),this.deviceDataFormGroup.patchValue({transportConfiguration:e?.transportConfiguration},{emitEvent:!1})}validate(){return this.deviceDataFormGroup.valid?null:{deviceDataForm:!1}}updateModel(){let e=null;this.deviceDataFormGroup.valid&&(e=this.deviceDataFormGroup.getRawValue()),this.propagateChange(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ce),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-device-data"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:4,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],["multi","true"],[3,"expanded",4,"ngIf"],[3,"expanded"],["translate",""],["formControlName","configuration","required",""],["formControlName","transportConfiguration","required",""]],template:function(o,t){o&1&&(s(0,"div",0)(1,"mat-accordion",1),v(2,$S,6,1,"mat-expansion-panel",2)(3,JS,6,1,"mat-expansion-panel",2),r()()),o&2&&(m("formGroup",t.deviceDataFormGroup),a(2),m("ngIf",t.displayDeviceConfiguration),a(),m("ngIf",t.displayTransportConfiguration))},dependencies:[U,Ur,Li,nn,on,W,X,fe,ne,le,J,tm,sm],encapsulation:2});let i=n;return i})();function KS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device.name-required")," "))}function XS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device.name-max-length")," "))}function ZS(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device.label-max-length")," "))}function eT(i,n){i&1&&(s(0,"mat-slide-toggle",25),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device.overwrite-activity-time")," "))}var mm=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_,D){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.destroyRef=D,this.entityType=O,this.otaUpdateType=Ka}ngOnInit(){this.deviceScope=this.entitiesTableConfig.componentsData.deviceScope,this.deviceCredentials$=this.entitiesTableConfigValue.componentsData.deviceCredentials$,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){let o=this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],deviceProfileId:[e?e.deviceProfileId:null,[T.required]],firmwareId:[e?e.firmwareId:null],softwareId:[e?e.softwareId:null],label:[e?e.label:"",[T.maxLength(255)]],deviceData:[e?e.deviceData:null,[T.required]],additionalInfo:this.fb.group({gateway:[e&&e.additionalInfo?e.additionalInfo.gateway:!1],overwriteActivityTime:[e&&e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1],description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return o.get("deviceProfileId").valueChanges.pipe(yr((t,d)=>t?.id===d?.id),Ne(this.destroyRef)).subscribe(t=>{t&&this.isEdit&&this.entityForm.patchValue({firmwareId:null,softwareId:null},{emitEvent:!1})}),o}updateForm(e){this.entityForm.patchValue({name:e.name,deviceProfileId:e.deviceProfileId,firmwareId:e.firmwareId,softwareId:e.softwareId,label:e.label,deviceData:e.deviceData,additionalInfo:{gateway:e.additionalInfo?e.additionalInfo.gateway:!1,overwriteActivityTime:e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1,description:e.additionalInfo?e.additionalInfo.description:""}})}onDeviceIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("device.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDeviceProfileUpdated(){this.entitiesTableConfig.updateData(!1)}onDeviceProfileChanged(e){if(e&&this.isEdit){let o=e.type,t=e.transportType,d=this.entityForm.getRawValue().deviceData;if(!d)d={configuration:ad(o),transportConfiguration:rd(t)},this.entityForm.patchValue({deviceData:d}),this.entityForm.markAsDirty();else{let f=!1;d.configuration.type!==o&&(d.configuration=ad(o),f=!0),d.transportConfiguration.type!==t&&(d.transportConfiguration=rd(t),f=!0),f&&(this.entityForm.patchValue({deviceData:d}),this.entityForm.markAsDirty())}}}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-device"]],features:[G],decls:77,vars:106,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[3,"disabled","credentials$","deviceId"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["required","","formControlName","deviceProfileId",3,"deviceProfileUpdated","deviceProfileChanged","selectDefaultProfile","showDetailsPageLink"],["matInput","","formControlName","label"],["formControlName","firmwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","softwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","deviceData","required",""],["formGroupName","additionalInfo",1,"flex","flex-col"],[1,"toggle-group"],["formControlName","gateway",2,"min-width","165px"],["formControlName","overwriteActivityTime",4,"ngIf"],["matInput","","formControlName","description","rows","2"],["formControlName","overwriteActivityTime"]],template:function(o,t){if(o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"makePublic")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"assignToCustomer")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromCustomer")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"manageCredentials")}),p(19),c(20,"translate"),r(),s(21,"button",1),c(22,"async"),C("click",function(f){return t.onEntityAction(f,"checkConnectivity")}),p(23),c(24,"translate"),r(),s(25,"button",1),c(26,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromEdge")}),p(27),c(28,"translate"),r(),s(29,"button",1),c(30,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(31),c(32,"translate"),r(),s(33,"div",2)(34,"button",3),c(35,"async"),C("cbOnSuccess",function(f){return t.onDeviceIdCopied(f)}),g(36,"mat-icon",4),s(37,"span",5),p(38,"device.copyId"),r()(),g(39,"tb-copy-device-credentials",6),c(40,"async"),r()(),s(41,"div",7)(42,"mat-form-field",8)(43,"mat-label",5),p(44,"device.assignedToCustomer"),r(),g(45,"input",9),r(),s(46,"div",10),p(47),c(48,"translate"),r(),s(49,"form",11)(50,"fieldset",12),c(51,"async"),s(52,"mat-form-field",8)(53,"mat-label",5),p(54,"device.name"),r(),g(55,"input",13),v(56,KS,3,3,"mat-error",14)(57,XS,3,3,"mat-error",14),r(),s(58,"tb-device-profile-autocomplete",15),C("deviceProfileUpdated",function(){return t.onDeviceProfileUpdated()})("deviceProfileChanged",function(f){return t.onDeviceProfileChanged(f)}),r(),s(59,"mat-form-field",8)(60,"mat-label",5),p(61,"device.label"),r(),g(62,"input",16),v(63,ZS,3,3,"mat-error",14),r(),g(64,"tb-ota-package-autocomplete",17)(65,"tb-ota-package-autocomplete",18)(66,"tb-device-data",19),s(67,"div",20)(68,"div",21)(69,"mat-slide-toggle",22),p(70),c(71,"translate"),r(),v(72,eT,3,3,"mat-slide-toggle",23),r(),s(73,"mat-form-field",8)(74,"mat-label",5),p(75,"device.description"),r(),g(76,"textarea",24),r()()()()()),o&2){let d,f;a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,64,t.isLoading$)),a(2),b(" ",u(4,66,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),m("disabled",u(6,68,t.isLoading$)),a(2),b(" ",u(8,70,"device.make-public")," "),a(2),j("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)),m("disabled",u(10,72,t.isLoading$)),a(2),b(" ",u(12,74,"device.assign-to-customer")," "),a(2),j("!hidden",t.isEdit||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),m("disabled",u(14,76,t.isLoading$)),a(2),b(" ",u(16,78,t.entity!=null&&t.entity.customerIsPublic?"device.make-private":"device.unassign-from-customer")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(18,80,t.isLoading$)),a(2),b(" ",u(20,82,t.deviceScope==="customer_user"||t.deviceScope==="edge_customer_user"?"device.view-credentials":"device.manage-credentials")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(22,84,t.isLoading$)),a(2),b(" ",u(24,86,"device.connectivity.check-connectivity")," "),a(2),j("!hidden",t.isEdit||t.deviceScope!=="edge"),m("disabled",u(26,88,t.isLoading$)),a(2),b(" ",u(28,90,"edge.unassign-from-edge")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(30,92,t.isLoading$)),a(2),b(" ",u(32,94,"device.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",u(35,96,t.isLoading$)),a(5),j("!hidden",t.isEdit),m("disabled",u(40,98,t.isLoading$))("credentials$",t.deviceCredentials$)("deviceId",t.entity==null?null:t.entity.id),a(3),j("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.deviceScope!=="tenant"),a(3),m("ngModel",t.entity==null?null:t.entity.customerTitle),a(),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"),a(),b(" ",u(48,100,"device.device-public")," "),a(2),m("formGroup",t.entityForm),a(),m("disabled",u(51,102,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(),m("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),a(5),m("ngIf",t.entityForm.get("label").hasError("maxlength")),a(),m("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.FIRMWARE)("deviceProfileId",(d=t.entityForm.get("deviceProfileId").value)==null?null:d.id),a(),m("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.SOFTWARE)("deviceProfileId",(f=t.entityForm.get("deviceProfileId").value)==null?null:f.id),a(5),b(" ",u(71,104,"device.is-gateway")," "),a(2),m("ngIf",t.entityForm.get("additionalInfo.gateway").value)}},dependencies:[U,te,re,be,de,Se,Fe,ht,Jt,ue,he,W,X,fe,Qe,ne,le,bt,J,P0,ws,Of,lm,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .toggle-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:16px;margin-bottom:16px}']});let i=n;return i})();S();var pm=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.entityType=O}deviceInfoFilterChanged(e){this.entitiesTableConfig.componentsData.deviceInfoFilter=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-device-table-header"]],features:[G],decls:1,vars:1,consts:[[3,"ngModelChange","ngModel"]],template:function(o,t){o&1&&(s(0,"tb-device-info-filter",0),C("ngModelChange",function(f){return t.deviceInfoFilterChanged(f)}),r()),o&2&&m("ngModel",t.entitiesTableConfig.componentsData.deviceInfoFilter)},dependencies:[W,Qe,Vf],encapsulation:2});let i=n;return i})();S();function iT(i,n){i&1&&g(0,"mat-progress-bar",11)}function nT(i,n){if(i&1&&(s(0,"section")(1,"form",12),g(2,"tb-device-credentials",13),r()()),i&2){let l=y();a(),m("formGroup",l.deviceCredentialsFormGroup),a(),m("deviceTransportType",l.deviceTransportType)}}function oT(i,n){i&1&&(s(0,"div",14),g(1,"mat-spinner",15),s(2,"span",16),p(3),c(4,"translate"),r()()),i&2&&(a(3),b(" ",u(4,1,"device.loading-device-credentials")," "))}function aT(i,n){if(i&1){let l=L();s(0,"button",17),c(1,"async"),C("click",function(){I(l);let o=y();return w(o.save())}),p(2),c(3,"translate"),r()}if(i&2){let l=y();m("disabled",u(1,2,l.isLoading$)||l.deviceCredentialsFormGroup.invalid||!l.deviceCredentialsFormGroup.dirty),a(2),b(" ",u(3,4,"action.save")," ")}}var dm=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D,M){super(e,o,D),this.store=e,this.router=o,this.data=t,this.deviceService=d,this.deviceProfileService=f,this.errorStateMatcher=_,this.dialogRef=D,this.fb=M,this.loadingCredentials=!0,this.submitted=!1,this.isReadOnly=t.isReadOnly}ngOnInit(){this.deviceCredentialsFormGroup=this.fb.group({credential:[null]}),this.isReadOnly&&this.deviceCredentialsFormGroup.disable({emitEvent:!1}),this.loadDeviceCredentials()}isErrorState(e,o){let t=this.errorStateMatcher.isErrorState(e,o),d=!!(e&&e.invalid&&this.submitted);return t||d}loadDeviceCredentials(){let e=[this.deviceService.getDeviceCredentials(this.data.deviceId),this.deviceProfileService.getDeviceProfileInfo(this.data.deviceProfileId)];jt(e).subscribe(([o,t])=>{this.deviceTransportType=t.transportType,this.deviceCredentials=o,this.deviceCredentialsFormGroup.patchValue({credential:o},{emitEvent:!1}),this.loadingCredentials=!1})}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0;let e=this.deviceCredentialsFormGroup.value.credential;this.deviceCredentials=Ce(Ce({},this.deviceCredentials),e),this.deviceService.saveDeviceCredentials(this.deviceCredentials).pipe(Hn(o=>o.status===Er.Conflict?this.deviceService.getDeviceCredentials(this.deviceCredentials.deviceId.id):vr(()=>o))).subscribe(o=>{this.dialogRef.close(o)})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(ma),h(os),h(en,4),h(it),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-device-credentials-dialog"]],features:[He([{provide:en,useExisting:n}]),G],decls:20,vars:15,consts:[["loadCredentials",""],["color","primary"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["color","warn","mode","indeterminate"],[3,"formGroup"],["formControlName","credential",3,"deviceTransportType"],[1,"flex","flex-col","items-center","justify-center"],["color","accent","diameter","65","strokeWidth","4",2,"margin-bottom","18px"],[1,"mat-subtitle-1",2,"margin-bottom","0"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",1)(1,"h2"),p(2),c(3,"translate"),r(),g(4,"span",2),s(5,"button",3),C("click",function(){return I(d),w(t.cancel())}),s(6,"mat-icon",4),p(7,"close"),r()()(),v(8,iT,1,0,"mat-progress-bar",5),c(9,"async"),s(10,"div",6),v(11,nT,3,2,"section",7)(12,oT,5,3,"ng-template",null,0,Et),r(),s(14,"div",8)(15,"button",9),c(16,"async"),C("click",function(){return I(d),w(t.cancel())}),p(17),c(18,"translate"),r(),v(19,aT,4,6,"button",10),r()}if(o&2){let d=q(13);a(2),B(u(3,7,"device.device-credentials")),a(6),m("ngIf",u(9,9,t.isLoading$)),a(3),m("ngIf",!t.loadingCredentials)("ngIfElse",d),a(4),m("disabled",u(16,11,t.isLoading$)),a(2),b(" ",u(18,13,t.isReadOnly?"action.close":"action.cancel")," "),a(2),m("ngIf",!t.isReadOnly)}},dependencies:[U,te,Ie,re,Ue,at,Nt,dt,to,ue,W,X,ne,le,Af,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;display:grid;grid-template-rows:min-content 4px auto min-content}@media screen and (min-width: 600px){[_nghost-%COMP%]{min-width:420px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{grid-row:4;display:flex;gap:8px;justify-content:flex-end;flex:1}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{grid-row:3;padding:24px 24px 4px}']});let i=n;return i})();S();function rT(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.CLIENT_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function sT(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function lT(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function mT(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"device.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function pT(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function dT(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function cT(i,n){if(i&1){let l=L();s(0,"mat-tab",8,6),c(2,"translate"),s(3,"tb-version-control",14),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var cm=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-device-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,rT,4,7,"mat-tab",7)(1,sT,4,7,"mat-tab",7)(2,lT,4,5,"mat-tab",7)(3,mT,4,7,"mat-tab",7)(4,pT,4,5,"mat-tab",7)(5,dT,4,6,"mat-tab",7)(6,cT,4,7,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,Ai,yi,_i,ai,R],encapsulation:2});let i=n;return i})();S();var qd=()=>({text:"",href:""}),Wd=(i,n,l)=>({noSecLabel:"HTTP",noSec:i,secLabel:"HTTPs",sec:n,doc:l}),Wn=i=>({cmd:i}),uT=()=>({text:"device.connectivity.sparkplug-command",href:"/"}),Ga=i=>({doc:i}),fT=()=>({text:"device.connectivity.install-mqtt-windows",href:"https://thingsboard.io/docs/reference/mqtt-api/?connectdevice=mqtt-windows#mqtt-connect"}),um=()=>({text:"device.connectivity.mqtts-x509-command",href:"https://thingsboard.io/docs/user-guide/mqtt-over-ssl/"}),fm=(i,n,l)=>({noSecLabel:"MQTT",noSec:i,secLabel:"MQTTs",sec:n,doc:l}),Sg=()=>({text:"device.connectivity.coaps-x509-command",href:"https://thingsboard.io/docs/user-guide/ssl/coap-x509-certificates/"}),Tg=(i,n,l)=>({noSecLabel:"CoAP",noSec:i,secLabel:"CoAPs",sec:n,doc:l}),gT=()=>({text:"device.connectivity.install-coap-client",href:"https://thingsboard.io/docs/user-guide/ssl/coap-access-token/"}),hT=()=>({text:"device.connectivity.snmp-command",href:"https://thingsboard.io/docs/reference/snmp-api/"}),bT=()=>({text:"device.connectivity.lwm2m-command",href:"https://thingsboard.io/docs/reference/lwm2m-api/"});function vT(i,n){if(i&1&&(s(0,"tb-toggle-option",32),p(1),c(2,"translate"),r()),i&2){let l=y(2);m("value",l.BasicTransportType.HTTP),a(),b(" ",u(2,2,l.deviceTransportTypeTranslationMap.get(l.BasicTransportType.HTTP))," ")}}function yT(i,n){if(i&1&&(s(0,"tb-toggle-option",32),p(1),c(2,"translate"),r()),i&2){let l=y(2);m("value",l.DeviceTransportType.MQTT),a(),b(" ",u(2,2,l.deviceTransportTypeTranslationMap.get(l.DeviceTransportType.MQTT))," ")}}function _T(i,n){if(i&1&&(s(0,"tb-toggle-option",32),p(1),c(2,"translate"),r()),i&2){let l=y(2);m("value",l.DeviceTransportType.COAP),a(),b(" ",u(2,2,l.deviceTransportTypeTranslationMap.get(l.DeviceTransportType.COAP))," ")}}function CT(i,n){if(i&1&&(s(0,"tb-toggle-option",32),p(1),c(2,"translate"),r()),i&2){let l=y(2);m("value",l.DeviceTransportType.SNMP),a(),b(" ",u(2,2,l.deviceTransportTypeTranslationMap.get(l.DeviceTransportType.SNMP))," ")}}function ST(i,n){if(i&1&&(s(0,"tb-toggle-option",32),p(1),c(2,"translate"),r()),i&2){let l=y(2);m("value",l.DeviceTransportType.LWM2M),a(),b(" ",u(2,2,l.deviceTransportTypeTranslationMap.get(l.DeviceTransportType.LWM2M))," ")}}function TT(i,n){i&1&&(g(0,"mat-icon",37),p(1," Windows "))}function xT(i,n){i&1&&Rt(0)}function ET(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),s(4,"div",39),p(5," device.connectivity.install-curl-windows "),r()(),v(6,xT,1,0,"ng-container",40),r()),i&2){let l=y(3),e=q(23);a(6),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(7,Wn,vn(3,Wd,l.commands.http.http,l.commands.http.https,Bt(2,qd))))}}function IT(i,n){i&1&&(g(0,"mat-icon",41),p(1," MacOS "))}function wT(i,n){i&1&&Rt(0)}function MT(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),s(4,"div",39),p(5," device.connectivity.install-curl-macos "),r()(),v(6,wT,1,0,"ng-container",40),r()),i&2){let l=y(3),e=q(23);a(6),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(7,Wn,vn(3,Wd,l.commands.http.http,l.commands.http.https,Bt(2,qd))))}}function DT(i,n){i&1&&(g(0,"mat-icon",42),p(1," Linux "))}function FT(i,n){i&1&&Rt(0)}function PT(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),g(4,"tb-markdown",43),r(),v(5,FT,1,0,"ng-container",40),r()),i&2){let l=y(3),e=q(23);a(4),m("data",l.createMarkDownCommand("sudo apt-get install curl")),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(8,Wn,vn(4,Wd,l.commands.http.http,l.commands.http.https,Bt(3,qd))))}}function AT(i,n){if(i&1){let l=L();s(0,"div",33),p(1," device.connectivity.use-following-instructions "),r(),s(2,"mat-tab-group",34),et("selectedIndexChange",function(o){I(l);let t=y(2);return Ze(t.httpTabIndex,o)||(t.httpTabIndex=o),w(o)}),s(3,"mat-tab"),v(4,TT,2,0,"ng-template",35)(5,ET,7,9,"ng-template",36),r(),s(6,"mat-tab"),v(7,IT,2,0,"ng-template",35)(8,MT,7,9,"ng-template",36),r(),s(9,"mat-tab"),v(10,DT,2,0,"ng-template",35)(11,PT,6,10,"ng-template",36),r()()}if(i&2){let l=y(2);a(2),Xe("selectedIndex",l.httpTabIndex)}}function NT(i,n){i&1&&Rt(0)}function kT(i,n){if(i&1&&(s(0,"div",23),v(1,NT,1,0,"ng-container",40),r()),i&2){y(3);let l=q(25);a(),m("ngTemplateOutlet",l)("ngTemplateOutletContext",pt(3,Ga,Bt(2,uT)))}}function OT(i,n){i&1&&(g(0,"mat-icon",37),p(1," Windows "))}function BT(i,n){i&1&&Rt(0)}function RT(i,n){i&1&&Rt(0)}function VT(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),s(4,"div",46),v(5,BT,1,0,"ng-container",40),r()(),v(6,RT,1,0,"ng-container",40),r()),i&2){let l=y(4),e=q(23),o=q(25);a(5),m("ngTemplateOutlet",o)("ngTemplateOutletContext",pt(5,Ga,Bt(4,fT))),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(12,Wn,vn(8,fm,l.commands.mqtt.mqtt,l.commands.mqtt.mqtts,Bt(7,um))))}}function jT(i,n){i&1&&(g(0,"mat-icon",41),p(1," MacOS "))}function LT(i,n){i&1&&Rt(0)}function GT(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),g(4,"tb-markdown",43),r(),v(5,LT,1,0,"ng-container",40),r()),i&2){let l=y(4),e=q(23);a(4),m("data",l.createMarkDownCommand("brew install mosquitto")),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(8,Wn,vn(4,fm,l.commands.mqtt.mqtt,l.commands.mqtt.mqtts,Bt(3,um))))}}function UT(i,n){i&1&&(g(0,"mat-icon",42),p(1," Linux "))}function qT(i,n){i&1&&Rt(0)}function WT(i,n){if(i&1&&(s(0,"div",38)(1,"div",23)(2,"div",25),p(3," device.connectivity.install-necessary-client-tools "),r(),g(4,"tb-markdown",43),r(),v(5,qT,1,0,"ng-container",40),r()),i&2){let l=y(4),e=q(23);a(4),m("data",l.createMarkDownCommand("sudo apt-get install curl mosquitto-clients")),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(8,Wn,vn(4,fm,l.commands.mqtt.mqtt,l.commands.mqtt.mqtts,Bt(3,um))))}}function HT(i,n){i&1&&(g(0,"mat-icon",47),p(1," Docker "))}function zT(i,n){i&1&&Rt(0)}function $T(i,n){if(i&1&&(s(0,"div",38),v(1,zT,1,0,"ng-container",40),r()),i&2){let l=y(5),e=q(23);a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(7,Wn,vn(3,fm,l.commands.mqtt.docker.mqtt,l.commands.mqtt.docker.mqtts,Bt(2,um))))}}function JT(i,n){i&1&&(s(0,"mat-tab"),v(1,HT,2,0,"ng-template",35)(2,$T,2,9,"ng-template",36),r())}function QT(i,n){if(i&1){let l=L();s(0,"div",33),p(1," device.connectivity.use-following-instructions "),r(),s(2,"mat-tab-group",34),et("selectedIndexChange",function(o){I(l);let t=y(3);return Ze(t.mqttTabIndex,o)||(t.mqttTabIndex=o),w(o)}),s(3,"mat-tab"),v(4,OT,2,0,"ng-template",35)(5,VT,7,14,"ng-template",36),r(),s(6,"mat-tab"),v(7,jT,2,0,"ng-template",35)(8,GT,6,10,"ng-template",36),r(),s(9,"mat-tab"),v(10,UT,2,0,"ng-template",35)(11,WT,6,10,"ng-template",36),r(),v(12,JT,3,0,"mat-tab",45),r()}if(i&2){let l=y(3);a(2),Xe("selectedIndex",l.mqttTabIndex),a(10),m("ngIf",!!l.commands.mqtt.docker)}}function YT(i,n){if(i&1&&v(0,kT,2,5,"div",44)(1,QT,13,2,"ng-template",null,5,Et),i&2){let l=q(2),e=y(2);m("ngIf",e.commands.mqtt.sparkplug)("ngIfElse",l)}}function KT(i,n){i&1&&(g(0,"mat-icon",42),p(1," Linux "))}function XT(i,n){i&1&&Rt(0)}function ZT(i,n){if(i&1&&(s(0,"div",23)(1,"div",25),p(2," device.connectivity.install-necessary-client-tools "),r(),s(3,"div",46),v(4,XT,1,0,"ng-container",40),r()()),i&2){y(4);let l=q(25);a(4),m("ngTemplateOutlet",l)("ngTemplateOutletContext",pt(3,Ga,Bt(2,gT)))}}function ex(i,n){i&1&&Rt(0)}function tx(i,n){if(i&1&&(s(0,"div",38),v(1,ZT,5,5,"div",48)(2,ex,1,0,"ng-container",40),r()),i&2){let l=y(3),e=q(23);a(),m("ngIf",l.commands.coap.coaps!=="Check documentation"),a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(8,Wn,vn(4,Tg,l.commands.coap.coap,l.commands.coap.coaps,Bt(3,Sg))))}}function ix(i,n){i&1&&(g(0,"mat-icon",47),p(1," Docker "))}function nx(i,n){i&1&&Rt(0)}function ox(i,n){if(i&1&&(s(0,"div",38),v(1,nx,1,0,"ng-container",40),r()),i&2){let l=y(4),e=q(23);a(),m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(7,Wn,vn(3,Tg,l.commands.coap.docker.coap,l.commands.coap.docker.coaps,Bt(2,Sg))))}}function ax(i,n){i&1&&(s(0,"mat-tab"),v(1,ix,2,0,"ng-template",35)(2,ox,2,9,"ng-template",36),r())}function rx(i,n){if(i&1){let l=L();s(0,"div",33),p(1," device.connectivity.use-following-instructions "),r(),s(2,"mat-tab-group",34),et("selectedIndexChange",function(o){I(l);let t=y(2);return Ze(t.coapTabIndex,o)||(t.coapTabIndex=o),w(o)}),s(3,"mat-tab"),v(4,KT,2,0,"ng-template",35)(5,tx,3,10,"ng-template",36),r(),v(6,ax,3,0,"mat-tab",45),r()}if(i&2){let l=y(2);a(2),Xe("selectedIndex",l.coapTabIndex),a(4),m("ngIf",!!l.commands.coap.docker)}}function sx(i,n){i&1&&Rt(0)}function lx(i,n){if(i&1&&(s(0,"div",23),v(1,sx,1,0,"ng-container",40),r()),i&2){y(2);let l=q(25);a(),m("ngTemplateOutlet",l)("ngTemplateOutletContext",pt(3,Ga,Bt(2,hT)))}}function mx(i,n){i&1&&Rt(0)}function px(i,n){if(i&1&&(s(0,"div",23),v(1,mx,1,0,"ng-container",40),r()),i&2){y(2);let l=q(25);a(),m("ngTemplateOutlet",l)("ngTemplateOutletContext",pt(3,Ga,Bt(2,bT)))}}function dx(i,n){if(i&1&&(s(0,"div",51)(1,"div",52),p(2),c(3,"date"),r(),s(4,"div",52),p(5),r(),s(6,"div",52),p(7),r()()),i&2){let l=n.$implicit;a(2),b(" ",Yt(3,3,l.lastUpdateTs,"yyyy-MM-dd HH:mm:ss")," "),a(3),B(l.key),a(2),b(" ",l.value," ")}}function cx(i,n){if(i&1&&(s(0,"div",49),v(1,dx,8,6,"div",50),r()),i&2){let l=y(2);a(),m("ngForOf",l.latestTelemetry)}}function ux(i,n){if(i&1&&(s(0,"section",18)(1,"tb-toggle-header",19,4),v(3,vT,3,4,"tb-toggle-option",20)(4,yT,3,4,"tb-toggle-option",20)(5,_T,3,4,"tb-toggle-option",20)(6,CT,3,4,"tb-toggle-option",20)(7,ST,3,4,"tb-toggle-option",20),r(),s(8,"div",18),Lt(9,21),v(10,AT,12,1,"ng-template",22)(11,YT,3,2,"ng-template",22)(12,rx,7,2,"ng-template",22)(13,lx,2,5,"ng-template",22)(14,px,2,5,"ng-template",22),Gt(),r(),s(15,"div",23)(16,"div",24)(17,"div",25),p(18,"device.state"),r(),s(19,"div",26),p(20),c(21,"translate"),r()(),s(22,"div",27),p(23," attribute.latest-telemetry "),r(),s(24,"div",28)(25,"div",29)(26,"div",30),p(27," device.time "),r(),s(28,"div",30),p(29," attribute.key "),r(),s(30,"div",30),p(31," attribute.value "),r()(),v(32,cx,2,1,"div",31),r()()()),i&2){let l=q(2),e=y(),o=q(21);a(),j("!hidden",e.allowTransportType.size<2),x("value",e.selectTransportType),a(2),m("ngIf",e.allowTransportType.has(e.BasicTransportType.HTTP)),a(),m("ngIf",e.allowTransportType.has(e.DeviceTransportType.MQTT)),a(),m("ngIf",e.allowTransportType.has(e.DeviceTransportType.COAP)),a(),m("ngIf",e.allowTransportType.has(e.DeviceTransportType.SNMP)),a(),m("ngIf",e.allowTransportType.has(e.DeviceTransportType.LWM2M)),a(),j("!hidden",!e.allowTransportType.size),a(),m("ngSwitch",l.value),a(),m("ngSwitchCase",e.BasicTransportType.HTTP),a(),m("ngSwitchCase",e.DeviceTransportType.MQTT),a(),m("ngSwitchCase",e.DeviceTransportType.COAP),a(),m("ngSwitchCase",e.DeviceTransportType.SNMP),a(),m("ngSwitchCase",e.DeviceTransportType.LWM2M),a(5),j("inactive",!e.status)("hide",e.status===void 0),a(),b(" ",u(21,23,e.status?"device.active":"device.inactive")," "),a(12),m("ngIf",e.latestTelemetry.length)("ngIfElse",o)}}function fx(i,n){i&1&&(s(0,"div",53),g(1,"mat-spinner",54),s(2,"span",55),p(3),c(4,"translate"),r()()),i&2&&(a(3),b(" ",u(4,1,"device.connectivity.loading-check-connectivity-command")," "))}function gx(i,n){i&1&&(s(0,"div",56),g(1,"div",57),s(2,"div",33),p(3,"attribute.no-latest-telemetry"),r()())}function hx(i,n){if(i&1&&g(0,"tb-markdown",43),i&2){let l=y().cmd,e=y();m("data",e.createMarkDownCommand(l.noSec))}}function bx(i,n){if(i&1&&(s(0,"div"),g(1,"tb-markdown",43),r()),i&2){let l=y(2).cmd,e=y();a(),m("data",e.createMarkDownCommand(l.sec))}}function vx(i,n){i&1&&Rt(0)}function yx(i,n){if(i&1&&v(0,vx,1,0,"ng-container",40),i&2){let l=y(2).cmd;y();let e=q(25);m("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(2,Ga,l.doc))}}function _x(i,n){if(i&1&&v(0,bx,2,1,"div",62)(1,yx,1,4,"ng-template",null,7,Et),i&2){let l=q(2),e=y().cmd;m("ngIf",e.sec!=="Check documentation")("ngIfElse",l)}}function Cx(i,n){if(i&1&&(s(0,"div",23)(1,"div",58)(2,"div",25),p(3," device.connectivity.execute-following-command "),r(),s(4,"tb-toggle-header",59,6)(6,"tb-toggle-option",60),p(7),r(),s(8,"tb-toggle-option",61),p(9),r()()(),Lt(10,21),v(11,hx,1,1,"ng-template",22)(12,_x,3,2,"ng-template",22),Gt(),r()),i&2){let l=n.cmd,e=q(5);a(),j("!hidden",!(l.noSec||l.sec!=="Check documentation")),a(3),j("!hidden",!l.noSec||!l.sec),x("value",l.noSec?"noSec":"sec"),a(3),B(l.noSecLabel),a(2),B(l.secLabel),a(),m("ngSwitch",e.value),a(),m("ngSwitchCase","noSec"),a(),m("ngSwitchCase","sec")}}function Sx(i,n){if(i&1&&(s(0,"div",63)(1,"div",64),p(2),c(3,"translate"),r(),s(4,"a",65)(5,"mat-icon"),p(6,"description"),r(),p(7),c(8,"translate"),r()()),i&2){let l=n.doc;a(2),B(u(3,3,l.text)),a(2),x("href",l.href,$n),a(3),b(" ",u(8,5,"common.documentation")," ")}}var gm=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.deviceService=f,this.telemetryWsService=_,this.zone=D,this.loadedCommand=!1,this.latestTelemetry=[],this.allowTransportType=new Set,this.BasicTransportType=od,this.DeviceTransportType=Ei,this.deviceTransportTypeTranslationMap=da,this.notShowAgain=!1,this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=0,this.currentTime=Date.now(),this.transportTypes=[...Object.keys(od),...Object.keys(Ei)],this.data.afterAdd?(this.dialogTitle="device.connectivity.device-created-check-connectivity",this.showDontShowAgain=!0):(this.dialogTitle="device.connectivity.check-connectivity",this.showDontShowAgain=!1)}ngOnInit(){this.loadCommands(),this.subscribeToLatestTelemetry()}ngOnDestroy(){super.ngOnDestroy(),this.telemetrySubscriber?.complete(),this.telemetrySubscriber?.unsubscribe()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayConnectivityAfterAddDevice:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let o=[];return e.forEach(t=>o.push(this.createMarkDownSingleCommand(t))),o.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}loadCommands(){this.deviceService.getDevicePublishTelemetryCommands(this.data.deviceId.id).subscribe(e=>{this.commands=e;let o=Object.keys(e);this.transportTypes.forEach(t=>{o.find(f=>f.toUpperCase().startsWith(t))&&this.allowTransportType.add(t)}),this.selectTransportType=this.allowTransportType.values().next().value,this.selectTabIndexForUserOS(),this.loadedCommand=!0})}subscribeToLatestTelemetry(){this.store.pipe(qt(Or)).pipe(mi(1)).subscribe(e=>{if(this.telemetrySubscriber=Hc.createEntityAttributesSubscription(this.telemetryWsService,this.data.deviceId,qc.LATEST_TELEMETRY,this.zone),!e){let o=new Wc;o.entityType=this.data.deviceId.entityType,o.entityId=this.data.deviceId.id,o.scope=Rr.SERVER_SCOPE,o.keys="active",this.telemetrySubscriber.subscriptionCommands.push(o)}this.telemetrySubscriber.subscribe(),this.telemetrySubscriber.attributeData$().subscribe(o=>{let t=o.reduce((d,f)=>(f.key==="active"?this.status=pi(f.value):f.lastUpdateTs>this.currentTime&&d.push(f),d),[]);this.latestTelemetry=t.sort((d,f)=>f.lastUpdateTs-d.lastUpdateTs)})})}selectTabIndexForUserOS(){switch(Pc()){case"linux":case"android":this.httpTabIndex=2,this.mqttTabIndex=2;break;case"macos":case"ios":this.httpTabIndex=1,this.mqttTabIndex=1,this.coapTabIndex=1;break;case"windows":this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=1;break;default:this.mqttTabIndex=this.commands.mqtt?.docker?3:0,this.coapTabIndex=this.commands.coap?.docker?1:0}}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it),h(ma),h(z0),h(Cr))},n.\u0275cmp=F({type:n,selectors:[["tb-device-check-connectivity-dialog"]],features:[G],decls:26,vars:15,consts:[["loadingCommand",""],["noData",""],["executeCommand",""],["seeDocumentation",""],["transportProtocol",""],["mqttCommands",""],["protocolType",""],["checkDocumentation",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],["name","TransportProtocol","useSelectOnMdLg","false","appearance","fill",3,"value"],[3,"value",4,"ngIf"],[3,"ngSwitch"],[3,"ngSwitchCase"],[1,"tb-form-panel","stroked"],[1,"flex","flex-1","flex-row"],["translate","",1,"tb-form-panel-title"],[1,"status"],["translate","",1,"tb-form-panel-hint","tb-font-14"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","flex-1"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[3,"value"],["translate","",1,"tb-no-data-text"],[3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","windows",1,"tabs-icon"],[1,"tb-form-panel","no-padding","no-border","tb-tab-body"],["translate","",1,"tb-install-instruction-text"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["svgIcon","macos",1,"tabs-icon"],["svgIcon","linux",1,"tabs-icon"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"tb-install-instruction-text"],["svgIcon","docker",1,"tabs-icon"],["class","tb-form-panel stroked",4,"ngIf"],[1,"tb-form-table-body"],["class","tb-form-table-row",4,"ngFor","ngForOf"],[1,"tb-form-table-row"],[1,"tb-form-table-row-cell","flex-1"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],[1,"flex","flex-row","items-center","justify-between"],["name","protocolType","useSelectOnMdLg","false",3,"value"],["value","noSec"],["value","sec"],[4,"ngIf","ngIfElse"],[1,"tb-form-row","no-border","no-padding","space-between"],[1,"tb-font-14","tb-flex-1"],["mat-stroked-button","","color","primary","target","_blank",3,"href"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",8)(1,"h2",9),p(2),r(),g(3,"span",10),s(4,"button",11),C("click",function(){return I(d),w(t.close())}),s(5,"mat-icon",12),p(6,"close"),r()()(),s(7,"div",13),v(8,ux,33,25,"section",14),r(),s(9,"div",15)(10,"mat-slide-toggle",16),et("ngModelChange",function(_){return I(d),Ze(t.notShowAgain,_)||(t.notShowAgain=_),w(_)}),p(11),c(12,"translate"),r(),g(13,"span",10),s(14,"button",17),c(15,"async"),C("click",function(){return I(d),w(t.close())}),p(16),c(17,"translate"),r()(),v(18,fx,5,3,"ng-template",null,0,Et)(20,gx,4,0,"ng-template",null,1,Et)(22,Cx,13,10,"ng-template",null,2,Et)(24,Sx,9,7,"ng-template",null,3,Et)}if(o&2){let d=q(19);a(2),B(t.dialogTitle),a(6),m("ngIf",t.loadedCommand)("ngIfElse",d),a(2),j("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),a(),B(u(12,9,"action.dont-show-again")),a(3),m("disabled",u(15,11,t.isLoading$)),a(2),b(" ",u(17,13,"action.close")," ")}},dependencies:[xe,U,Qn,yn,_n,sa,ea,te,Ie,re,at,Nt,dt,to,Qr,Yr,St,aa,ht,W,Qe,J,Eu,Di,me,Oe,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:12px;border-radius:12px;height:24px;line-height:24px;padding:0 8px;width:fit-content;color:#198038;background-color:#19803814;font-size:14px}[_nghost-%COMP%]   .status.inactive[_ngcontent-%COMP%]{color:#d12730;background-color:#d1273014}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]{border-radius:6px;background-color:#3056800a;padding:6px 16px}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]{max-height:108px;min-height:108px;overflow-y:auto;scrollbar-gutter:stable}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]   .tb-form-table-row[_ngcontent-%COMP%]{min-height:38px}[_nghost-%COMP%]   .tb-no-data-available[_ngcontent-%COMP%]   .tb-no-data-bg[_ngcontent-%COMP%]{min-height:68px}[_nghost-%COMP%]   .tb-install-instruction-text[_ngcontent-%COMP%]{min-height:42px}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:470px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:720px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:16px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;background:#f3f6fa;border-color:#305680;padding-right:38px;overflow:scroll;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']});let i=n;return i})();var Nn=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y,ke,Ke){this.store=e,this.broadcast=o,this.deviceService=t,this.customerService=d,this.dialogService=f,this.edgeService=_,this.homeDialogs=D,this.translate=M,this.datePipe=Y,this.router=ke,this.dialog=Ke,this.config=new Le,this.config.entityType=O.DEVICE,this.config.entityComponent=mm,this.config.entityTabsComponent=cm,this.config.entityTranslations=Ge.get(O.DEVICE),this.config.entityResources=tt.get(O.DEVICE),this.config.addDialogStyle={width:"600px"},this.config.deleteEntityTitle=xt=>this.translate.instant("device.delete-device-title",{deviceName:xt.name}),this.config.deleteEntityContent=()=>this.translate.instant("device.delete-device-text"),this.config.deleteEntitiesTitle=xt=>this.translate.instant("device.delete-devices-title",{count:xt}),this.config.deleteEntitiesContent=()=>this.translate.instant("device.delete-devices-text"),this.config.loadEntity=xt=>this.deviceService.getDeviceInfo(xt.id),this.config.saveEntity=xt=>this.deviceService.saveDevice(xt).pipe(Ot(()=>{this.broadcast.broadcast("deviceSaved")}),_t(za=>this.deviceService.getDeviceInfo(za.id.id))),this.config.onEntityAction=xt=>this.onDeviceAction(xt,this.config),this.config.detailsReadonly=()=>this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user",this.config.onLoadAction=xt=>this.onLoadAction(xt),this.config.headerComponent=pm}resolve(e){let o=e.params;return this.config.componentsData={deviceScope:e.data.devicesType,deviceInfoFilter:{},deviceCredentials$:new Ft,edgeId:o.edgeId},this.customerId=o.customerId,this.config.componentsData.edgeId=o.edgeId,this.store.pipe(qt(Sn),mi(1)).pipe(Ot(t=>{t.authority===E.CUSTOMER_USER&&(e.data.devicesType==="edge"?this.config.componentsData.deviceScope="edge_customer_user":this.config.componentsData.deviceScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):Ct(null)),rt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-devices"):this.config.tableTitle=t.title+": "+this.translate.instant("device.devices"):this.config.componentsData.deviceScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(d=>this.config.tableTitle=d.name+": "+this.translate.instant("device.devices")):this.config.tableTitle=this.translate.instant("device.devices"),this.config.columns=this.configureColumns(this.config.componentsData.deviceScope),this.configureEntityFunctions(this.config.componentsData.deviceScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.deviceScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.deviceScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.deviceScope),this.config.addEnabled=!(this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.deviceScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.deviceScope==="tenant",this.config)))}onLoadAction(e){let o=e.snapshot.queryParams;if(o){let t=Tt(o),d=!1;o?.deviceProfileId&&(this.config.componentsData.deviceInfoFilter.deviceProfileId=new Z0(o?.deviceProfileId),delete t.deviceProfileId,d=!0),On(o?.active)&&(this.config.componentsData.deviceInfoFilter.active=o?.active===!0||o?.active==="true",delete t.active,d=!0),d&&this.router.navigate([],{relativeTo:e,queryParams:t,queryParamsHandling:"",replaceUrl:!0})}}configureColumns(e){let o=[new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","device.name","25%"),new K("deviceProfileName","device-profile.device-profile","25%"),new K("label","device.label","25%"),new K("active","device.state","80px",t=>this.deviceState(t),t=>this.deviceStateStyle(t))];return e==="tenant"&&o.push(new K("customerTitle","customer.customer","25%"),new K("customerIsPublic","device.public","60px",t=>Dt(t.customerIsPublic),()=>({}))),o.push(new K("gateway","device.is-gateway","60px",t=>Dt(t.additionalInfo&&t.additionalInfo.gateway),()=>({}),!1)),o}deviceState(e){let o="device.active",t="rgba(25, 128, 56, 0.08)";return e.active||(o="device.inactive",t="rgba(209, 39, 48, 0.08)"),`<div class="status" style="border-radius: 16px; height: 32px;
                line-height: 32px; padding: 0 12px; width: fit-content; background-color: ${t}">
                ${this.translate.instant(o)}
            </div>`}deviceStateStyle(e){let o={fontSize:"14px",color:"#198038",cursor:"pointer"};return e.active||(o.color="#d12730"),o}configureEntityFunctions(e){this.config.entitiesFetchFunction=o=>this.deviceService.getDeviceInfosByQuery(this.prepareDeviceInfoQuery(o)),e==="tenant"?this.config.deleteEntity=o=>this.deviceService.deleteDevice(o.id):this.config.deleteEntity=()=>Ct()}prepareDeviceInfoQuery(e){let o=Tt(this.config.componentsData.deviceInfoFilter);return this.config.componentsData.deviceScope==="edge"||this.config.componentsData.deviceScope==="edge_customer_user"?o.edgeId=new ef(this.config.componentsData.edgeId):this.config.componentsData.deviceScope!=="tenant"&&(o.customerId=new Ko(this.customerId)),new Uu(e,o)}configureCellActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("device.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.makePublic(t,d)},{name:this.translate.instant("device.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.assignToCustomer(t,[d.id])},{name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,d)=>this.manageCredentials(t,d)}),e==="customer"&&o.push({name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,d)=>this.manageCredentials(t,d)}),(e==="customer_user"||e==="edge_customer_user")&&o.push({name:this.translate.instant("device.view-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,d)=>this.manageCredentials(t,d)}),e==="edge"&&o.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,d)=>this.unassignFromEdge(t,d)}),o}configureGroupActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("device.assign-devices"),icon:"assignment_ind",isEnabled:!0,onAction:(t,d)=>this.assignToCustomer(t,d.map(f=>f.id))}),e==="customer"&&o.push({name:this.translate.instant("device.unassign-devices"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignDevicesFromCustomer(t,d)}),e==="edge"&&o.push({name:this.translate.instant("device.unassign-devices-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignDevicesFromEdge(t,d)}),o}configureAddActions(e){this.config.addEntity=null;let o=[];return e==="tenant"&&(o.push({name:this.translate.instant("device.add-device-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.deviceWizard(t)},{name:this.translate.instant("device.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importDevices(t)}),this.config.addEntity=()=>(this.deviceWizard(null),Ct(null))),e==="customer"&&o.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToCustomer(t)}),e==="edge"&&o.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToEdge(t)}),o}openDevice(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}importDevices(e){this.homeDialogs.importEntities(O.DEVICE).subscribe(o=>{o&&(this.broadcast.broadcast("deviceSaved"),this.config.updateData())})}deviceWizard(e){this.dialog.open(Nf,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(o=>{o&&this.store.pipe(qt(Yo("notDisplayConnectivityAfterAddDevice"))).pipe(mi(1)).subscribe(t=>{t?this.config.updateData():this.checkConnectivity(null,o.id,!0)})})}addDevicesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:O.DEVICE}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}makePublic(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.make-public-device-title",{deviceName:o.name}),this.translate.instant("device.make-public-device-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.makeDevicePublic(o.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,o){e&&e.stopPropagation(),this.dialog.open(ao,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:o,entityType:O.DEVICE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,o){e&&e.stopPropagation();let t=o.customerIsPublic,d,f;t?(d=this.translate.instant("device.make-private-device-title",{deviceName:o.name}),f=this.translate.instant("device.make-private-device-text")):(d=this.translate.instant("device.unassign-device-title",{deviceName:o.name}),f=this.translate.instant("device.unassign-device-text")),this.dialogService.confirm(d,f,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.deviceService.unassignDeviceFromCustomer(o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromCustomer(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-title",{count:o.length}),this.translate.instant("device.unassign-devices-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.deviceService.unassignDeviceFromCustomer(f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}manageCredentials(e,o){e&&e.stopPropagation(),this.dialog.open(dm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:o.id.id,deviceProfileId:o.deviceProfileId.id,isReadOnly:this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"}}).afterClosed().subscribe(t=>{Be(t)&&this.config.componentsData.deviceCredentials$.next(t)})}onDeviceAction(e,o){switch(e.action){case"open":return this.openDevice(e.event,e.entity,o),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"manageCredentials":return this.manageCredentials(e.event,e.entity),!0;case"checkConnectivity":return this.checkConnectivity(e.event,e.entity.id),!0}return!1}addDevicesToEdge(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:O.DEVICE}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}unassignFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-device-from-edge-title",{deviceName:o.name}),this.translate.instant("device.unassign-device-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-from-edge-title",{count:o.length}),this.translate.instant("device.unassign-devices-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}checkConnectivity(e,o,t=!1){e&&e.stopPropagation(),this.dialog.open(gm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:o,afterAdd:t}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Tn),P(ma),P(qi),P(Wt),P(Wi),P(An),P(ee),P(Oe),P(pe),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();function xx(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"asset.name-required")," "))}function Ex(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"asset.name-max-length")," "))}function Ix(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"asset.label-max-length")," "))}function wx(i,n){if(i&1&&g(0,"tb-entity-autocomplete",19),i&2){let l=y();m("entityType",l.entityType.CUSTOMER)}}var hm=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.entityType=O}ngOnInit(){this.assetScope=this.entitiesTableConfig.componentsData.assetScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){return this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],assetProfileId:[e?e.assetProfileId:null,[T.required]],label:[e?e.label:"",T.maxLength(255)],customerId:[e?e.customerId:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({assetProfileId:e.assetProfileId}),this.entityForm.patchValue({label:e.label}),this.entityForm.patchValue({customerId:e.customerId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onAssetIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("asset.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onAssetProfileUpdated(){this.entitiesTableConfig.updateData(!1)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-asset"]],features:[G],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","label"],["required","","formControlName","assetProfileId",3,"assetProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"makePublic")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"assignToCustomer")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromCustomer")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromEdge")}),p(19),c(20,"translate"),r(),s(21,"button",1),c(22,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(23),c(24,"translate"),r(),s(25,"div",2)(26,"button",3),C("cbOnSuccess",function(f){return t.onAssetIdCopied(f)}),g(27,"mat-icon",4),s(28,"span",5),p(29,"asset.copyId"),r()()()(),s(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"asset.assignedToCustomer"),r(),g(34,"input",8),r(),s(35,"div",9),p(36),c(37,"translate"),r(),s(38,"form",10)(39,"fieldset",11),c(40,"async"),s(41,"mat-form-field",7)(42,"mat-label",5),p(43,"asset.name"),r(),g(44,"input",12),v(45,xx,3,3,"mat-error",13)(46,Ex,3,3,"mat-error",13),r(),s(47,"mat-form-field",7)(48,"mat-label",5),p(49,"asset.label"),r(),g(50,"input",14),v(51,Ix,3,3,"mat-error",13),r(),s(52,"tb-asset-profile-autocomplete",15),C("assetProfileUpdated",function(){return t.onAssetProfileUpdated()}),r(),v(53,wx,1,1,"tb-entity-autocomplete",16),s(54,"div",17)(55,"mat-form-field",7)(56,"mat-label",5),p(57,"asset.description"),r(),g(58,"textarea",18),r()()()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,41,t.isLoading$)),a(2),b(" ",u(4,43,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),m("disabled",u(6,45,t.isLoading$)),a(2),b(" ",u(8,47,"asset.make-public")," "),a(2),j("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)),m("disabled",u(10,49,t.isLoading$)),a(2),b(" ",u(12,51,"asset.assign-to-customer")," "),a(2),j("!hidden",t.isEdit||t.assetScope!=="customer"&&t.assetScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),m("disabled",u(14,53,t.isLoading$)),a(2),b(" ",u(16,55,t.entity!=null&&t.entity.customerIsPublic?"asset.make-private":"asset.unassign-from-customer")," "),a(2),j("!hidden",t.isEdit||t.assetScope!=="edge"),m("disabled",u(18,57,t.isLoading$)),a(2),b(" ",u(20,59,"edge.unassign-from-edge")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(22,61,t.isLoading$)),a(2),b(" ",u(24,63,"asset.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),j("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.assetScope!=="tenant"),a(3),m("ngModel",t.entity==null?null:t.entity.customerTitle),a(),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.assetScope!=="customer"&&t.assetScope!=="tenant"),a(),b(" ",u(37,65,"asset.asset-public")," "),a(2),m("formGroup",t.entityForm),a(),m("disabled",u(40,67,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(5),m("ngIf",t.entityForm.get("label").hasError("maxlength")),a(),m("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),a(),m("ngIf",t.isAdd))},dependencies:[U,ca,te,re,be,de,Se,Fe,Jt,ue,he,W,X,fe,Qe,ne,le,bt,J,Ms,me,R],styles:['@charset "UTF-8";']});let i=n;return i})();S();var bm=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.entityType=O}assetProfileChanged(e){this.entitiesTableConfig.componentsData.assetProfileId=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-asset-table-header"]],features:[G],decls:1,vars:4,consts:[["subscriptSizing","dynamic",3,"ngModelChange","ngModel","addNewProfile","displayAllOnEmpty","editProfileEnabled"]],template:function(o,t){o&1&&(s(0,"tb-asset-profile-autocomplete",0),C("ngModelChange",function(f){return t.assetProfileChanged(f)}),r()),o&2&&m("ngModel",t.entitiesTableConfig.componentsData.assetProfileId)("addNewProfile",!1)("displayAllOnEmpty",!0)("editProfileEnabled",!1)},dependencies:[W,Qe,Ms],encapsulation:2});let i=n;return i})();S();function Mx(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function Dx(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function Fx(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function Px(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"asset.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function Ax(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function Nx(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function kx(i,n){if(i&1){let l=L();s(0,"mat-tab",8,6),c(2,"translate"),s(3,"tb-version-control",14),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var vm=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-asset-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,Mx,4,7,"mat-tab",7)(1,Dx,4,7,"mat-tab",7)(2,Fx,4,5,"mat-tab",7)(3,Px,4,7,"mat-tab",7)(4,Ax,4,5,"mat-tab",7)(5,Nx,4,6,"mat-tab",7)(6,kx,4,7,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,Ai,yi,_i,ai,R],encapsulation:2});let i=n;return i})();var kn=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y,ke,Ke){this.store=e,this.broadcast=o,this.assetService=t,this.customerService=d,this.edgeService=f,this.dialogService=_,this.homeDialogs=D,this.translate=M,this.datePipe=Y,this.router=ke,this.dialog=Ke,this.config=new Le,this.config.entityType=O.ASSET,this.config.entityComponent=hm,this.config.entityTabsComponent=vm,this.config.entityTranslations=Ge.get(O.ASSET),this.config.entityResources=tt.get(O.ASSET),this.config.deleteEntityTitle=xt=>this.translate.instant("asset.delete-asset-title",{assetName:xt.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset.delete-asset-text"),this.config.deleteEntitiesTitle=xt=>this.translate.instant("asset.delete-assets-title",{count:xt}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset.delete-assets-text"),this.config.loadEntity=xt=>this.assetService.getAssetInfo(xt.id),this.config.saveEntity=xt=>this.assetService.saveAsset(xt).pipe(Ot(()=>{this.broadcast.broadcast("assetSaved")}),_t(za=>this.assetService.getAssetInfo(za.id.id))),this.config.onEntityAction=xt=>this.onAssetAction(xt,this.config),this.config.detailsReadonly=()=>this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user",this.config.headerComponent=bm}resolve(e){let o=e.params;return this.config.componentsData={assetScope:e.data.assetsType,assetProfileId:null,assetType:"",edgeId:o.edgeId},this.customerId=o.customerId,this.store.pipe(qt(Sn),mi(1)).pipe(Ot(t=>{t.authority===E.CUSTOMER_USER&&(e.data.assetsType==="edge"?this.config.componentsData.assetScope="edge_customer_user":this.config.componentsData.assetScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):Ct(null)),rt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-assets"):this.config.tableTitle=t.title+": "+this.translate.instant("asset.assets"):this.config.componentsData.assetScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(d=>this.config.tableTitle=d.name+": "+this.translate.instant("asset.assets")):this.config.tableTitle=this.translate.instant("asset.assets"),this.config.columns=this.configureColumns(this.config.componentsData.assetScope),this.configureEntityFunctions(this.config.componentsData.assetScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.assetScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.assetScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.assetScope),this.config.addEnabled=!(this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.assetScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.assetScope==="tenant",this.config)))}configureColumns(e){let o=[new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","asset.name","25%"),new K("assetProfileName","asset-profile.asset-profile","25%"),new K("label","asset.label","25%")];return e==="tenant"&&o.push(new K("customerTitle","customer.customer","25%"),new K("customerIsPublic","asset.public","60px",t=>Dt(t.customerIsPublic),()=>({}),!1)),o}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=o=>this.assetService.getTenantAssetInfosByAssetProfileId(o,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=o=>this.assetService.deleteAsset(o.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=o=>this.assetService.getEdgeAssets(this.config.componentsData.edgeId,o,this.config.componentsData.assetType):(this.config.entitiesFetchFunction=o=>this.assetService.getCustomerAssetInfosByAssetProfileId(this.customerId,o,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=o=>this.assetService.unassignAssetFromCustomer(o.id))}configureCellActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("asset.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.makePublic(t,d)},{name:this.translate.instant("asset.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.assignToCustomer(t,[d.id])},{name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)}),e==="customer"&&o.push({name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)}),e==="edge"&&o.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,d)=>this.unassignFromEdge(t,d)}),o}configureGroupActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("asset.assign-assets"),icon:"assignment_ind",isEnabled:!0,onAction:(t,d)=>this.assignToCustomer(t,d.map(f=>f.id))}),e==="customer"&&o.push({name:this.translate.instant("asset.unassign-assets"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignAssetsFromCustomer(t,d)}),e==="edge"&&o.push({name:this.translate.instant("asset.unassign-assets-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignAssetsFromEdge(t,d)}),o}configureAddActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("asset.add-asset-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("asset.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importAssets(t)}),e==="customer"&&o.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToCustomer(t)}),e==="edge"&&o.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToEdge(t)}),o}importAssets(e){this.homeDialogs.importEntities(O.ASSET).subscribe(o=>{o&&(this.broadcast.broadcast("assetSaved"),this.config.updateData())})}openAsset(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}addAssetsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:O.ASSET}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}makePublic(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.make-public-asset-title",{assetName:o.name}),this.translate.instant("asset.make-public-asset-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.makeAssetPublic(o.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,o){e&&e.stopPropagation(),this.dialog.open(ao,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:o,entityType:O.ASSET}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,o){e&&e.stopPropagation();let t=o.customerIsPublic,d,f;t?(d=this.translate.instant("asset.make-private-asset-title",{assetName:o.name}),f=this.translate.instant("asset.make-private-asset-text")):(d=this.translate.instant("asset.unassign-asset-title",{assetName:o.name}),f=this.translate.instant("asset.unassign-asset-text")),this.dialogService.confirm(d,f,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.assetService.unassignAssetFromCustomer(o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromCustomer(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-title",{count:o.length}),this.translate.instant("asset.unassign-assets-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.assetService.unassignAssetFromCustomer(f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}onAssetAction(e,o){switch(e.action){case"open":return this.openAsset(e.event,e.entity,o),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addAssetsToEdge(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:O.ASSET}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}unassignFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-asset-from-edge-title",{assetName:o.name}),this.translate.instant("asset.unassign-asset-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-from-edge-title",{count:o.length}),this.translate.instant("asset.unassign-assets-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Tn),P(Nu),P(qi),P(Wi),P(Wt),P(An),P(ee),P(Oe),P(pe),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();function Bx(i,n){if(i&1){let l=L();Lt(0),s(1,"button",1),c(2,"async"),C("click",function(o){I(l);let t=y();return w(t.onEntityAction(o,"openInstallInstructions"))}),s(3,"mat-icon"),p(4,"info_outline"),r(),s(5,"span"),p(6),c(7,"translate"),r()(),Gt()}if(i&2){let l=y();a(),j("!hidden",l.isEdit||l.edgeScope==="customer_user"),m("disabled",u(2,4,l.isLoading$)),a(5),B(u(7,6,"edge.install-connect-instructions"))}}function Rx(i,n){if(i&1){let l=L();Lt(0),s(1,"button",1),c(2,"async"),C("click",function(o){I(l);let t=y();return w(t.onEntityAction(o,"openUpgradeInstructions"))}),s(3,"mat-icon"),p(4,"info_outline"),r(),s(5,"span"),p(6),c(7,"translate"),r()(),Gt()}if(i&2){let l=y();a(),j("!hidden",l.isEdit||l.edgeScope==="customer_user"),m("disabled",u(2,4,l.isLoading$)),a(5),B(u(7,6,"edge.upgrade-instructions"))}}function Vx(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"edge.name-required")," "))}function jx(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"edge.name-max-length")," "))}function Lx(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"edge.label-max-length")," "))}var ym=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_,D){super(e,_,d,f,D),this.store=e,this.translate=o,this.edgeService=t,this.entityValue=d,this.entitiesTableConfigValue=f,this.fb=_,this.cd=D,this.entityType=O,this.upgradeAvailable=!1}ngOnInit(){this.edgeScope=this.entitiesTableConfig.componentsData.edgeScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){let o=this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],type:[e?.type?e.type:"default",[T.required,T.maxLength(255)]],label:[e?e.label:"",T.maxLength(255)],routingKey:this.fb.control({value:e?e.routingKey:null,disabled:!0}),secret:this.fb.control({value:e?e.secret:null,disabled:!0}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.generateRoutingKeyAndSecret(e,o),o}updateForm(e){this.entityForm.patchValue({name:e.name,type:e.type,label:e.label,routingKey:e.routingKey,secret:e.secret,additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.generateRoutingKeyAndSecret(e,this.entityForm),this.edgeService.isEdgeUpgradeAvailable(this.entity.id.id).subscribe(o=>{this.upgradeAvailable=o})}updateFormState(){super.updateFormState(),this.entityForm.get("routingKey").disable({emitEvent:!1}),this.entityForm.get("secret").disable({emitEvent:!1})}onEdgeIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("edge.id-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onEdgeInfoCopied(e){let o=e==="key"?"edge.edge-key-copied-message":"edge.edge-secret-copied-message";this.store.dispatch(new ze({message:this.translate.instant(o),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}generateRoutingKeyAndSecret(e,o){e&&!e.id&&(o.get("routingKey").patchValue(Dc(),{emitEvent:!1}),o.get("secret").patchValue(Fc(20),{emitEvent:!1}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h(Wi),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-edge"]],features:[G],decls:112,vars:138,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","flex-wrap","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],["mat-raised-button","","ngxClipboard","",3,"click","disabled"],["svgIcon","mdi:sync"],[1,"flex","flex-row","xs:flex-col"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-row"],[1,"mat-block","flex-1"],["matInput","","formControlName","routingKey"],["mat-icon-button","","type","button","ngxClipboard","",3,"cbOnSuccess","cbContent","matTooltip"],["matInput","","formControlName","secret"],["matInput","","formControlName","label"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"makePublic")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"assignToCustomer")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromCustomer")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"openEdgeAssets")}),p(19),c(20,"translate"),r(),s(21,"button",1),c(22,"async"),C("click",function(f){return t.onEntityAction(f,"openEdgeDevices")}),p(23),c(24,"translate"),r(),s(25,"button",1),c(26,"async"),C("click",function(f){return t.onEntityAction(f,"openEdgeEntityViews")}),p(27),c(28,"translate"),r(),s(29,"button",1),c(30,"async"),C("click",function(f){return t.onEntityAction(f,"openEdgeDashboards")}),p(31),c(32,"translate"),r(),s(33,"button",1),c(34,"async"),C("click",function(f){return t.onEntityAction(f,"openEdgeRuleChains")}),p(35),c(36,"translate"),r(),s(37,"button",1),c(38,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(39),c(40,"translate"),r(),s(41,"div",2)(42,"button",3),c(43,"async"),C("cbOnSuccess",function(f){return t.onEdgeIdCopied(f)}),g(44,"mat-icon",4),s(45,"span",5),p(46,"edge.copy-id"),r()(),s(47,"button",3),c(48,"async"),C("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),g(49,"mat-icon",4),s(50,"span",5),p(51,"edge.copy-edge-key"),r()(),s(52,"button",3),c(53,"async"),C("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),g(54,"mat-icon",4),s(55,"span",5),p(56,"edge.copy-edge-secret"),r()(),s(57,"button",6),c(58,"async"),C("click",function(f){return t.onEntityAction(f,"syncEdge")}),g(59,"mat-icon",7),s(60,"span",5),p(61,"edge.sync"),r()()(),s(62,"div",8)(63,"div",9),v(64,Bx,8,8,"ng-container",10)(65,Rx,8,8,"ng-container",10),r()()(),s(66,"div",11)(67,"mat-form-field",12)(68,"mat-label",5),p(69,"edge.assignedToCustomer"),r(),g(70,"input",13),r(),s(71,"div",14),p(72),c(73,"translate"),r(),s(74,"form",15)(75,"fieldset",16),c(76,"async"),s(77,"mat-form-field",12)(78,"mat-label",5),p(79,"edge.name"),r(),g(80,"input",17),v(81,Vx,3,3,"mat-error",18)(82,jx,3,3,"mat-error",18),r(),g(83,"tb-entity-subtype-autocomplete",19),r(),s(84,"div",20)(85,"mat-form-field",21)(86,"mat-label",5),p(87,"edge.edge-key"),r(),g(88,"input",22),r(),s(89,"button",23),c(90,"translate"),C("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),g(91,"mat-icon",4),r()(),s(92,"div",20)(93,"mat-form-field",21)(94,"mat-label",5),p(95,"edge.edge-secret"),r(),g(96,"input",24),r(),s(97,"button",23),c(98,"translate"),C("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),g(99,"mat-icon",4),r()(),s(100,"fieldset",16),c(101,"async"),s(102,"mat-form-field",12)(103,"mat-label",5),p(104,"edge.label"),r(),g(105,"input",25),v(106,Lx,3,3,"mat-error",18),r(),s(107,"div",26)(108,"mat-form-field",12)(109,"mat-label",5),p(110,"edge.description"),r(),g(111,"textarea",27),r()()()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,80,t.isLoading$)),a(2),b(" ",u(4,82,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),m("disabled",u(6,84,t.isLoading$)),a(2),b(" ",u(8,86,"edge.make-public")," "),a(2),j("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)),m("disabled",u(10,88,t.isLoading$)),a(2),b(" ",u(12,90,"edge.assign-to-customer")," "),a(2),j("!hidden",t.isEdit||t.edgeScope!=="customer"&&t.edgeScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),m("disabled",u(14,92,t.isLoading$)),a(2),b(" ",u(16,94,t.entity!=null&&t.entity.customerIsPublic?"edge.make-private":"edge.unassign-from-customer")," "),a(2),j("!hidden",t.isEdit||t.edgeScope==="customer"),m("disabled",u(18,96,t.isLoading$)),a(2),b(" ",u(20,98,"edge.manage-assets")," "),a(2),j("!hidden",t.isEdit||t.edgeScope==="customer"),m("disabled",u(22,100,t.isLoading$)),a(2),b(" ",u(24,102,"edge.manage-devices")," "),a(2),j("!hidden",t.isEdit||t.edgeScope==="customer"),m("disabled",u(26,104,t.isLoading$)),a(2),b(" ",u(28,106,"edge.manage-entity-views")," "),a(2),j("!hidden",t.isEdit||t.edgeScope==="customer"),m("disabled",u(30,108,t.isLoading$)),a(2),b(" ",u(32,110,"edge.manage-dashboards")," "),a(2),j("!hidden",t.isEdit||t.edgeScope!=="tenant"),m("disabled",u(34,112,t.isLoading$)),a(2),b(" ",u(36,114,"edge.manage-rulechains")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(38,116,t.isLoading$)),a(2),b(" ",u(40,118,"edge.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",u(43,120,t.isLoading$)),a(5),j("!hidden",t.isEdit||t.edgeScope==="customer_user"),m("cbContent",t.entity==null?null:t.entity.routingKey)("disabled",u(48,122,t.isLoading$)),a(5),j("!hidden",t.isEdit||t.edgeScope==="customer_user"),m("cbContent",t.entity==null?null:t.entity.secret)("disabled",u(53,124,t.isLoading$)),a(5),j("!hidden",t.isEdit||t.edgeScope==="customer_user"),m("disabled",u(58,126,t.isLoading$)),a(6),m("ngSwitch",t.upgradeAvailable),a(),m("ngSwitchCase",!1),a(),m("ngSwitchCase",!0),a(2),j("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.edgeScope!=="tenant"),a(3),m("ngModel",t.entity==null?null:t.entity.customerTitle),a(),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.edgeScope!=="tenant"),a(),b(" ",u(73,128,"edge.edge-public")," "),a(2),m("formGroup",t.entityForm),a(),m("disabled",u(76,130,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(),m("required",!0)("entityType",t.entityType.EDGE),a(),j("!hidden",t.edgeScope==="customer_user"),a(5),x("matTooltip",u(90,132,"edge.copy-edge-key")),m("cbContent",t.entityForm==null?null:t.entityForm.get("routingKey").value),a(3),j("!hidden",t.edgeScope==="customer_user"),a(5),x("matTooltip",u(98,134,"edge.copy-edge-secret")),m("cbContent",t.entityForm==null?null:t.entityForm.get("secret").value),a(3),m("disabled",u(101,136,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("label").hasError("maxlength")))},dependencies:[U,yn,_n,rs,te,Ie,re,be,de,Se,Fe,Mt,Jt,ue,he,W,X,fe,Qe,ne,le,bt,J,me,R],styles:['@charset "UTF-8";']});let i=n;return i})();S();var _m=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.entityType=O}edgeTypeChanged(e){this.entitiesTableConfig.componentsData.edgeType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-edge-table-header"]],features:[G],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(o,t){o&1&&(s(0,"tb-entity-subtype-select",0),C("ngModelChange",function(f){return t.edgeTypeChanged(f)}),r()),o&2&&m("showLabel",!0)("entityType",t.entityType.EDGE)("ngModel",t.entitiesTableConfig.componentsData.edgeType)},dependencies:[ss,W,Qe],encapsulation:2});let i=n;return i})();S();function Ux(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function qx(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function Wx(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function Hx(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"edge.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function zx(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-edge-downlink-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"edge.downlinks")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function $x(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function Jx(i,n){if(i&1&&(s(0,"mat-tab",8,6),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}var Cm=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-edge-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["downLinksTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"]],template:function(o,t){o&1&&v(0,Ux,4,7,"mat-tab",7)(1,qx,4,7,"mat-tab",7)(2,Wx,4,5,"mat-tab",7)(3,Hx,4,7,"mat-tab",7)(4,zx,4,5,"mat-tab",7)(5,$x,4,5,"mat-tab",7)(6,Jx,4,6,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,kf,Ai,yi,_i,R],encapsulation:2});let i=n;return i})();S();function Qx(i,n){i&1&&(g(0,"mat-icon",15),p(1," Ubuntu "))}function Yx(i,n){if(i&1&&(s(0,"div",11)(1,"div",16),g(2,"tb-markdown",17),r()()),i&2){let l=y(2);a(2),m("data",l.contentData.ubuntu)}}function Kx(i,n){i&1&&(g(0,"mat-icon",18),p(1," CentOS/RHEL "))}function Xx(i,n){if(i&1&&(s(0,"div",11)(1,"div",16),g(2,"tb-markdown",17),r()()),i&2){let l=y(2);a(2),m("data",l.contentData.centos)}}function Zx(i,n){i&1&&(g(0,"mat-icon",19),p(1," Docker "))}function eE(i,n){if(i&1&&(s(0,"div",11)(1,"div",16),g(2,"tb-markdown",17),r()()),i&2){let l=y(2);a(2),m("data",l.contentData.docker)}}function tE(i,n){if(i&1){let l=L();s(0,"section",11)(1,"div",11)(2,"mat-tab-group",12),et("selectedIndexChange",function(o){I(l);let t=y();return Ze(t.tabIndex,o)||(t.tabIndex=o),w(o)}),C("selectedTabChange",function(){I(l);let o=y();return w(o.selectedTabChange(o.tabIndex))}),s(3,"mat-tab"),v(4,Qx,2,0,"ng-template",13)(5,Yx,3,1,"ng-template",14),r(),s(6,"mat-tab"),v(7,Kx,2,0,"ng-template",13)(8,Xx,3,1,"ng-template",14),r(),s(9,"mat-tab"),v(10,Zx,2,0,"ng-template",13)(11,eE,3,1,"ng-template",14),r()()()()}if(i&2){let l=y();a(2),Xe("selectedIndex",l.tabIndex)}}function iE(i,n){i&1&&(s(0,"div",20),g(1,"mat-spinner",21),s(2,"span",22),p(3),c(4,"translate"),r()()),i&2&&(a(3),b(" ",u(4,1,"edge.loading-edge-instructions")," "))}var Sm=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.attributeService=f,this.edgeService=_,this.loadedInstructions=!1,this.notShowAgain=!1,this.tabIndex=0,this.instructionsMethod=zu,this.contentData={},this.data.afterAdd?(this.dialogTitle="edge.install-connect-instructions-edge-created",this.showDontShowAgain=!0):this.data.upgradeAvailable?(this.dialogTitle="edge.upgrade-instructions",this.showDontShowAgain=!1):(this.dialogTitle="edge.install-connect-instructions",this.showDontShowAgain=!1)}ngOnInit(){this.getInstructions(this.instructionsMethod[this.tabIndex])}ngOnDestroy(){super.ngOnDestroy()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayInstructionsAfterAddEdge:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}selectedTabChange(e){this.getInstructions(this.instructionsMethod[e])}getInstructions(e){if(!this.contentData[e]){this.loadedInstructions=!1;let o;this.data.upgradeAvailable?o=this.attributeService.getEntityAttributes(this.data.edge.id,Rr.SERVER_SCOPE,[$u]).pipe(_t(t=>{if(t.length){let d=t[0].value;return this.edgeService.getEdgeUpgradeInstructions(d,e)}})):o=this.edgeService.getEdgeInstallInstructions(this.data.edge.id.id,e),o.subscribe(t=>{this.contentData[e]=t.instructions,this.loadedInstructions=!0})}}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it),h(qu),h(Wi))},n.\u0275cmp=F({type:n,selectors:[["tb-edge-installation-dialog"]],features:[G],decls:20,vars:15,consts:[["loadingInstructions",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],[3,"selectedIndexChange","selectedTabChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","mdi:ubuntu",1,"tabs-icon"],[1,"tb-form-panel","no-padding","stroked"],[3,"data"],["svgIcon","mdi:centos",1,"tabs-icon"],["svgIcon","docker",1,"tabs-icon"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",1)(1,"h2",2),p(2),r(),g(3,"span",3),s(4,"button",4),C("click",function(){return I(d),w(t.close())}),s(5,"mat-icon",5),p(6,"close"),r()()(),s(7,"div",6),v(8,tE,12,1,"section",7),r(),s(9,"div",8)(10,"mat-slide-toggle",9),et("ngModelChange",function(_){return I(d),Ze(t.notShowAgain,_)||(t.notShowAgain=_),w(_)}),p(11),c(12,"translate"),r(),g(13,"span",3),s(14,"button",10),c(15,"async"),C("click",function(){return I(d),w(t.close())}),p(16),c(17,"translate"),r()(),v(18,iE,5,3,"ng-template",null,0,Et)}if(o&2){let d=q(19);a(2),B(t.dialogTitle),a(6),m("ngIf",t.loadedInstructions)("ngIfElse",d),a(2),j("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),a(),B(u(12,9,"action.dont-show-again")),a(3),m("disabled",u(15,11,t.isLoading$)),a(2),B(u(17,13,"action.close"))}},dependencies:[U,sa,te,Ie,re,at,Nt,dt,to,Qr,Yr,St,aa,ht,W,Qe,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:705px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:1080px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0 16px 16px;border-top:16px solid #fff}[_nghost-%COMP%]     .tb-markdown-view{padding:16px 16px 32px}[_nghost-%COMP%]     .tb-markdown-view div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p{color:#305680!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div{background-color:unset!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn.multiline{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view>*:not(ul){padding-right:unset!important;padding-left:unset!important}[_nghost-%COMP%]     .tb-markdown-view pre[class*=language-]{border:1px solid #305680!important}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .mat-mdc-tab-header{position:sticky;top:0;z-index:10;background-color:#fff}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}[_nghost-%COMP%]     .mat-mdc-tab-body{padding:16px 0}']});let i=n;return i})();var Po=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y,ke){this.store=e,this.broadcast=o,this.edgeService=t,this.customerService=d,this.dialogService=f,this.homeDialogs=_,this.translate=D,this.datePipe=M,this.router=Y,this.dialog=ke,this.config=new Le,this.config.entityType=O.EDGE,this.config.entityComponent=ym,this.config.entityTabsComponent=Cm,this.config.entityTranslations=Ge.get(O.EDGE),this.config.entityResources=tt.get(O.EDGE),this.config.deleteEntityTitle=Ke=>this.translate.instant("edge.delete-edge-title",{edgeName:Ke.name}),this.config.deleteEntityContent=()=>this.translate.instant("edge.delete-edge-text"),this.config.deleteEntitiesTitle=Ke=>this.translate.instant("edge.delete-edges-title",{count:Ke}),this.config.deleteEntitiesContent=()=>this.translate.instant("edge.delete-edges-text"),this.config.loadEntity=Ke=>this.edgeService.getEdgeInfo(Ke.id),this.config.saveEntity=Ke=>this.edgeService.saveEdge(Ke).pipe(Ot(()=>{this.broadcast.broadcast("edgeSaved")}),_t(xt=>this.edgeService.getEdgeInfo(xt.id.id))),this.config.onEntityAction=Ke=>this.onEdgeAction(Ke,this.config),this.config.detailsReadonly=()=>this.config.componentsData.edgeScope==="customer_user",this.config.headerComponent=_m}resolve(e){let o=e.params;return this.config.componentsData={edgeScope:e.data.edgesType,edgeType:""},this.customerId=o.customerId,this.store.pipe(qt(Sn),mi(1)).pipe(Ot(t=>{t.authority===E.CUSTOMER_USER&&(this.config.componentsData.edgeScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):Ct(null)),rt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-edges"):this.config.tableTitle=t.title+": "+this.translate.instant("edge.edge-instances"):this.config.tableTitle=this.translate.instant("edge.edge-instances"),this.config.columns=this.configureColumns(this.config.componentsData.edgeScope),this.configureEntityFunctions(this.config.componentsData.edgeScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.edgeScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.edgeScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.edgeScope),this.config.addEnabled=this.config.componentsData.edgeScope!=="customer_user",this.config.entitiesDeleteEnabled=this.config.componentsData.edgeScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.edgeScope==="tenant",this.config.addEntity=()=>(this.addEdge(),Ct(null)),this.config)))}configureColumns(e){let o=[new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","edge.name","25%"),new K("type","edge.edge-type","25%"),new K("label","edge.label","25%")];return e==="tenant"&&o.push(new K("customerTitle","customer.customer","25%"),new K("customerIsPublic","edge.public","60px",t=>Dt(t.customerIsPublic),()=>({}),!1)),o}configureEntityFunctions(e){e==="tenant"&&(this.config.entitiesFetchFunction=o=>this.edgeService.getTenantEdgeInfos(o,this.config.componentsData.edgeType),this.config.deleteEntity=o=>this.edgeService.deleteEdge(o.id)),e==="customer"&&(this.config.entitiesFetchFunction=o=>this.edgeService.getCustomerEdgeInfos(this.customerId,o,this.config.componentsData.edgeType),this.config.deleteEntity=o=>this.edgeService.unassignEdgeFromCustomer(o.id)),e==="customer_user"&&(this.config.entitiesFetchFunction=o=>this.edgeService.getCustomerEdgeInfos(this.customerId,o,this.config.componentsData.edgeType),this.config.deleteEntity=o=>this.edgeService.unassignEdgeFromCustomer(o.id))}configureCellActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("edge.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.makePublic(t,d)},{name:this.translate.instant("edge.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.assignToCustomer(t,[d.id])},{name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.DASHBOARD)},{name:this.translate.instant("edge.manage-rulechains"),icon:"settings_ethernet",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.RULE_CHAIN)}),e==="customer"&&o.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)}),e==="customer_user"&&o.push({name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,d)=>this.openEdgeEntitiesByType(t,d,O.DASHBOARD)}),o}configureGroupActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("edge.assign-edge-to-customer-text"),icon:"assignment_ind",isEnabled:!0,onAction:(t,d)=>this.assignToCustomer(t,d.map(f=>f.id))}),e==="customer"&&o.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignEdgesFromCustomer(t,d)}),o}configureAddActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("edge.add-edge-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("edge.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importEdges(t)}),e==="customer"&&o.push({name:this.translate.instant("edge.assign-new-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEdgesToCustomer(t)}),o}importEdges(e){this.homeDialogs.importEntities(O.EDGE).subscribe(o=>{o&&(this.broadcast.broadcast("edgeSaved"),this.config.updateData())})}addEdgesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:O.EDGE}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}openEdge(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}makePublic(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.make-public-edge-title",{edgeName:o.name}),this.translate.instant("edge.make-public-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.edgeService.makeEdgePublic(o.id.id).subscribe(()=>{this.config.updateData()})})}openEdgeEntitiesByType(e,o,t){e&&e.stopPropagation();let d;switch(t){case O.DEVICE:d="devices";break;case O.ASSET:d="assets";break;case O.EDGE:d="assets";break;case O.ENTITY_VIEW:d="entityViews";break;case O.DASHBOARD:d="dashboards";break;case O.RULE_CHAIN:d="ruleChains";break}this.router.navigateByUrl(`edgeManagement/instances/${o.id.id}/${d}`)}assignToCustomer(e,o){e&&e.stopPropagation(),this.dialog.open(ao,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:o,entityType:O.EDGE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,o){e&&e.stopPropagation();let t=o.customerIsPublic,d,f;t?(d=this.translate.instant("edge.make-private-edge-title",{edgeName:o.name}),f=this.translate.instant("edge.make-private-edge-text")):(d=this.translate.instant("edge.unassign-edge-title",{edgeName:o.name}),f=this.translate.instant("edge.unassign-edge-text")),this.dialogService.confirm(d,f,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.edgeService.unassignEdgeFromCustomer(o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.edgeScope!=="tenant")})})}unassignEdgesFromCustomer(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.unassign-edges-title",{count:o.length}),this.translate.instant("edge.unassign-edges-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.edgeService.unassignEdgeFromCustomer(f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}syncEdge(e,o){e&&e.stopPropagation(),this.edgeService.syncEdge(o.id.id).subscribe(()=>{this.store.dispatch(new ze({message:this.translate.instant("edge.sync-process-started-successfully"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))})}addEdge(){this.dialog.open(K0,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entitiesTableConfig:this.config}}).afterClosed().subscribe(e=>{e&&this.store.pipe(qt(Yo("notDisplayInstructionsAfterAddEdge"))).pipe(mi(1)).subscribe(o=>{o?(this.config.updateData(),this.config.entityAdded(e)):this.openInstructions(null,e,!0)})})}openInstructions(e,o,t=!1,d=!1){e&&e.stopPropagation(),this.dialog.open(Sm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edge:o,afterAdd:t,upgradeAvailable:d}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}onEdgeAction(e,o){switch(e.action){case"open":return this.openEdge(e.event,e.entity,o),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"openEdgeAssets":return this.openEdgeEntitiesByType(e.event,e.entity,O.ASSET),!0;case"openEdgeDevices":return this.openEdgeEntitiesByType(e.event,e.entity,O.DEVICE),!0;case"openEdgeEntityViews":return this.openEdgeEntitiesByType(e.event,e.entity,O.ENTITY_VIEW),!0;case"openEdgeDashboards":return this.openEdgeEntitiesByType(e.event,e.entity,O.DASHBOARD),!0;case"openEdgeRuleChains":return this.openEdgeEntitiesByType(e.event,e.entity,O.RULE_CHAIN),!0;case"syncEdge":return this.syncEdge(e.event,e.entity),!0;case"openInstallInstructions":return this.openInstructions(e.event,e.entity),!0;case"openUpgradeInstructions":return this.openInstructions(e.event,e.entity,!1,!0),!0}}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Tn),P(Wi),P(qi),P(Wt),P(An),P(ee),P(Oe),P(pe),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var nE=[{path:"customers",data:{breadcrumb:{menuId:ve.customers}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Zl}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"supervisor_account"},auth:[E.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Zl}},{path:":customerId/users",data:{breadcrumb:{label:"user.customer-users",icon:"account_circle"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:qn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"account_circle"},auth:[E.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:qn}}]},{path:":customerId/devices",data:{breadcrumb:{label:"customer.devices",icon:"devices_other"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Nn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"devices_other"},auth:[E.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Nn}}]},{path:":customerId/assets",data:{breadcrumb:{label:"customer.assets",icon:"domain"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:kn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"domain"},auth:[E.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:kn}}]},{path:":customerId/edgeInstances",data:{breadcrumb:{label:"customer.edges",icon:"router"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:Po}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"router"},auth:[E.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:Po}}]},{path:":customerId/dashboards",data:{breadcrumb:{label:"customer.dashboards",icon:"dashboard"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"customer.dashboards",dashboardsType:"customer"},resolve:{entitiesTableConfig:Ps}},{path:":dashboardId",component:wa,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Ns,icon:"dashboard"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"customer.dashboard",widgetEditMode:!1},resolve:{dashboard:As}}]}]}],Tm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Zl],imports:[V.forChild(nE),V]});let i=n;return i})();(function(){Q(Tm,{imports:[V],exports:[V]})})();var xm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Tm]});let i=n;return i})();(function(){Q(xm,{declarations:[Kl,Xl],imports:[oe,ae,ye,Tm]})})();S();var Em=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,rl]});let i=n;return i})();(function(){Q(Em,{imports:[oe,ae,rl]})})();S();S();var oE=[{path:"users",data:{breadcrumb:{skip:!0}},children:[{path:"",redirectTo:"/",pathMatch:"full"},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"account_circle"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"user.user"},resolve:{entitiesTableConfig:qn}}]}],Im=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[qn],imports:[V.forChild(oE),V]});let i=n;return i})();(function(){Q(Im,{imports:[V],exports:[V]})})();var wm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Im]});let i=n;return i})();(function(){Q(wm,{declarations:[uo,Jl,$l,La],imports:[oe,ae,ye,Im]})})();S();S();var Eg=[{path:"devices",data:{breadcrumb:{menuId:ve.devices}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Nn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Nn}}]}],aE=[{path:"devices",pathMatch:"full",redirectTo:"/entities/devices"},{path:"devices/:entityId",redirectTo:"/entities/devices/:entityId"}],Mm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Nn],imports:[V.forChild(aE),V]});let i=n;return i})();(function(){Q(Mm,{imports:[V],exports:[V]})})();var Dm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ci,xd,Td,Mm]});let i=n;return i})();(function(){Q(Dm,{declarations:[em,tm,im,nm,om,am,rm,sm,lm,mm,cm,pm,dm,gm],imports:[oe,ae,ye,Ci,xd,Td,Mm]})})();S();S();var Ig=[{path:"assets",data:{breadcrumb:{menuId:ve.assets}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:kn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"domain"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:kn}}]}],rE=[{path:"assets",pathMatch:"full",redirectTo:"/entities/assets"},{path:"assets/:entityId",redirectTo:"/entities/assets/:entityId"}],Fm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[kn],imports:[V.forChild(rE),V]});let i=n;return i})();(function(){Q(Fm,{imports:[V],exports:[V]})})();var Pm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ci,Fm]});let i=n;return i})();(function(){Q(Pm,{declarations:[hm,vm,bm],imports:[oe,ae,ye,Ci,Fm]})})();S();S();function sE(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"entity-view.name-required")," "))}function lE(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"entity-view.name-max-length")," "))}var Am=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.entityType=O,this.dataKeyType=Uc,this.allowedEntityTypes=[O.DEVICE,O.ASSET]}ngOnInit(){this.entityViewScope=this.entitiesTableConfig.componentsData.entityViewScope,super.ngOnInit(),this.maxStartTimeMs=this.entityForm.get("endTimeMs").valueChanges,this.minEndTimeMs=this.entityForm.get("startTimeMs").valueChanges,this.selectedEntityId=this.entityForm.get("entityId").valueChanges}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){return this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],type:[e?e.type:null,T.required],entityId:[e?e.entityId:null,[T.required]],startTimeMs:[e?e.startTimeMs:null],endTimeMs:[e?e.endTimeMs:null],keys:this.fb.group({attributes:this.fb.group({cs:[e&&e.keys&&e.keys.attributes?e.keys.attributes.cs:null],sh:[e&&e.keys&&e.keys.attributes?e.keys.attributes.sh:null],ss:[e&&e.keys&&e.keys.attributes?e.keys.attributes.ss:null]}),timeseries:[e&&e.keys&&e.keys.timeseries?e.keys.timeseries:null]}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({type:e.type}),this.entityForm.patchValue({entityId:e.entityId}),this.entityForm.patchValue({startTimeMs:e.startTimeMs}),this.entityForm.patchValue({endTimeMs:e.endTimeMs}),this.entityForm.patchValue({keys:{attributes:{cs:e.keys&&e.keys.attributes?e.keys.attributes.cs:null,sh:e.keys&&e.keys.attributes?e.keys.attributes.sh:null,ss:e.keys&&e.keys.attributes?e.keys.attributes.ss:null},timeseries:e.keys&&e.keys.timeseries?e.keys.timeseries:null}}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onEntityViewIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("entity-view.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-entity-view"]],features:[G],decls:95,vars:100,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-col"],["translate","",1,"tb-title","no-padding"],["formControlName","entityId",1,"flex-1",3,"required","allowedEntityTypes"],["formGroupName","keys",1,"mat-accordion-container"],[3,"multi"],["formGroupName","attributes",3,"expanded"],["translate","",1,"tb-panel-title"],["translate","",1,"tb-hint"],["formControlName","cs","keysText","entity-view.client-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","sh","keysText","entity-view.shared-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","ss","keysText","entity-view.server-attributes-placeholder",3,"entityId","dataKeyType"],[3,"expanded"],["formControlName","timeseries","keysText","entity-view.timeseries-placeholder",3,"entityId","dataKeyType"],["formControlName","startTimeMs",1,"block",3,"dateText","maxDate"],["formControlName","endTimeMs",1,"block",3,"dateText","minDate"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"makePublic")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"assignToCustomer")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromCustomer")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromEdge")}),p(19),c(20,"translate"),r(),s(21,"button",1),c(22,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(23),c(24,"translate"),r(),s(25,"div",2)(26,"button",3),C("cbOnSuccess",function(f){return t.onEntityViewIdCopied(f)}),g(27,"mat-icon",4),s(28,"span",5),p(29,"entity-view.copyId"),r()()()(),s(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"entity-view.assignedToCustomer"),r(),g(34,"input",8),r(),s(35,"div",9),p(36),c(37,"translate"),r(),s(38,"form",10)(39,"fieldset",11),c(40,"async"),s(41,"mat-form-field",7)(42,"mat-label",5),p(43,"entity-view.name"),r(),g(44,"input",12),v(45,sE,3,3,"mat-error",13)(46,lE,3,3,"mat-error",13),r(),g(47,"tb-entity-subtype-autocomplete",14),s(48,"section",15)(49,"label",16),p(50,"entity-view.target-entity"),r(),g(51,"tb-entity-select",17),r(),s(52,"div",18)(53,"mat-accordion",19)(54,"mat-expansion-panel",20)(55,"mat-expansion-panel-header")(56,"mat-panel-title")(57,"div",21),p(58,"entity-view.attributes-propagation"),r()()(),s(59,"div",22),p(60,"entity-view.attributes-propagation-hint"),r(),s(61,"label",16),p(62,"entity-view.client-attributes"),r(),g(63,"tb-entity-keys-list",23),c(64,"async"),s(65,"label",16),p(66,"entity-view.shared-attributes"),r(),g(67,"tb-entity-keys-list",24),c(68,"async"),s(69,"label",16),p(70,"entity-view.server-attributes"),r(),g(71,"tb-entity-keys-list",25),c(72,"async"),r(),s(73,"mat-expansion-panel",26)(74,"mat-expansion-panel-header")(75,"mat-panel-title")(76,"div",21),p(77,"entity-view.timeseries-data"),r()()(),s(78,"div",22),p(79,"entity-view.timeseries-data-hint"),r(),s(80,"label",16),p(81,"entity-view.timeseries"),r(),g(82,"tb-entity-keys-list",27),c(83,"async"),r()()(),g(84,"tb-datetime",28),c(85,"translate"),c(86,"async"),g(87,"tb-datetime",29),c(88,"translate"),c(89,"async"),s(90,"div",30)(91,"mat-form-field",7)(92,"mat-label",5),p(93,"entity-view.description"),r(),g(94,"textarea",31),r()()()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,56,t.isLoading$)),a(2),b(" ",u(4,58,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),m("disabled",u(6,60,t.isLoading$)),a(2),b(" ",u(8,62,"entity-view.make-public")," "),a(2),j("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)),m("disabled",u(10,64,t.isLoading$)),a(2),b(" ",u(12,66,"entity-view.assign-to-customer")," "),a(2),j("!hidden",t.isEdit||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),m("disabled",u(14,68,t.isLoading$)),a(2),b(" ",u(16,70,t.entity!=null&&t.entity.customerIsPublic?"entity-view.make-private":"entity-view.unassign-from-customer")," "),a(2),j("!hidden",t.isEdit||t.entityViewScope!=="edge"),m("disabled",u(18,72,t.isLoading$)),a(2),b(" ",u(20,74,"edge.unassign-from-edge")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(22,76,t.isLoading$)),a(2),b(" ",u(24,78,"entity-view.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),j("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.entityViewScope!=="tenant"),a(3),m("ngModel",t.entity==null?null:t.entity.customerTitle),a(),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"),a(),b(" ",u(37,80,"entity-view.entity-view-public")," "),a(2),m("formGroup",t.entityForm),a(),m("disabled",u(40,82,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(),m("required",!0)("entityType",t.entityType.ENTITY_VIEW),a(4),m("required",!0)("allowedEntityTypes",t.allowedEntityTypes),a(2),m("multi",!0),a(),m("expanded",!0),a(9),m("entityId",u(64,84,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),a(4),m("entityId",u(68,86,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),a(4),m("entityId",u(72,88,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),a(2),m("expanded",!0),a(9),m("entityId",u(83,90,t.selectedEntityId))("dataKeyType",t.dataKeyType.timeseries),a(2),x("dateText",u(85,92,"entity-view.start-ts")),m("maxDate",u(86,94,t.maxStartTimeMs)),a(3),x("dateText",u(88,96,"entity-view.end-ts")),m("minDate",u(89,98,t.minEndTimeMs)))},dependencies:[U,t0,rs,e0,i0,te,re,be,de,Se,Fe,Ur,Li,nn,on,Jt,ue,he,W,X,fe,Qe,ne,le,bt,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-accordion-container[_ngcontent-%COMP%]{margin-bottom:16px}']});let i=n;return i})();S();var Nm=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e,this.entityType=O}entityViewTypeChanged(e){this.entitiesTableConfig.componentsData.entityViewType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-entity-view-table-header"]],features:[G],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(o,t){o&1&&(s(0,"tb-entity-subtype-select",0),C("ngModelChange",function(f){return t.entityViewTypeChanged(f)}),r()),o&2&&m("showLabel",!0)("entityType",t.entityType.ENTITY_VIEW)("ngModel",t.entitiesTableConfig.componentsData.entityViewType)},dependencies:[ss,W,Qe],encapsulation:2});let i=n;return i})();S();S();S();function mE(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.CLIENT_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function pE(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function dE(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function cE(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"entity-view.events")),a(3),m("defaultEventType",e.eventTypes.ERROR)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function uE(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function fE(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function gE(i,n){if(i&1){let l=L();s(0,"mat-tab",8,6),c(2,"translate"),s(3,"tb-version-control",14),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var km=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-entity-view-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,mE,4,7,"mat-tab",7)(1,pE,4,7,"mat-tab",7)(2,dE,4,5,"mat-tab",7)(3,cE,4,7,"mat-tab",7)(4,uE,4,5,"mat-tab",7)(5,fE,4,6,"mat-tab",7)(6,gE,4,7,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,Ai,yi,_i,ai,R],encapsulation:2});let i=n;return i})();var Ao=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y,ke){this.store=e,this.broadcast=o,this.entityViewService=t,this.customerService=d,this.edgeService=f,this.dialogService=_,this.translate=D,this.datePipe=M,this.router=Y,this.dialog=ke,this.config=new Le,this.config.entityType=O.ENTITY_VIEW,this.config.entityComponent=Am,this.config.entityTabsComponent=km,this.config.entityTranslations=Ge.get(O.ENTITY_VIEW),this.config.entityResources=tt.get(O.ENTITY_VIEW),this.config.addDialogStyle={maxWidth:"800px"},this.config.deleteEntityTitle=Ke=>this.translate.instant("entity-view.delete-entity-view-title",{entityViewName:Ke.name}),this.config.deleteEntityContent=()=>this.translate.instant("entity-view.delete-entity-view-text"),this.config.deleteEntitiesTitle=Ke=>this.translate.instant("entity-view.delete-entity-views-title",{count:Ke}),this.config.deleteEntitiesContent=()=>this.translate.instant("entity-view.delete-entity-views-text"),this.config.loadEntity=Ke=>this.entityViewService.getEntityViewInfo(Ke.id),this.config.saveEntity=Ke=>this.entityViewService.saveEntityView(Ke).pipe(Ot(()=>{this.broadcast.broadcast("entityViewSaved")}),_t(xt=>this.entityViewService.getEntityViewInfo(xt.id.id))),this.config.onEntityAction=Ke=>this.onEntityViewAction(Ke,this.config),this.config.detailsReadonly=()=>this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user",this.config.headerComponent=Nm}resolve(e){let o=e.params;return this.config.componentsData={entityViewScope:e.data.entityViewsType,entityViewType:"",edgeId:o.edgeId},this.customerId=o.customerId,this.store.pipe(qt(Sn),mi(1)).pipe(Ot(t=>{t.authority===E.CUSTOMER_USER&&(e.data.entityViewsType==="edge"?this.config.componentsData.entityViewScope="edge_customer_user":this.config.componentsData.entityViewScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):Ct(null)),rt(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-entity-views"):this.config.tableTitle=t.title+": "+this.translate.instant("entity-view.entity-views"):this.config.componentsData.entityViewScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(d=>this.config.tableTitle=d.name+": "+this.translate.instant("entity-view.entity-views")):this.config.tableTitle=this.translate.instant("entity-view.entity-views"),this.config.columns=this.configureColumns(this.config.componentsData.entityViewScope),this.configureEntityFunctions(this.config.componentsData.entityViewScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.entityViewScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.entityViewScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.entityViewScope),this.config.addEnabled=!(this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.entityViewScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.entityViewScope==="tenant",this.config)))}configureColumns(e){let o=[new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","entity-view.name","33%"),new K("type","entity-view.entity-view-type","33%")];return e==="tenant"&&o.push(new K("customerTitle","customer.customer","33%"),new K("customerIsPublic","entity-view.public","60px",t=>Dt(t.customerIsPublic),()=>({}),!1)),o}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=o=>this.entityViewService.getTenantEntityViewInfos(o,this.config.componentsData.entityViewType),this.config.deleteEntity=o=>this.entityViewService.deleteEntityView(o.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=o=>this.entityViewService.getEdgeEntityViews(this.config.componentsData.edgeId,o,this.config.componentsData.entityViewType):(this.config.entitiesFetchFunction=o=>this.entityViewService.getCustomerEntityViewInfos(this.customerId,o,this.config.componentsData.entityViewType),this.config.deleteEntity=o=>this.entityViewService.unassignEntityViewFromCustomer(o.id))}configureCellActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("entity-view.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.makePublic(t,d)},{name:this.translate.instant("entity-view.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,d)=>this.assignToCustomer(t,[d.id])},{name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)}),e==="customer"&&o.push({name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,d)=>this.unassignFromCustomer(t,d)}),e==="edge"&&o.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(t,d)=>this.unassignFromEdge(t,d)}),o}configureGroupActions(e){let o=[];return e==="tenant"&&o.push({name:this.translate.instant("entity-view.assign-entity-views"),icon:"assignment_ind",isEnabled:!0,onAction:(t,d)=>this.assignToCustomer(t,d.map(f=>f.id))}),e==="customer"&&o.push({name:this.translate.instant("entity-view.unassign-entity-views"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignEntityViewsFromCustomer(t,d)}),e==="edge"&&o.push({name:this.translate.instant("entity-view.unassign-entity-views-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignEntityViewsFromEdge(t,d)}),o}configureAddActions(e){let o=[];return e==="customer"&&o.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToCustomer(t)}),e==="edge"&&o.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToEdge(t)}),o}addEntityViewsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:O.ENTITY_VIEW}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}openEntityView(e,o,t){e&&e.stopPropagation();let d=this.router.createUrlTree([o.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(d)}makePublic(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.make-public-entity-view-title",{entityViewName:o.name}),this.translate.instant("entity-view.make-public-entity-view-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.makeEntityViewPublic(o.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,o){e&&e.stopPropagation(),this.dialog.open(ao,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:o,entityType:O.ENTITY_VIEW}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,o){e&&e.stopPropagation();let t=o.customerIsPublic,d,f;t?(d=this.translate.instant("entity-view.make-private-entity-view-title",{entityViewName:o.name}),f=this.translate.instant("entity-view.make-private-entity-view-text")):(d=this.translate.instant("entity-view.unassign-entity-view-title",{entityViewName:o.name}),f=this.translate.instant("entity-view.unassign-entity-view-text")),this.dialogService.confirm(d,f,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(_=>{_&&this.entityViewService.unassignEntityViewFromCustomer(o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromCustomer(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-title",{count:o.length}),this.translate.instant("entity-view.unassign-entity-views-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.entityViewService.unassignEntityViewFromCustomer(f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}onEntityViewAction(e,o){switch(e.action){case"open":return this.openEntityView(e.event,e.entity,o),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addEntityViewsToEdge(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:O.ENTITY_VIEW}}).afterClosed().subscribe(o=>{o&&this.config.updateData()})}unassignFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-view-from-edge-title",{entityViewName:o.name}),this.translate.instant("entity-view.unassign-entity-view-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,o.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-from-edge-title",{count:o.length}),this.translate.instant("entity-view.unassign-entity-views-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,f.id.id))}),jt(d).subscribe(()=>{this.config.updateData()})}})}};n.\u0275fac=function(o){return new(o||n)(P(A),P(Tn),P(ku),P(qi),P(Wi),P(Wt),P(ee),P(Oe),P(pe),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var wg=[{path:"entityViews",data:{breadcrumb:{menuId:ve.entity_views}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:Ao}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"view_quilt"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:Ao}}]}],hE=[{path:"entityViews",pathMatch:"full",redirectTo:"/entities/entityViews"},{path:"entityViews/:entityId",redirectTo:"/entities/entityViews/:entityId"}],Om=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Ao],imports:[V.forChild(hE),V]});let i=n;return i})();(function(){Q(Om,{imports:[V],exports:[V]})})();var Bm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ci,Om]});let i=n;return i})();(function(){Q(Bm,{declarations:[Am,km,Nm],imports:[oe,ae,ye,Ci,Om]})})();S();S();function bE(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"rulechain.name-required")," "))}function vE(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"rulechain.name-max-length")," "))}var Rm=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_}ngOnInit(){this.ruleChainScope=this.entitiesTableConfig.componentsData.ruleChainScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[T.required,T.maxLength(255)]],debugMode:[e?e.debugMode:!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({debugMode:e.debugMode}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onRuleChainIdCopied(e){this.store.dispatch(new ze({message:this.translate.instant("rulechain.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}isEdgeRootRuleChain(){return this.entitiesTableConfig&&this.entityValue?this.entitiesTableConfig.componentsData.edge?.rootRuleChainId?.id==this.entityValue.id.id:!1}isAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}isNotAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&!this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-rulechain"]],features:[G],decls:56,vars:76,consts:[[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","debugMode",1,"flex-1",2,"padding-bottom","16px"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"export")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"setRoot")}),p(11),c(12,"translate"),r(),s(13,"button",1),c(14,"async"),C("click",function(f){return t.onEntityAction(f,"setEdgeTemplateRoot")}),p(15),c(16,"translate"),r(),s(17,"button",1),c(18,"async"),C("click",function(f){return t.onEntityAction(f,"setAutoAssignToEdge")}),p(19),c(20,"translate"),r(),s(21,"button",1),c(22,"async"),C("click",function(f){return t.onEntityAction(f,"unsetAutoAssignToEdge")}),p(23),c(24,"translate"),r(),s(25,"button",1),c(26,"async"),C("click",function(f){return t.onEntityAction(f,"unassignFromEdge")}),p(27),c(28,"translate"),r(),s(29,"button",1),c(30,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(31),c(32,"translate"),r(),s(33,"div",2)(34,"button",3),C("cbOnSuccess",function(f){return t.onRuleChainIdCopied(f)}),g(35,"mat-icon",4),s(36,"span",5),p(37,"rulechain.copyId"),r()()()(),s(38,"div",6)(39,"form",7)(40,"fieldset",8),c(41,"async"),s(42,"mat-form-field",9)(43,"mat-label",5),p(44,"rulechain.name"),r(),g(45,"input",10),v(46,bE,3,3,"mat-error",11)(47,vE,3,3,"mat-error",11),r(),s(48,"mat-checkbox",12),p(49),c(50,"translate"),r(),s(51,"div",13)(52,"mat-form-field",9)(53,"mat-label",5),p(54,"rulechain.description"),r(),g(55,"textarea",14),r()()()()()),o&2&&(a(),j("!hidden",t.isEdit),m("disabled",u(2,40,t.isLoading$)),a(2),b(" ",u(4,42,"rulechain.open-rulechain")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(6,44,t.isLoading$)),a(2),b(" ",u(8,46,"rulechain.export")," "),a(2),j("!hidden",t.isEdit||!(!(t.entity!=null&&t.entity.root)&&t.ruleChainScope==="tenant"||!t.isEdgeRootRuleChain()&&t.ruleChainScope==="edge")),m("disabled",u(10,48,t.isLoading$)),a(2),b(" ",u(12,50,"rulechain.set-root")," "),a(2),j("!hidden",t.isEdit||(t.entity==null?null:t.entity.root)||t.ruleChainScope!=="edges"),m("disabled",u(14,52,t.isLoading$)),a(2),b(" ",u(16,54,"rulechain.set-edge-template-root-rulechain")," "),a(2),j("!hidden",t.isEdit||!t.isNotAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),m("disabled",u(18,56,t.isLoading$)),a(2),b(" ",u(20,58,"rulechain.set-auto-assign-to-edge")," "),a(2),j("!hidden",t.isEdit||!t.isAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),m("disabled",u(22,60,t.isLoading$)),a(2),b(" ",u(24,62,"rulechain.unset-auto-assign-to-edge")," "),a(2),j("!hidden",t.isEdit||t.isEdgeRootRuleChain()||t.ruleChainScope!=="edges"),m("disabled",u(26,64,t.isLoading$)),a(2),b(" ",u(28,66,"edge.unassign-from-edge")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit||t.ruleChainScope==="edge"),m("disabled",u(30,68,t.isLoading$)),a(2),b(" ",u(32,70,"rulechain.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(5),m("formGroup",t.entityForm),a(),m("disabled",u(41,72,t.isLoading$)||!t.isEdit),a(6),m("ngIf",t.entityForm.get("name").hasError("required")),a(),m("ngIf",t.entityForm.get("name").hasError("maxlength")),a(2),b(" ",u(50,74,"rulechain.debug-mode")," "))},dependencies:[U,te,zt,re,be,de,Se,Fe,Jt,ue,he,W,X,fe,ne,le,bt,J,me,R],styles:['@charset "UTF-8";']});let i=n;return i})();S();S();S();var yE=i=>[i];function _E(i,n){if(i&1&&(s(0,"mat-tab",8,0),c(2,"translate"),g(3,"tb-attribute-table",9),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function CE(i,n){if(i&1&&(s(0,"mat-tab",8,1),c(2,"translate"),g(3,"tb-attribute-table",10),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function SE(i,n){if(i&1&&(s(0,"mat-tab",8,2),c(2,"translate"),g(3,"tb-alarm-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function TE(i,n){if(i&1&&(s(0,"mat-tab",8,3),c(2,"translate"),g(3,"tb-event-table",12),r()),i&2){let l=q(1),e=y();x("label",u(2,6,"rulechain.events")),a(3),m("debugEventTypes",pt(8,yE,e.debugEventTypes.DEBUG_RULE_CHAIN))("defaultEventType",e.debugEventTypes.DEBUG_RULE_CHAIN)("active",l.isActive)("tenantId",e.entity.tenantId.id)("entityId",e.entity.id)}}function xE(i,n){if(i&1&&(s(0,"mat-tab",8,4),c(2,"translate"),g(3,"tb-relation-table",11),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"relation.relations")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}function EE(i,n){if(i&1&&(s(0,"mat-tab",8,5),c(2,"translate"),g(3,"tb-audit-log-table",13),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function IE(i,n){if(i&1){let l=L();s(0,"mat-tab",8,6),c(2,"translate"),s(3,"tb-version-control",14),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var Vm=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-rulechain-tabs"]],features:[G],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"debugEventTypes","defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,_E,4,7,"mat-tab",7)(1,CE,4,7,"mat-tab",7)(2,SE,4,5,"mat-tab",7)(3,TE,4,10,"mat-tab",7)(4,xE,4,5,"mat-tab",7)(5,EE,4,6,"mat-tab",7)(6,IE,4,7,"mat-tab",7),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[U,St,ri,zi,Ai,yi,_i,ai,R],encapsulation:2});let i=n;return i})();var qa=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M,Y,ke){this.ruleChainService=e,this.dialogService=o,this.dialog=t,this.importExport=d,this.itembuffer=f,this.edgeService=_,this.translate=D,this.datePipe=M,this.router=Y,this.customTranslate=ke,this.config=new Le,this.config.entityType=O.RULE_CHAIN,this.config.entityComponent=Rm,this.config.entityTabsComponent=Vm,this.config.entityTranslations=Ge.get(O.RULE_CHAIN),this.config.entityResources=tt.get(O.RULE_CHAIN),this.config.rowPointer=!0,this.config.deleteEntityTitle=Ke=>this.translate.instant("rulechain.delete-rulechain-title",{ruleChainName:Ke.name}),this.config.deleteEntityContent=()=>this.translate.instant("rulechain.delete-rulechain-text"),this.config.deleteEntitiesTitle=Ke=>this.translate.instant("rulechain.delete-rulechains-title",{count:Ke}),this.config.deleteEntitiesContent=()=>this.translate.instant("rulechain.delete-rulechains-text"),this.config.loadEntity=Ke=>this.ruleChainService.getRuleChain(Ke.id),this.config.saveEntity=Ke=>this.saveRuleChain(Ke),this.config.deleteEntity=Ke=>this.ruleChainService.deleteRuleChain(Ke.id),this.config.onEntityAction=Ke=>this.onRuleChainAction(Ke),this.config.handleRowClick=(Ke,xt)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(Ke,xt):this.openRuleChain(Ke,xt),!0)}resolve(e){let o=e.params?.edgeId,t=e.data?.ruleChainsType?e.data?.ruleChainsType:"tenant";return this.config.componentsData={ruleChainScope:t,edgeId:o},this.config.columns=this.configureEntityTableColumns(t),this.config.entitiesFetchFunction=this.configureEntityFunctions(t,o),this.config.groupActionDescriptors=this.configureGroupActions(t),this.config.addActionDescriptors=this.configureAddActions(t),this.config.cellActionDescriptors=this.configureCellActions(t),t==="tenant"||t==="edges"?(this.config.entitySelectionEnabled=d=>d&&!d.root,this.config.deleteEnabled=d=>d&&!d.root,this.config.entitiesDeleteEnabled=!0,this.config.tableTitle=this.configureTableTitle(t,null)):t==="edge"&&(this.config.entitySelectionEnabled=d=>this.config.componentsData.edge.rootRuleChainId.id!==d.id.id,this.edgeService.getEdge(o).subscribe(d=>{this.config.componentsData.edge=d,this.config.tableTitle=this.configureTableTitle(t,d)}),this.config.entitiesDeleteEnabled=!1),this.config}configureEntityTableColumns(e){let o=[];return o.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","rulechain.name","50%"),new K("description","rulechain.description","50%",t=>this.customTranslate.transform(t.additionalInfo?.description||""),()=>({}),!1)),e==="tenant"||e==="edge"?o.push(new K("root","rulechain.root","60px",t=>e==="edge"?Dt(this.config.componentsData.edge.rootRuleChainId.id===t.id.id):Dt(t.root))):e==="edges"&&o.push(new K("root","rulechain.edge-template-root","100px",t=>Dt(t.root)),new K("assignToEdge","rulechain.assign-to-edge","100px",t=>Dt(this.isAutoAssignToEdgeRuleChain(t)),()=>({}),!1)),o}configureAddActions(e){let o=[];return(e==="tenant"||e==="edges")&&o.push({name:this.translate.instant("rulechain.create-new-rulechain"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("rulechain.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importRuleChain(t)}),e==="edge"&&o.push({name:this.translate.instant("rulechain.assign-to-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.assignRuleChainsToEdge(t)}),o}configureEntityFunctions(e,o){if(e==="tenant")return t=>this.fetchRuleChains(t);if(e==="edges")return t=>this.fetchEdgeRuleChains(t);if(e==="edge")return t=>this.ruleChainService.getEdgeRuleChains(o,t)}configureTableTitle(e,o){if(e==="tenant")return this.translate.instant("rulechain.rulechains");if(e==="edges")return this.translate.instant("edge.rulechain-templates");if(e==="edge")return this.config.tableTitle=o.name+": "+this.translate.instant("rulechain.rulechains")}configureGroupActions(e){let o=[];return e==="edge"&&o.push({name:this.translate.instant("rulechain.unassign-rulechains"),icon:"assignment_return",isEnabled:!0,onAction:(t,d)=>this.unassignRuleChainsFromEdge(t,d)}),o}configureCellActions(e){let o=[];return o.push({name:this.translate.instant("rulechain.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,d)=>this.exportRuleChain(t,d)}),e==="tenant"&&o.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,d)=>this.setRootRuleChain(t,d)}),e==="edges"&&o.push({name:this.translate.instant("rulechain.set-edge-template-root-rulechain"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,d)=>this.setEdgeTemplateRootRuleChain(t,d)},{name:this.translate.instant("rulechain.set-auto-assign-to-edge"),icon:"bookmark_outline",isEnabled:t=>this.isNotAutoAssignToEdgeRuleChain(t),onAction:(t,d)=>this.setAutoAssignToEdgeRuleChain(t,d)},{name:this.translate.instant("rulechain.unset-auto-assign-to-edge"),icon:"bookmark",isEnabled:t=>this.isAutoAssignToEdgeRuleChain(t),onAction:(t,d)=>this.unsetAutoAssignToEdgeRuleChain(t,d)}),e==="edge"&&o.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,d)=>this.setRootRuleChain(t,d)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>t.id.id!==this.config.componentsData.edge.rootRuleChainId.id,onAction:(t,d)=>this.unassignFromEdge(t,d)}),o.push({name:this.translate.instant("rulechain.rulechain-details"),icon:"edit",isEnabled:()=>!0,onAction:(t,d)=>this.config.toggleEntityDetails(t,d)}),o}importRuleChain(e){e&&e.stopPropagation();let o=this.config.componentsData.ruleChainScope==="tenant"?xi.CORE:xi.EDGE;this.importExport.importRuleChain(o).subscribe(t=>{t&&(this.itembuffer.storeRuleChainImport(t),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl("edgeManagement/ruleChains/ruleChain/import"):this.router.navigateByUrl("ruleChains/ruleChain/import"))})}openRuleChain(e,o){e&&e.stopPropagation(),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl(`edgeManagement/ruleChains/${o.id.id}`):this.config.componentsData.ruleChainScope==="edge"?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/ruleChains/${o.id.id}`):this.router.navigateByUrl(`ruleChains/${o.id.id}`)}saveRuleChain(e){return Ec(e.type)&&(this.config.componentsData.ruleChainScope==="tenant"?e.type=xi.CORE:this.config.componentsData.ruleChainScope==="edges"?e.type=xi.EDGE:e.type=xi.CORE),this.ruleChainService.saveRuleChain(e)}exportRuleChain(e,o){e&&e.stopPropagation(),this.importExport.exportRuleChain(o.id.id)}setRootRuleChain(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-root-rulechain-title",{ruleChainName:o.name}),this.translate.instant("rulechain.set-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&(this.config.componentsData.ruleChainScope==="edge"?this.ruleChainService.setEdgeRootRuleChain(this.config.componentsData.edgeId,o.id.id).subscribe(d=>{this.config.componentsData.edge=d,this.config.updateData()}):this.ruleChainService.setRootRuleChain(o.id.id).subscribe(()=>{this.config.updateData()}))})}onRuleChainAction(e){switch(e.action){case"open":return this.openRuleChain(e.event,e.entity),!0;case"export":return this.exportRuleChain(e.event,e.entity),!0;case"setRoot":return this.setRootRuleChain(e.event,e.entity),!0;case"setEdgeTemplateRoot":return this.setEdgeTemplateRootRuleChain(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"setAutoAssignToEdge":return this.setAutoAssignToEdgeRuleChain(e.event,e.entity),!0;case"unsetAutoAssignToEdge":return this.unsetAutoAssignToEdgeRuleChain(e.event,e.entity),!0}return!1}setEdgeTemplateRootRuleChain(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-edge-template-root-rulechain-title",{ruleChainName:o.name}),this.translate.instant("rulechain.set-edge-template-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setEdgeTemplateRootRuleChain(o.id.id).subscribe(()=>{this.config.updateData()})})}checkMissingToRelatedRuleChains(){this.edgeService.findMissingToRelatedRuleChains(this.config.componentsData.edgeId).subscribe(e=>{if(e&&Object.keys(e).length>0){let o=new Array;for(let d of Object.keys(e)){let f=e[d],_="- '"+d+"': '"+f.join("', ")+"'";o.push(_)}let t=this.translate.instant("edge.missing-related-rule-chains-text",{missingRuleChains:o.join("<br>")});this.dialogService.alert(this.translate.instant("edge.missing-related-rule-chains-title"),t,this.translate.instant("action.close"),!0).subscribe(()=>{this.config.updateData()})}else this.config.updateData()})}assignRuleChainsToEdge(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:O.RULE_CHAIN}}).afterClosed().subscribe(o=>{o&&this.checkMissingToRelatedRuleChains()})}unassignFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechain-title",{ruleChainName:o.name}),this.translate.instant("rulechain.unassign-rulechain-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,o.id.id).subscribe(()=>{this.checkMissingToRelatedRuleChains()})})}unassignRuleChainsFromEdge(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechains-from-edge-title",{count:o.length}),this.translate.instant("rulechain.unassign-rulechains-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let d=[];o.forEach(f=>{d.push(this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,f.id.id))}),jt(d).subscribe(()=>{this.checkMissingToRelatedRuleChains()})}})}setAutoAssignToEdgeRuleChain(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-auto-assign-to-edge-title",{ruleChainName:o.name}),this.translate.instant("rulechain.set-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setAutoAssignToEdgeRuleChain(o.id.id).subscribe(()=>{this.config.updateData()})})}unsetAutoAssignToEdgeRuleChain(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unset-auto-assign-to-edge-title",{ruleChainName:o.name}),this.translate.instant("rulechain.unset-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unsetAutoAssignToEdgeRuleChain(o.id.id).subscribe(()=>{this.config.updateData()})})}isNonRootRuleChain(e){return this.config.componentsData.ruleChainScope==="edge"?this.config.componentsData.edge.rootRuleChainId&&this.config.componentsData.edge.rootRuleChainId.id!==e.id.id:!e.root}isAutoAssignToEdgeRuleChain(e){return!e.root&&this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}isNotAutoAssignToEdgeRuleChain(e){return!e.root&&!this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}fetchRuleChains(e){return this.ruleChainService.getRuleChains(e,xi.CORE)}fetchEdgeRuleChains(e){return this.ruleChainService.getAutoAssignToEdgeRuleChains().pipe(_t(o=>(this.config.componentsData.autoAssignToEdgeRuleChainIds=[],o.map(t=>this.config.componentsData.autoAssignToEdgeRuleChainIds.push(t.id.id)),this.ruleChainService.getRuleChains(e,xi.EDGE))))}};n.\u0275fac=function(o){return new(o||n)(P(pa),P(Wt),P(je),P(Pi),P(us),P(Wi),P(ee),P(Oe),P(pe),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var fr=(()=>{let n=class n{constructor(e){this.ruleChainService=e}resolve(e){let o=e.params.ruleChainId;return this.ruleChainService.getRuleChain(o)}};n.\u0275fac=function(o){return new(o||n)(P(pa))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),gr=(()=>{let n=class n{constructor(e){this.ruleChainService=e}resolve(e){let o=e.params.ruleChainId;return this.ruleChainService.getRuleChainMetadata(o)}};n.\u0275fac=function(o){return new(o||n)(P(pa))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),No=(()=>{let n=class n{constructor(e,o){this.ruleChainService=e,this.modulesMap=o}resolve(e){return this.ruleChainService.getRuleNodeComponents(this.modulesMap,e.data.ruleChainType)}};n.\u0275fac=function(o){return new(o||n)(P(pa),P(_c,8))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),ko=(()=>{let n=class n{constructor(){}resolve(e){return $a(import("./chunk-ULZHJSWS.js"))}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),jm=(()=>{let n=class n{constructor(e,o){this.itembuffer=e,this.router=o}canActivate(e,o){return this.itembuffer.hasRuleChainImport()?!0:this.router.parseUrl("ruleChains")}};n.\u0275fac=function(o){return new(o||n)(P(us),P(pe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})(),Lm=(i,n,l)=>{let e=l.ruleChain.name;return l.ruleChain.root&&(e+=` (${n.instant("rulechain.root")})`),e},Hd=(i,n,l)=>`${n.instant("rulechain.import")}: ${l.ruleChain.name}`,ME=[{path:"ruleChains",data:{breadcrumb:{menuId:ve.rule_chains}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"rulechain.rulechains",ruleChainsType:"tenant"},resolve:{entitiesTableConfig:qa}},{path:":ruleChainId",component:vo,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Lm,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.rulechain",import:!1,ruleChainType:xi.CORE},loadChildren:()=>import("./chunk-AGCCPRNL.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:fr,ruleChainMetaData:gr,ruleNodeComponents:No,tooltipster:ko}},{path:"ruleChain/import",component:vo,canActivate:[jm],canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Hd,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.rulechain",import:!0,ruleChainType:xi.CORE},loadChildren:()=>import("./chunk-AGCCPRNL.js").then(i=>i.RuleChainPageModule),resolve:{ruleNodeComponents:No,tooltipster:ko}}]}],Gm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[qa,fr,gr,No,ko,jm],imports:[V.forChild(ME),V]});let i=n;return i})();(function(){Q(Gm,{imports:[V],exports:[V]})})();S();function FE(i,n){if(i&1&&(s(0,"mat-icon",9),p(1),r()),i&2){let l=y();a(),B(l.node.icon)}}function PE(i,n){if(i&1&&g(0,"img",10),i&2){let l=y();m("src",l.iconUrl,$n)}}function AE(i,n){if(i&1&&(s(0,"span",11),p(1),r()),i&2){let l=y();a(),B(l.node.name)}}function NE(i,n){if(i&1&&(s(0,"div",12),g(1,"div",13),r()),i&2){let l=n.$implicit,e=y();m("connector",l)("callbacks",e.callbacks),a(),m("connector",l)("nodeRectInfo",e.nodeRectInfo)("mouseOverConnector",e.mouseOverConnector)("callbacks",e.callbacks)("modelservice",e.modelservice)}}function kE(i,n){if(i&1&&(s(0,"div",12),g(1,"div",13),r()),i&2){let l=n.$implicit,e=y();m("connector",l)("callbacks",e.callbacks),a(),m("connector",l)("nodeRectInfo",e.nodeRectInfo)("mouseOverConnector",e.mouseOverConnector)("callbacks",e.callbacks)("modelservice",e.modelservice)}}function OE(i,n){if(i&1){let l=L();s(0,"section")(1,"div",14),C("click",function(o){I(l);let t=y();return w(t.userNodeCallbacks.nodeEdit(o,t.node))}),g(2,"i",15),r(),s(3,"div",16),C("click",function(){I(l);let o=y();return w(o.modelservice.nodes.delete(o.node))}),p(4," \xD7 "),r()()}}function BE(i,n){if(i&1){let l=L();s(0,"section")(1,"div",17),C("click",function(o){I(l);let t=y();return w(t.openRuleChain(o,t.node))})("mouseenter",function(o){I(l);let t=y();return w(t.displayOpenRuleChainTooltip(o,t.node))}),g(2,"mat-icon",18),r()()}}var zd=(()=>{let n=class n extends tu{constructor(e,o,t){super(),this.sanitizer=e,this.translate=o,this.router=t,this.RuleNodeType=Ou}ngOnInit(){super.ngOnInit(),this.node.iconUrl&&(this.iconUrl=this.sanitizer.bypassSecurityTrustResourceUrl(this.node.iconUrl))}openRuleChain(e,o){e&&e.stopPropagation(),o.configuration?.ruleChainId&&(o.ruleChainType===xi.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${o.configuration?.ruleChainId}`):this.router.navigateByUrl(`/ruleChains/${o.configuration?.ruleChainId}`))}displayOpenRuleChainTooltip(e,o){e&&e.stopPropagation(),this.userNodeCallbacks.mouseLeave(e,o);let t='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-description">'+this.translate.instant("rulechain.open-rulechain")+"</div></div></div>",d=$(e.target);d.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0,mouseleave:!0},side:"top",distance:12,trackOrigin:!0});let f=d.tooltipster("instance"),_=$(t);f.content(_),f.open()}};n.\u0275fac=function(o){return new(o||n)(h(wr),h(ee),h(pe))},n.\u0275cmp=F({type:n,selectors:[["rule-node"]],features:[G],decls:15,vars:21,consts:[[3,"dblclick","mousedown","mouseenter","mouseleave"],[1,"fc-node-overlay"],["class","max-w-15% flex-full",4,"ngIf"],["class","max-w-15% flex-full",3,"src",4,"ngIf"],[1,"flex","max-w-85%","flex-full","flex-col","items-stretch","justify-center"],[1,"tb-node-type"],["class","tb-node-title",4,"ngIf"],["fc-magnet","",3,"connector","callbacks",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"max-w-15%","flex-full"],[1,"max-w-15%","flex-full",3,"src"],[1,"tb-node-title"],["fc-magnet","",3,"connector","callbacks"],["fc-connector","",3,"connector","nodeRectInfo","mouseOverConnector","callbacks","modelservice"],[1,"fc-nodeedit",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],[1,"fc-nodedelete",3,"click"],[1,"fc-nodeopen",3,"click","mouseenter"],["svgIcon","mdi:login",1,"material-icons"]],template:function(o,t){o&1&&(s(0,"div",0),C("dblclick",function(f){return t.userNodeCallbacks.doubleClick(f,t.node)})("mousedown",function(f){return t.userNodeCallbacks.mouseDown(f,t.node)})("mouseenter",function(f){return t.userNodeCallbacks.mouseEnter(f,t.node)})("mouseleave",function(f){return t.userNodeCallbacks.mouseLeave(f,t.node)}),g(1,"div",1),s(2,"div"),v(3,FE,2,1,"mat-icon",2)(4,PE,1,1,"img",3),s(5,"div",4)(6,"span",5),p(7),r(),v(8,AE,2,1,"span",6),r(),s(9,"div"),v(10,NE,2,7,"div",7),r(),s(11,"div"),v(12,kE,2,7,"div",7),r()(),v(13,OE,5,0,"section",8)(14,BE,3,0,"section",8),r()),o&2&&(a(2),pc("tb-rule-node ",t.node.nodeClass,""),j("tb-rule-node-highlighted",t.node.highlighted)("tb-rule-node-invalid",t.node.error),a(),m("ngIf",!t.iconUrl),a(),m("ngIf",t.iconUrl),a(3),B(t.node.component.name),a(),m("ngIf",t.node.name),a(),id(t.flowchartConstants.leftConnectorClass),a(),m("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.leftConnectorType)),a(),id(t.flowchartConstants.rightConnectorClass),a(),m("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.rightConnectorType)),a(),m("ngIf",t.modelservice.isEditable()&&!t.node.readonly),a(),m("ngIf",(t.node.component==null||t.node.component.configurationDescriptor==null||t.node.component.configurationDescriptor.nodeDefinition==null?null:t.node.component.configurationDescriptor.nodeDefinition.ruleChainNode)&&t.modelservice.isEditable()))},dependencies:[xe,U,re,iu,nu],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;inset:0;background-color:#000;border-radius:5px;opacity:0}[_nghost-%COMP%]   .fc-hover[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-hover   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25;transition:opacity .2s}[_nghost-%COMP%]   .fc-selected[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-selected   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25}[_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], [_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%]{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]{box-sizing:content-box;display:flex;flex-direction:row;min-width:150px;max-width:150px;height:32px;min-height:32px;max-height:32px;padding:5px 10px;font-size:12px;line-height:16px;color:#333;pointer-events:none;background-color:#f15b26;border:solid 1px #777;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node.tb-filter-type[_ngcontent-%COMP%]{background-color:#f1e861}[_nghost-%COMP%]   .tb-rule-node.tb-enrichment-type[_ngcontent-%COMP%]{background-color:#cdf14e}[_nghost-%COMP%]   .tb-rule-node.tb-transformation-type[_ngcontent-%COMP%]{background-color:#79cef1}[_nghost-%COMP%]   .tb-rule-node.tb-action-type[_ngcontent-%COMP%]{background-color:#f1928f}[_nghost-%COMP%]   .tb-rule-node.tb-external-type[_ngcontent-%COMP%]{background-color:#fbc766}[_nghost-%COMP%]   .tb-rule-node.tb-flow-type[_ngcontent-%COMP%]{background-color:#d6c4f1}[_nghost-%COMP%]   .tb-rule-node.tb-unknown-type[_ngcontent-%COMP%]{background-color:#f16c29}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid){box-shadow:0 0 10px 6px #51cbee}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid)   .tb-node-title[_ngcontent-%COMP%]{font-weight:700;text-decoration:underline}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-invalid[_ngcontent-%COMP%]{box-shadow:0 0 10px 6px #ff5c50}[_nghost-%COMP%]   .tb-rule-node.tb-input-type[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;background-color:#a3eaa9}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:auto;width:20px;min-width:20px;height:20px;min-height:20px;padding-right:4px;font-size:20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-type[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{position:absolute;top:0;z-index:0;display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]{left:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{right:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{display:flex;flex-grow:1;justify-content:center;height:60px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector[_ngcontent-%COMP%]{width:14px;height:14px;margin:10px;pointer-events:all;background-color:#ccc;border:1px solid #333;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector.fc-hover[_ngcontent-%COMP%]{background-color:#000}']});let i=n;return i})();var Um=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[{provide:eu,useValue:{nodeComponentType:zd}}],imports:[oe,ae,ye,Gm]});let i=n;return i})();(function(){Q(Um,{declarations:[Rm,Vm,zd],imports:[oe,ae,ye,Gm]})})();S();var qm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ed,al]});let i=n;return i})();(function(){Q(qm,{declarations:[tl,gs,Io,ol,el,Na,Aa,il,Ks,b0],imports:[oe,ae,ye,Ed,al]})})();S();var Wm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ci,Id]});let i=n;return i})();(function(){Q(Wm,{declarations:[jf,Uf,Lf,Gf],imports:[oe,ae,ye,Ci,Id]})})();S();S();S();S();function RE(i,n){if(i&1&&(s(0,"mat-tab",4,0),c(2,"translate"),g(3,"tb-attribute-table",5),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.attributes")),a(3),m("defaultAttributeScope",e.attributeScopes.SERVER_SCOPE)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function VE(i,n){if(i&1&&(s(0,"mat-tab",4,1),c(2,"translate"),g(3,"tb-attribute-table",6),r()),i&2){let l=q(1),e=y();x("label",u(2,5,"attribute.latest-telemetry")),a(3),m("defaultAttributeScope",e.latestTelemetryTypes.LATEST_TELEMETRY)("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)}}function jE(i,n){if(i&1&&(s(0,"mat-tab",4,2),c(2,"translate"),g(3,"tb-alarm-table",7),r()),i&2){let l=q(1),e=y();x("label",u(2,3,"alarm.alarms")),a(3),m("active",l.isActive)("entityId",e.entity.id)}}var Hm=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-tenant-profile-tabs"]],features:[G],decls:3,vars:3,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"]],template:function(o,t){o&1&&v(0,RE,4,7,"mat-tab",3)(1,VE,4,7,"mat-tab",3)(2,jE,4,5,"mat-tab",3),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity))},dependencies:[U,St,yi,_i,R],encapsulation:2});let i=n;return i})();var zm=(()=>{let n=class n{constructor(e,o,t,d,f,_,D){this.tenantProfileService=e,this.importExport=o,this.translate=t,this.datePipe=d,this.router=f,this.dialogService=_,this.customTranslate=D,this.config=new Le,this.config.entityType=O.TENANT_PROFILE,this.config.entityComponent=xf,this.config.entityTabsComponent=Hm,this.config.entityTranslations=Ge.get(O.TENANT_PROFILE),this.config.entityResources=tt.get(O.TENANT_PROFILE),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","tenant-profile.name","40%"),new K("description","tenant-profile.description","60%",M=>this.customTranslate.transform(M.description||"")),new K("isDefault","tenant-profile.default","60px",M=>Dt(M.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(M,Y)=>this.exportTenantProfile(M,Y)},{name:this.translate.instant("tenant-profile.set-default"),icon:"flag",isEnabled:M=>!M.default,onAction:(M,Y)=>this.setDefaultTenantProfile(M,Y)}),this.config.deleteEntityTitle=M=>this.translate.instant("tenant-profile.delete-tenant-profile-title",{tenantProfileName:M.name}),this.config.deleteEntityContent=()=>this.translate.instant("tenant-profile.delete-tenant-profile-text"),this.config.deleteEntitiesTitle=M=>this.translate.instant("tenant-profile.delete-tenant-profiles-title",{count:M}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant-profile.delete-tenant-profiles-text"),this.config.entitiesFetchFunction=M=>this.tenantProfileService.getTenantProfiles(M),this.config.loadEntity=M=>this.tenantProfileService.getTenantProfile(M.id),this.config.saveEntity=M=>this.tenantProfileService.saveTenantProfile(M),this.config.deleteEntity=M=>this.tenantProfileService.deleteTenantProfile(M.id),this.config.onEntityAction=M=>this.onTenantProfileAction(M),this.config.deleteEnabled=M=>M&&!M.default,this.config.entitySelectionEnabled=M=>M&&!M.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("tenant-profile.tenant-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("tenant-profile.create-tenant-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:o=>this.config.getTable().addEntity(o)},{name:this.translate.instant("tenant-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:o=>this.importTenantProfile(o)}),e}openTenantProfile(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["tenantProfiles",o.id.id]);this.router.navigateByUrl(t)}setDefaultTenantProfile(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("tenant-profile.set-default-tenant-profile-title",{tenantProfileName:o.name}),this.translate.instant("tenant-profile.set-default-tenant-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.tenantProfileService.setDefaultTenantProfile(o.id.id).subscribe(()=>{this.config.updateData()})})}importTenantProfile(e){this.importExport.importTenantProfile().subscribe(o=>{o&&this.config.updateData()})}exportTenantProfile(e,o){e&&e.stopPropagation(),this.importExport.exportTenantProfile(o.id.id)}onTenantProfileAction(e){switch(e.action){case"open":return this.openTenantProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultTenantProfile(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(Xu),P(Pi),P(ee),P(Oe),P(pe),P(Wt),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var LE=[{path:"tenantProfiles",data:{breadcrumb:{menuId:ve.tenant_profiles}},children:[{path:"",component:Ve,data:{auth:[E.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:zm}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"mdi:alpha-t-box"},auth:[E.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:zm}}]}],$m=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[zm],imports:[V.forChild(LE),V]});let i=n;return i})();(function(){Q($m,{imports:[V],exports:[V]})})();var Jm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,$m]});let i=n;return i})();(function(){Q(Jm,{declarations:[Hm],imports:[oe,ae,ye,$m]})})();S();S();var GE=i=>({count:i});function UE(i,n){if(i&1&&(s(0,"mat-option",17),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(3);m("value",l),a(),b(" ",u(2,2,e.deviceTransportTypeTranslations.get(l))," ")}}function qE(i,n){if(i&1&&(s(0,"mat-hint"),p(1),c(2,"translate"),r()),i&2){let l=y(3);a(),b(" ",u(2,1,l.deviceTransportTypeHints.get(l.detailsForm.get("transportType").value))," ")}}function WE(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"device-profile.transport-type-required")," "))}function HE(i,n){if(i&1&&(s(0,"div",9)(1,"mat-form-field",10)(2,"mat-label",11),p(3,"device-profile.transport-type"),r(),s(4,"mat-select",12),v(5,UE,3,4,"mat-option",13),r(),v(6,qE,3,3,"mat-hint",14)(7,WE,3,3,"mat-error",14),r(),s(8,"div",15),g(9,"tb-device-profile-transport-configuration",16),r()()),i&2){let l=y(2);m("formGroup",l.detailsForm),a(5),m("ngForOf",l.deviceTransportTypes),a(),m("ngIf",l.detailsForm.get("transportType").value),a(),m("ngIf",l.detailsForm.get("transportType").hasError("required")),a(2),m("isAdd",l.isTransportTypeChanged)}}function zE(i,n){if(i&1&&(s(0,"mat-tab",7,0),c(2,"translate"),v(3,HE,10,5,"div",8),r()),i&2){let l=q(1);x("label",u(2,2,"device-profile.transport-configuration")),a(3),m("ngIf",l.isActive)}}function $E(i,n){if(i&1&&(s(0,"div",9)(1,"div",15),g(2,"tb-device-profile-alarms",18),r()()),i&2){let l=y(2);m("formGroup",l.detailsForm),a(2),m("deviceProfileId",l.entity.id)}}function JE(i,n){if(i&1&&(s(0,"mat-tab",7,1),c(2,"translate"),v(3,$E,3,2,"div",8),r()),i&2){let l,e=q(1),o=y();x("label",Yt(2,2,"device-profile.alarm-rules-with-count",pt(5,GE,(l=o.detailsForm.get("profileData.alarms").value)!=null&&l.length?o.detailsForm.get("profileData.alarms").value.length:0))),a(3),m("ngIf",e.isActive)}}function QE(i,n){if(i&1&&(s(0,"div",9)(1,"div",15),g(2,"tb-device-profile-provision-configuration",19),r()()),i&2){let l=y(2);m("formGroup",l.detailsForm)}}function YE(i,n){if(i&1&&(s(0,"mat-tab",7,2),c(2,"translate"),v(3,QE,3,1,"div",8),r()),i&2){let l=q(1);x("label",u(2,2,"device-profile.device-provisioning")),a(3),m("ngIf",l.isActive)}}function KE(i,n){if(i&1&&(s(0,"mat-tab",7,3),c(2,"translate"),s(3,"div",9)(4,"div",15),g(5,"tb-device-profile-configuration",20),r()()()),i&2){let l=y();x("label",u(2,2,"device-profile.profile-configuration")),a(3),m("formGroup",l.detailsForm)}}function XE(i,n){if(i&1&&(s(0,"mat-tab",7,4),c(2,"translate"),g(3,"tb-audit-log-table",21),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function ZE(i,n){if(i&1){let l=L();s(0,"mat-tab",7,5),c(2,"translate"),s(3,"tb-version-control",22),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var Qm=(()=>{let n=class n extends Vt{constructor(e,o){super(e),this.store=e,this.destroyRef=o,this.deviceTransportTypes=Object.values(Ei),this.deviceTransportTypeTranslations=da,this.deviceTransportTypeHints=Vu,this.isTransportTypeChanged=!1}ngOnInit(){super.ngOnInit(),this.detailsForm.get("transportType").valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.isTransportTypeChanged=!0})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ft))},n.\u0275cmp=F({type:n,selectors:[["tb-device-profile-tabs"]],features:[G],decls:6,vars:6,consts:[["transportType","matTab"],["alarmRules","matTab"],["deviceProvisioning","matTab"],["deviceProfile","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["class","mat-padding",3,"formGroup",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"mat-block"],["translate",""],["formControlName","transportType","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formGroupName","profileData"],["formControlName","transportConfiguration",3,"isAdd"],[3,"value"],["formControlName","alarms",3,"deviceProfileId"],["formControlName","provisionConfiguration"],["formControlName","configuration"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,zE,4,4,"mat-tab",6)(1,JE,4,7,"mat-tab",6)(2,YE,4,4,"mat-tab",6)(3,KE,6,4,"mat-tab",6)(4,XE,4,6,"mat-tab",6)(5,ZE,4,7,"mat-tab",6),o&2&&(m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",t.entity),a(),m("ngIf",!1),a(),m("ngIf",t.entity&&!t.isEdit),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[xe,U,de,Se,Kt,Fe,vt,gt,St,W,X,fe,ne,le,bt,J,ri,If,wf,Mf,Df,ai,R],encapsulation:2});let i=n;return i})();S();S();var Ym=(()=>{let n=class n{constructor(e,o,t,d,f,_,D,M){this.deviceProfileService=e,this.importExport=o,this.translate=t,this.datePipe=d,this.dialogService=f,this.router=_,this.dialog=D,this.customTranslate=M,this.config=new Le,this.config.entityType=O.DEVICE_PROFILE,this.config.entityComponent=Ff,this.config.entityTabsComponent=Qm,this.config.entityTranslations=Ge.get(O.DEVICE_PROFILE),this.config.entityResources=tt.get(O.DEVICE_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.addDialogStyle={width:"1000px"},this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","device-profile.name","20%"),new K("type","device-profile.type","20%",Y=>this.translate.instant(Bu.get(Y.type))),new K("transportType","device-profile.transport-type","20%",Y=>this.translate.instant(da.get(Y.transportType))),new K("description","device-profile.description","40%",Y=>this.customTranslate.transform(Y.description||"")),new K("isDefault","device-profile.default","60px",Y=>Dt(Y.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("device-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(Y,ke)=>this.exportDeviceProfile(Y,ke)},{name:this.translate.instant("device-profile.set-default"),icon:"flag",isEnabled:Y=>!Y.default,onAction:(Y,ke)=>this.setDefaultDeviceProfile(Y,ke)}),this.config.deleteEntityTitle=Y=>this.translate.instant("device-profile.delete-device-profile-title",{deviceProfileName:Y.name}),this.config.deleteEntityContent=()=>this.translate.instant("device-profile.delete-device-profile-text"),this.config.deleteEntitiesTitle=Y=>this.translate.instant("device-profile.delete-device-profiles-title",{count:Y}),this.config.deleteEntitiesContent=()=>this.translate.instant("device-profile.delete-device-profiles-text"),this.config.entitiesFetchFunction=Y=>this.deviceProfileService.getDeviceProfiles(Y),this.config.loadEntity=Y=>this.deviceProfileService.getDeviceProfile(Y.id),this.config.saveEntity=(Y,ke)=>this.deviceProfileService.saveDeviceProfileAndConfirmOtaChange(ke,Y),this.config.deleteEntity=Y=>this.deviceProfileService.deleteDeviceProfile(Y.id),this.config.onEntityAction=Y=>this.onDeviceProfileAction(Y),this.config.deleteEnabled=Y=>Y&&!Y.default,this.config.entitySelectionEnabled=Y=>Y&&!Y.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("device-profile.device-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("device-profile.create-device-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:()=>this.addDeviceProfile()},{name:this.translate.instant("device-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:o=>this.importDeviceProfile(o)}),e}addDeviceProfile(){this.dialog.open(Pf,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceProfileName:null,transportType:null}}).afterClosed().subscribe(e=>{e&&this.config.updateData()})}setDefaultDeviceProfile(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device-profile.set-default-device-profile-title",{deviceProfileName:o.name}),this.translate.instant("device-profile.set-default-device-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceProfileService.setDefaultDeviceProfile(o.id.id).subscribe(()=>{this.config.updateData()})})}openDeviceProfile(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","deviceProfiles",o.id.id]);this.router.navigateByUrl(t)}importDeviceProfile(e){this.importExport.importDeviceProfile().subscribe(o=>{o&&this.config.updateData()})}exportDeviceProfile(e,o){e&&e.stopPropagation(),this.importExport.exportDeviceProfile(o.id.id)}onDeviceProfileAction(e){switch(e.action){case"open":return this.openDeviceProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultDeviceProfile(e.event,e.entity),!0;case"export":return this.exportDeviceProfile(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(os),P(Pi),P(ee),P(Oe),P(Wt),P(pe),P(je),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Mg=[{path:"deviceProfiles",data:{breadcrumb:{menuId:ve.device_profiles}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Ym}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"mdi:alpha-d-box"},auth:[E.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Ym}}]}],$d=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Ym]});let i=n;return i})();var Km=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,$d]});let i=n;return i})();(function(){Q(Km,{declarations:[Qm],imports:[oe,ae,ye,$d]})})();S();S();var eI="/assets/dashboard/api_usage.json",tI=(i,n,l=Ut(la))=>l.loadJsonResource(eI),iI=[{path:"usage",component:Fs,data:{auth:[E.TENANT_ADMIN],title:"api-usage.api-usage",breadcrumb:{menuId:ve.api_usage}},resolve:{dashboard:tI}}],Xm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(iI),V]});let i=n;return i})();(function(){Q(Xm,{imports:[V],exports:[V]})})();var Zm=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Xm]});let i=n;return i})();(function(){Q(Zm,{imports:[oe,ae,ye,Xm]})})();S();S();var nI=[{path:"edgeManagement",data:{breadcrumb:{menuId:ve.edge_management}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/edgeManagement/instances"}},{path:"instances",data:{breadcrumb:{menuId:ve.edges}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:Po}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"router"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:Po}},{path:":edgeId/assets",data:{breadcrumb:{label:"edge.assets",icon:"domain"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:kn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"domain"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:kn}}]},{path:":edgeId/devices",data:{breadcrumb:{label:"edge.devices",icon:"devices_other"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Nn}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Nn}}]},{path:":edgeId/entityViews",data:{breadcrumb:{label:"edge.entity-views",icon:"view_quilt"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:Ao}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:Ao}}]},{path:":edgeId/dashboards",data:{breadcrumb:{label:"edge.dashboards",icon:"dashboard"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],dashboardsType:"edge"},resolve:{entitiesTableConfig:Ps}},{path:":dashboardId",component:wa,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Ns,icon:"dashboard"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.dashboard",widgetEditMode:!1},resolve:{dashboard:As}}]},{path:":edgeId/ruleChains",data:{breadcrumb:{label:"edge.rulechains",icon:"settings_ethernet"}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"edge.rulechains",ruleChainsType:"edge"},resolve:{entitiesTableConfig:qa}},{path:":ruleChainId",component:vo,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Lm,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:xi.EDGE},loadChildren:()=>import("./chunk-AGCCPRNL.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:fr,ruleChainMetaData:gr,ruleNodeComponents:No,tooltipster:ko}}]}]},{path:"ruleChains",data:{breadcrumb:{menuId:ve.rulechain_templates}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"edge.rulechain-templates",ruleChainsType:"edges"},resolve:{entitiesTableConfig:qa}},{path:":ruleChainId",component:vo,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Lm,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:xi.EDGE},loadChildren:()=>import("./chunk-AGCCPRNL.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:fr,ruleChainMetaData:gr,ruleNodeComponents:No,tooltipster:ko}},{path:"ruleChain/import",component:vo,canActivate:[jm],canDeactivate:[Ee],data:{breadcrumb:{labelFunction:Hd,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!0,ruleChainType:xi.EDGE},loadChildren:()=>import("./chunk-AGCCPRNL.js").then(i=>i.RuleChainPageModule),resolve:{ruleNodeComponents:No,tooltipster:ko}}]}]},{path:"edgeInstances",pathMatch:"full",redirectTo:"/edgeManagement/instances"},{path:"edgeInstances/:entityId",pathMatch:"full",redirectTo:"/edgeManagement/instances/:entityId"},{path:"edgeInstances/:edgeId/assets",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/assets"},{path:"edgeInstances/:edgeId/assets/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/assets/:entityId"},{path:"edgeInstances/:edgeId/devices",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/devices"},{path:"edgeInstances/:edgeId/devices/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/devices/:entityId"},{path:"edgeInstances/:edgeId/entityViews",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/entityViews"},{path:"edgeInstances/:edgeId/entityViews/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/entityViews/:entityId"},{path:"edgeInstances/:edgeId/dashboards",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/dashboards"},{path:"edgeInstances/:edgeId/dashboards/:dashboardId",redirectTo:"/edgeManagement/instances/:edgeId/dashboards/:dashboardId"},{path:"edgeInstances/:edgeId/ruleChains",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains"},{path:"edgeInstances/:edgeId/ruleChains/:ruleChainId",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains/:ruleChainId"}],ep=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Po],imports:[V.forChild(nI),V]});let i=n;return i})();(function(){Q(ep,{imports:[V],exports:[V]})})();var tp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,Ci,ye,ep]});let i=n;return i})();(function(){Q(tp,{declarations:[ym,_m,Cm,Sm],imports:[oe,ae,Ci,ye,ep]})})();S();S();S();S();function oI(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"ota-update.title-required")," "))}function aI(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"ota-update.title-max-length")," "))}function rI(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"ota-update.version-required")," "))}function sI(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"ota-update.version-max-length")," "))}function lI(i,n){i&1&&(s(0,"mat-hint",5),p(1,"ota-update.version-tag-hint"),r())}function mI(i,n){if(i&1&&(s(0,"mat-option",25),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.otaUpdateTypeTranslationMap.get(l))," ")}}function pI(i,n){i&1&&(s(0,"section")(1,"div",26),p(2,"ota-update.warning-after-save-no-edit"),r(),s(3,"mat-radio-group",27)(4,"mat-radio-button",25),p(5),c(6,"translate"),r(),s(7,"mat-radio-button",25),p(8),c(9,"translate"),r()()()),i&2&&(a(4),m("value",!1),a(),B(u(6,4,"ota-update.upload-binary-file")),a(2),m("value",!0),a(),B(u(9,6,"ota-update.use-external-url")))}function dI(i,n){if(i&1&&(s(0,"section"),g(1,"tb-file-input",29),c(2,"translate"),c(3,"translate"),s(4,"mat-checkbox",30),p(5),c(6,"translate"),r()()),i&2){let l=y(2);a(),x("label",u(2,4,"ota-update.package-file")),x("dropLabel",u(3,6,"ota-update.drop-package-file-or")),m("required",!l.entityForm.get("isURL").value),a(4),b(" ",u(6,8,"ota-update.auto-generate-checksum")," ")}}function cI(i,n){if(i&1&&(s(0,"mat-option",25),p(1),r()),i&2){let l=n.$implicit,e=y(3);m("value",l),a(),b(" ",e.checksumAlgorithmTranslationMap.get(l)," ")}}function uI(i,n){i&1&&(s(0,"mat-hint",5),p(1,"ota-update.checksum-hint"),r())}function fI(i,n){if(i&1&&(s(0,"div",31)(1,"mat-form-field",32)(2,"mat-label",5),p(3,"ota-update.checksum-algorithm"),r(),s(4,"mat-select",33),v(5,cI,2,2,"mat-option",21),r()(),s(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.checksum"),r(),g(9,"input",34),v(10,uI,2,0,"mat-hint",17),r()()),i&2){let l=y(2);a(5),m("ngForOf",l.checksumAlgorithms),a(5),m("ngIf",l.isAdd)}}function gI(i,n){i&1&&(s(0,"section")(1,"div",35)(2,"mat-form-field",32)(3,"mat-label",5),p(4,"ota-update.file-name"),r(),g(5,"input",36),r(),s(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.file-size-bytes"),r(),g(9,"input",37),r(),s(10,"mat-form-field",13)(11,"mat-label",5),p(12,"ota-update.content-type"),r(),g(13,"input",38),r()()())}function hI(i,n){if(i&1&&(s(0,"section"),v(1,dI,7,10,"section",12)(2,fI,11,2,"div",28)(3,gI,14,0,"section",12),r()),i&2){let l=y();a(),m("ngIf",l.isAdd),a(),m("ngIf",!(l.isAdd&&l.entityForm.get("generateChecksum").value)),a(),m("ngIf",!l.isAdd)}}function bI(i,n){i&1&&(s(0,"mat-error",5),p(1," ota-update.direct-url-required "),r())}function vI(i,n){if(i&1&&(s(0,"section",39)(1,"mat-form-field",19)(2,"mat-label",5),p(3,"ota-update.direct-url"),r(),g(4,"input",40),v(5,bI,2,0,"mat-error",17),r()()),i&2){let l=y();a(4),m("required",l.entityForm.get("isURL").value),a(),m("ngIf",l.entityForm.get("url").hasError("required")||l.entityForm.get("url").hasError("pattern"))}}var ip=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_){super(e,f,t,d,_),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.fb=f,this.cd=_,this.destroy$=new Ft,this.checksumAlgorithms=Object.values(md),this.checksumAlgorithmTranslationMap=is,this.packageTypes=Object.values(Ka),this.otaUpdateTypeTranslationMap=ns}ngOnInit(){super.ngOnInit(),this.isAdd&&(this.entityForm.get("isURL").valueChanges.pipe(mt(this.destroy$)).subscribe(e=>{e===!1?(this.entityForm.get("url").clearValidators(),this.entityForm.get("file").setValidators(T.required),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1})):(this.entityForm.get("file").clearValidators(),this.entityForm.get("url").setValidators([T.required,T.pattern("(.|\\s)*\\S(.|\\s)*")]),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}))}),ic([this.entityForm.get("title").valueChanges.pipe(go("")),this.entityForm.get("version").valueChanges.pipe(go(""))]).pipe(oc(()=>this.entityForm.get("tag").pristine),mt(this.destroy$)).subscribe(([e,o])=>{let t=`${e} ${o}`.trim();this.entityForm.get("tag").patchValue(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){let o=this.fb.group({title:[e?e.title:"",[T.required,T.maxLength(255)]],version:[e?e.version:"",[T.required,T.maxLength(255)]],tag:[e?e.tag:"",[T.maxLength(255)]],type:[e?.type?e.type:Ka.FIRMWARE,T.required],deviceProfileId:[e?e.deviceProfileId:null,T.required],checksumAlgorithm:[e&&e.checksumAlgorithm?e.checksumAlgorithm:md.SHA256],checksum:[e?e.checksum:"",T.maxLength(1020)],url:[e?e.url:""],isURL:[!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.isAdd?(o.addControl("file",this.fb.control(null,T.required)),o.addControl("generateChecksum",this.fb.control(!0))):(o.addControl("fileName",this.fb.control(null)),o.addControl("dataSize",this.fb.control(null)),o.addControl("contentType",this.fb.control(null))),o}updateForm(e){this.entityForm.patchValue({title:e.title,version:e.version,tag:e.tag,type:e.type,deviceProfileId:e.deviceProfileId,checksumAlgorithm:e.checksumAlgorithm,checksum:e.checksum,fileName:e.fileName,dataSize:e.dataSize,contentType:e.contentType,url:e.url,isURL:$o(e.url),additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),!this.isAdd&&this.entityForm.enabled&&(this.entityForm.disable({emitEvent:!1}),this.entityForm.get("additionalInfo").enable({emitEvent:!1}))}onPackageIdCopied(){this.store.dispatch(new ze({message:this.translate.instant("ota-update.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageChecksumCopied(){this.store.dispatch(new ze({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageDirectUrlCopied(){this.store.dispatch(new ze({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}prepareFormValue(e){return e.isURL?delete e.file:delete e.url,delete e.generateChecksum,super.prepareFormValue(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity"),h("entitiesTableConfig"),h(ce),h(Je))},n.\u0275cmp=F({type:n,selectors:[["tb-ota-update"]],features:[G],decls:62,vars:57,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col","gap-2"],[3,"formGroup"],[1,"flex","flex-col",3,"disabled"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-45%"],["matInput","","formControlName","title","type","text","required","",3,"readonly"],[4,"ngIf"],[1,"mat-block","flex-1"],["matInput","","formControlName","version","type","text","required","",3,"readonly"],[1,"mat-block","flex-1",2,"margin-bottom","8px"],["matInput","","formControlName","tag","type","text",3,"readonly"],["translate","",4,"ngIf"],["formControlName","deviceProfileId","required","",3,"hint","editProfileEnabled","addNewProfile","showDetailsPageLink"],[1,"mat-block"],["formControlName","type","required",""],[3,"value",4,"ngFor","ngForOf"],["style","margin-top: 8px",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],[3,"value"],["translate","",1,"mat-caption",2,"margin","-8px 0 8px"],["formControlName","isURL",1,"gap-4"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-xs:gap-2",4,"ngIf"],["formControlName","file","workFromFileObj","true",3,"label","required","dropLabel"],["formControlName","generateChecksum",2,"margin-top","16px"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-33%"],["formControlName","checksumAlgorithm"],["matInput","","formControlName","checksum","type","text"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],["matInput","","formControlName","fileName","type","text"],["matInput","","formControlName","dataSize","type","text"],["matInput","","formControlName","contentType","type","text"],[2,"margin-top","8px"],["matInput","","formControlName","url","type","text",3,"required"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"button",1),c(2,"async"),C("click",function(f){return t.onEntityAction(f,"open")}),p(3),c(4,"translate"),r(),s(5,"button",1),c(6,"async"),C("click",function(f){return t.onEntityAction(f,"uploadPackage")}),p(7),c(8,"translate"),r(),s(9,"button",1),c(10,"async"),C("click",function(f){return t.onEntityAction(f,"delete")}),p(11),c(12,"translate"),r(),s(13,"div",2)(14,"button",3),C("cbOnSuccess",function(){return t.onPackageIdCopied()}),g(15,"mat-icon",4),s(16,"span",5),p(17,"ota-update.copyId"),r()(),s(18,"button",3),C("cbOnSuccess",function(){return t.onPackageChecksumCopied()}),g(19,"mat-icon",4),s(20,"span",5),p(21,"ota-update.copy-checksum"),r()(),s(22,"button",3),C("cbOnSuccess",function(){return t.onPackageDirectUrlCopied()}),g(23,"mat-icon",4),s(24,"span",5),p(25,"ota-update.copy-direct-url"),r()()()(),s(26,"div",6)(27,"form",7)(28,"fieldset",8),c(29,"async"),s(30,"div",9)(31,"mat-form-field",10)(32,"mat-label",5),p(33,"ota-update.title"),r(),g(34,"input",11),v(35,oI,3,3,"mat-error",12)(36,aI,3,3,"mat-error",12),r(),s(37,"mat-form-field",13)(38,"mat-label",5),p(39,"ota-update.version"),r(),g(40,"input",14),v(41,rI,3,3,"mat-error",12)(42,sI,3,3,"mat-error",12),r()(),s(43,"mat-form-field",15)(44,"mat-label",5),p(45,"ota-update.version-tag"),r(),g(46,"input",16),v(47,lI,2,0,"mat-hint",17),r(),g(48,"tb-device-profile-autocomplete",18),s(49,"mat-form-field",19)(50,"mat-label",5),p(51,"ota-update.package-type"),r(),s(52,"mat-select",20),v(53,mI,3,4,"mat-option",21),r()(),v(54,pI,10,8,"section",12)(55,hI,4,3,"section",12)(56,vI,6,2,"section",22),s(57,"div",23)(58,"mat-form-field",19)(59,"mat-label",5),p(60,"ota-update.description"),r(),g(61,"textarea",24),r()()()()()),o&2&&(a(),j("!hidden",t.isEdit||t.isDetailsPage),m("disabled",u(2,43,t.isLoading$)),a(2),b(" ",u(4,45,"common.open-details-page")," "),a(2),j("!hidden",t.isEdit),m("disabled",u(6,47,t.isLoading$)||!(t.entity!=null&&t.entity.hasData&&!(t.entity!=null&&t.entity.url))),a(2),b(" ",u(8,49,"ota-update.download")," "),a(2),j("!hidden",t.hideDelete()||t.isEdit),m("disabled",u(10,51,t.isLoading$)),a(2),b(" ",u(12,53,"ota-update.delete")," "),a(3),j("!hidden",t.isEdit),m("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),a(4),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.checksum)),m("cbContent",t.entity==null?null:t.entity.checksum),a(4),j("!hidden",t.isEdit||!(t.entity!=null&&t.entity.url)),m("cbContent",t.entity==null?null:t.entity.url),a(5),m("formGroup",t.entityForm),a(),m("disabled",u(29,55,t.isLoading$)||!t.isEdit),a(6),m("readonly",!t.isAdd),a(),m("ngIf",t.entityForm.get("title").hasError("required")),a(),m("ngIf",t.entityForm.get("title").hasError("maxlength")),a(4),m("readonly",!t.isAdd),a(),m("ngIf",t.entityForm.get("version").hasError("required")),a(),m("ngIf",t.entityForm.get("version").hasError("maxlength")),a(4),m("readonly",!t.isAdd),a(),m("ngIf",t.isAdd),a(),j("pb-4",t.isAdd)("pb-0",!t.isAdd),m("hint","ota-update.chose-compatible-device-profile")("editProfileEnabled",!1)("addNewProfile",!1)("showDetailsPageLink",!0),a(5),m("ngForOf",t.packageTypes),a(),m("ngIf",t.isAdd),a(),m("ngIf",!t.entityForm.get("isURL").value),a(),m("ngIf",t.entityForm.get("isURL").value))},dependencies:[xe,U,te,zt,re,be,de,Se,Kt,Fe,vt,gt,du,cu,Jt,ue,he,W,X,fe,ne,le,bt,no,J,ws,me,R],encapsulation:2});let i=n;return i})();var np=(()=>{let n=class n{constructor(e,o,t,d,f,_){this.translate=e,this.datePipe=o,this.store=t,this.otaPackageService=d,this.router=f,this.fileSize=_,this.config=new Le,this.config.entityType=O.OTA_PACKAGE,this.config.entityComponent=ip,this.config.entityTranslations=Ge.get(O.OTA_PACKAGE),this.config.entityResources=tt.get(O.OTA_PACKAGE),this.config.entityTitle=D=>D?D.title:"",this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("title","ota-update.title","15%"),new K("version","ota-update.version","15%"),new K("tag","ota-update.version-tag","15%"),new K("type","ota-update.package-type","15%",D=>this.translate.instant(ns.get(D.type))),new K("url","ota-update.direct-url","20%",D=>D.url?D.url.length>20?`${D.url.slice(0,20)}\u2026`:D.url:"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-direct-url"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:D=>!!D.url,onAction:(D,M)=>M.url,type:ua.COPY_BUTTON}),new K("fileName","ota-update.file-name","20%"),new K("dataSize","ota-update.file-size","70px",D=>D.dataSize?this.fileSize.transform(D.dataSize):""),new K("checksum","ota-update.checksum","220px",D=>D.checksum?this.checksumText(D):"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-checksum"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:D=>!!D.checksum,onAction:(D,M)=>M.checksum,type:ua.COPY_BUTTON})),this.config.cellActionDescriptors.push({name:this.translate.instant("ota-update.download"),icon:"file_download",isEnabled:D=>D.hasData&&!D.url,onAction:(D,M)=>this.exportPackage(D,M)}),this.config.deleteEntityTitle=D=>this.translate.instant("ota-update.delete-ota-update-title",{title:D.title}),this.config.deleteEntityContent=()=>this.translate.instant("ota-update.delete-ota-update-text"),this.config.deleteEntitiesTitle=D=>this.translate.instant("ota-update.delete-ota-updates-title",{count:D}),this.config.deleteEntitiesContent=()=>this.translate.instant("ota-update.delete-ota-updates-text"),this.config.entitiesFetchFunction=D=>this.otaPackageService.getOtaPackages(D),this.config.loadEntity=D=>this.otaPackageService.getOtaPackageInfo(D.id),this.config.saveEntity=D=>this.otaPackageService.saveOtaPackage(D),this.config.deleteEntity=D=>this.otaPackageService.deleteOtaPackage(D.id),this.config.onEntityAction=D=>this.onPackageAction(D)}resolve(){return this.config.tableTitle=this.translate.instant("ota-update.packages-repository"),this.config}openOtaPackage(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["otaUpdates",o.id.id]);this.router.navigateByUrl(t)}exportPackage(e,o){e&&e.stopPropagation(),o.url?window.open(o.url,"_blank"):this.otaPackageService.downloadOtaPackage(o.id.id).subscribe()}checksumText(e){let o=`${is.get(e.checksumAlgorithm)}: ${e.checksum}`;return o.length>20&&(o=`${o.slice(0,20)}\u2026`),o}onPackageAction(e){switch(e.action){case"open":return this.openOtaPackage(e.event,e.entity),!0;case"uploadPackage":return this.exportPackage(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(ee),P(Oe),P(A),P(Hu),P(pe),P(f0))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Dg=[{path:"otaUpdates",data:{breadcrumb:{menuId:ve.otaUpdates}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:np}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"memory"},auth:[E.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:np}}]}],yI=[{path:"otaUpdates",pathMatch:"full",redirectTo:"/features/otaUpdates"},{path:"otaUpdates/:entityId",redirectTo:"/features/otaUpdates/:entityId"}],op=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[np],imports:[V.forChild(yI),V]});let i=n;return i})();(function(){Q(op,{imports:[V],exports:[V]})})();var ap=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,op]});let i=n;return i})();(function(){Q(ap,{declarations:[ip],imports:[oe,ae,ye,op]})})();S();S();var Fg=[{path:"vc",component:ai,canDeactivate:[Ee],data:{auth:[E.TENANT_ADMIN],title:"version-control.version-control",breadcrumb:{menuId:ve.version_control}}}],_I=[{path:"vc",redirectTo:"/features/vc"}],rp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(_I),V]});let i=n;return i})();(function(){Q(rp,{imports:[V],exports:[V]})})();var sp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,rp]});let i=n;return i})();(function(){Q(sp,{imports:[oe,ae,rp]})})();S();S();function CI(i,n){if(i&1&&(s(0,"mat-tab",3,0),c(2,"translate"),g(3,"tb-audit-log-table",4),r()),i&2){let l=q(1),e=y();x("label",u(2,4,"audit-log.audit-logs")),a(3),m("active",l.isActive)("auditLogMode",e.auditLogModes.ENTITY)("entityId",e.entity.id)}}function SI(i,n){if(i&1){let l=L();s(0,"mat-tab",3,1),c(2,"translate"),s(3,"tb-version-control",5),C("versionRestored",function(){I(l);let o=y();return w(o.entitiesTableConfig.updateData())}),r()()}if(i&2){let l=q(1),e=y();x("label",u(2,5,"version-control.version-control")),a(3),m("active",l.isActive)("entityId",e.entity.id)("entityName",e.entity.name)("externalEntityId",e.entity.externalId||e.entity.id)}}var lp=(()=>{let n=class n extends Vt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-asset-profile-tabs"]],features:[G],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(o,t){o&1&&v(0,CI,4,6,"mat-tab",2)(1,SI,4,7,"mat-tab",2),o&2&&(m("ngIf",t.entity&&!t.isEdit),a(),m("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[U,St,ri,ai,R],encapsulation:2});let i=n;return i})();S();S();var mp=(()=>{let n=class n{constructor(e,o,t,d,f,_,D){this.assetProfileService=e,this.importExport=o,this.translate=t,this.datePipe=d,this.dialogService=f,this.router=_,this.customTranslate=D,this.config=new Le,this.config.entityType=O.ASSET_PROFILE,this.config.entityComponent=Bf,this.config.entityTabsComponent=lp,this.config.entityTranslations=Ge.get(O.ASSET_PROFILE),this.config.entityResources=tt.get(O.ASSET_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"150px"),new K("name","asset-profile.name","50%"),new K("description","asset-profile.description","50%",M=>this.customTranslate.transform(M.description||"")),new K("isDefault","asset-profile.default","60px",M=>Dt(M.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("asset-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(M,Y)=>this.exportAssetProfile(M,Y)},{name:this.translate.instant("asset-profile.set-default"),icon:"flag",isEnabled:M=>!M.default,onAction:(M,Y)=>this.setDefaultAssetProfile(M,Y)}),this.config.deleteEntityTitle=M=>this.translate.instant("asset-profile.delete-asset-profile-title",{assetProfileName:M.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset-profile.delete-asset-profile-text"),this.config.deleteEntitiesTitle=M=>this.translate.instant("asset-profile.delete-asset-profiles-title",{count:M}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset-profile.delete-asset-profiles-text"),this.config.entitiesFetchFunction=M=>this.assetProfileService.getAssetProfiles(M),this.config.loadEntity=M=>this.assetProfileService.getAssetProfile(M.id),this.config.saveEntity=M=>this.assetProfileService.saveAssetProfile(M),this.config.deleteEntity=M=>this.assetProfileService.deleteAssetProfile(M.id),this.config.onEntityAction=M=>this.onAssetProfileAction(M),this.config.deleteEnabled=M=>M&&!M.default,this.config.entitySelectionEnabled=M=>M&&!M.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("asset-profile.asset-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("asset-profile.create-asset-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:o=>this.config.getTable().addEntity(o)},{name:this.translate.instant("asset-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:o=>this.importAssetProfile(o)}),e}setDefaultAssetProfile(e,o){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset-profile.set-default-asset-profile-title",{assetProfileName:o.name}),this.translate.instant("asset-profile.set-default-asset-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetProfileService.setDefaultAssetProfile(o.id.id).subscribe(()=>{this.config.updateData()})})}openAssetProfile(e,o){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","assetProfiles",o.id.id]);this.router.navigateByUrl(t)}importAssetProfile(e){this.importExport.importAssetProfile().subscribe(o=>{o&&this.config.updateData()})}exportAssetProfile(e,o){e&&e.stopPropagation(),this.importExport.exportAssetProfile(o.id.id)}onAssetProfileAction(e){switch(e.action){case"open":return this.openAssetProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultAssetProfile(e.event,e.entity),!0;case"export":return this.exportAssetProfile(e.event,e.entity),!0}return!1}};n.\u0275fac=function(o){return new(o||n)(P(Ku),P(Pi),P(ee),P(Oe),P(Wt),P(pe),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Pg=[{path:"assetProfiles",data:{breadcrumb:{menuId:ve.asset_profiles}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:mp}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"mdi:alpha-a-box"},auth:[E.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:mp}}]}],Jd=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[mp]});let i=n;return i})();var pp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Jd]});let i=n;return i})();(function(){Q(pp,{declarations:[lp],imports:[oe,ae,ye,Jd]})})();S();S();var TI=[{path:"profiles",data:{auth:[E.TENANT_ADMIN],breadcrumb:{menuId:ve.profiles}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN],redirectTo:"/profiles/deviceProfiles"}},...Mg,...Pg]}],dp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(TI),V]});let i=n;return i})();(function(){Q(dp,{imports:[V],exports:[V]})})();var cp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,dp]});let i=n;return i})();(function(){Q(cp,{imports:[oe,ae,dp]})})();S();S();var xI=[{path:"alarms",component:yi,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"alarm.alarms",breadcrumb:{menuId:ve.alarms},isPage:!0,alarmsMode:Vc.ALL}}],up=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(xI),V]});let i=n;return i})();(function(){Q(up,{imports:[V],exports:[V]})})();var fp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Ci,up]});let i=n;return i})();(function(){Q(fp,{imports:[oe,ae,ye,Ci,up]})})();S();S();S();var EI="/api/resource/dashboard/system/gateways_dashboard.json",II=(i,n,l=Ut(la))=>l.loadJsonResource(EI),Ag=[{path:"gateways",component:Fs,data:{auth:[E.TENANT_ADMIN],title:"gateway.gateways",breadcrumb:{menuId:ve.gateways}},resolve:{dashboard:II}}],wI=[{path:"gateways",pathMatch:"full",redirectTo:"/entities/gateways"}],gp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(wI),V]});let i=n;return i})();(function(){Q(gp,{imports:[V],exports:[V]})})();var MI=[{path:"entities",data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],breadcrumb:{skip:!0}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/entities/devices"}},...Eg,...Ig,...wg,...Ag]}],hp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(MI),V]});let i=n;return i})();(function(){Q(hp,{imports:[V],exports:[V]})})();var bp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,hp]});let i=n;return i})();(function(){Q(bp,{imports:[oe,ae,hp]})})();S();S();var DI=[{path:"features",data:{auth:[E.TENANT_ADMIN],breadcrumb:{menuId:ve.features}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN],redirectTo:"/features/otaUpdates"}},...Dg,...Fg]}],vp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(DI),V]});let i=n;return i})();(function(){Q(vp,{imports:[V],exports:[V]})})();var yp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,vp]});let i=n;return i})();(function(){Q(yp,{imports:[oe,ae,vp]})})();S();S();S();S();var _p=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e}changeUnreadOnly(e){this.entitiesTableConfig.componentsData.unreadOnly=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-inbox-table-header"]],features:[G],decls:8,vars:9,consts:[[1,"flex","flex-full","flex-row","items-center","justify-start"],["appearance","fill",1,"w-44",3,"ngModelChange","ngModel"],[3,"value"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"tb-toggle-select",1),C("ngModelChange",function(f){return t.changeUnreadOnly(f)}),s(2,"tb-toggle-option",2),p(3),c(4,"translate"),r(),s(5,"tb-toggle-option",2),p(6),c(7,"translate"),r()()()),o&2&&(a(),m("ngModel",t.entitiesTableConfig.componentsData.unreadOnly),a(),m("value",!0),a(),B(u(4,5,"notification.unread")),a(2),m("value",!1),a(),B(u(7,7,"notification.all")))},dependencies:[W,Qe,Di,Fi,R],encapsulation:2});let i=n;return i})();S();var Cp=(()=>{let n=class n extends nt{constructor(e,o,t,d){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.data=d,this.notification=d.notification}markAsRead(e){this.dialogRef.close(e)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(At))},n.\u0275cmp=F({type:n,selectors:[["tb-inbox-notification-dialog"]],features:[G],decls:1,vars:1,consts:[[3,"markAsRead","notification"]],template:function(o,t){o&1&&(s(0,"tb-notification",0),C("markAsRead",function(f){return t.markAsRead(f)}),r()),o&2&&m("notification",t.notification)},dependencies:[L0],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;max-width:400px;min-width:350px;padding:2px}']});let i=n;return i})();var Qd=(()=>{let n=class n{constructor(e,o,t,d,f){this.notificationService=e,this.translate=o,this.dialog=t,this.datePipe=d,this.utilsService=f,this.config=new Le,this.config.entityType=O.NOTIFICATION,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.NOTIFICATION),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-notification-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-notification-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("notification.delete-notifications-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-notifications-text"),this.config.deleteEntity=_=>this.notificationService.deleteNotification(_.id),this.config.entitiesFetchFunction=_=>this.notificationService.getNotifications(_,this.config.componentsData.unreadOnly),this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.handleRowClick=(_,D)=>(this.showNotification(_,D),!0),this.config.componentsData={unreadOnly:!0},this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=_p,this.config.headerActionDescriptors=[{name:this.translate.instant("notification.mark-all-as-read"),icon:"done_all",isEnabled:()=>!0,onAction:_=>this.markAllRead(_)}],this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("type","notification.type","10%",_=>this.translate.instant(Ta.get(_.type).name)),new K("subject","notification.subject","30%",_=>this.utilsService.customTranslation(_.subject,_.subject)),new K("text","notification.message","60%",_=>this.utilsService.customTranslation(_.text,_.text)))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.mark-as-read"),icon:"check_circle_outline",isEnabled:e=>e.status!==bd.READ,onAction:(e,o)=>this.markAsRead(e,o)}]}markAllRead(e){e&&e.stopPropagation(),this.notificationService.markAllNotificationsAsRead().subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().resetSortAndFilter(!0):this.config.updateData()})}markAsRead(e,o){e&&e.stopPropagation(),this.notificationService.markNotificationAsRead(o.id.id).subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().dataSource.pageData$.pipe(mi(1)).subscribe(t=>{t.data.length===1&&this.config.getTable().pageLink.page?this.config.getTable().paginator.previousPage():this.config.updateData()}):(o.status=bd.READ,this.config.getTable().detectChanges())})}showNotification(e,o){e&&e.stopPropagation(),this.dialog.open(Cp,{disableClose:!1,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notification:o}}).afterClosed().subscribe(t=>{t&&this.markAsRead(null,o)})}};n.\u0275fac=function(o){return new(o||n)(P(vi),P(ee),P(je),P(Oe),P(Gr))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();function FI(i,n){if(i&1&&(s(0,"tr")(1,"td")(2,"mat-chip"),p(3),r()(),s(4,"td",9),p(5),r()()),i&2){let l=n.$implicit;a(3),B(l.key),a(2),B(l.value)}}function PI(i,n){i&1&&g(0,"mat-divider")}function AI(i,n){if(i&1&&(s(0,"div")(1,"h6"),p(2),c(3,"translate"),r(),s(4,"table",7),v(5,FI,6,2,"tr",6),c(6,"keyvalue"),r(),v(7,PI,1,0,"mat-divider",8),r()),i&2){let l=n.$implicit,e=n.last,o=y();a(2),B(u(3,3,o.NotificationDeliveryMethodInfoMap.get(l.key).name)),a(3),m("ngForOf",u(6,5,l.value)),a(2),m("ngIf",!e)}}var Sp=(()=>{let n=class n extends nt{constructor(e,o,t,d){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.data=d,this.NotificationDeliveryMethodInfoMap=Ca,this.errorStats=d.notificationRequest.stats.errors}cancel(){this.dialogRef.close(null)}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(At))},n.\u0275cmp=F({type:n,selectors:[["tb-notification-send-error-dialog"]],features:[G],decls:10,vars:3,consts:[["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[4,"ngFor","ngForOf"],[1,"tb-table-list"],[4,"ngIf"],[1,"tb-row-error"]],template:function(o,t){o&1&&(s(0,"mat-toolbar",0)(1,"h2",1),p(2,"notification.failed-send"),r(),g(3,"span",2),s(4,"button",3),C("click",function(){return t.cancel()}),s(5,"mat-icon",4),p(6,"close"),r()()(),s(7,"div",5),v(8,AI,8,7,"div",6),c(9,"keyvalue"),r()),o&2&&(a(8),m("ngForOf",u(9,1,t.errorStats)))},dependencies:[xe,U,Ie,re,at,dt,sn,oa,J,xr,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;width:600px;max-width:100%;color:#000000de}[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:500;font-size:16px;line-height:20px;margin-top:0}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]{table-layout:fixed;width:100%;border:hidden;border-collapse:collapse}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:8px solid transparent;border-collapse:collapse;font-size:14px}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   .tb-row-error[_ngcontent-%COMP%]{word-wrap:break-word}[_nghost-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin:24px 0}']});let i=n;return i})();var Yd=(()=>{let n=class n{constructor(e,o,t,d){this.notificationService=e,this.translate=o,this.dialog=t,this.datePipe=d,this.config=new Le,this.config.entityType=O.NOTIFICATION_REQUEST,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.searchEnabled=!1,this.config.entityTranslations=Ge.get(O.NOTIFICATION_REQUEST),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-request-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-request-text"),this.config.deleteEntitiesTitle=f=>this.translate.instant("notification.delete-requests-title",{count:f}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-requests-text"),this.config.deleteEntity=f=>this.notificationService.deleteNotificationRequest(f.id),this.config.entitiesFetchFunction=f=>this.notificationService.getNotificationRequests(f),this.config.cellActionDescriptors=this.configureCellActions(),this.config.onEntityAction=f=>this.onRequestAction(f),this.config.handleRowClick=(f,_)=>((f.target.getElementsByClassName("stats").length||f.target.className==="stats")&&this.openStatsErrorDialog(f,_),!0),this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("status","notification.status","15%",f=>`<span style="display: flex;">${this.requestStatus(f.status)}${this.requestStats(f.stats)}</span>`,f=>this.requestStatusStyle(f.status)),new K("deliveryMethods","notification.delivery-method.delivery-method","15%",f=>f.deliveryMethods.map(_=>this.translate.instant(Ca.get(_).name)).join(", "),()=>({}),!1),new K("templateName","notification.template","70%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.notify-again"),icon:"mdi:repeat-variant",isEnabled:e=>e.status!==Sa.SCHEDULED,onAction:(e,o)=>this.createRequest(e,o)}]}createRequest(e,o,t=!1,d=!0){e&&e.stopPropagation(),this.dialog.open(Ds,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,request:o}}).afterClosed().subscribe(f=>{f&&d&&this.config.updateData()})}onRequestAction(e){switch(e.action){case"add":return this.createRequest(e.event,e.entity,!0),!0;case"add-without-update":return this.createRequest(e.event,e.entity,!0,!1),!0}return!1}requestStatus(e){let o=V0.get(e),t="rgba(25, 128, 56, 0.08)";switch(e){case Sa.SCHEDULED:t="rgba(48, 86, 128, 0.08)";break;case Sa.PROCESSING:t="rgba(212, 125, 24, 0.08)";break}return`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(o)}
            </div>`}requestStats(e){if(!e?.errors)return"";let o=e.totalErrors;return o===0?"":`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px; width: max-content; cursor: pointer;
                        background-color: #D12730; color: #fff; font-weight: 500; margin-left: 8px" class="stats">
                ${this.translate.instant("notification.fails",{count:o})} >
            </div>`}requestStatusStyle(e){let o={fontSize:"14px",color:"#198038"};switch(e){case Sa.SCHEDULED:o.color="#305680";break;case Sa.PROCESSING:o.color="#D47D18";break}return o}openStatsErrorDialog(e,o){e&&e.stopPropagation(),this.dialog.open(Sp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notificationRequest:o}}).afterClosed().subscribe(()=>{})}};n.\u0275fac=function(o){return new(o||n)(P(vi),P(ee),P(je),P(Oe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();var Kd=(()=>{let n=class n{constructor(e,o,t,d,f){this.notificationService=e,this.translate=o,this.dialog=t,this.datePipe=d,this.customTranslate=f,this.config=new Le,this.config.entityType=O.NOTIFICATION_TARGET,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.NOTIFICATION_TARGET),this.config.entityResources={},this.config.addEntity=()=>this.notificationTargetDialog(null,!0),this.config.entitiesFetchFunction=_=>this.notificationService.getNotificationTargets(_),this.config.deleteEntityTitle=_=>this.translate.instant("notification.delete-recipient-title",{recipientName:_.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-recipient-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("notification.delete-recipients-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-recipients-text"),this.config.deleteEntity=_=>this.notificationService.deleteNotificationTarget(_.id),this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.handleRowClick=(_,D)=>(this.editTarget(_,D),!0),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("name","notification.recipient-group","20%"),new K("configuration.type","notification.type","20%",_=>this.translate.instant(R0.get(_.configuration.type)),()=>({}),!1),new K("configuration.description","notification.description","60%",_=>this.customTranslate.transform(_.configuration.description||""),()=>({}),!1))}resolve(e){return this.config}editTarget(e,o){e?.stopPropagation(),this.notificationTargetDialog(o).subscribe(t=>t?this.config.updateData():null)}notificationTargetDialog(e,o=!1){return this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:o,target:e}}).afterClosed()}};n.\u0275fac=function(o){return new(o||n)(P(vi),P(ee),P(je),P(Oe),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();var Xd=(()=>{let n=class n{constructor(e,o,t,d){this.notificationService=e,this.translate=o,this.dialog=t,this.datePipe=d,this.config=new Le,this.config.entityType=O.NOTIFICATION_TEMPLATE,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.NOTIFICATION_TEMPLATE),this.config.entityResources={},this.config.addEntity=()=>this.notificationTemplateDialog(null,!0),this.config.entitiesFetchFunction=f=>this.notificationService.getNotificationTemplates(f),this.config.deleteEntityTitle=f=>this.translate.instant("notification.delete-template-title",{templateName:f.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-template-text"),this.config.deleteEntitiesTitle=f=>this.translate.instant("notification.delete-templates-title",{count:f}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-templates-text"),this.config.deleteEntity=f=>this.notificationService.deleteNotificationTemplate(f.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.handleRowClick=(f,_)=>(this.editTemplate(f,_),!0),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("notificationType","notification.type","20%",f=>this.translate.instant(Ta.get(f.notificationType).name)),new K("name","notification.template","80%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.copy-template"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,o)=>this.editTemplate(e,o,!0)}]}editTemplate(e,o,t=!1){e?.stopPropagation(),this.notificationTemplateDialog(o,!1,t).subscribe(d=>d?this.config.updateData():null)}notificationTemplateDialog(e,o=!1,t=!1){return this.dialog.open(_s,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:o,isCopy:t,template:e}}).afterClosed()}};n.\u0275fac=function(o){return new(o||n)(P(vi),P(ee),P(je),P(Oe))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();S();S();S();S();function NI(i,n){i&1&&(s(0,"div",8),p(1,"notification.first-recipient"),r())}function kI(i,n){i&1&&(s(0,"div",9)(1,"span",10),p(2,"notification.after"),r(),g(3,"tb-timeinterval",11),s(4,"span",12),p(5,"notification.notify"),r()())}var Tp=(()=>{let n=class n{constructor(e,o){this.fb=e,this.dialog=o,this.systemEscalation=!1,this.entityType=O,this.notificationType=j0,this.propagateChange=null,this.propagateChangePending=!1,this.destroy$=new Ft}registerOnChange(e){this.propagateChange=e,this.propagateChangePending&&(this.propagateChangePending=!1,setTimeout(()=>{this.propagateChange(this.modelValue)},0))}registerOnTouched(e){}ngOnInit(){this.escalationFormGroup=this.fb.group({delayInSec:[0],targets:[null,T.required]}),this.escalationFormGroup.valueChanges.pipe(mt(this.destroy$)).subscribe(()=>this.updateModel())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.escalationFormGroup.disable({emitEvent:!1}):this.escalationFormGroup.enable({emitEvent:!1})}writeValue(e){this.propagateChangePending=!1,this.modelValue=e,this.modelValue.delayInSec=+e.delayInSec,Be(this.modelValue)&&this.escalationFormGroup.patchValue(this.modelValue,{emitEvent:!1}),!this.disabled&&!this.escalationFormGroup.valid&&this.updateModel()}createTarget(e,o){e&&e.stopPropagation(),o._elementRef.nativeElement.blur(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let d=this.escalationFormGroup.get("targets").value;d||(d=[]),d.push(t.id.id),this.escalationFormGroup.get("targets").patchValue(d)}})}validate(e){return this.escalationFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let e=this.escalationFormGroup.value;this.modelValue=Ce(Ce({},this.modelValue),e),this.propagateChange?this.propagateChange(this.modelValue):this.propagateChangePending=!0}};n.\u0275fac=function(o){return new(o||n)(h(ct),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-escalation-form"]],inputs:{disabled:"disabled",systemEscalation:"systemEscalation"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}])],decls:12,vars:13,consts:[["selectTime",""],["createTargetButton",""],[1,"flex","flex-col",3,"formGroup"],[1,"escalation","flex","flex-row","items-center","justify-center","xs:flex-col","xs:items-stretch","xs:justify-start"],["class","flex-1","translate","",4,"ngIf","ngIfElse"],["required","","formControlName","targets","subscriptSizing","dynamic",1,"flex-full","xs:max-h-60%","gt-xs:max-w-60%",3,"entityType","subType","placeholderText"],["mat-button","","matSuffix","",3,"click"],[2,"white-space","nowrap"],["translate","",1,"flex-1"],[1,"flex","flex-1","flex-row","items-center","justify-center","xs:flex-col"],["translate",""],["subscriptSizing","dynamic","formControlName","delayInSec","min","60000","max","604800000","disabledAdvanced",""],["translate","",1,"escalation-notify","flex-1"]],template:function(o,t){if(o&1){let d=L();s(0,"form",2)(1,"div",3),v(2,NI,2,0,"div",4)(3,kI,6,0,"ng-template",null,0,Et),s(5,"tb-entity-list",5),c(6,"translate"),s(7,"button",6,1),C("click",function(_){I(d);let D=q(8);return w(t.createTarget(_,D))}),s(9,"span",7),p(10),c(11,"translate"),r()()()()()}if(o&2){let d=q(4);m("formGroup",t.escalationFormGroup),a(2),m("ngIf",t.systemEscalation)("ngIfElse",d),a(3),x("entityType",t.entityType.NOTIFICATION_TARGET),x("subType",t.notificationType.ALARM),m("placeholderText",t.escalationFormGroup.get("targets").value?"":u(6,9,"notification.add-recipient")),a(2),j("!hidden",t.disabled),a(3),B(u(11,11,"notification.create-new"))}},dependencies:[U,Tu,io,te,Xt,ue,W,X,fe,ne,le,J,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%]{height:100%;min-height:74px;max-height:100%;border-radius:8px;background:#0000000a;padding:0 10px}[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-right:10px}[_nghost-%COMP%]   .escalation-notify[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{min-width:100px;padding:0 10px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding:10px 0 0}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]     .mat-mdc-form-field{min-width:100px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-select{min-width:110px!important}']});let i=n;return i})();function BI(i,n){i&1&&g(0,"span",8)}function RI(i,n){if(i&1){let l=L();s(0,"button",9),c(1,"translate"),C("click",function(){I(l);let o=y().index,t=y();return w(t.removeEscalation(o))}),s(2,"mat-icon"),p(3,"close"),r()()}i&2&&x("matTooltip",u(1,1,"action.remove"))}function VI(i,n){if(i&1&&(s(0,"div",4),g(1,"tb-escalation-form",5),v(2,BI,1,0,"span",6)(3,RI,4,3,"button",7),r()),i&2){let l=n.$implicit,e=n.index,o=n.last,t=y();j("pb-2",!o),a(),m("formControl",l)("systemEscalation",e===0),a(),m("ngIf",e===0),a(),m("ngIf",e!==0&&!t.disabled)}}function jI(i,n){i&1&&(s(0,"div")(1,"span",10),p(2,"notification.no-rule"),r()())}function LI(i,n){if(i&1){let l=L();s(0,"div",11)(1,"button",12),C("click",function(){I(l);let o=y();return w(o.addEscalation())}),s(2,"span",13),p(3,"notification.add-stage"),r()()()}}var fo=class fo{constructor(n,l){this.store=n,this.fb=l,this.destroy$=new Ft,this.propagateChange=e=>{}}registerOnChange(n){this.propagateChange=n}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}registerOnTouched(n){}ngOnInit(){this.escalationsFormGroup=this.fb.group({escalations:this.fb.array([])}),this.escalationsFormGroup.valueChanges.pipe(mt(this.destroy$)).subscribe(()=>this.updateModel())}get escalationsFormArray(){return this.escalationsFormGroup.get("escalations")}setDisabledState(n){this.disabled=n,this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}writeValue(n){let l=[];for(let e in n)l.push({delayInSec:Number(e)*1e3,targets:n[e]});if(l.length===0)this.addEscalation(0);else if(l?.length===this.escalationsFormArray.length)this.escalationsFormArray.patchValue(l,{emitEvent:!1});else{let e=[];l.forEach(o=>{e.push(this.fb.control(o,[T.required]))}),this.escalationsFormGroup.setControl("escalations",this.fb.array(e),{emitEvent:!1}),this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}}removeEscalation(n){this.escalationsFormGroup.get("escalations").removeAt(n)}addEscalation(n=36e5){let l={delayInSec:n,targets:null};this.escalationsFormGroup.get("escalations").push(this.fb.control(l,[]),{emitEvent:!1})}validate(n){return this.escalationsFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let n={};this.escalationsFormGroup.get("escalations").value.forEach(l=>n[l.delayInSec/1e3]=l.targets),this.propagateChange(n)}};fo.\u0275fac=function(l){return new(l||fo)(h(A),h(ct))},fo.\u0275cmp=F({type:fo,selectors:[["tb-escalations-component"]],inputs:{required:"required",disabled:"disabled"},features:[He([{provide:ot,useExisting:Re(()=>fo),multi:!0},{provide:Ht,useExisting:Re(()=>fo),multi:!0}])],decls:4,vars:3,consts:[[1,"flex","flex-col"],["class","tb-tenant-profile-queues flex flex-row items-center",3,"pb-2",4,"ngFor","ngForOf"],[4,"ngIf"],["style","padding: 16px 0;",4,"ngIf"],[1,"tb-tenant-profile-queues","flex","flex-row","items-center"],[1,"flex-1",3,"formControl","systemEscalation"],["style","width: 48px;",4,"ngIf"],["mat-icon-button","","style","min-width: 40px;","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[2,"width","48px"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"min-width","40px",3,"click","matTooltip"],["translate","",1,"tb-prompt","flex","items-center","justify-center"],[2,"padding","16px 0"],["mat-raised-button","","color","primary","type","button",3,"click"],["translate",""]],template:function(l,e){l&1&&(s(0,"div",0),v(1,VI,4,6,"div",1)(2,jI,3,0,"div",2)(3,LI,4,0,"div",3),r()),l&2&&(a(),m("ngForOf",e.escalationsFormArray.controls),a(),m("ngIf",!e.escalationsFormArray.controls.length),a(),m("ngIf",!e.disabled))},dependencies:[xe,U,te,Ie,re,Mt,W,ii,J,Tp,R],encapsulation:2});var Oo=fo;Bo([ra(),Ro("design:type",Boolean)],Oo.prototype,"required",void 0);var UI=["addNotificationRule"];function qI(i,n){i&1&&g(0,"mat-progress-bar",31)}function WI(i,n){i&1&&g(0,"div",32)}function HI(i,n){i&1&&(s(0,"mat-icon"),p(1,"check"),r())}function zI(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.basic-settings"))}function $I(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.rule-name-required")," "))}function JI(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.triggerTypeTranslationMap.get(l))," ")}}function QI(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.trigger.trigger-required")," "))}function YI(i,n){if(i&1){let l=L();s(0,"section",34)(1,"tb-entity-list",35),c(2,"translate"),c(3,"translate"),c(4,"translate"),s(5,"button",36,3),C("click",function(o){I(l);let t=q(6),d=y();return w(d.createTarget(o,t))}),s(7,"span",37),p(8),c(9,"translate"),r()()()()}if(i&2){let l=y();a(),x("subType",l.ruleNotificationForm.get("triggerType").value),x("entityType",l.entityType.NOTIFICATION_TARGET),x("labelText",u(2,6,"notification.recipients")),x("requiredText",u(3,8,"notification.recipients-required")),x("placeholderText",u(4,10,"notification.recipient")),a(7),B(u(9,12,"notification.create-new"))}}function KI(i,n){i&1&&Rt(0)}function XI(i,n){if(i&1&&(s(0,"fieldset",38)(1,"legend",19),p(2,"notification.escalation-chain"),r(),s(3,"div",39),p(4,"notification.recipients"),r(),g(5,"tb-escalations-component",40),v(6,KI,1,0,"ng-container",41),r()),i&2){y();let l=q(40);a(6),m("ngTemplateOutlet",l)}}function ZI(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSearchStatusTranslationMap.get(l))," ")}}function ew(i,n){if(i&1&&(s(0,"form",17)(1,"section",42)(2,"section",43)(3,"div",39),p(4,"notification.stop-escalation-alarm-status-become"),r(),s(5,"mat-form-field",44)(6,"mat-label",19),p(7,"alarm.alarm-status-list"),r(),s(8,"mat-select",45),c(9,"translate"),v(10,ZI,3,4,"mat-option",24),r()()()()()),i&2){let l,e=y();m("formGroup",e.alarmTemplateForm),a(8),x("placeholder",(l=e.alarmTemplateForm.get("triggerConfig.clearRule.alarmStatuses").value)!=null&&l.length?"":u(9,3,"alarm.any-status")),a(2),m("ngForOf",e.alarmSearchStatuses)}}function tw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.alarm-trigger-settings"))}function iw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSeverityTranslationMap.get(l))," ")}}function nw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmActionTranslationMap.get(l))," ")}}function ow(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.notify-on-required")," "))}function aw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,tw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),g(7,"tb-string-items-list",47),c(8,"translate"),c(9,"translate"),s(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),s(13,"mat-select",49),c(14,"translate"),v(15,iw,3,4,"mat-option",24),r()()(),s(16,"mat-form-field",50)(17,"mat-label",19),p(18,"notification.notify-on"),r(),s(19,"mat-select",51),v(20,nw,3,4,"mat-option",24),r(),v(21,ow,3,3,"mat-error",21),r()()(),s(22,"form",17)(23,"section",52)(24,"mat-form-field",18)(25,"mat-label",19),p(26,"notification.description"),r(),g(27,"input",53),r()()()()),i&2){let l,e,o=y();m("stepControl",o.alarmTemplateForm),a(2),m("formGroup",o.alarmTemplateForm),a(5),x("label",u(8,9,"alarm.alarm-type-list")),x("placeholder",(l=o.alarmTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&l.length?"":u(9,11,"alarm.any-type")),a(6),x("placeholder",(e=o.alarmTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&e.length?"":u(14,13,"alarm.any-severity")),a(2),m("ngForOf",o.alarmSeverities),a(5),m("ngForOf",o.alarmActions),a(),m("ngIf",o.alarmTemplateForm.get("triggerConfig.notifyOn").hasError("required")),a(),m("formGroup",o.ruleNotificationForm)}}function rw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.device-activity-trigger-settings"))}function sw(i,n){if(i&1&&(Lt(0),g(1,"tb-entity-list",57),c(2,"translate"),c(3,"translate"),c(4,"translate"),Gt()),i&2){let l=y(2);a(),x("labelText",u(2,4,"device.devices")),x("placeholderText",u(3,6,"device.devices")),x("hint",u(4,8,"notification.device-list-rule-hint")),m("entityType",l.entityType.DEVICE)}}function lw(i,n){if(i&1&&(g(0,"tb-entity-list",58),c(1,"translate"),c(2,"translate"),c(3,"translate")),i&2){let l=y(2);x("labelText",u(1,4,"device-profile.device-profiles")),x("placeholderText",u(2,6,"device-profile.device-profiles")),x("hint",u(3,8,"notification.device-profiles-list-rule-hint")),m("entityType",l.entityType.DEVICE_PROFILE)}}function mw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.deviceEventTranslationMap.get(l))," ")}}function pw(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.notify-on-required")," "))}function dw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,rw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"div",54)(5,"tb-toggle-select",55)(6,"tb-toggle-option",33),p(7),c(8,"translate"),r(),s(9,"tb-toggle-option",33),p(10),c(11,"translate"),r()()(),v(12,sw,5,10,"ng-container",56)(13,lw,4,10,"ng-template",null,4,Et),s(15,"mat-form-field",50)(16,"mat-label",19),p(17,"notification.notify-on"),r(),s(18,"mat-select",51),v(19,mw,3,4,"mat-option",24),r(),v(20,pw,3,3,"mat-error",21),r()()(),s(21,"form",17)(22,"section",52)(23,"mat-form-field",18)(24,"mat-label",19),p(25,"notification.description"),r(),g(26,"input",53),r()()()()),i&2){let l=q(14),e=y();m("stepControl",e.deviceInactivityTemplateForm),a(2),m("formGroup",e.deviceInactivityTemplateForm),a(4),m("value",!0),a(),B(u(8,11,"device.device")),a(2),m("value",!1),a(),B(u(11,13,"device-profile.device-profile")),a(2),m("ngIf",e.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").value)("ngIfElse",l),a(7),m("ngForOf",e.deviceEvents),a(),m("ngIf",e.deviceInactivityTemplateForm.get("triggerConfig.notifyOn").hasError("required")),a(),m("formGroup",e.ruleNotificationForm)}}function cw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.entity-action-trigger-settings"))}function uw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,cw,2,3,"ng-template",16),s(2,"form",17)(3,"fieldset",59)(4,"legend",19),p(5,"notification.filter"),r(),g(6,"tb-entity-type-list",60),s(7,"section",61)(8,"span",62),p(9,"notification.status"),r(),s(10,"mat-slide-toggle",63),p(11),c(12,"translate"),r(),s(13,"mat-slide-toggle",64),p(14),c(15,"translate"),r(),s(16,"mat-slide-toggle",65),p(17),c(18,"translate"),r()()()(),s(19,"form",17)(20,"section",52)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.description"),r(),g(24,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.entityActionTemplateForm),a(2),m("formGroup",l.entityActionTemplateForm),a(4),m("allowedEntityTypes",l.allowEntityTypeForEntityAction),a(5),B(u(12,7,"notification.created")),a(3),B(u(15,9,"notification.updated")),a(3),B(u(18,11,"notification.deleted")),a(2),m("formGroup",l.ruleNotificationForm)}}function fw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.alarm-comment-trigger-settings"))}function gw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSeverityTranslationMap.get(l))," ")}}function hw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSearchStatusTranslationMap.get(l))," ")}}function bw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,fw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.filter"),r(),g(7,"tb-string-items-list",47),c(8,"translate"),c(9,"translate"),s(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),s(13,"mat-select",49),c(14,"translate"),v(15,gw,3,4,"mat-option",24),r()(),s(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),r(),s(19,"mat-select",45),c(20,"translate"),v(21,hw,3,4,"mat-option",24),r()()(),s(22,"section",67)(23,"mat-slide-toggle",68),p(24),c(25,"translate"),r(),s(26,"mat-slide-toggle",69),p(27),c(28,"translate"),r()()()(),s(29,"form",17)(30,"section",52)(31,"mat-form-field",18)(32,"mat-label",19),p(33,"notification.description"),r(),g(34,"input",53),r()()()()),i&2){let l,e,o,t=y();m("stepControl",t.alarmCommentTemplateForm),a(2),m("formGroup",t.alarmCommentTemplateForm),a(5),x("label",u(8,11,"alarm.alarm-type-list")),x("placeholder",(l=t.alarmCommentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&l.length?"":u(9,13,"alarm.any-type")),a(6),x("placeholder",(e=t.alarmCommentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&e.length?"":u(14,15,"alarm.any-severity")),a(2),m("ngForOf",t.alarmSeverities),a(4),x("placeholder",(o=t.alarmCommentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&o.length?"":u(20,17,"alarm.any-status")),a(2),m("ngForOf",t.alarmSearchStatuses),a(3),b(" ",u(25,19,"notification.notify-only-user-comments")," "),a(3),b(" ",u(28,21,"notification.notify-on-comment-update")," "),a(2),m("formGroup",t.ruleNotificationForm)}}function vw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.alarm-assignment-trigger-settings"))}function yw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSeverityTranslationMap.get(l))," ")}}function _w(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmSearchStatusTranslationMap.get(l))," ")}}function Cw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.alarmAssignmentActionTranslationMap.get(l))," ")}}function Sw(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.notify-on-required")," "))}function Tw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,vw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.filter"),r(),g(7,"tb-string-items-list",47),c(8,"translate"),c(9,"translate"),s(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),r(),s(13,"mat-select",49),c(14,"translate"),v(15,yw,3,4,"mat-option",24),r()(),s(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),r(),s(19,"mat-select",45),c(20,"translate"),v(21,_w,3,4,"mat-option",24),r()()(),s(22,"mat-form-field",50)(23,"mat-label",19),p(24,"notification.notify-on"),r(),s(25,"mat-select",51),v(26,Cw,3,4,"mat-option",24),r(),v(27,Sw,3,3,"mat-error",21),r()()(),s(28,"form",17)(29,"section",52)(30,"mat-form-field",18)(31,"mat-label",19),p(32,"notification.description"),r(),g(33,"input",53),r()()()()),i&2){let l,e,o,t=y();m("stepControl",t.alarmAssignmentTemplateForm),a(2),m("formGroup",t.alarmAssignmentTemplateForm),a(5),x("label",u(8,11,"alarm.alarm-type-list")),x("placeholder",(l=t.alarmAssignmentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&l.length?"":u(9,13,"alarm.any-type")),a(6),x("placeholder",(e=t.alarmAssignmentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&e.length?"":u(14,15,"alarm.any-severity")),a(2),m("ngForOf",t.alarmSeverities),a(4),x("placeholder",(o=t.alarmAssignmentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&o.length?"":u(20,17,"alarm.any-status")),a(2),m("ngForOf",t.alarmSearchStatuses),a(5),m("ngForOf",t.alarmAssignmentActions),a(),m("ngIf",t.alarmAssignmentTemplateForm.get("triggerConfig.notifyOn").hasError("required")),a(),m("formGroup",t.ruleNotificationForm)}}function xw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.rule-engine-events-trigger-settings"))}function Ew(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.componentLifecycleEventTranslationMap.get(l))," ")}}function Iw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(3);m("value",l),a(),b(" ",u(2,2,e.componentLifecycleEventTranslationMap.get(l))," ")}}function ww(i,n){if(i&1&&(s(0,"section")(1,"mat-form-field",48)(2,"mat-label",19),p(3,"rulenode.rule-node-events"),r(),s(4,"mat-select",74),c(5,"translate"),v(6,Iw,3,4,"mat-option",24),r()(),s(7,"mat-slide-toggle",75),p(8),c(9,"translate"),r()()),i&2){let l,e=y(2);a(4),x("placeholder",(l=e.ruleEngineEventsTemplateForm.get("triggerConfig.ruleNodeEvents").value)!=null&&l.length?"":u(5,3,"event.all-events")),a(2),m("ngForOf",e.componentLifecycleEvents),a(2),b(" ",u(9,5,"notification.only-rule-node-lifecycle-failures")," ")}}function Mw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,xw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.rule-engine-filter"),r(),g(7,"tb-entity-list",70),c(8,"translate"),c(9,"translate"),c(10,"translate"),s(11,"mat-form-field",48)(12,"mat-label",19),p(13,"rulechain.rulechain-events"),r(),s(14,"mat-select",71),c(15,"translate"),v(16,Ew,3,4,"mat-option",24),r()(),s(17,"mat-slide-toggle",72),p(18),c(19,"translate"),r()(),s(20,"fieldset",66)(21,"legend",19),p(22,"notification.rule-node-filter"),r(),s(23,"mat-slide-toggle",73),p(24),c(25,"translate"),r(),v(26,ww,10,7,"section",21),r()()(),s(27,"form",17)(28,"section",52)(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.description"),r(),g(32,"input",53),r()()()()),i&2){let l,e=y();m("stepControl",e.ruleEngineEventsTemplateForm),a(2),m("formGroup",e.ruleEngineEventsTemplateForm),a(5),x("labelText",u(8,12,"rulechain.rulechains")),x("placeholderText",u(9,14,"rulechain.rulechains")),x("hint",u(10,16,"notification.rule-chain-list-rule-hint")),m("entityType",e.entityType.RULE_CHAIN),a(7),x("placeholder",(l=e.ruleEngineEventsTemplateForm.get("triggerConfig.ruleChainEvents").value)!=null&&l.length?"":u(15,18,"event.all-events")),a(2),m("ngForOf",e.componentLifecycleEvents),a(2),b(" ",u(19,20,"notification.only-rule-chain-lifecycle-failures")," "),a(6),b(" ",u(25,22,"notification.track-rule-node-events")," "),a(2),m("ngIf",e.ruleEngineEventsTemplateForm.get("triggerConfig.trackRuleNodeEvents").value),a(),m("formGroup",e.ruleNotificationForm)}}function Dw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.edge-trigger-settings"))}function Fw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.edgeConnectionEventTranslationMap.get(l))," ")}}function Pw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,Dw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),g(7,"tb-entity-list",76),c(8,"translate"),c(9,"translate"),c(10,"translate"),s(11,"mat-form-field",48)(12,"mat-label",19),p(13,"notification.notify-on"),r(),s(14,"mat-select",77),c(15,"translate"),v(16,Fw,3,4,"mat-option",24),r()()()()(),s(17,"form",17)(18,"section",52)(19,"mat-form-field",18)(20,"mat-label",19),p(21,"notification.description"),r(),g(22,"input",53),r()()()()),i&2){let l,e=y();m("stepControl",e.edgeConnectionTemplateForm),a(2),m("formGroup",e.edgeConnectionTemplateForm),a(5),x("labelText",u(8,9,"edge.edge-instances")),x("placeholderText",u(9,11,"edge.edge-instances")),x("hint",u(10,13,"notification.edge-list-rule-hint")),m("entityType",e.entityType.EDGE),a(7),x("placeholder",(l=e.edgeConnectionTemplateForm.get("triggerConfig.notifyOn").value)!=null&&l.length?"":u(15,15,"event.all-events")),a(2),m("ngForOf",e.edgeConnectionEvents),a(),m("formGroup",e.ruleNotificationForm)}}function Aw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.edge-trigger-settings"))}function Nw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,Aw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),r(),g(7,"tb-entity-list",78),c(8,"translate"),c(9,"translate"),r()()(),s(10,"form",17)(11,"section",52)(12,"mat-form-field",18)(13,"mat-label",19),p(14,"notification.description"),r(),g(15,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.edgeCommunicationFailureTemplateForm),a(2),m("formGroup",l.edgeCommunicationFailureTemplateForm),a(5),x("labelText",u(8,6,"edge.edge-instances")),x("hint",u(9,8,"notification.edge-list-rule-hint")),m("entityType",l.entityType.EDGE),a(3),m("formGroup",l.ruleNotificationForm)}}function kw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.entities-limit-trigger-settings"))}function Ow(i,n){if(i&1&&(s(0,"mat-step",15),v(1,kw,2,3,"ng-template",16),s(2,"form",17)(3,"fieldset",59)(4,"legend",19),p(5,"notification.filter"),r(),g(6,"tb-entity-type-list",79),s(7,"div",80)(8,"label",19),p(9,"notification.threshold"),r(),s(10,"div",81)(11,"mat-slider",82),g(12,"input",83),r(),s(13,"mat-form-field",84),g(14,"input",85),r()()()()(),s(15,"form",17)(16,"section",52)(17,"mat-form-field",18)(18,"mat-label",19),p(19,"notification.description"),r(),g(20,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.entitiesLimitTemplateForm),a(2),m("formGroup",l.entitiesLimitTemplateForm),a(4),m("allowedEntityTypes",l.allowEntityTypeForEntitiesLimit),a(5),m("displayWith",l.formatLabel),a(3),m("value",l.entitiesLimitTemplateForm.get("triggerConfig.threshold").value),a(),m("formGroup",l.ruleNotificationForm)}}function Bw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.api-usage-trigger-settings"))}function Rw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.apiFeatureTranslationMap.get(l))," ")}}function Vw(i,n){if(i&1&&(s(0,"mat-option",33),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y(2);m("value",l),a(),b(" ",u(2,2,e.apiUsageStateValueTranslationMap.get(l))," ")}}function jw(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"notification.notify-on-required")," "))}function Lw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,Bw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42)(4,"mat-form-field",86)(5,"mat-label",19),p(6,"api-usage.api-features"),r(),s(7,"mat-select",87),v(8,Rw,3,4,"mat-option",24),r(),s(9,"mat-hint"),p(10),c(11,"translate"),r()(),s(12,"mat-form-field",50)(13,"mat-label",19),p(14,"notification.notify-on"),r(),s(15,"mat-select",51),v(16,Vw,3,4,"mat-option",24),r(),v(17,jw,3,3,"mat-error",21),r()()(),s(18,"form",17)(19,"section",52)(20,"mat-form-field",18)(21,"mat-label",19),p(22,"notification.description"),r(),g(23,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.apiUsageLimitTemplateForm),a(2),m("formGroup",l.apiUsageLimitTemplateForm),a(6),m("ngForOf",l.apiFeatures),a(2),B(u(11,7,"notification.api-feature-hint")),a(6),m("ngForOf",l.apiUsageStateValues),a(),m("ngIf",l.apiUsageLimitTemplateForm.get("triggerConfig.notifyOn").hasError("required")),a(),m("formGroup",l.ruleNotificationForm)}}function Gw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.new-platform-version-trigger-settings"))}function Uw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,Gw,2,3,"ng-template",16),s(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),r(),g(7,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.newPlatformVersionTemplateForm),a(2),m("formGroup",l.ruleNotificationForm)}}function qw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.rate-limits-trigger-settings"))}function Ww(i,n){if(i&1&&(s(0,"mat-step",15),v(1,qw,2,3,"ng-template",16),s(2,"form",17)(3,"section",42),g(4,"tb-string-items-list",88),c(5,"translate"),c(6,"translate"),r()(),s(7,"form",17)(8,"section",52)(9,"mat-form-field",18)(10,"mat-label",19),p(11,"notification.description"),r(),g(12,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.rateLimitsTemplateForm),a(2),m("formGroup",l.rateLimitsTemplateForm),a(2),x("label",u(5,6,"notification.rate-limits")),x("hint",u(6,8,"notification.api-feature-hint")),m("predefinedValues",l.limitedApis),a(3),m("formGroup",l.ruleNotificationForm)}}function Hw(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"notification.task-processing-failure-trigger-settings"))}function zw(i,n){if(i&1&&(s(0,"mat-step",15),v(1,Hw,2,3,"ng-template",16),s(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),r(),g(7,"input",53),r()()()()),i&2){let l=y();m("stepControl",l.taskProcessingFailureTemplateForm),a(2),m("formGroup",l.ruleNotificationForm)}}function $w(i,n){if(i&1){let l=L();s(0,"button",89),C("click",function(){I(l);let o=y();return w(o.backStep())}),p(1),c(2,"translate"),r()}i&2&&(a(),B(u(2,1,"action.back")))}var xp=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D,M,Y){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.data=d,this.breakpointObserver=f,this.fb=_,this.translate=D,this.notificationService=M,this.dialog=Y,this.triggerType=Qt,this.triggerTypeTranslationMap=ys,this.alarmSearchStatuses=[Ya.ACTIVE,Ya.CLEARED,Ya.ACK,Ya.UNACK],this.alarmSearchStatusTranslationMap=Gc,this.alarmSeverityTranslationMap=Lc,this.alarmSeverities=Object.keys(jc),this.alarmActions=Object.values(fd),this.alarmActionTranslationMap=k0,this.alarmAssignmentActions=Object.values(gd),this.alarmAssignmentActionTranslationMap=O0,this.componentLifecycleEvents=Object.values(A0),this.componentLifecycleEventTranslationMap=N0,this.deviceEvents=Object.values(hd),this.deviceEventTranslationMap=B0,this.apiUsageStateValues=Object.values(yd),this.apiUsageStateValueTranslationMap=tf,this.apiFeatures=Object.values(nf),this.apiFeatureTranslationMap=of,this.edgeConnectionEvents=Object.values(Ju),this.edgeConnectionEventTranslationMap=Qu,this.entityType=O,this.isAdd=!0,this.allowEntityTypeForEntitiesLimit=[O.DEVICE,O.ASSET,O.CUSTOMER,O.USER,O.DASHBOARD,O.RULE_CHAIN],this.selectedIndex=0,this.dialogTitle="notification.edit-rule",this.destroy$=new Ft,this.authState=ji(this.store),this.authUser=this.authState.authUser,this.triggerTypes=this.allowTriggerTypes(),On(d.isAdd)&&(this.isAdd=d.isAdd),this.limitedApis=Object.values(af).map(ke=>({name:this.translate.instant(rf.get(ke)),value:ke})),this.stepperOrientation=this.breakpointObserver.observe(wi["gt-xs"]).pipe(rt(({matches:ke})=>ke?"horizontal":"vertical")),this.ruleNotificationForm=this.fb.group({name:[null,T.required],enabled:[!0,T.required],templateId:[null,T.required],triggerType:[this.isSysAdmin()?Qt.ENTITIES_LIMIT:Qt.ALARM,T.required],recipientsConfig:this.fb.group({targets:[{value:null,disabled:!this.isSysAdmin()},T.required],escalationTable:[{value:null,disabled:this.isSysAdmin()},T.required]}),triggerConfig:[null],additionalConfig:this.fb.group({description:[""]})}),this.ruleNotificationForm.get("triggerType").valueChanges.pipe(mt(this.destroy$)).subscribe(ke=>{ke===Qt.ALARM?(this.ruleNotificationForm.get("recipientsConfig.escalationTable").enable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").disable({emitEvent:!1})):(this.ruleNotificationForm.get("recipientsConfig.escalationTable").disable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").enable({emitEvent:!1}))}),this.ruleNotificationForm.get("recipientsConfig.escalationTable").valueChanges.pipe(mt(this.destroy$)).subscribe(()=>{this.countRecipientsChainConfig()>1?this.alarmTemplateForm.get("triggerConfig.clearRule").enable({emitEvent:!1}):this.alarmTemplateForm.get("triggerConfig.clearRule").disable({emitEvent:!1})}),this.edgeConnectionTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null],notifyOn:[null]})}),this.edgeCommunicationFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null]})}),this.alarmTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],clearRule:this.fb.group({alarmStatuses:[[]]}),notifyOn:[[fd.CREATED],T.required]})}),this.deviceInactivityTemplateForm=this.fb.group({triggerConfig:this.fb.group({filterByDevice:[!0],devices:[null],deviceProfiles:[{value:null,disabled:!0}],notifyOn:[[hd.INACTIVE],T.required]})}),this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").valueChanges.pipe(mt(this.destroy$)).subscribe(ke=>{ke?(this.deviceInactivityTemplateForm.get("triggerConfig.devices").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").disable({emitEvent:!1})):(this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.devices").disable({emitEvent:!1}))}),this.entityActionTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[[O.DEVICE],T.required],created:[!1],updated:[!1],deleted:[!1]})}),this.alarmCommentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],onlyUserComments:[!1],notifyOnCommentUpdate:[!1]})}),this.alarmAssignmentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],notifyOn:[[gd.ASSIGNED],T.required]})}),this.ruleEngineEventsTemplateForm=this.fb.group({triggerConfig:this.fb.group({ruleChains:[null],ruleChainEvents:[null],onlyRuleChainLifecycleFailures:[!1],trackRuleNodeEvents:[!1],ruleNodeEvents:[null],onlyRuleNodeLifecycleFailures:[!1]})}),this.entitiesLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[],threshold:[.8,[T.min(0),T.max(1)]]})}),this.apiUsageLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({apiFeatures:[[]],notifyOn:[[yd.WARNING],T.required]})}),this.newPlatformVersionTemplateForm=this.fb.group({triggerConfig:this.fb.group({})}),this.rateLimitsTemplateForm=this.fb.group({triggerConfig:this.fb.group({apis:[]})}),this.taskProcessingFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({taskTypes:[]})}),this.triggerTypeFormsMap=new Map([[Qt.ALARM,this.alarmTemplateForm],[Qt.ALARM_COMMENT,this.alarmCommentTemplateForm],[Qt.DEVICE_ACTIVITY,this.deviceInactivityTemplateForm],[Qt.ENTITY_ACTION,this.entityActionTemplateForm],[Qt.ALARM_ASSIGNMENT,this.alarmAssignmentTemplateForm],[Qt.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,this.ruleEngineEventsTemplateForm],[Qt.ENTITIES_LIMIT,this.entitiesLimitTemplateForm],[Qt.API_USAGE_LIMIT,this.apiUsageLimitTemplateForm],[Qt.NEW_PLATFORM_VERSION,this.newPlatformVersionTemplateForm],[Qt.RATE_LIMITS,this.rateLimitsTemplateForm],[Qt.EDGE_COMMUNICATION_FAILURE,this.edgeCommunicationFailureTemplateForm],[Qt.EDGE_CONNECTION,this.edgeConnectionTemplateForm],[Qt.TASK_PROCESSING_FAILURE,this.taskProcessingFailureTemplateForm]]),(d.isAdd||d.isCopy)&&(this.dialogTitle="notification.add-rule"),this.ruleNotification=Tt(this.data.rule),this.ruleNotification&&(this.data.isCopy?this.ruleNotification.name+=` (${this.translate.instant("action.copy")})`:this.ruleNotificationForm.get("triggerType").disable({emitEvent:!1}),this.ruleNotificationForm.reset({},{emitEvent:!1}),this.ruleNotificationForm.patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotificationForm.get("triggerType").updateValueAndValidity({onlySelf:!0}),this.triggerTypeFormsMap.get(this.ruleNotification.triggerType).patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotification.triggerType===Qt.DEVICE_ACTIVITY&&this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").patchValue(!!this.ruleNotification.triggerConfig.devices,{onlySelf:!0}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}backStep(){this.addNotificationRule.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addNotificationRule.next()}nextStepLabel(){return this.selectedIndex!==0?this.data.isAdd||this.data.isCopy?"action.add":"action.save":"action.next"}get maxStepperIndex(){return this.addNotificationRule?._steps?.length-1}add(){if(this.allValid()){let e=this.ruleNotificationForm.value,o=this.ruleNotificationForm.get("triggerType").value,t=this.triggerTypeFormsMap.get(o);Object.assign(e,t.value),o===Qt.DEVICE_ACTIVITY&&delete e.triggerConfig.filterByDevice,e.recipientsConfig.triggerType=o,e.triggerConfig.triggerType=o,this.ruleNotification&&!this.data.isCopy&&(e=Ce(Ce({},this.ruleNotification),e)),this.notificationService.saveNotificationRule(Bn(e)).subscribe(d=>this.dialogRef.close(d))}}allValid(){return!this.addNotificationRule.steps.find((e,o)=>e.stepControl.invalid?(e.interacted=!0,this.addNotificationRule.selectedIndex=o,!0):!1)}cancel(){this.dialogRef.close(null)}createTarget(e,o){e&&e.stopPropagation(),o._elementRef.nativeElement.blur(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let d=this.ruleNotificationForm.get("recipientsConfig.targets").value;d||(d=[]),d.push(t.id.id),this.ruleNotificationForm.get("recipientsConfig.targets").patchValue(d)}})}countRecipientsChainConfig(){return Object.keys(this.ruleNotificationForm.get("recipientsConfig.escalationTable").value??{}).length}formatLabel(e){return`${(e*100).toFixed()}%`}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}allowTriggerTypes(){let e=new Set([Qt.ENTITIES_LIMIT,Qt.API_USAGE_LIMIT,Qt.NEW_PLATFORM_VERSION,Qt.RATE_LIMITS,Qt.TASK_PROCESSING_FAILURE]);return this.isSysAdmin()?Array.from(e):Object.values(Qt).filter(o=>!e.has(o))}get allowEntityTypeForEntityAction(){if(!this._allowEntityTypeForEntityAction){let e=new Set([O.API_USAGE_STATE,O.TENANT_PROFILE,O.RPC,O.QUEUE,O.NOTIFICATION,O.NOTIFICATION_REQUEST,O.WIDGET_TYPE]);this._allowEntityTypeForEntityAction=Object.values(O).filter(o=>!e.has(o))}return this._allowEntityTypeForEntityAction}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(At),h(Xn),h(ct),h(ee),h(vi),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-rule-notification-dialog"]],viewQuery:function(o,t){if(o&1&&we(UI,7),o&2){let d;Me(d=De())&&(t.addNotificationRule=d.first)}},features:[G],decls:61,vars:41,consts:[["addNotificationRule",""],["alarmTargesConfig",""],["clearRules",""],["createTargetButton",""],["deviceProfile",""],["color","primary"],[1,"flex-1"],["tb-help","ruleNotifications"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",1,"xs:p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"formGroup"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","enabled",2,"margin-bottom","22px"],["formControlName","triggerType","required",""],[3,"value",4,"ngFor","ngForOf"],["required","","allowCreate","","allowEdit","","formControlName","templateId",3,"notificationTypes"],["formGroupName","recipientsConfig",4,"ngIf","ngIfElse"],[3,"stepControl",4,"ngIf"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formGroupName","recipientsConfig"],["required","","formControlName","targets",3,"subType","entityType","labelText","requiredText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click"],[2,"white-space","nowrap"],["formGroupName","recipientsConfig",1,"fields-group","tb-hierarchy"],["translate","",1,"mat-body-2"],["formControlName","escalationTable"],[4,"ngTemplateOutlet"],["formGroupName","triggerConfig"],["formGroupName","clearRule"],["floatLabel","always",1,"mat-block","flex-1",2,"margin-right","48px"],["formControlName","alarmStatuses","multiple","",3,"placeholder"],[1,"fields-group","tb-margin-before-field"],["editable","","floatLabel","always","formControlName","alarmTypes",3,"label","placeholder"],["floatLabel","always",1,"mat-block","flex-1"],["formControlName","alarmSeverities","multiple","",3,"placeholder"],[1,"mat-block","flex-1"],["formControlName","notifyOn","multiple",""],["formGroupName","additionalConfig"],["matInput","","formControlName","description"],[1,"mb-4","flex","justify-center"],["appearance","fill","formControlName","filterByDevice",1,"w-60"],[4,"ngIf","ngIfElse"],["formControlName","devices","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","deviceProfiles","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formGroupName","triggerConfig",1,"fields-group","tb-margin"],["required","","ignoreAuthorityFilter","","formControlName","entityTypes",3,"allowedEntityTypes"],[1,"flex","flex-col","gap-2"],["translate","",1,"flex-1"],["formControlName","created"],["formControlName","updated"],["formControlName","deleted"],[1,"fields-group","tb-margin"],[1,"flex","flex-col"],["formControlName","onlyUserComments",2,"margin-bottom","12px"],["formControlName","notifyOnCommentUpdate",2,"margin-bottom","12px"],["formControlName","ruleChains","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","ruleChainEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleChainLifecycleFailures"],["formControlName","trackRuleNodeEvents"],["formControlName","ruleNodeEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleNodeLifecycleFailures"],["formControlName","edges","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","notifyOn","multiple","",3,"placeholder"],["formControlName","edges",3,"labelText","hint","entityType"],["formControlName","entityTypes","ignoreAuthorityFilter","",3,"allowedEntityTypes"],[1,"limit-slider-container","flex","flex-row","items-center","justify-start","xs:flex-col","xs:items-stretch"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["min","0","max","1","step","0.01","discrete","",1,"flex-1",3,"displayWith"],["matSliderThumb","","formControlName","threshold"],[1,"limit-slider-value"],["matInput","","formControlName","threshold","type","number","step","0.01","min","0","max","1",3,"value"],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["formControlName","apiFeatures","multiple",""],["formControlName","apis",3,"label","hint","predefinedValues"],["mat-stroked-button","",3,"click"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",5)(1,"h2"),p(2),c(3,"translate"),r(),g(4,"span",6)(5,"div",7),s(6,"button",8),C("click",function(){return I(d),w(t.cancel())}),s(7,"mat-icon",9),p(8,"close"),r()()(),v(9,qI,1,0,"mat-progress-bar",10),c(10,"async"),v(11,WI,1,0,"div",11),c(12,"async"),s(13,"div",12)(14,"mat-horizontal-stepper",13,0),c(16,"async"),C("selectionChange",function(_){return I(d),w(t.changeStep(_))}),v(17,HI,2,0,"ng-template",14),s(18,"mat-step",15),v(19,zI,2,3,"ng-template",16),s(20,"form",17)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.rule-name"),r(),g(24,"input",20),v(25,$I,3,3,"mat-error",21),r(),s(26,"mat-slide-toggle",22),p(27),c(28,"translate"),r(),s(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.trigger.trigger"),r(),s(32,"mat-select",23),v(33,JI,3,4,"mat-option",24),r(),v(34,QI,3,3,"mat-error",21),r(),g(35,"tb-template-autocomplete",25),v(36,YI,10,14,"section",26)(37,XI,7,1,"ng-template",null,1,Et),r(),v(39,ew,11,5,"ng-template",null,2,Et),r(),v(41,aw,28,15,"mat-step",27)(42,dw,27,15,"mat-step",27)(43,uw,25,13,"mat-step",27)(44,bw,35,23,"mat-step",27)(45,Tw,34,19,"mat-step",27)(46,Mw,33,24,"mat-step",27)(47,Pw,23,17,"mat-step",27)(48,Nw,16,10,"mat-step",27)(49,Ow,21,6,"mat-step",27)(50,Lw,24,9,"mat-step",27)(51,Uw,8,2,"mat-step",27)(52,Ww,13,10,"mat-step",27)(53,zw,8,2,"mat-step",27),r()(),g(54,"mat-divider"),s(55,"div",28),v(56,$w,3,3,"button",29),g(57,"span",6),s(58,"button",30),C("click",function(){return I(d),w(t.nextStep())}),p(59),c(60,"translate"),r()()}if(o&2){let d=q(38);a(2),B(u(3,29,t.dialogTitle)),a(7),m("ngIf",u(10,31,t.isLoading$)),a(2),m("ngIf",u(12,33,t.isLoading$)===!1),a(3),m("linear",!0)("orientation",u(16,35,t.stepperOrientation)),a(4),m("stepControl",t.ruleNotificationForm),a(2),m("formGroup",t.ruleNotificationForm),a(5),m("ngIf",t.ruleNotificationForm.get("name").hasError("required")),a(2),b(" ",u(28,37,"notification.rule-enable")," "),a(6),m("ngForOf",t.triggerTypes),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").hasError("required")),a(),m("notificationTypes",t.ruleNotificationForm.get("triggerType").value),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value!==t.triggerType.ALARM)("ngIfElse",d),a(5),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.DEVICE_ACTIVITY),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITY_ACTION),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_COMMENT),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_ASSIGNMENT),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_CONNECTION),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_COMMUNICATION_FAILURE),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITIES_LIMIT),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.API_USAGE_LIMIT),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.NEW_PLATFORM_VERSION),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RATE_LIMITS),a(),m("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.TASK_PROCESSING_FAILURE),a(3),m("ngIf",t.selectedIndex>0),a(3),B(u(60,39,t.nextStepLabel()))}},dependencies:[xe,U,Qn,$t,io,y0,mn,te,Ie,re,Ue,be,de,Se,Kt,Fe,Xt,at,Nt,dt,vt,gt,sn,ht,hu,bu,wn,En,Mn,In,ue,he,Gi,W,X,fe,Ui,an,ne,le,bt,J,q0,Di,Fi,Oo,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:900px;height:100%;max-width:100%;max-height:100vh;display:flex;flex-direction:column}[_nghost-%COMP%]   .tb-hint[_ngcontent-%COMP%]{margin-top:-1.25em;padding:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group.tb-margin[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-margin-before-field[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-hierarchy[_ngcontent-%COMP%]{padding:0 0 8px 16px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000c2}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .clear-button-space[_ngcontent-%COMP%]{margin-right:48px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   .limit-slider-value[_ngcontent-%COMP%]{margin-left:16px;min-width:25px;max-width:100px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{text-align:center}@media screen and (min-width: 960px){[_nghost-%COMP%]   .history-time-input[_ngcontent-%COMP%]{min-width:364px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:16px;width:min-content;max-width:40%}}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}']});let i=n;return i})();var Zd=(()=>{let n=class n{constructor(e,o,t,d,f){this.notificationService=e,this.translate=o,this.dialog=t,this.datePipe=d,this.customTranslate=f,this.config=new Le,this.config.entityType=O.NOTIFICATION_RULE,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.NOTIFICATION_RULE),this.config.entityResources={},this.config.addEntity=()=>this.notificationRuleDialog(null,!0),this.config.entitiesFetchFunction=_=>this.notificationService.getNotificationRules(_),this.config.deleteEntityTitle=_=>this.translate.instant("notification.delete-rule-title",{ruleName:_.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-rule-text"),this.config.deleteEntitiesTitle=_=>this.translate.instant("notification.delete-rules-title",{count:_}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-rules-text"),this.config.deleteEntity=_=>this.notificationService.deleteNotificationRule(_.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.handleRowClick=(_,D)=>(this.editRule(_,D),!0),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("name","notification.rule-name","30%"),new K("templateName","notification.template","20%"),new K("triggerType","notification.trigger.trigger","20%",_=>this.translate.instant(ys.get(_.triggerType))||"",()=>({}),!0),new K("additionalConfig.description","notification.description","30%",_=>this.customTranslate.transform(_.additionalConfig?.description||""),()=>({}),!1))}resolve(e){return this.config}configureCellActions(){return[{name:"",nameFunction:e=>this.translate.instant(e.enabled?"notification.rule-disable":"notification.rule-enable"),icon:"mdi:toggle-switch",isEnabled:()=>!0,iconFunction:e=>e.enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",onAction:(e,o)=>this.toggleEnableMode(e,o)},{name:this.translate.instant("notification.copy-rule"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,o)=>this.editRule(e,o,!0)}]}editRule(e,o,t=!1){e?.stopPropagation(),this.notificationRuleDialog(o,!1,t).subscribe(d=>d?this.config.updateData():null)}notificationRuleDialog(e,o=!1,t=!1){return this.dialog.open(xp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:o,isCopy:t,rule:e}}).afterClosed()}toggleEnableMode(e,o){e&&e.stopPropagation();let t=Ji(Ce({},o),{enabled:!o.enabled});this.notificationService.saveNotificationRule(t,{ignoreLoading:!0}).subscribe(d=>{o.enabled=d.enabled,this.config.getTable().detectChanges()})}};n.\u0275fac=function(o){return new(o||n)(P(vi),P(ee),P(je),P(Oe),P(di))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Jw=[{path:"notification",component:pn,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],breadcrumb:{menuId:ve.notifications_center},routerTabsHeaderComponent:Rf},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],redirectTo:"/notification/inbox"}},{path:"inbox",component:Ve,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],title:"notification.inbox",breadcrumb:{menuId:ve.notification_inbox}},resolve:{entitiesTableConfig:Qd}},{path:"sent",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.sent",breadcrumb:{menuId:ve.notification_sent}},resolve:{entitiesTableConfig:Yd}},{path:"templates",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.templates",breadcrumb:{menuId:ve.notification_templates}},resolve:{entitiesTableConfig:Xd}},{path:"recipients",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.recipients",breadcrumb:{menuId:ve.notification_recipients}},resolve:{entitiesTableConfig:Kd}},{path:"rules",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.rules",breadcrumb:{menuId:ve.notification_rules}},resolve:{entitiesTableConfig:Zd}}]}],Ep=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Qd,Yd,Kd,Xd,Zd],imports:[V.forChild(Jw),V]});let i=n;return i})();(function(){Q(Ep,{imports:[V],exports:[V]})})();S();S();function Qw(i,n){if(i&1){let l=L();s(0,"div",6)(1,"div",7)(2,"mat-checkbox",8),C("click",function(){let o=I(l).$implicit,t=y();return w(t.toggleDeliviryMethod(o))}),r()()()}if(i&2){let l=n.$implicit,e=y();a(2),m("checked",e.getChecked(l))}}var Ip=(()=>{let n=class n{constructor(e){this.fb=e,this.deliveryMethods=[],this.notificationTemplateTypeTranslateMap=Ta,this.propagateChange=null,this.valueChange$=null}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){let e={};this.deliveryMethods.forEach(o=>{e[o]=!0}),this.notificationSettingsFormGroup=this.fb.group({name:[""],enabled:[!0],enabledDeliveryMethods:this.fb.group(Ce({},e))}),this.valueChange$=this.notificationSettingsFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.valueChange$&&(this.valueChange$.unsubscribe(),this.valueChange$=null)}setDisabledState(e){this.disabled=e,this.disabled?this.notificationSettingsFormGroup.disable({emitEvent:!1}):this.notificationSettingsFormGroup.enable({emitEvent:!1})}getChecked(e){if(e)return this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value;{let o=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),t=o.some(d=>d===!0);return t!==this.notificationSettingsFormGroup.get("enabled").value&&setTimeout(()=>this.notificationSettingsFormGroup.get("enabled").patchValue(t),0),o.every(d=>d)}}toggleDeliviryMethod(e){this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).patchValue(!this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value)}changeInstanceTypeCheckBox(e){let o=Tt(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value);Object.keys(o).forEach(t=>{o[t]=e}),this.notificationSettingsFormGroup.get("enabled").patchValue(e,{emitEvent:!1}),this.notificationSettingsFormGroup.get("enabledDeliveryMethods").patchValue(o),this.notificationSettingsFormGroup.markAsDirty()}getIndeterminate(){if(!this.notificationSettingsFormGroup.get("enabled").value)return!1;let e=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),o=e.filter(t=>t);return o.length!==0&&o.length!==e.length}writeValue(e){Be(e)&&this.notificationSettingsFormGroup.patchValue(e,{emitEvent:!1})}updateModel(){this.propagateChange(this.notificationSettingsFormGroup.value)}};n.\u0275fac=function(o){return new(o||n)(h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-notification-setting-form"]],inputs:{disabled:"disabled",deliveryMethods:"deliveryMethods"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0}])],decls:8,vars:9,consts:[[1,"flex","flex-col",3,"formGroup"],[1,"flex","flex-row",2,"height","48px"],[1,"flex","max-w-50%","flex-full","items-center","justify-start"],["color","primary",3,"click","change","checked","indeterminate"],[1,"notification-type"],["class","flex flex-1 flex-row",4,"ngFor","ngForOf"],[1,"flex","flex-1","flex-row"],[1,"flex","flex-1","items-center","justify-start"],["color","primary",3,"click","checked"]],template:function(o,t){if(o&1&&(s(0,"form",0)(1,"div",1)(2,"div",2)(3,"mat-checkbox",3),C("click",function(f){return f.stopPropagation()})("change",function(f){return t.changeInstanceTypeCheckBox(f.checked)}),s(4,"span",4),p(5),c(6,"translate"),r()()(),v(7,Qw,3,1,"div",5),r()()),o&2){let d;m("formGroup",t.notificationSettingsFormGroup),a(3),m("checked",t.getChecked())("indeterminate",t.getIndeterminate()),a(),j("notification-type-disabled",!t.notificationSettingsFormGroup.get("enabled").value),a(),b(" ",u(6,7,(d=t.notificationTemplateTypeTranslateMap.get(t.notificationSettingsFormGroup.get("name").value))==null?null:d.name)," "),a(2),m("ngForOf",t.deliveryMethods)}},dependencies:[xe,zt,ue,X,ne,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .notification-type[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .notification-type-disabled[_ngcontent-%COMP%]{color:#00000061}']});let i=n;return i})();function Kw(i,n){i&1&&g(0,"mat-progress-bar",20)}function Xw(i,n){i&1&&g(0,"div",21)}function Zw(i,n){if(i&1){let l=L();s(0,"div",22)(1,"div",23)(2,"mat-checkbox",24),C("change",function(o){let t=I(l).$implicit,d=y();return w(d.changeInstanceTypeCheckBox(o.checked,t))})("click",function(o){return I(l),w(o.stopPropagation())}),s(3,"mat-label"),p(4),c(5,"translate"),r()()()()}if(i&2){let l=n.$implicit,e=y();a(2),m("checked",e.getChecked(l))("indeterminate",e.getIndeterminate(l)),a(2),B(u(5,3,e.notificationDeliveryMethodInfoMap.get(l).name))}}function eM(i,n){i&1&&g(0,"mat-divider")}function tM(i,n){if(i&1&&(s(0,"div"),g(1,"tb-notification-setting-form",25),v(2,eM,1,0,"mat-divider",26),r()),i&2){let l=n.$implicit,e=n.last,o=y();a(),m("formControl",l)("deliveryMethods",o.notificationDeliveryMethods),a(),m("ngIf",!e)}}var wp=(()=>{let n=class n extends It{constructor(e,o,t,d,f,_){super(e),this.store=e,this.route=o,this.translate=t,this.dialogService=d,this.notificationService=f,this.fb=_,this.notificationDeliveryMethodInfoMap=Ca,this.deliveryMethods=new Set([vd.SLACK,vd.MICROSOFT_TEAMS]),this.getChecked=(D=null)=>{let M=this.notificationSettings.get("prefs").value;return Be(D)?Be(M)&&M.every(Y=>Y.enabledDeliveryMethods[D]):Be(M)&&M.every(Y=>Y.enabled)},this.getSomeChecked=()=>{let D=this.notificationSettings.get("prefs").value;return Be(D)&&D.some(M=>M.enabled)},this.getIndeterminate=(D=null)=>{let M=this.notificationSettings.get("prefs").value;if(Be(M)){let Y=Be(D)?M.filter(ke=>ke.enabledDeliveryMethods[D]):M.filter(ke=>ke.enabled);return Y.length!==0&&Y.length!==M.length}return!1},this.changeInstanceTypeCheckBox=(D,M=null)=>{let Y=Tt(this.notificationSettings.get("prefs").value);Be(M)?Y.forEach(ke=>ke.enabledDeliveryMethods[M]=D):Y.forEach(ke=>{ke.enabled=D,ke.enabledDeliveryMethods=Object.keys(ke.enabledDeliveryMethods).reduce((Ke,xt)=>Ji(Ce({},Ke),{[xt]:D}),{})}),this.notificationSettings.get("prefs").patchValue(Y,{emitEvent:!1}),this.notificationSettings.markAsDirty()},this.notificationService.getAvailableDeliveryMethods({ignoreLoading:!0}).subscribe(D=>{this.notificationDeliveryMethods=D.filter(M=>!this.deliveryMethods.has(M)),this.patchNotificationSettings(this.route.snapshot.data.userSettings)})}ngOnInit(){this.buildNotificationSettingsForm()}buildNotificationSettingsForm(){this.notificationSettings=this.fb.group({prefs:this.fb.array([])})}patchNotificationSettings(e){let o=[];e.prefs&&this.prepareNotificationSettings(e.prefs).forEach(t=>o.push(this.fb.control(t,[T.required]))),this.notificationSettings.setControl("prefs",this.fb.array(o),{emitEvent:!1})}prepareNotificationSettings(e){return Object.entries(e).map(o=>{if(o[1].name=o[0],!o[1].enabled&&Object.values(o[1].enabledDeliveryMethods).some(t=>t===!0)){let t=Tt(o[1].enabledDeliveryMethods);Object.keys(t).forEach(d=>{t[d]=!1}),o[1].enabledDeliveryMethods=t}return o[1].enabledDeliveryMethods=Object.assign(this.notificationDeliveryMethods.reduce((t,d)=>Ji(Ce({},t),{[d]:!0}),{}),o[1].enabledDeliveryMethods),o[1]})}resetSettings(){this.dialogService.confirm(this.translate.instant("notification.settings.reset-all-title"),this.translate.instant("notification.settings.reset-all-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(e=>{if(e){let o=this.prepareNotificationSettings(this.route.snapshot.data.userSettings.prefs),t=[];this.notificationSettings.reset({}),o&&o.forEach(d=>{d.enabled=!0,d.enabledDeliveryMethods=this.notificationDeliveryMethods.reduce((f,_)=>Ji(Ce({},f),{[_]:!0}),{}),t.push(this.fb.control(d,[T.required]))}),this.notificationSettings.setControl("prefs",this.fb.array(t),{emitEvent:!1}),this.save()}})}get notificationSettingsFormArray(){return this.notificationSettings.get("prefs")}save(){let e={prefs:{}};this.notificationSettings.getRawValue().prefs.forEach(o=>{let t=o.name;delete o.name,e.prefs[t]=o}),this.notificationService.saveNotificationUserSettings(e).subscribe(o=>{this.notificationSettings.get("prefs").reset({}),this.patchNotificationSettings(o)})}confirmForm(){return this.notificationSettings}};n.\u0275fac=function(o){return new(o||n)(h(A),h(Ri),h(ee),h(Wt),h(vi),h(ce))},n.\u0275cmp=F({type:n,selectors:[["tb-notification-settings"]],features:[G],decls:33,vars:23,consts:[["appearance","outlined",1,"settings-card","tb-absolute-fill"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"flex","flex-col"],["mat-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px","overflow","hidden"],[1,"notification-form",3,"formGroup"],[1,"notification-section"],[1,"notification-section-block"],[1,"flex","flex-row","items-center","justify-start",2,"height","44px"],[1,"max-w-50%","flex-full"],["color","warn",3,"click","change","indeterminate","checked"],["translate",""],["class","flex-1",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","items-start","justify-end",2,"padding","16px"],["mat-button","","mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"flex-1"],[1,"flex","flex-1","items-center","justify-start"],["color","warn",3,"change","click","checked","indeterminate"],[3,"formControl","deliveryMethods"],[4,"ngIf"]],template:function(o,t){o&1&&(s(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"notification.settings.notification-settings"),r()(),s(7,"div",4)(8,"button",5),c(9,"async"),C("click",function(){return t.resetSettings()}),p(10),c(11,"translate"),r()()()(),v(12,Kw,1,0,"mat-progress-bar",6),c(13,"async"),v(14,Xw,1,0,"div",7),c(15,"async"),s(16,"mat-card-content",8)(17,"form",9)(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"mat-checkbox",14),C("click",function(f){return f.stopPropagation()})("change",function(f){return t.changeInstanceTypeCheckBox(f.checked)}),s(23,"mat-label",15),p(24,"notification.settings.type"),r()()(),v(25,Zw,6,5,"div",16),r(),g(26,"mat-divider"),v(27,tM,3,3,"div",17),r()()()(),s(28,"div",18)(29,"button",19),c(30,"async"),C("click",function(){return t.save()}),p(31),c(32,"translate"),r()()()()),o&2&&(a(8),m("disabled",u(9,11,t.isLoading$)),a(2),B(u(11,13,"notification.settings.reset-all")),a(2),m("ngIf",u(13,15,t.isLoading$)),a(2),m("ngIf",!u(15,17,t.isLoading$)),a(3),m("formGroup",t.notificationSettings),a(5),m("indeterminate",t.getIndeterminate())("checked",t.getChecked()),a(3),m("ngForOf",t.notificationDeliveryMethods),a(2),m("ngForOf",t.notificationSettingsFormArray.controls),a(2),m("disabled",u(30,19,t.isLoading$)||t.notificationSettings.invalid||!t.notificationSettings.dirty),a(2),b(" ",u(32,21,"action.save")," "))},dependencies:[xe,U,te,zt,Zt,ni,ui,Ue,Se,sn,ue,W,X,ii,ne,J,Ip,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-form[_ngcontent-%COMP%]{height:100%;min-height:min-content;max-height:min-content}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section[_ngcontent-%COMP%]{height:100%;border:1px solid rgba(0,0,0,.12);overflow:scroll}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section-block[_ngcontent-%COMP%]{min-width:470px}']});let i=n;return i})();var Mp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,Ep,ye]});let i=n;return i})();(function(){Q(Mp,{declarations:[_p,Cp,Sp,Ds,lo,_s,Tp,Oo,xp,wp,Ip,U0,G0],imports:[oe,ae,Ep,ye]})})();S();S();S();var Ng=[{path:"notificationSettings",component:wp,canDeactivate:[Ee],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"account.notification-settings",breadcrumb:{label:"account.notification-settings",icon:"settings"}},resolve:{userSettings:()=>Ut(vi).getNotificationUserSettings()}}];var iM=[{path:"account",component:pn,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],showMainLoadingBar:!1,breadcrumb:{label:"account.account",icon:"account_circle"},useChildrenRoutesForTabs:!0},resolve:{replaceUrl:()=>ji(Ut(A)).forceFullscreen},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/account/profile"}},...fg,...yg,...Ng]}],Dp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(iM),V]});let i=n;return i})();(function(){Q(Dp,{imports:[V],exports:[V]})})();var Fp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,Dp]});let i=n;return i})();(function(){Q(Fp,{imports:[oe,Dp]})})();S();S();var Pp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,Ma]});let i=n;return i})();(function(){Q(Pp,{declarations:[ur,Ra,vl,bl,Mo,cr,yl],imports:[oe,ae,Ma],exports:[ur]})})();dc(Mo,[xe,U,h0,te,Ie,re,Mt,_a,ya,va,W,ii,J,cr],[R]);var Ap=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Pp,cl,Ma]});let i=n;return i})();(function(){Q(Ap,{declarations:[hl,_l],imports:[oe,ae,ye,Pp,cl,Ma]})})();S();var Np=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,gp]});let i=n;return i})();(function(){Q(Np,{imports:[oe,ae,ye,gp]})})();S();S();S();S();S();S();function nM(i,n){if(i&1){let l=L();s(0,"button",6),C("click",function(){I(l);let o=y();return w(o.apply())}),p(1),c(2,"translate"),r()}if(i&2){let l=y();m("disabled",l.editorControl.invalid||!l.editorControl.dirty),a(),b(" ",u(2,2,"action.apply")," ")}}var hr=(()=>{let n=class n{constructor(e){this.fb=e,this.editorContentApplied=new wt,this.tinyMceOptions={base_url:"/assets/tinymce",suffix:".min",plugins:["lists"],menubar:"edit insert view format",toolbar:["fontfamily fontsize | bold italic underline strikethrough forecolor backcolor","alignleft aligncenter alignright alignjustify | bullist"],toolbar_mode:"sliding",height:400,autofocus:!1,branding:!1,promotion:!1,resize:!1,setup:o=>{o.on("PostRender",function(){let t=o.getContainer().closest(".tb-popover-content"),d=document.querySelector(".tox.tox-tinymce-aux");t.parentNode.appendChild(d)})},relative_urls:!1,urlconverter_callback:o=>o}}ngOnInit(){this.editorControl=this.fb.control(this.content),this.disabled&&(this.editorControl.disable({emitEvent:!1}),this.tinyMceOptions.toolbar=!1,this.tinyMceOptions.menubar=!1,this.tinyMceOptions.statusbar=!1)}cancel(){this.popover?.hide()}apply(){this.editorControl.valid&&this.editorContentApplied.emit(this.editorControl.value)}};n.\u0275fac=function(o){return new(o||n)(h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-release-notes-panel"]],inputs:{disabled:"disabled",content:"content",title:"title",popover:"popover"},outputs:{editorContentApplied:"editorContentApplied"},decls:10,vars:9,consts:[[1,"tb-editor-panel"],[1,"tb-editor-title"],[1,"tb-editor",3,"init","formControl"],[1,"tb-editor-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1),p(2),c(3,"translate"),r(),g(4,"editor",2),s(5,"div",3)(6,"button",4),C("click",function(){return t.cancel()}),p(7),c(8,"translate"),r(),v(9,nM,3,4,"button",5),r()()),o&2&&(a(2),B(u(3,5,t.title)),a(2),m("init",t.tinyMceOptions)("formControl",t.editorControl),a(3),b(" ",u(8,7,"action.cancel")," "),a(2),m("ngIf",!t.disabled))},dependencies:[U,te,W,ii,_u,R],styles:[`@charset "UTF-8";.tb-editor-panel{width:600px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-editor-panel{width:90vw}}.tb-editor-panel .tb-editor-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-editor-panel .tb-editor{height:400px;overflow-y:auto}.tb-editor-panel .tb-editor-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2});let i=n;return i})();function oM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.mobile-package-required")," "))}function aM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.mobile-package-max-length")," "))}function rM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.mobile-package-pattern")," "))}function sM(i,n){if(i&1&&(s(0,"mat-option",28),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.platformTypeTranslations.get(l))," ")}}function lM(i,n){if(i&1){let l=L();s(0,"button",29),c(1,"translate"),C("click",function(o){I(l);let t=y();return w(t.generateAppSecret(o))}),s(2,"tb-icon"),p(3,"cached"),r()()}i&2&&x("matTooltip",u(1,1,"mobile.generate-application-secret"))}function mM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.application-secret-required")," "))}function pM(i,n){if(i&1&&(s(0,"mat-option",28),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.mobileAppStatusTranslations.get(l))," ")}}function dM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.invalid-version-pattern")," "))}function cM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.invalid-version-pattern")," "))}function uM(i,n){if(i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2){let l=y();a(),b(" ",u(2,1,l.entityForm.get("platformType").value===l.PlatformType.ANDROID?"mobile.google-play-link-required":"mobile.app-store-link-required")," ")}}function fM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.invalid-store-link")," "))}function gM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.sha256-certificate-fingerprints-required")," "))}function hM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.sha256-certificate-fingerprints-pattern")," "))}function bM(i,n){if(i&1&&(s(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.sha256-certificate-fingerprints"),r(),g(3,"input",30)(4,"tb-copy-button",6),c(5,"translate"),v(6,gM,3,3,"mat-error",7)(7,hM,3,3,"mat-error",7),r()),i&2){let l=y();a(3),m("required",l.entityForm.get("status").value===l.MobileAppStatus.PUBLISHED),a(),x("tooltipText",u(5,5,"mobile.copy-sha256-certificate-fingerprints")),m("copyText",l.entityForm.get("storeInfo.sha256CertFingerprints").value),a(2),m("ngIf",l.entityForm.get("storeInfo.sha256CertFingerprints").hasError("required")),a(),m("ngIf",l.entityForm.get("storeInfo.sha256CertFingerprints").hasError("pattern"))}}function vM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.app-id-required")," "))}function yM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.app-id-pattern")," "))}function _M(i,n){if(i&1&&(s(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.app-id"),r(),g(3,"input",31)(4,"tb-copy-button",6),c(5,"translate"),v(6,vM,3,3,"mat-error",7)(7,yM,3,3,"mat-error",7),r()),i&2){let l=y();a(3),m("required",l.entityForm.get("status").value===l.MobileAppStatus.PUBLISHED),a(),x("tooltipText",u(5,5,"mobile.copy-app-id")),m("copyText",l.entityForm.get("storeInfo.appId").value),a(2),m("ngIf",l.entityForm.get("storeInfo.appId").hasError("required")),a(),m("ngIf",l.entityForm.get("storeInfo.appId").hasError("pattern"))}}var Wa=(()=>{let n=class n extends kt{constructor(e,o,t,d,f,_,D,M,Y){super(e,_,t,d,f),this.store=e,this.translate=o,this.entityValue=t,this.entitiesTableConfigValue=d,this.cd=f,this.fb=_,this.popoverService=D,this.renderer=M,this.viewContainerRef=Y,this.entityType=O,this.platformTypes=[Vi.ANDROID,Vi.IOS],this.MobileAppStatus=ki,this.PlatformType=Vi,this.mobileAppStatuses=Object.keys(ki),this.platformTypeTranslations=Kn,this.mobileAppStatusTranslations=xs}buildForm(e){let o=this.fb.group({pkgName:[e?.pkgName?e.pkgName:"",[T.required,T.maxLength(255),T.pattern(/^[a-zA-Z][a-zA-Z\d_]*(?:\.[a-zA-Z][a-zA-Z\d_]*)+$/)]],platformType:[e?.platformType?e.platformType:Vi.ANDROID],appSecret:[e?.appSecret?e.appSecret:btoa(Qa(64)),[T.required,this.base64Format]],status:[e?.status?e.status:ki.DRAFT],versionInfo:this.fb.group({minVersion:[e?.versionInfo?.minVersion?e.versionInfo.minVersion:"",T.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],minVersionReleaseNotes:[e?.versionInfo?.minVersionReleaseNotes?e.versionInfo.minVersionReleaseNotes:""],latestVersion:[e?.versionInfo?.latestVersion?e.versionInfo.latestVersion:"",T.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],latestVersionReleaseNotes:[e?.versionInfo?.latestVersionReleaseNotes?e.versionInfo.latestVersionReleaseNotes:""]}),storeInfo:this.fb.group({storeLink:[e?.storeInfo?.storeLink?e.storeInfo.storeLink:"",T.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+(?:&[a-zA-Z0-9._-]+=[a-zA-Z0-9._%-]*)*$/)],sha256CertFingerprints:[e?.storeInfo?.sha256CertFingerprints?e.storeInfo.sha256CertFingerprints:"",T.pattern(/^[A-Fa-f0-9]{2}(:[A-Fa-f0-9]{2}){31}$/)],appId:[e?.storeInfo?.appId?e.storeInfo.appId:"",T.pattern(/^[A-Z0-9]{10}\.[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)*$/)]})});return o.get("platformType").valueChanges.pipe(Ne()).subscribe(t=>{t===Vi.ANDROID?(o.get("storeInfo.sha256CertFingerprints").enable({emitEvent:!1}),o.get("storeInfo.appId").disable({emitEvent:!1}),o.get("storeInfo.storeLink").setValidators(T.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+(?:&[a-zA-Z0-9._-]+=[a-zA-Z0-9._%-]*)*$/))):t===Vi.IOS&&(o.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1}),o.get("storeInfo.appId").enable({emitEvent:!1}),o.get("storeInfo.storeLink").setValidators(T.pattern(/^https?:\/\/apps\.apple\.com\/[a-z]{2}\/app\/[\w-]+\/id\d{7,10}(?:\?[^\s]*)?$/))),o.get("storeInfo.storeLink").setValue("",{emitEvent:!1})}),o.get("status").valueChanges.pipe(Ne()).subscribe(t=>{t===ki.PUBLISHED?(o.get("storeInfo.storeLink").addValidators(T.required),o.get("storeInfo.sha256CertFingerprints").addValidators(T.required),o.get("storeInfo.appId").addValidators(T.required)):(o.get("storeInfo.storeLink").clearValidators(),o.get("storeInfo.sha256CertFingerprints").removeValidators(T.required),o.get("storeInfo.appId").removeValidators(T.required)),o.get("storeInfo.storeLink").updateValueAndValidity({emitEvent:!1}),o.get("storeInfo.sha256CertFingerprints").updateValueAndValidity({emitEvent:!1}),o.get("storeInfo.appId").updateValueAndValidity({emitEvent:!1})}),o}updateForm(e){this.entityForm.patchValue(e,{emitEvent:!1})}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("status").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("platformType").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("platformType").disable({emitEvent:!1}),this.entityForm.get("platformType").value===Vi.ANDROID?this.entityForm.get("storeInfo.appId").disable({emitEvent:!1}):this.entityForm.get("platformType").value===Vi.IOS&&this.entityForm.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1})),this.entityForm&&this.isAdd&&this.entityForm.get("storeInfo.appId").disable({emitEvent:!1})}prepareFormValue(e){return e.storeInfo=this.entityForm.get("storeInfo").value,super.prepareFormValue(e)}generateAppSecret(e){e.stopPropagation(),this.entityForm.get("appSecret").setValue(btoa(Qa(64))),this.entityForm.get("appSecret").markAsDirty()}editReleaseNote(e,o,t){e&&e.stopPropagation();let d=o._elementRef.nativeElement;if(this.popoverService.hasPopover(d))this.popoverService.hidePopover(d);else{let f={disabled:!(this.isAdd||this.isEdit),title:t?"mobile.latest-version-release-notes":"mobile.min-version-release-notes",content:t?this.entityForm.get("versionInfo.latestVersionReleaseNotes").value:this.entityForm.get("versionInfo.minVersionReleaseNotes").value},_=this.popoverService.displayPopover(d,this.renderer,this.viewContainerRef,hr,["leftOnly","leftBottomOnly","leftTopOnly"],!0,null,f,{},{},{},!1,()=>{},{padding:"16px 24px"});_.tbComponentRef.instance.popover=_,_.tbComponentRef.instance.editorContentApplied.subscribe(D=>{_.hide(),t?(this.entityForm.get("versionInfo.latestVersionReleaseNotes").setValue(D),this.entityForm.get("versionInfo.latestVersionReleaseNotes").markAsDirty()):(this.entityForm.get("versionInfo.minVersionReleaseNotes").setValue(D),this.entityForm.get("versionInfo.minVersionReleaseNotes").markAsDirty())})}}base64Format(e){if(e.value==="")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}};n.\u0275fac=function(o){return new(o||n)(h(A),h(ee),h("entity",8),h("entitiesTableConfig",8),h(Je),h(ct),h(Dn),h(bn),h(Zi))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-app"]],features:[G],decls:75,vars:39,consts:[["editMinReleaseNotesVersionButton",""],["editLatestReleaseNotesVersionButton",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","pkgName"],["matSuffix","","miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[4,"ngIf"],["appearance","outline",1,"flex"],["formControlName","platformType"],[3,"value",4,"ngFor","ngForOf"],["matInput","","required","","formControlName","appSecret",3,"placeholder"],["matSuffix","",2,"display","flex","align-items","center"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],["appearance","outline"],["formControlName","status"],["formGroupName","versionInfo",1,"tb-form-panel","stroked","no-padding-bottom",2,"margin-bottom","21px"],["translate","",1,"tb-form-panel-title"],[1,"flex","flex-col"],[1,"flex","flex-row"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","formControlName","minVersion"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"margin-top","4px","color","#00000061",3,"click","matTooltip"],["matInput","","formControlName","latestVersion"],["formGroupName","storeInfo",1,"tb-form-panel","stroked","no-padding-bottom"],["matInput","","formControlName","storeLink",3,"required"],["appearance","outline",4,"ngIf"],[3,"value"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"click","matTooltip"],["matInput","","formControlName","sha256CertFingerprints",3,"required"],["matInput","","formControlName","appId",3,"required"]],template:function(o,t){if(o&1){let d=L();s(0,"section",2)(1,"mat-form-field",3)(2,"mat-label",4),p(3,"mobile.mobile-package"),r(),g(4,"input",5)(5,"tb-copy-button",6),c(6,"translate"),g(7,"mat-hint"),v(8,oM,3,3,"mat-error",7)(9,aM,3,3,"mat-error",7)(10,rM,3,3,"mat-error",7),r(),s(11,"mat-form-field",8)(12,"mat-label",4),p(13,"mobile.platform-type"),r(),s(14,"mat-select",9),v(15,sM,3,4,"mat-option",10),r()(),s(16,"mat-form-field",3)(17,"mat-label",4),p(18,"mobile.application-secret"),r(),g(19,"input",11),c(20,"translate"),s(21,"div",12),v(22,lM,4,3,"button",13),g(23,"tb-copy-button",14),c(24,"translate"),r(),g(25,"mat-hint"),v(26,mM,3,3,"mat-error",7),r(),s(27,"mat-form-field",15)(28,"mat-label",4),p(29,"mobile.status"),r(),s(30,"mat-select",16),v(31,pM,3,4,"mat-option",10),r()(),s(32,"section",17)(33,"div",18),p(34,"mobile.version-information"),r(),s(35,"section",19)(36,"section",20)(37,"mat-form-field",21)(38,"mat-label",4),p(39,"mobile.min-version"),r(),g(40,"input",22)(41,"mat-hint"),v(42,dM,3,3,"mat-error",7),r(),s(43,"button",23,0),c(45,"translate"),C("click",function(_){I(d);let D=q(44);return w(t.editReleaseNote(_,D,!1))}),s(46,"tb-icon"),p(47,"mdi:text-box-edit"),r()()(),s(48,"section",20)(49,"mat-form-field",21)(50,"mat-label",4),p(51,"mobile.latest-version"),r(),g(52,"input",24)(53,"mat-hint"),v(54,cM,3,3,"mat-error",7),r(),s(55,"button",23,1),c(57,"translate"),C("click",function(_){I(d);let D=q(56);return w(t.editReleaseNote(_,D,!0))}),s(58,"tb-icon"),p(59,"mdi:text-box-edit"),r()()()()(),s(60,"section",25)(61,"div",18),p(62,"mobile.store-information"),r(),s(63,"section",19)(64,"mat-form-field",15)(65,"mat-label"),p(66),c(67,"translate"),r(),g(68,"input",26)(69,"tb-copy-button",6),c(70,"translate"),v(71,uM,3,3,"mat-error",7)(72,fM,3,3,"mat-error",7),r(),v(73,bM,8,7,"mat-form-field",27)(74,_M,8,7,"mat-form-field",27),r()()()}o&2&&(m("formGroup",t.entityForm),a(5),x("tooltipText",u(6,25,"mobile.copy-application-package")),m("copyText",t.entityForm.get("pkgName").value),a(3),m("ngIf",t.entityForm.get("pkgName").hasError("required")),a(),m("ngIf",t.entityForm.get("pkgName").hasError("maxlength")),a(),m("ngIf",t.entityForm.get("pkgName").hasError("pattern")),a(5),m("ngForOf",t.platformTypes),a(4),x("placeholder",u(20,27,"mobile.set")),a(3),m("ngIf",t.isEdit),a(),x("tooltipText",u(24,29,"mobile.copy-application-secret")),m("copyText",t.entityForm.get("appSecret").value),a(3),m("ngIf",t.entityForm.get("appSecret").hasError("required")),a(5),m("ngForOf",t.mobileAppStatuses),a(11),m("ngIf",t.entityForm.get("versionInfo.minVersion").hasError("pattern")),a(),x("matTooltip",u(45,31,"mobile.min-version-release-notes")),a(11),m("ngIf",t.entityForm.get("versionInfo.latestVersion").hasError("pattern")),a(),x("matTooltip",u(57,33,"mobile.latest-version-release-notes")),a(11),B(u(67,35,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.google-play-link":"mobile.app-store-link")),a(2),m("required",t.entityForm.get("status").value===t.MobileAppStatus.PUBLISHED),a(),x("tooltipText",u(70,37,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.copy-google-play-link":"mobile.copy-app-store-link")),m("copyText",t.entityForm.get("storeInfo.storeLink").value),a(2),m("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("required")),a(),m("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("pattern")),a(),m("ngIf",t.entityForm.get("platformType").value===t.PlatformType.ANDROID),a(),m("ngIf",t.entityForm.get("platformType").value===t.PlatformType.IOS))},dependencies:[xe,U,Ie,be,de,Se,Kt,Fe,Xt,vt,gt,Mt,he,W,X,fe,ne,le,bt,J,ga,bi,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']});let i=n;return i})();S();var kp=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-app-table-header"]],features:[G],decls:4,vars:0,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileApplication"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1),p(2,"mobile.applications"),r(),g(3,"div",2),r())},dependencies:[$t,tn,J],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%}']});let i=n;return i})();S();function SM(i,n){i&1&&g(0,"mat-progress-bar",13)}function TM(i,n){i&1&&g(0,"div")}var Bp=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D,M){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.data=d,this.translate=f,this.sanitizer=_,this.fb=D,this.mobileAppService=M,this.deleteVerification=this.fb.control(""),this.deleteVerificationText=this.translate.instant("mobile.delete-application-phrase"),this.deleteApplicationText=this.sanitizer.bypassSecurityTrustHtml(this.translate.instant("mobile.delete-application-text",{phrase:this.deleteVerificationText}))}cancel(){this.dialogRef.close(!1)}suspend(){this.mobileAppService.getMobileAppInfoById(this.data.id).pipe(_t(e=>(e.status=ki.SUSPENDED,this.mobileAppService.saveMobileApp(e)))).subscribe(()=>{this.dialogRef.close(!0)})}delete(){this.mobileAppService.deleteMobileApp(this.data.id).subscribe(()=>{this.dialogRef.close(!0)})}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(At),h(ee),h(wr),h(ct),h(Fn))},n.\u0275cmp=F({type:n,selectors:[["tb-remove-app-dialog"]],features:[G],decls:24,vars:23,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"flex","flex-col","gap-4"],[1,"select-none",3,"innerHTML"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"formControl","placeholder"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-button","","mat-raised-button","","color","warn","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"]],template:function(o,t){o&1&&(s(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.delete-application"),r(),s(3,"button",2),C("click",function(){return t.cancel()}),s(4,"mat-icon",3),p(5,"close"),r()()(),v(6,SM,1,0,"mat-progress-bar",4),c(7,"async"),v(8,TM,1,0,"div",5),c(9,"async"),s(10,"div",6),g(11,"div",7),s(12,"mat-form-field",8),g(13,"input",9),c(14,"translate"),r()(),s(15,"div",10)(16,"button",11),c(17,"async"),C("click",function(){return t.suspend()}),p(18),c(19,"translate"),r(),s(20,"button",12),c(21,"async"),C("click",function(){return t.delete()}),p(22),c(23,"translate"),r()()),o&2&&(a(6),m("ngIf",u(7,9,t.isLoading$)),a(2),m("ngIf",!u(9,11,t.isLoading$)),a(3),m("innerHTML",t.deleteApplicationText,zn),a(2),x("placeholder",u(14,13,"mobile.type-here")),m("formControl",t.deleteVerification),a(3),m("disabled",u(17,15,t.isLoading$)),a(2),b(" ",u(19,17,"action.suspend")," "),a(2),m("disabled",u(21,19,t.isLoading$)||t.deleteVerification.invalid||t.deleteVerification.value!==t.deleteVerificationText),a(2),b(" ",u(23,21,"mobile.delete-application-button-text")," "))},dependencies:[U,te,Ie,re,Ue,be,de,at,Nt,dt,he,W,ii,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:750px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']});let i=n;return i})();var Rp=(()=>{let n=class n{constructor(e,o,t,d,f){this.translate=e,this.datePipe=o,this.mobileAppService=t,this.truncatePipe=d,this.dialog=f,this.config=new Le,this.config.selectionEnabled=!1,this.config.entityType=O.MOBILE_APP,this.config.addAsTextButton=!0,this.config.entitiesDeleteEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=Ge.get(O.MOBILE_APP),this.config.entityResources=tt.get(O.MOBILE_APP),this.config.entityComponent=Wa,this.config.headerComponent=kp,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("pkgName","mobile.application-package","20%",_=>_.pkgName??"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-package"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:_=>!!_.pkgName,onAction:(_,D)=>D.pkgName,type:ua.COPY_BUTTON}),new K("appSecret","mobile.application-secret","15%",_=>this.truncatePipe.transform(_.appSecret,!0,10,"\u2026"),()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-secret"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:_=>!!_.appSecret,onAction:(_,D)=>D.appSecret,type:ua.COPY_BUTTON}),new K("platformType","mobile.platform-type","15%",_=>this.translate.instant(Kn.get(_.platformType))),new K("status","mobile.status","15%",_=>`<span style="display: flex;">${this.mobileStatus(_.status)}</span>`,_=>this.mobileStatusStyle(_.status)),new K("minVersion","mobile.min-version","15%",_=>_.versionInfo?.minVersion??"",()=>({}),!1),new K("latestVersion","mobile.latest-version","15%",_=>_.versionInfo?.latestVersion??"",()=>({}),!1)),this.config.entitiesFetchFunction=_=>this.mobileAppService.getTenantMobileAppInfos(_),this.config.loadEntity=_=>this.mobileAppService.getMobileAppInfoById(_.id),this.config.saveEntity=_=>this.mobileAppService.saveMobileApp(_),this.config.deleteEntityTitle=_=>this.translate.instant("mobile.delete-application-title-short",{name:_.name}),this.config.deleteEntityContent=()=>this.translate.instant("mobile.delete-application-text-short"),this.config.deleteEntity=_=>this.mobileAppService.deleteMobileApp(_.id),this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("action.delete"),icon:"delete",isEnabled:()=>!0,onAction:(e,o)=>this.deleteEntity(e,o)}]}deleteEntity(e,o){e&&e.stopPropagation(),o.status===ki.PUBLISHED?this.dialog.open(Bp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{id:o.id.id}}).afterClosed().subscribe(t=>{t&&this.config.updateData()}):this.config.getTable().deleteEntity(e,o)}mobileStatus(e){let o=xs.get(e),t="rgba(25, 128, 56, 0.06)";switch(e){case ki.DEPRECATED:t="rgba(250, 164, 5, 0.06)";break;case ki.SUSPENDED:t="rgba(209, 39, 48, 0.06)";break;case ki.DRAFT:t="rgba(0, 148, 255, 0.06)";break}return`<div style="border-radius: 14px; height: 28px; line-height: 20px; padding: 4px 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(o)}
            </div>`}mobileStatusStyle(e){let o={fontSize:"14px",color:"#198038"};switch(e){case ki.DEPRECATED:o.color="#FAA405";break;case ki.SUSPENDED:o.color="#D12730";break;case ki.DRAFT:o.color="#0094FF";break}return o}};n.\u0275fac=function(o){return new(o||n)(P(ee),P(Oe),P(Fn),P(_0),P(je))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var kg=[{path:"applications",data:{breadcrumb:{menuId:ve.mobile_apps}},children:[{path:"",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Rp}},{path:":entityId",component:st,canDeactivate:[Ee],data:{breadcrumb:{labelFunction:lt,icon:"list"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Rp}}]}],xM=[{path:"security-settings/oauth2/mobile-applications",pathMatch:"full",redirectTo:"/mobile-center/applications"}],Vp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[Rp],imports:[V.forChild(xM),V]});let i=n;return i})();(function(){Q(Vp,{imports:[V],exports:[V]})})();S();S();S();var jp=(()=>{let n=class n extends oi{constructor(e){super(e),this.store=e}};n.\u0275fac=function(o){return new(o||n)(h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-bundle-table-header"]],features:[G],decls:4,vars:0,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileBundle"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1),p(2,"mobile.bundles"),r(),g(3,"div",2),r())},dependencies:[$t,tn,J],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%}']});let i=n;return i})();S();S();var EM=["mobileAppComponent"];function IM(i,n){i&1&&g(0,"mat-progress-bar",13)}function wM(i,n){i&1&&g(0,"div")}var br=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.mobileAppService=d,this.data=f,this.errorStateMatcher=_,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.mobileAppComponent.entityForm.markAsDirty(),this.mobileAppComponent.entityForm.patchValue({platformType:this.data.platformType}),this.mobileAppComponent.entityForm.get("platformType").disable({emitEvent:!1}),this.mobileAppComponent.isEdit=!0},0)}isErrorState(e,o){let t=this.errorStateMatcher.isErrorState(e,o),d=!!(e&&e.invalid&&this.submitted);return t||d}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.mobileAppComponent.entityForm.valid&&this.mobileAppService.saveMobileApp(this.mobileAppComponent.entityFormValue()).subscribe(e=>this.dialogRef.close(e))}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(Fn),h(At),h(en,4))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-app-dialog"]],viewQuery:function(o,t){if(o&1&&we(EM,7),o&2){let d;Me(d=De())&&(t.mobileAppComponent=d.first)}},features:[He([{provide:en,useExisting:n}]),G],decls:26,vars:21,consts:[["mobileAppComponent",""],[2,"width","850px","max-height","100vh","display","grid","grid-template-rows","min-content 4px minmax(auto, 1fr) min-content",3,"ngSubmit"],["color","primary"],[1,"flex-1"],["tb-help","mobileApplication"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"!p-0"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(o,t){if(o&1){let d=L();s(0,"form",1),C("ngSubmit",function(){return I(d),w(t.save())}),s(1,"mat-toolbar",2)(2,"h2"),p(3),c(4,"translate"),r(),g(5,"span",3)(6,"div",4),s(7,"button",5),C("click",function(){return I(d),w(t.cancel())}),s(8,"mat-icon",6),p(9,"close"),r()()(),v(10,IM,1,0,"mat-progress-bar",7),c(11,"async"),v(12,wM,1,0,"div",8),c(13,"async"),s(14,"div",9),g(15,"tb-mobile-app",null,0),r(),s(17,"div",10)(18,"button",11),c(19,"async"),C("click",function(){return I(d),w(t.cancel())}),p(20),c(21,"translate"),r(),s(22,"button",12),c(23,"async"),p(24),c(25,"translate"),r()()()}if(o&2){let d=q(16);a(3),B(u(4,7,"mobile.add-application")),a(7),m("ngIf",u(11,9,t.isLoading$)),a(2),m("ngIf",!u(13,11,t.isLoading$)),a(6),m("disabled",u(19,13,t.isLoading$)),a(2),b(" ",u(21,15,"action.cancel")," "),a(2),m("disabled",u(23,17,t.isLoading$)||(d.entityForm==null?null:d.entityForm.invalid)||!(d.entityForm!=null&&d.entityForm.dirty)),a(2),b(" ",u(25,19,"action.add")," ")}},dependencies:[U,$t,te,Ie,re,Ue,at,Nt,dt,ue,X,xn,Wa,me,R],encapsulation:2});let i=n;return i})();S();S();S();function MM(i,n){i&1&&(s(0,"mat-icon",13),c(1,"translate"),p(2," warning "),r()),i&2&&x("matTooltip",u(1,1,"mobile.page-name-required"))}function DM(i,n){i&1&&(s(0,"mat-icon",13),c(1,"translate"),p(2," warning "),r()),i&2&&x("matTooltip",u(1,1,"mobile.page-name-cannot-contain-only-spaces"))}function FM(i,n){if(i&1&&(s(0,"mat-option",14),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit,e=y();m("value",l),a(),b(" ",u(2,2,e.mobilePageTypeTranslations.get(l))," ")}}function PM(i,n){i&1&&(Lt(0),g(1,"tb-dashboard-autocomplete",15),c(2,"translate"),c(3,"translate"),Gt()),i&2&&(a(),x("label",u(2,3,"dashboard.dashboard")),x("placeholder",u(3,5,"dashboard.select-dashboard")),m("selectFirstDashboard",!1))}function AM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.invalid-url-format")," "))}function NM(i,n){if(i&1&&(Lt(0),s(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.url"),r(),g(4,"input",16)(5,"mat-hint"),v(6,AM,3,3,"mat-error",12),r(),Gt()),i&2){let l=y();a(6),m("ngIf",l.customMobilePageForm.get("url").hasError("pattern"))}}function kM(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.invalid-path-format")," "))}function OM(i,n){if(i&1&&(Lt(0),s(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.path"),r(),g(4,"input",17)(5,"mat-hint"),v(6,kM,3,3,"mat-error",12),r(),Gt()),i&2){let l=y();a(6),m("ngIf",l.customMobilePageForm.get("path").hasError("pattern"))}}var Ha=(()=>{let n=class n{constructor(e,o){this.fb=e,this.store=o,this.mobilePagesTypes=[Oi.DASHBOARD,Oi.WEB_VIEW,Oi.CUSTOM],this.MobilePageType=Oi,this.mobilePageTypeTranslations=Es,this.customMobilePageForm=this.fb.group({visible:[!0],icon:["star"],label:["",[T.required,T.pattern(/\S/)]],type:[Oi.DASHBOARD],dashboardId:this.fb.control(null,T.required),url:[{value:"",disabled:!0},[T.required,T.pattern(hf)]],path:[{value:"",disabled:!0},[T.required,T.pattern(/^(\/[\w\-._~:/?#[\]@!$&'()*+,;=%]*)?$/)]]}),this.propagateChange=t=>{},this.customMobilePageForm.get("type").valueChanges.pipe(Ne()).subscribe(t=>{switch(this.customMobilePageForm.get("dashboardId").disable({emitEvent:!1}),this.customMobilePageForm.get("url").disable({emitEvent:!1}),this.customMobilePageForm.get("path").disable({emitEvent:!1}),t){case Oi.DASHBOARD:this.customMobilePageForm.get("dashboardId").enable({emitEvent:!1});break;case Oi.WEB_VIEW:this.customMobilePageForm.get("url").enable({emitEvent:!1});break;case Oi.CUSTOM:this.customMobilePageForm.get("path").enable({emitEvent:!1});break}}),Pt(this.store).authority===E.SYS_ADMIN&&(this.mobilePagesTypes.shift(),this.customMobilePageForm.get("type").setValue(Oi.WEB_VIEW)),this.customMobilePageForm.valueChanges.pipe(Ne()).subscribe(t=>this.propagateChange(t))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.customMobilePageForm.disable({emitEvent:!1}):(this.customMobilePageForm.enable({emitEvent:!1}),this.customMobilePageForm.get("type").updateValueAndValidity({onlySelf:!0}))}validate(){return this.customMobilePageForm.valid?null:{invalidCustomMobilePageForm:!0}}writeValue(e){this.customMobilePageForm.patchValue(e,{emitEvent:!1})}};n.\u0275fac=function(o){return new(o||n)(h(ct),h(A))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-page-item"]],inputs:{disabled:[2,"disabled","disabled",Go]},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}]),jo],decls:21,vars:10,consts:[[1,"mobile-page-form",3,"formGroup"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","required","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["translate",""],["required","","matInput","","formControlName","label"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],[3,"value"],["formControlName","dashboardId","required","","floatLabel","always","appearance","outline","subscriptSizing","dynamic","requiredText","dashboard.dashboard-required",1,"flex-1",3,"label","placeholder","selectFirstDashboard"],["required","","matInput","","formControlName","url"],["required","","matInput","","formControlName","path"]],template:function(o,t){o&1&&(s(0,"section",0)(1,"div",1)(2,"mat-slide-toggle",2),p(3),c(4,"translate"),r()(),s(5,"div",3),g(6,"tb-material-icon-select",4),s(7,"mat-form-field",5)(8,"mat-label",6),p(9,"mobile.page-name"),r(),g(10,"input",7),v(11,MM,3,3,"mat-icon",8)(12,DM,3,3,"mat-icon",8),r()(),s(13,"mat-form-field",9)(14,"mat-label",6),p(15,"mobile.page-type"),r(),s(16,"mat-select",10),v(17,FM,3,4,"mat-option",11),r()(),v(18,PM,4,7,"ng-container",12)(19,NM,7,1,"ng-container",12)(20,OM,7,1,"ng-container",12),r()),o&2&&(m("formGroup",t.customMobilePageForm),a(3),b(" ",u(4,8,"mobile.visible")," "),a(8),m("ngIf",t.customMobilePageForm.get("label").hasError("required")&&t.customMobilePageForm.get("label").touched),a(),m("ngIf",t.customMobilePageForm.get("label").hasError("pattern")&&t.customMobilePageForm.get("label").touched),a(5),m("ngForOf",t.mobilePagesTypes),a(),m("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.DASHBOARD),a(),m("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.WEB_VIEW),a(),m("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.CUSTOM))},dependencies:[xe,U,ln,re,be,de,Se,Kt,Fe,Xt,vt,gt,Mt,ht,he,W,X,fe,ne,le,ba,J,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']});let i=n;return i})();var Lp=(()=>{let n=class n extends nt{constructor(e,o,t,d){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.fb=d,this.customMobilePage=this.fb.control(null)}cancel(){this.dialogRef.close(null)}save(){if(this.customMobilePage.valid){let e=Bn(this.customMobilePage.value);this.dialogRef.close(e)}}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-add-mobile-page-dialog"]],features:[G],decls:17,vars:13,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[3,"formControl"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.add-specific-page"),r(),s(3,"button",2),C("click",function(){return t.cancel()}),s(4,"mat-icon",3),p(5,"close"),r()()(),s(6,"div",4),g(7,"tb-mobile-page-item",5),r(),s(8,"div",6)(9,"button",7),c(10,"async"),C("click",function(){return t.cancel()}),p(11),c(12,"translate"),r(),s(13,"button",8),c(14,"async"),C("click",function(){return t.save()}),p(15),c(16,"translate"),r()()),o&2&&(a(7),m("formControl",t.customMobilePage),a(2),m("disabled",u(10,5,t.isLoading$)),a(2),b(" ",u(12,7,"action.cancel")," "),a(2),m("disabled",u(14,9,t.isLoading$)||t.customMobilePage.invalid||!t.customMobilePage.dirty),a(2),b(" ",u(16,11,"action.add")," "))},dependencies:[te,Ie,re,at,Nt,dt,W,ii,J,Ha,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:600px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']});let i=n;return i})();S();S();var Gp=(()=>{let n=class n{constructor(e){this.fb=e,this.customMobilePageApplied=new wt,this.mobilePageControl=this.fb.control(null)}ngOnInit(){this.mobilePageControl.setValue(this.pageItem,{emitEvent:!1}),this.disabled&&this.mobilePageControl.disable({emitEvent:!1})}cancel(){this.popover?.hide()}apply(){if(this.mobilePageControl.valid){let e=this.mobilePageControl.value;this.customMobilePageApplied.emit(e)}}};n.\u0275fac=function(o){return new(o||n)(h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-custom-menu-item-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{customMobilePageApplied:"customMobilePageApplied"},decls:12,vars:8,consts:[[1,"tb-custom-mobile-page-panel"],["translate","",1,"tb-custom-mobile-page-title"],[1,"tb-custom-mobile-page-panel-content"],[3,"formControl"],[1,"tb-custom-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1),p(2,"mobile.edit-custom-page"),r(),s(3,"div",2),g(4,"tb-mobile-page-item",3),r(),s(5,"div",4)(6,"button",5),C("click",function(){return t.cancel()}),p(7),c(8,"translate"),r(),s(9,"button",6),C("click",function(){return t.apply()}),p(10),c(11,"translate"),r()()()),o&2&&(a(4),m("formControl",t.mobilePageControl),a(3),b(" ",u(8,4,"action.cancel")," "),a(2),m("disabled",t.mobilePageControl.invalid||!t.mobilePageControl.dirty),a(),b(" ",u(11,6,"action.apply")," "))},dependencies:[te,W,ii,J,Ha,R],styles:[`@charset "UTF-8";.tb-custom-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-custom-mobile-page-panel{width:90vw}}.tb-custom-mobile-page-panel .tb-custom-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2});let i=n;return i})();S();function BM(i,n){if(i&1){let l=L();s(0,"button",15),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.cleanup())}),s(2,"tb-icon",16),p(3,"mdi:broom"),r()()}if(i&2){let l=y();x("matTooltip",u(1,3,"mobile.reset-to-page-default")),m("disabled",!l.isCleanupEnabled),a(2),m("color",l.isCleanupEnabled?"primary":null)}}var Up=(()=>{let n=class n{constructor(e){this.fb=e,this.defaultMobilePageApplied=new wt,this.mobilePageFormGroup=this.fb.group({visible:[!0],icon:[""],label:[""]}),this.isCleanupEnabled=!1,this.destroyRef=Ut(ft)}ngOnInit(){this.defaultMobilePages=er.get(this.pageItem.id),this.defaultItemName=this.defaultMobilePages.label,this.mobilePageFormGroup.patchValue({label:this.pageItem.label,icon:this.pageItem.icon?this.pageItem.icon:this.defaultMobilePages.icon,visible:this.pageItem.visible},{emitEvent:!1}),this.disabled?this.mobilePageFormGroup.disable({emitEvent:!1}):(this.mobilePageFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()}),this.updateCleanupState())}cancel(){this.popover?.hide()}apply(){this.defaultMobilePageApplied.emit(this.pageItem)}cleanup(){this.mobilePageFormGroup.patchValue({visible:!Ia.includes(this.pageItem.id),icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.mobilePageFormGroup.markAsDirty(),this.updateModel()}updateCleanupState(){this.isCleanupEnabled=(Ia.includes(this.pageItem.id)?this.pageItem.visible:!this.pageItem.visible)||!!this.pageItem.label||!!this.pageItem.icon}updateModel(){this.pageItem.visible=this.mobilePageFormGroup.get("visible").value;let e=this.mobilePageFormGroup.get("label").value;e?this.pageItem.label=e:delete this.pageItem.label;let o=this.mobilePageFormGroup.get("icon").value;o!==this.defaultMobilePages.icon?this.pageItem.icon=o:delete this.pageItem.icon,this.updateCleanupState()}};n.\u0275fac=function(o){return new(o||n)(h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-default-mobile-page-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{defaultMobilePageApplied:"defaultMobilePageApplied"},decls:23,vars:13,consts:[[1,"tb-default-mobile-page-panel",3,"formGroup"],[1,"tb-default-mobile-page-title-container"],["translate","",1,"tb-default-mobile-page-title"],["type","button","mat-stroked-button","","class","tb-box-button","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],[1,"tb-default-mobile-page-panel-content"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic","floatLabel","always",1,"flex-1"],["translate",""],["matInput","","formControlName","label",3,"placeholder"],[1,"tb-default-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button",3,"click","disabled","matTooltip"],["matButtonIcon","",3,"color"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),p(3,"mobile.edit-page"),r(),v(4,BM,4,5,"button",3),r(),s(5,"div",4)(6,"div",5)(7,"mat-slide-toggle",6),p(8),c(9,"translate"),r()(),s(10,"div",7),g(11,"tb-material-icon-select",8),s(12,"mat-form-field",9)(13,"mat-label",10),p(14,"mobile.page-name"),r(),g(15,"input",11),r()()(),s(16,"div",12)(17,"button",13),C("click",function(){return t.cancel()}),p(18),c(19,"translate"),r(),s(20,"button",14),C("click",function(){return t.apply()}),p(21),c(22,"translate"),r()()()),o&2&&(m("formGroup",t.mobilePageFormGroup),a(4),m("ngIf",!t.disabled),a(4),b(" ",u(9,7,"mobile.visible")," "),a(7),x("placeholder",t.defaultItemName),a(3),b(" ",u(19,9,"action.cancel")," "),a(2),m("disabled",t.mobilePageFormGroup.invalid||!t.mobilePageFormGroup.dirty),a(),b(" ",u(22,11,"action.apply")," "))},dependencies:[U,te,be,de,Se,Mt,ht,he,W,X,ne,le,ba,J,bi,R],styles:[`@charset "UTF-8";.tb-default-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}@media screen and (max-width: 959px){.tb-default-mobile-page-panel{width:90vw}}.tb-default-mobile-page-panel .tb-default-mobile-page-title-container{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.tb-default-mobile-page-panel .tb-default-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2});let i=n;return i})();var RM=[[["",8,"tb-custom-menu-item-row-prefix"]]],VM=[".tb-custom-menu-item-row-prefix"];function jM(i,n){i&1&&(s(0,"mat-icon",17),c(1,"translate"),p(2," warning "),r()),i&2&&x("matTooltip",u(1,1,"mobile.page-name-required"))}function LM(i,n){i&1&&(s(0,"mat-icon",17),c(1,"translate"),p(2," warning "),r()),i&2&&x("matTooltip",u(1,1,"mobile.page-name-cannot-contain-only-spaces"))}function GM(i,n){if(i&1&&(s(0,"mat-form-field",18),g(1,"input",19),r()),i&2){let l=y();a(),m("placeholder",l.itemInfo)}}function UM(i,n){if(i&1){let l=L();s(0,"button",20,0),c(2,"translate"),C("click",function(o){I(l);let t=q(1),d=y();return w(d.edit(o,t))}),s(3,"mat-icon"),p(4,"edit"),r()()}i&2&&x("matTooltip",u(2,1,"mobile.edit-page"))}function qM(i,n){if(i&1){let l=L();s(0,"button",21),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.cleanup())}),s(2,"tb-icon"),p(3,"mdi:broom"),r()()}if(i&2){let l=y();x("matTooltip",u(1,2,"mobile.reset-to-page-default")),m("disabled",!l.isCleanupEnabled)}}function WM(i,n){if(i&1){let l=L();s(0,"button",22),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.delete())}),s(2,"mat-icon"),p(3,"delete"),r()()}i&2&&x("matTooltip",u(1,1,"mobile.delete-page"))}var qp=(()=>{let n=class n{constructor(e,o,t,d,f,_){this.fb=e,this.cd=o,this.popoverService=t,this.renderer=d,this.viewContainerRef=f,this.translate=_,this.maxIconNameBlockWidth=256,this.pageRemoved=new wt,this.iconNameBlockWidth="256px",this.isDefaultMenuItem=!1,this.isCustomMenuItem=!1,this.isCleanupEnabled=!1,this.mobilePageRowForm=this.fb.group({visible:[!0,[]],icon:["",[]],label:["",[T.pattern(/\S/)]],type:[Oi.DEFAULT]}),this.propagateChange=D=>{},this.destroyRef=Ut(ft),this.mobilePageRowForm.valueChanges.pipe(Ne()).subscribe(()=>this.updateModel())}ngOnInit(){this.updateIconNameBlockWidth(),this.hideItems&&this.hideItems.pipe(Ne(this.destroyRef)).subscribe(()=>{!this.disabled&&this.modelValue.visible&&this.mobilePageRowForm.patchValue({visible:!1},{emitEvent:!0})})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.mobilePageRowForm.disable({emitEvent:!1}):this.mobilePageRowForm.enable({emitEvent:!1})}validate(){return this.mobilePageRowForm.valid?null:{invalidMobileMenuItem:!0}}writeValue(e){if(this.modelValue=e,this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon,label:e.label},{emitEvent:!1}),this.modelValue.type===Oi.DEFAULT){this.isDefaultMenuItem=!0;let o=this.modelValue;er.has(o.id)&&(this.defaultMobilePages=er.get(o.id),this.defaultItemName=this.defaultMobilePages.label,e.icon||this.mobilePageRowForm.patchValue({icon:this.defaultMobilePages.icon},{emitEvent:!1}))}else this.isCustomMenuItem=!0,this.mobilePageRowForm.get("label").addValidators([T.required]),this.mobilePageRowForm.get("label").updateValueAndValidity({emitEvent:!1});this.updateCleanupState(),this.updateItemInfo(),this.cd.markForCheck()}cleanup(){let e=!Ia.includes(this.modelValue.id);this.mobilePageRowForm.patchValue({visible:e,icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.modelValue.visible=e,delete this.modelValue.icon,delete this.modelValue.label,this.updateModel()}delete(){this.pageRemoved.emit()}edit(e,o){e&&e.stopPropagation();let t=o._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let d={disabled:this.disabled,pageItem:Tt(this.modelValue)};if(this.isDefaultMenuItem){let f=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,Up,["right","bottom","top"],!0,null,d,{},{},{},!1,()=>{},{padding:"16px 24px"});f.tbComponentRef.instance.popover=f,f.tbComponentRef.instance.defaultMobilePageApplied.subscribe(_=>{f.hide(),this.afterPageEdit(_)})}else{let f=this.popoverService.displayPopover(t,this.renderer,this.viewContainerRef,Gp,["right","bottom","top"],!0,null,d,{},{},{},!1,()=>{},{padding:"16px 24px"});f.tbComponentRef.instance.popover=f,f.tbComponentRef.instance.customMobilePageApplied.subscribe(_=>{f.hide(),this.afterPageEdit(_)})}}}get itemName(){return this.isDefaultMenuItem?this.defaultItemName:this.mobilePageRowForm.get("label").value}get itemNamePlaceholder(){return this.isDefaultMenuItem?this.defaultItemName:""}updateIconNameBlockWidth(){this.maxIconNameBlockWidth?this.iconNameBlockWidth=`${this.maxIconNameBlockWidth}px`:this.iconNameBlockWidth="100%"}updateModel(){this.modelValue.visible=this.mobilePageRowForm.get("visible").value;let e=this.mobilePageRowForm.get("label").value;e?.trim()?this.modelValue.label=e:delete this.modelValue.label;let o=this.mobilePageRowForm.get("icon").value;this.isDefaultMenuItem&&this.defaultMobilePages.icon===o&&(o=null),o?this.modelValue.icon=o:delete this.modelValue.icon,this.updateCleanupState(),this.updateItemInfo(),this.propagateChange(this.modelValue)}updateCleanupState(){this.isDefaultMenuItem&&(this.isCleanupEnabled=(Ia.includes(this.modelValue.id)?this.modelValue.visible:!this.modelValue.visible)||!!this.modelValue.label||!!this.modelValue.icon)}updateItemInfo(){this.isCustomMenuItem?this.itemInfo=this.translate.instant(Es.get(this.modelValue.type)):this.itemInfo=""}afterPageEdit(e){this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon||(this.isDefaultMenuItem?this.defaultMobilePages.icon:null),label:e.label},{emitEvent:!1}),this.isCustomMenuItem&&(this.modelValue=e),this.updateModel()}};n.\u0275fac=function(o){return new(o||n)(h(ct),h(Je),h(Dn),h(bn),h(Zi),h(ee))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-menu-item-row"]],inputs:{disabled:[2,"disabled","disabled",Go],maxIconNameBlockWidth:[2,"maxIconNameBlockWidth","maxIconNameBlockWidth",uc],hideItems:"hideItems"},outputs:{pageRemoved:"pageRemoved"},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}]),jo],ngContentSelectors:VM,decls:20,vars:15,consts:[["editButton",""],[1,"tb-mobile-page-item-row-component-container"],[1,"tb-mobile-page-item-row-component"],[1,"tb-form-row",3,"formGroup"],[1,"tb-mobile-page-item-start-block"],[1,"tb-mobile-page-item-icon-name-block"],["matTooltipPosition","above","formControlName","visible",3,"matTooltip"],["asBoxInput","","color","#305680","formControlName","icon"],["tbTruncateWithTooltip",""],[1,"tb-mobile-page-item-input-block","xs:!hidden"],["appearance","outline","subscriptSizing","dynamic",1,"tb-suffix-absolute","flex"],["matInput","","formControlName","label",3,"required","placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["class","tb-mobile-page-item-info flex","appearance","outline","subscriptSizing","dynamic",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],["appearance","outline","subscriptSizing","dynamic",1,"tb-mobile-page-item-info","flex"],["matInput","","readonly","",3,"placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"]],template:function(o,t){o&1&&(Lo(RM),s(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),Jn(4),s(5,"div",5),g(6,"mat-slide-toggle",6),c(7,"translate"),g(8,"tb-material-icon-select",7),s(9,"div",8),p(10),r()()(),s(11,"div",9)(12,"mat-form-field",10),g(13,"input",11),v(14,jM,3,3,"mat-icon",12)(15,LM,3,3,"mat-icon",12),r(),v(16,GM,2,1,"mat-form-field",13),r()(),v(17,UM,5,3,"button",14)(18,qM,4,4,"button",15)(19,WM,4,3,"button",16),r()()),o&2&&(a(2),m("formGroup",t.mobilePageRowForm),a(3),Bi("width",t.iconNameBlockWidth),a(),x("matTooltip",u(7,13,t.mobilePageRowForm.get("visible").value?"mobile.visible":"mobile.hidden")),a(4),b(" ",t.itemName," "),a(3),x("placeholder",t.itemNamePlaceholder),m("required",t.isCustomMenuItem),a(),m("ngIf",t.mobilePageRowForm.get("label").hasError("required")&&t.mobilePageRowForm.get("label").touched),a(),m("ngIf",t.mobilePageRowForm.get("label").hasError("pattern")&&t.mobilePageRowForm.get("label").touched),a(),m("ngIf",t.isCustomMenuItem),a(),m("ngIf",!t.disabled),a(),m("ngIf",!t.disabled&&t.isDefaultMenuItem),a(),m("ngIf",!t.disabled&&t.isCustomMenuItem))},dependencies:[U,Ie,re,be,de,Xt,Mt,ht,he,W,X,fe,ne,le,ba,tn,bi,R],styles:[`@charset "UTF-8";.tb-mobile-page-item-row-component-container{display:flex;flex-direction:column;gap:0}.tb-mobile-page-item-row-component{display:flex;gap:8px;align-items:center}@media screen and (max-width: 599px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:24px;height:24px;line-height:24px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:24px;height:24px}}@media screen and (min-width: 600px) and (max-width: 959px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:32px;height:32px;line-height:32px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:32px;height:32px}}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(:disabled) .mat-icon{color:#0000008a}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:disabled .mat-icon{color:#0000001f}.tb-mobile-page-item-row-component .tb-form-row{flex:1;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-start-block{display:flex;align-items:center;gap:0;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-icon-name-block{display:flex;align-items:center;gap:12px;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-input-block{display:flex;gap:8px;flex:1}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input{cursor:default}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input::placeholder{color:#305680}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input:-ms-input-placeholder{color:#305680}
`],encapsulation:2});let i=n;return i})();var zM=["mobilePagesContainer"];function $M(i,n){if(i&1){let l=L();s(0,"button",12),C("click",function(){I(l);let o=y();return w(o.hideAll())}),s(1,"tb-icon",13),p(2,"visibility_off"),r(),s(3,"div",14),p(4),c(5,"translate"),r()()}i&2&&(a(4),B(u(5,1,"mobile.hide-all-pages")))}function JM(i,n){if(i&1){let l=L();s(0,"button",12),C("click",function(){I(l);let o=y();return w(o.resetToDefault())}),s(1,"tb-icon",13),p(2,"mdi:broom"),r(),s(3,"div",14),p(4),c(5,"translate"),r()()}i&2&&(a(4),B(u(5,1,"mobile.reset-to-default-pages")))}function QM(i,n){if(i&1){let l=L();s(0,"button",15),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.hideAll())}),s(2,"tb-icon",16),p(3,"visibility_off"),r()()}i&2&&x("matTooltip",u(1,1,"mobile.hide-all-pages"))}function YM(i,n){if(i&1){let l=L();s(0,"button",15),c(1,"translate"),C("click",function(){I(l);let o=y();return w(o.resetToDefault())}),s(2,"tb-icon",16),p(3,"mdi:broom"),r()()}i&2&&x("matTooltip",u(1,1,"mobile.reset-to-default-pages"))}function KM(i,n){i&1&&(s(0,"div",23),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.custom-page")," "))}function XM(i,n){i&1&&(s(0,"button",24),c(1,"translate"),s(2,"tb-icon"),p(3,"drag_indicator"),r()()),i&2&&x("matTooltip",u(1,1,"action.drag"))}function ZM(i,n){if(i&1&&(s(0,"span",29),p(1),c(2,"translate"),r()),i&2){let l=y(2).index,e=y();a(),B(u(2,1,e.getDividerLabel(l)))}}function e3(i,n){if(i&1){let l=L();s(0,"button",25),c(1,"translate"),C("click",function(){I(l);let o=y().index,t=y();return w(t.addCustomMobilePage(o))}),s(2,"div",26)(3,"mat-icon",27),p(4,"add"),r(),v(5,ZM,3,3,"span",28),r()()}if(i&2){let l=y().index,e=y();j("divider",e.showMenuDivider(l)),x("matTooltip",u(1,4,"mobile.add-specific-page")),a(5),m("ngIf",e.showMenuDivider(l))}}function t3(i,n){if(i&1){let l=L();s(0,"div",17)(1,"div",18),v(2,KM,3,3,"div",19)(3,XM,4,3,"button",20),s(4,"tb-mobile-menu-item-row",21),C("pageRemoved",function(){let o=I(l).index,t=y();return w(t.removeCustomPage(o))}),r()(),v(5,e3,6,6,"button",22),r()}if(i&2){let l=n.$implicit,e=n.last,o=y();a(),m("cdkDragDisabled",!o.dragEnabled),a(),m("ngIf",o.isCustom(l)),a(),m("ngIf",o.dragEnabled),a(),m("formControl",l)("maxIconNameBlockWidth",o.maxIconNameBlockWidth)("hideItems",o.hideItems$),a(),m("ngIf",!e&&!o.readonly)}}function i3(i,n){if(i&1){let l=L();s(0,"button",30),C("click",function(){I(l);let o=y();return w(o.addCustomMobilePage())}),s(1,"mat-icon",31),p(2,"add"),r(),s(3,"span",32),p(4,"mobile.add-specific-page"),r()()}}var Wp=(()=>{let n=class n{constructor(e,o,t){this.fb=e,this.breakpointObserver=o,this.dialog=t,this.pagesForm=this.fb.group({pages:this.fb.array([])}),this.maxIconNameBlockWidth=256,this.showHiddenPages=new ia(!0),this.hideItemsSubject=new Ft,this.hideItems$=this.hideItemsSubject.asObservable(),this.propagateChange=d=>{},this.pagesForm.valueChanges.pipe(Ne()).subscribe(()=>this.updateModel()),this.breakpointObserver.observe([wi.xs,wi["gt-xs"],wi["gt-sm"]]).pipe(Ne()).subscribe(()=>{this.computeMaxIconNameBlockWidth()}),this.computeMaxIconNameBlockWidth()}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){e?this.pagesForm.disable({emitEvent:!1}):this.pagesForm.enable({emitEvent:!1})}writeValue(e){let o=this.prepareMobilePages(e);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(o))}validate(e){return this.pagesForm.valid?null:{invalidLayoutForm:!0}}hideAll(){this.hideItemsSubject.next(),this.showHiddenPages.value&&this.showHiddenPages.setValue(!1)}resetToDefault(){if(!_d(this.pagesForm.value.pages)){let e=this.prepareMobilePages(null);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(e))}}get dragEnabled(){return!this.readonly&&this.visibleMobilePagesControls().length>1}visibleMobilePagesControls(){return this.pagesFormArray().controls.filter(e=>this.showHiddenPages.value||e.value.visible)}mobileItemDrop(e){let o=this.pagesFormArray(),t=this.visibleMobilePagesControls()[e.previousIndex],d=this.actualMobilePageIndex(e.previousIndex),f=this.actualMobilePageIndex(e.currentIndex);o.removeAt(d),o.insert(f,t),this.pagesForm.markAsDirty()}trackByMenuItem(e,o){return o}addCustomMobilePage(e){this.dialog.open(Lp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(o=>{if(o){let t=this.pagesFormArray(),d=this.fb.control(o,[]);if(On(e)){let f=this.actualMobilePageIndex(e)+1;t.insert(f,d)}else t.push(d),setTimeout(()=>{this.mobilePagesContainer.nativeElement.scrollTop=this.mobilePagesContainer.nativeElement.scrollHeight},0);this.pagesForm.markAsDirty()}})}isCustom(e){return e.value.type!==Oi.DEFAULT}removeCustomPage(e){this.pagesFormArray().removeAt(this.actualMobilePageIndex(e)),this.pagesForm.markAsDirty()}showMenuDivider(e){return Cd.has(e)}getDividerLabel(e){return Cd.get(e)}updateModel(){_d(this.pagesForm.value.pages)?this.propagateChange(null):this.propagateChange(this.pagesForm.value)}prepareMobilePages(e){return e?.pages?.length?e.pages:yf()}prepareMobilePagesFormArray(e){let o=[];return e.forEach(t=>{o.push(this.fb.control(Tt(t)))}),this.fb.array(o)}computeMaxIconNameBlockWidth(){this.breakpointObserver.isMatched(wi["gt-sm"])?this.maxIconNameBlockWidth=256:this.breakpointObserver.isMatched(wi["gt-xs"])?this.maxIconNameBlockWidth=200:this.maxIconNameBlockWidth=0}pagesFormArray(){return this.pagesForm.get("pages")}actualMobilePageIndex(e){let o=this.visibleMobilePagesControls()[e];return this.pagesFormArray().controls.indexOf(o)}};n.\u0275fac=function(o){return new(o||n)(h(ct),h(Xn),h(je))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-layout"]],viewQuery:function(o,t){if(o&1&&we(zM,5),o&2){let d;Me(d=De())&&(t.mobilePagesContainer=d.first)}},inputs:{readonly:[2,"readonly","readonly",Go]},features:[He([{provide:ot,useExisting:Re(()=>n),multi:!0},{provide:Ht,useExisting:Re(()=>n),multi:!0}]),jo],decls:17,vars:12,consts:[["mobilePagesContainer",""],[1,"mobile-layout-container"],[1,"header","flex","items-center","gap-2"],[1,"title-section"],["tbTruncateWithTooltip","","translate","",1,"title-container"],[1,"whitespace-nowrap","xs:!hidden",3,"formControl"],[1,"flex-1"],["class","tb-mobile-layout-button lt-lg:!hidden","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["type","button","mat-stroked-button","","class","tb-box-button gt-md:!hidden","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-mobile-items-container",3,"cdkDropListDropped","cdkDropListDisabled"],["class","tb-mobile-item-row-container",4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","","color","primary","class","tb-primary-fill","style","min-height: 52px;",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",1,"tb-mobile-layout-button","lt-lg:!hidden",3,"click"],["matButtonIcon",""],["tbTruncateWithTooltip",""],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button","gt-md:!hidden",3,"click","matTooltip"],["color","primary","matButtonIcon",""],[1,"tb-mobile-item-row-container"],["cdkDrag","",1,"tb-draggable","tb-mobile-item-row",3,"cdkDragDisabled"],["class","tb-mobile-item-label",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-mat-40 tb-drag-handle",3,"matTooltip",4,"ngIf"],[2,"flex","1","min-width","0",3,"pageRemoved","formControl","maxIconNameBlockWidth","hideItems"],["class","tb-add-mobile-item-button","mat-button","","matTooltipPosition","above","color","primary",3,"divider","matTooltip","click",4,"ngIf"],[1,"tb-mobile-item-label"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-40","tb-drag-handle",3,"matTooltip"],["mat-button","","matTooltipPosition","above","color","primary",1,"tb-add-mobile-item-button",3,"click","matTooltip"],[1,"tb-add-mobile-label-container","tb-primary-fill"],["color","primary",1,"tb-mat-18"],["class","tb-mobile-divider-label",4,"ngIf"],[1,"tb-mobile-divider-label"],["mat-button","","color","primary",1,"tb-primary-fill",2,"min-height","52px",3,"click"],["color","primary"],["translate",""]],template:function(o,t){if(o&1){let d=L();s(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),p(4,"mobile.pages"),r(),s(5,"mat-slide-toggle",5),p(6),c(7,"translate"),r()(),g(8,"span",6),v(9,$M,6,3,"button",7)(10,JM,6,3,"button",7)(11,QM,4,3,"button",8)(12,YM,4,3,"button",8),r(),s(13,"div",9,0),C("cdkDropListDropped",function(_){return I(d),w(t.mobileItemDrop(_))}),v(15,t3,6,7,"div",10),r(),v(16,i3,5,0,"button",11),r()}o&2&&(a(5),m("formControl",t.showHiddenPages),a(),B(u(7,10,"mobile.show-hidden-pages")),a(3),m("ngIf",!t.readonly),a(),m("ngIf",!t.readonly),a(),m("ngIf",!t.readonly),a(),m("ngIf",!t.readonly),a(),m("cdkDropListDisabled",!t.dragEnabled),a(2),m("ngForOf",t.visibleMobilePagesControls())("ngForTrackBy",t.trackByMenuItem),a(),m("ngIf",!t.readonly))},dependencies:[xe,U,te,Ie,re,Mt,ht,_a,ya,va,W,ii,tn,J,bi,qp,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:24px;min-width:0}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.1px}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .tb-mobile-items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]{min-width:120px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   tb-icon[_ngcontent-%COMP%]{min-width:18px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   .mdc-button__label[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button{height:24px;opacity:0;transition:all .2s}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{border-bottom-style:dashed;border-bottom-width:1px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container{vertical-align:middle}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container .mat-icon{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .mat-mdc-button-persistent-ripple{border-bottom-style:inherit;border-bottom-width:inherit}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container{vertical-align:sub}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .mat-icon{display:inline-block}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .tb-mobile-divider-label{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:hover{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .mat-mdc-button-persistent-ripple:before{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .tb-add-mobile-label-container:after{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container{display:inline-flex;padding:3px;vertical-align:sub;border-radius:6px;background:#fff}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .mat-icon{margin:0}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .tb-mobile-divider-label{line-height:12px;font-size:10px;font-weight:400;padding:0 6px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container:after{display:block;height:auto;content:"";position:absolute;inset:0;opacity:.32;border-radius:6px;border:1px solid #305680;pointer-events:none}.tb-mobile-item-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.tb-mobile-item-row[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:row;align-items:center;padding:12px 12px 12px 0;background:#fff;gap:0;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-mobile-item-row[_ngcontent-%COMP%]   .tb-mobile-item-label[_ngcontent-%COMP%]{position:absolute;left:8px;top:-8px;padding-left:8px;padding-right:8px;background:#fff;font-size:12px;font-weight:400;line-height:16px;letter-spacing:.4px;color:#0000008a}']});let i=n;return i})();var o3=["addMobileBundle"];function a3(i,n){i&1&&g(0,"mat-progress-bar",31)}function r3(i,n){i&1&&g(0,"div")}function s3(i,n){i&1&&(s(0,"mat-icon"),p(1,"check"),r())}function l3(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"mobile.basic-settings"))}function m3(i,n){i&1&&(s(0,"mat-error"),p(1),c(2,"translate"),r()),i&2&&(a(),b(" ",u(2,1,"mobile.title-required")," "))}function p3(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"admin.oauth2.oauth2"))}function d3(i,n){i&1&&(p(0),c(1,"translate")),i&2&&B(u(1,1,"mobile.layout"))}function c3(i,n){if(i&1){let l=L();s(0,"button",32),C("click",function(){I(l);let o=y();return w(o.backStep())}),p(1),c(2,"translate"),r()}i&2&&(a(),B(u(2,1,"action.back")))}var Hp=(()=>{let n=class n extends nt{constructor(e,o,t,d,f,_,D,M){super(e,o,t),this.store=e,this.router=o,this.dialogRef=t,this.data=d,this.breakpointObserver=f,this.fb=_,this.dialog=D,this.mobileAppService=M,this.entityType=O,this.selectedIndex=0,this.dialogTitle="mobile.edit-bundle",this.platformType=Vi,this.bundlesForms=this.fb.group({title:["",T.required],androidAppId:[null],iosAppId:[null],description:[""]}),this.oauthForms=this.fb.group({oauth2Enabled:[!0],oauth2ClientIds:[null]}),this.layoutForms=this.fb.group({layoutConfig:[null]}),this.isAdd=!1,this.data.isAdd&&(this.dialogTitle="mobile.add-bundle",this.isAdd=!0),this.stepperOrientation=this.breakpointObserver.observe(wi["gt-xs"]).pipe(rt(({matches:Y})=>Y?"horizontal":"vertical")),this.oauthForms.get("oauth2Enabled").valueChanges.pipe(Ne()).subscribe(Y=>{Y?this.oauthForms.get("oauth2ClientIds").enable({emitEvent:!1}):this.oauthForms.get("oauth2ClientIds").disable({emitEvent:!1})}),!this.data.isAdd&&this.data.bundle&&(this.bundlesForms.patchValue(this.data.bundle,{emitEvent:!1}),this.oauthForms.get("oauth2Enabled").setValue(this.data.bundle.oauth2Enabled,{onlySelf:!0}),this.oauthForms.get("oauth2ClientIds").setValue(Tt(this.data.bundle.oauth2ClientInfos.map(Y=>Y.id.id)),{emitEvent:!1}),this.layoutForms.patchValue(this.data.bundle,{emitEvent:!1}))}cancel(){this.dialogRef.close(null)}backStep(){this.addMobileBundle.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addMobileBundle.next()}nextStepLabel(){return this.selectedIndex>=this.maxStepperIndex?this.data.isAdd?"action.add":"action.save":"action.next"}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}createApplication(e,o){this.dialog.open(br,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{platformType:o}}).afterClosed().subscribe(t=>{t&&(this.bundlesForms.get(e).patchValue(t.id),this.bundlesForms.get(e).markAsDirty())})}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(Oa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(o=>{if(o){let t=this.oauthForms.get("oauth2ClientIds").value?[...this.oauthForms.get("oauth2ClientIds").value]:[];t.push(o.id.id),this.oauthForms.get("oauth2ClientIds").patchValue(t),this.oauthForms.get("oauth2ClientIds").markAsDirty()}})}get maxStepperIndex(){return this.addMobileBundle?._steps?.length-1}add(){if(this.allValid()){let e={mobileBundle:this.mobileAppService.saveMobileAppBundle(this.mobileAppBundleFormValue,this.oauthForms.value.oauth2ClientIds),oath2Clients:null};if(this.data.isAdd)delete e.oath2Clients;else{let o=Ce(Ce({},this.data.bundle),this.mobileAppBundleFormValue);e.mobileBundle=this.mobileAppService.saveMobileAppBundle(o),e.oath2Clients=this.mobileAppService.updateOauth2Clients(o.id.id,this.oauthForms.get("oauth2ClientIds").value)}jt(e).subscribe(o=>this.dialogRef.close(o.mobileBundle))}}allValid(){return!this.addMobileBundle.steps.find((e,o)=>e.stepControl?.invalid?(e.interacted=!0,this.addMobileBundle.selectedIndex=o,!0):!1)}get mobileAppBundleFormValue(){let e=Bn(this.bundlesForms.value);return e.layoutConfig=Bn(this.layoutForms.value.layoutConfig),e.oauth2Enabled=this.oauthForms.value.oauth2Enabled,e}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(it),h(At),h(Xn),h(ct),h(je),h(Fn))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-bundle-dialog"]],viewQuery:function(o,t){if(o&1&&we(o3,7),o&2){let d;Me(d=De())&&(t.addMobileBundle=d.first)}},features:[G],decls:56,vars:42,consts:[["addMobileBundle",""],["color","primary"],[1,"flex-1"],["tb-help","mobileBundle"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"xs:!p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[2,"margin-top","4px",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","title"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.android-application","formControlName","androidAppId",3,"createNew","entityType","entitySubtype"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.ios-application","formControlName","iosAppId",3,"createNew","entityType","entitySubtype"],["appearance","outline"],["matInput","","formControlName","description","rows","1"],[2,"margin-top","8px",3,"formGroup"],["formControlName","oauth2Enabled"],["formControlName","oauth2ClientIds","appearance","outline",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"layout-form",3,"formGroup"],["formControlName","layoutConfig"],["mat-dialog-actions",""],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],["mat-stroked-button","",3,"click"]],template:function(o,t){if(o&1){let d=L();s(0,"mat-toolbar",1)(1,"h2"),p(2),c(3,"translate"),r(),g(4,"span",2)(5,"div",3),s(6,"button",4),C("click",function(){return I(d),w(t.cancel())}),s(7,"mat-icon",5),p(8,"close"),r()()(),v(9,a3,1,0,"mat-progress-bar",6),c(10,"async"),v(11,r3,1,0,"div",7),c(12,"async"),s(13,"div",8)(14,"mat-horizontal-stepper",9,0),c(16,"async"),C("selectionChange",function(_){return I(d),w(t.changeStep(_))}),v(17,s3,2,0,"ng-template",10),s(18,"mat-step",11),v(19,l3,2,3,"ng-template",12),s(20,"form",13)(21,"mat-form-field",14)(22,"mat-label",15),p(23,"mobile.title"),r(),g(24,"input",16)(25,"mat-hint"),v(26,m3,3,3,"mat-error",7),r(),s(27,"tb-entity-autocomplete",17),C("createNew",function(){return I(d),w(t.createApplication("androidAppId",t.platformType.ANDROID))}),r(),s(28,"tb-entity-autocomplete",18),C("createNew",function(){return I(d),w(t.createApplication("iosAppId",t.platformType.IOS))}),r(),s(29,"mat-form-field",19)(30,"mat-label",15),p(31,"mobile.description"),r(),g(32,"textarea",20),r()()(),s(33,"mat-step",11),v(34,p3,2,3,"ng-template",12),s(35,"form",21)(36,"mat-slide-toggle",22),p(37),c(38,"translate"),r(),s(39,"tb-entity-list",23),c(40,"translate"),c(41,"translate"),s(42,"button",24),C("click",function(_){return I(d),w(t.createClient(_))}),s(43,"span",25),p(44),c(45,"translate"),r()()()()(),s(46,"mat-step",11),v(47,d3,2,3,"ng-template",12),s(48,"form",26),g(49,"tb-mobile-layout",27),r()()()(),s(50,"div",28),v(51,c3,3,3,"button",29),g(52,"span",2),s(53,"button",30),C("click",function(){return I(d),w(t.nextStep())}),p(54),c(55,"translate"),r()()}o&2&&(a(2),B(u(3,24,t.dialogTitle)),a(7),m("ngIf",u(10,26,t.isLoading$)),a(2),m("ngIf",!u(12,28,t.isLoading$)),a(3),m("linear",t.isAdd)("orientation",u(16,30,t.stepperOrientation)),a(4),m("stepControl",t.bundlesForms),a(2),m("formGroup",t.bundlesForms),a(6),m("ngIf",t.bundlesForms.get("title").hasError("required")),a(),m("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.ANDROID),a(),m("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.IOS),a(5),m("stepControl",t.oauthForms),a(2),m("formGroup",t.oauthForms),a(2),b(" ",u(38,32,"mobile.enable-oauth")," "),a(2),x("labelText",u(40,34,"admin.oauth2.clients")),x("placeholderText",u(41,36,"admin.oauth2.add-client")),m("entityType",t.entityType.OAUTH2_CLIENT),a(3),m("disabled",t.oauthForms.get("oauth2ClientIds").disabled),a(2),B(u(45,38,"admin.oauth2.create-new")),a(2),m("stepControl",t.layoutForms),a(2),m("formGroup",t.layoutForms),a(3),m("ngIf",t.selectedIndex>0),a(3),B(u(55,40,t.nextStepLabel())))},dependencies:[U,$t,ca,io,te,Ie,re,Ue,be,de,Se,Kt,Fe,Xt,at,Nt,dt,ht,wn,En,Mn,In,ue,he,W,X,fe,ne,le,J,Wp,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:850px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form.layout-form[_ngcontent-%COMP%]{display:block;height:100%;max-height:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%;max-width:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container .mat-horizontal-stepper-content:not(.mat-horizontal-stepper-content-inactive):nth-child(3){height:100%;max-height:100%;overflow:hidden}']});let i=n;return i})();S();function u3(i,n){if(i&1&&(s(0,"div",5)(1,"div",6),p(2,"mobile.configuration-step.configure-package-title"),r(),s(3,"div",1),p(4,"mobile.configuration-step.configure-package-text"),r(),s(5,"div",1),p(6,"mobile.configuration-step.configure-package-text-install"),r(),g(7,"tb-markdown",11),s(8,"div",1),p(9,"mobile.configuration-step.configure-package-run-commands"),r(),g(10,"tb-markdown",11),r()),i&2){let l=y();a(7),m("data",l.createMarkDownCommand(l.flutterInstallRenameCommand)),a(3),m("data",l.createMarkDownCommand(l.renameCommands))}}var zp=(()=>{let n=class n extends nt{constructor(e,o,t,d){super(e,o,d),this.store=e,this.router=o,this.data=t,this.dialogRef=d,this.notShowAgain=!1,this.setApplication=!1,this.gitRepositoryLink="git clone -b master https://github.com/thingsboard/flutter_thingsboard_app.git",this.pathToConstants="lib/constants/app_constants.dart",this.flutterRunCommand="flutter run",this.flutterInstallRenameCommand="flutter pub global activate rename",this.renameCommands=[],this.showDontShowAgain=this.data.afterAdd,this.setApplication=!!this.data.androidApp||!!this.data.iosApp,this.configureApi=`static const thingsBoardApiEndpoint = '${window.location.origin}';`,this.setApplication&&(this.configureApi+=`
`,this.data.androidApp&&(this.configureApi+=`
static const thingsboardAndroidAppSecret = '${this.data.androidApp.appSecret}';`),this.data.iosApp&&(this.configureApi+=`
static const thingsboardIOSAppSecret = '${this.data.iosApp.appSecret}';`)),this.setApplication&&(this.data.androidApp?.pkgName===this.data.iosApp?.pkgName?this.renameCommands.push(`rename setBundleId --targets android, ios --value "${this.data.androidApp.pkgName}"`):(this.data.androidApp&&this.renameCommands.push(`rename setBundleId --targets android --value "${this.data.androidApp.pkgName}"`),this.data.iosApp&&this.renameCommands.push(`rename setBundleId --targets ios --value "${this.data.iosApp.pkgName}"`)))}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayConfigurationAfterAddMobileBundle:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let o=[];return e.forEach(t=>o.push(this.createMarkDownSingleCommand(t))),o.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}};n.\u0275fac=function(o){return new(o||n)(h(A),h(pe),h(At),h(it))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-app-configuration-dialog"]],features:[G],decls:58,vars:23,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content","",1,"flex","flex-col","gap-4","xs:gap-2","gt-xs:max-h-[80vh]"],[1,"tb-form-panel","stroked"],["translate","",1,"tb-form-panel-title"],[1,"flex","gap-4"],["translate","",1,"flex-1"],["mat-stroked-button","","color","primary","href","https://docs.flutter.dev/get-started/install","target","_blank"],[1,"tb-mat-24"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf"],[1,"flex","items-center","gap-4"],["mat-stroked-button","","color","primary","href","https://docs.flutter.dev/get-started/learn-flutter","target","_blank"],["mat-dialog-actions","",1,"tb-dialog-actions","gap-2"],[3,"ngModelChange","ngModel"],[1,"flex-1"],["mat-button","",3,"click","disabled"]],template:function(o,t){o&1&&(s(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.configuration-dialog"),r(),s(3,"button",2),C("click",function(){return t.close()}),s(4,"mat-icon",3),p(5,"close"),r()()(),s(6,"div",4)(7,"div",5)(8,"div",6),p(9,"mobile.configuration-step.prepare-environment-title"),r(),s(10,"div",7)(11,"div",8),p(12,"mobile.configuration-step.prepare-environment-text"),r(),s(13,"a",9)(14,"mat-icon",10),p(15,"description"),r(),p(16),c(17,"translate"),r()()(),s(18,"div",5)(19,"div",6),p(20,"mobile.configuration-step.get-source-code-title"),r(),s(21,"div",1),p(22,"mobile.configuration-step.get-source-code-text"),r(),g(23,"tb-markdown",11),r(),s(24,"div",5)(25,"div",6),p(26,"mobile.configuration-step.configure-api-title"),r(),s(27,"div",1),p(28,"mobile.configuration-step.configure-api-text"),r(),g(29,"tb-markdown",11),s(30,"div",1),p(31,"mobile.configuration-step.configure-api-hint"),r(),g(32,"tb-markdown",11),r(),v(33,u3,11,2,"div",12),s(34,"div",5)(35,"div",6),p(36,"mobile.configuration-step.run-app-title"),r(),s(37,"div",1),p(38,"mobile.configuration-step.run-app-text"),r(),g(39,"tb-markdown",11),r(),s(40,"div",5)(41,"div",13)(42,"div",8),p(43,"mobile.configuration-step.more-information"),r(),s(44,"a",14)(45,"mat-icon",10),p(46,"rocket_launch"),r(),p(47),c(48,"translate"),r()()()(),s(49,"div",15)(50,"mat-slide-toggle",16),et("ngModelChange",function(f){return Ze(t.notShowAgain,f)||(t.notShowAgain=f),f}),p(51),c(52,"translate"),r(),g(53,"span",17),s(54,"button",18),c(55,"async"),C("click",function(){return t.close()}),p(56),c(57,"translate"),r()()),o&2&&(a(16),b("",u(17,13,"common.documentation")," "),a(7),m("data",t.createMarkDownCommand(t.gitRepositoryLink)),a(6),m("data",t.createMarkDownCommand(t.pathToConstants)),a(3),m("data",t.createMarkDownCommand(t.configureApi)),a(),m("ngIf",t.setApplication),a(6),m("data",t.createMarkDownCommand(t.flutterRunCommand)),a(8),b("",u(48,15,"mobile.configuration-step.getting-started")," "),a(3),j("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),a(),B(u(52,17,"action.dont-show-again")),a(3),m("disabled",u(55,19,t.isLoading$)),a(2),B(u(57,21,"action.close")))},dependencies:[U,sa,ea,te,Ie,re,at,Nt,dt,ht,W,Qe,J,me,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;width:870px;max-width:100%;grid-template-rows:min-content minmax(auto,1fr) min-content}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{padding:8px 16px 8px 24px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;font-size:14px;background:#f3f6fa;border-color:#305680;padding-right:38px;overflow:hidden;overflow-x:auto;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']});let i=n;return i})();var ec=(()=>{let n=class n{constructor(e,o,t,d,f,_){this.datePipe=e,this.mobileAppService=o,this.translate=t,this.dialog=d,this.router=f,this.store=_,this.config=new Le,this.openingEditDialog=!1,this.config.selectionEnabled=!1,this.config.entityType=O.MOBILE_APP_BUNDLE,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.detailsPanelEnabled=!1,this.config.entityTranslations=Ge.get(O.MOBILE_APP_BUNDLE),this.config.entityResources=tt.get(O.MOBILE_APP_BUNDLE),this.config.headerComponent=jp,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:ei.DESC},this.config.addEntity=()=>this.editBundle(null,!0),this.config.columns.push(new qe("createdTime","common.created-time",this.datePipe,"170px"),new K("title","mobile.title","25%"),new fa("oauth2ClientInfos","mobile.oauth-clients","35%"),new fa("androidPkg","mobile.android-app","20%"),new fa("iosPkg","mobile.ios-app","20%"),new K("oauth2Enabled","mobile.enable-oauth","140px",D=>Dt(D.oauth2Enabled))),this.config.deleteEnabled=D=>!(D.iosAppId||D.androidAppId),this.config.deleteEntityTitle=D=>this.translate.instant("mobile.delete-applications-bundle-title",{bundleName:D.name}),this.config.deleteEntityContent=()=>this.translate.instant("mobile.delete-applications-bundle-text"),this.config.deleteEntity=D=>this.mobileAppService.deleteMobileAppBundle(D.id),this.config.entitiesFetchFunction=D=>this.mobileAppService.getTenantMobileAppBundleInfos(D).pipe(rt(M=>(M.data.map(Y=>{Y.androidPkgName&&(Y.androidPkg={id:Y.androidAppId,name:Y.androidPkgName}),Y.iosPkgName&&(Y.iosPkg={id:Y.iosAppId,name:Y.iosPkgName})}),M))),this.config.handleRowClick=(D,M)=>(D?.stopPropagation(),this.openingEditDialog||(this.openingEditDialog=!0,this.mobileAppService.getMobileAppBundleInfoById(M.id.id).pipe(Xi(Y=>this.editBundle(Y)),mt(this.router.events.pipe(lc(1))),rc(()=>{this.openingEditDialog=!1})).subscribe(Y=>{Y&&this.config.updateData()})),!0),this.config.entityAdded=D=>{this.store.pipe(qt(Yo("notDisplayConfigurationAfterAddMobileBundle"))).pipe(mi(1)).subscribe(M=>{M||this.configurationApp(null,D,!0)})},this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("mobile.configuration-app"),icon:"code",isEnabled:()=>!0,onAction:(e,o)=>this.configurationApp(e,o)}]}editBundle(e,o=!1){return this.dialog.open(Hp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:o,bundle:e}}).afterClosed()}configurationApp(e,o,t=!1){e&&e.stopPropagation();let d={androidApp:o.androidAppId?this.mobileAppService.getMobileAppInfoById(o.androidAppId.id):Ct(null),iosApp:o.iosAppId?this.mobileAppService.getMobileAppInfoById(o.iosAppId.id):Ct(null)};jt(d).subscribe(f=>{this.dialog.open(zp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{afterAdd:t,androidApp:f.androidApp,iosApp:f.iosApp}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})})}};n.\u0275fac=function(o){return new(o||n)(P(Oe),P(Fn),P(ee),P(je),P(pe),P(A))},n.\u0275prov=Te({token:n,factory:n.\u0275fac});let i=n;return i})();var Rg=[{path:"bundles",component:Ve,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.bundles",breadcrumb:{menuId:ve.mobile_bundles}},resolve:{entitiesTableConfig:ec}}],tc=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({providers:[ec]});let i=n;return i})();S();S();var f3=()=>["flex"];function g3(i,n){i&1&&g(0,"mat-progress-bar",23)}function h3(i,n){i&1&&g(0,"div",24)}function b3(i,n){if(i&1&&(s(0,"div",25)(1,"div",26),p(2),c(3,"translate"),r(),g(4,"tb-entity-autocomplete",27),r()),i&2){let l=y();a(2),B(u(3,3,"mobile.bundle")),a(2),m("additionalClasses",Bt(5,f3))("entityType",l.entityType.MOBILE_APP_BUNDLE)}}function v3(i,n){if(i&1&&(s(0,"mat-option",12),p(1),c(2,"translate"),r()),i&2){let l=n.$implicit;m("value",l.key),a(),b(" ",u(2,2,l.value)," ")}}function y3(i,n){if(i&1){let l=L();s(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",30),C("click",function(o){return I(l),w(o.stopPropagation())}),p(3),c(4,"translate"),r(),s(5,"mat-form-field",31)(6,"mat-select",32),v(7,v3,3,4,"mat-option",33),c(8,"keyvalue"),r()()()()}if(i&2){let l=y();a(3),b(" ",u(4,2,"admin.mobile-app.badges")," "),a(4),m("ngForOf",u(8,4,l.badgePositionTranslationsMap))}}function _3(i,n){if(i&1&&(s(0,"mat-icon",37),c(1,"translate"),p(2," warning "),r()),i&2){let l=y(2);m("matTooltip",u(1,1,l.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")?"admin.mobile-app.label-required":"admin.mobile-app.label-max-length"))}}function C3(i,n){if(i&1){let l=L();s(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",34),C("click",function(o){return I(l),w(o.stopPropagation())}),p(3),c(4,"translate"),r(),s(5,"mat-form-field",31),g(6,"input",35),c(7,"translate"),v(8,_3,3,3,"mat-icon",36),r()()()}if(i&2){let l=y();a(3),b(" ",u(4,3,"admin.mobile-app.label")," "),a(3),x("placeholder",u(7,5,"admin.mobile-app.set")),a(2),m("ngIf",!l.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").untouched&&l.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")||l.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("maxlength"))}}function S3(i,n){if(i&1&&(s(0,"div",38)(1,"div",10),p(2,"admin.mobile-app.preview"),r(),g(3,"tb-mobile-app-qrcode-widget",39),r()),i&2){let l=y();a(3),m("mobileAppSettings",l.mobileAppSettingsForm.getRawValue())}}var $p=(()=>{let n=class n extends It{constructor(e,o,t){super(e),this.store=e,this.mobileAppService=o,this.fb=t,this.badgePositionTranslationsMap=vf,this.entityType=O,this.mobileAppSettingsForm=this.fb.group({useDefaultApp:[!0],mobileAppBundleId:[{value:null,disabled:!0},T.required],androidEnabled:[!0],iosEnabled:[!0],qrCodeConfig:this.fb.group({showOnHomePage:[!0],badgeEnabled:[!0],badgePosition:[bf.RIGHT],qrCodeLabelEnabled:[!0],qrCodeLabel:["",[T.required,T.maxLength(50)]]})}),this.mobileAppService.getMobileAppSettings().subscribe(d=>this.processMobileAppSettings(d)),this.mobileAppSettingsForm.get("useDefaultApp").valueChanges.pipe(Ne()).subscribe(d=>{d?this.mobileAppSettingsForm.get("mobileAppBundleId").disable({emitEvent:!1}):this.mobileAppSettingsForm.get("mobileAppBundleId").enable({emitEvent:!1})}),this.mobileAppSettingsForm.get("androidEnabled").valueChanges.pipe(Ne()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("iosEnabled").valueChanges.pipe(Ne()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").valueChanges.pipe(Ne()).subscribe(d=>{d?this.mobileAppSettingsForm.get("qrCodeConfig").enable({emitEvent:!1}):(this.mobileAppSettingsForm.get("qrCodeConfig").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").enable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").valueChanges.pipe(Ne()).subscribe(d=>{if(d){let f=this.mobileAppSettingsForm.getRawValue();f.androidEnabled||f.iosEnabled?(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1}))}else this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1})}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").valueChanges.pipe(Ne()).subscribe(d=>{d&&this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value?this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").enable({emitEvent:!1}):this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").disable({emitEvent:!1})})}processMobileAppSettings(e){this.mobileAppSettings=Ce({},e),this.mobileAppSettingsForm.reset(this.mobileAppSettings)}save(){let e=this.mobileAppSettings.qrCodeConfig.showOnHomePage;this.mobileAppSettings=Ce(Ce({},this.mobileAppSettings),this.mobileAppSettingsForm.getRawValue()),this.mobileAppService.saveMobileAppSettings(this.mobileAppSettings).subscribe(o=>{let t=o.qrCodeConfig.showOnHomePage;e!==t&&this.store.dispatch(new kc({mobileQrEnabled:t})),this.processMobileAppSettings(o)})}confirmForm(){return this.mobileAppSettingsForm}};n.\u0275fac=function(o){return new(o||n)(h(A),h(_f),h(ct))},n.\u0275cmp=F({type:n,selectors:[["tb-mobile-qr-code-widget"]],features:[G],decls:51,vars:39,consts:[["appearance","outlined",1,"settings-card"],[1,"items-center"],["translate","",1,"mat-headline-5"],["tb-help","mobileQrCode"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[1,"tb-form-panel","no-border","no-padding",3,"formGroup"],[1,"tb-form-panel"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["translate","",1,"tb-form-panel-title"],["formControlName","useDefaultApp"],[3,"value"],["class","tb-form-row column-xs",4,"ngIf"],[1,"tb-form-row","stroked","no-padding-bottom"],["formControlName","androidEnabled",1,"mat-slide",3,"click"],["formControlName","iosEnabled",1,"mat-slide",3,"click"],["formGroupName","qrCodeConfig",1,"tb-form-panel"],["formControlName","showOnHomePage"],["class","tb-form-panel stroked no-padding no-gap",4,"ngIf"],["class","tb-form-panel tb-qrcode-preview",4,"ngIf"],[1,"tb-flex","row","flex-end",2,"margin-top","16px"],["mat-button","","mat-raised-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"tb-form-row","column-xs"],[1,"fixed-title-width-230"],["useFullEntityId","","appearance","outline","subscriptSizing","dynamic","formControlName","mobileAppBundleId",1,"flex-1",3,"additionalClasses","entityType"],[1,"tb-form-panel","stroked","no-padding","no-gap"],[1,"tb-form-row","space-between","no-border","no-padding-bottom","column-xs"],["formControlName","badgeEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["formControlName","badgePosition"],[3,"value",4,"ngFor","ngForOf"],["formControlName","qrCodeLabelEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["matInput","","formControlName","qrCodeLabel",3,"placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],[1,"tb-form-panel","tb-qrcode-preview"],[3,"mobileAppSettings"]],template:function(o,t){o&1&&(s(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title")(3,"span",2),p(4,"admin.mobile-app.mobile-app-qr-code-widget-settings"),r()(),g(5,"div",3),r(),v(6,g3,1,0,"mat-progress-bar",4),c(7,"async"),v(8,h3,1,0,"div",5),c(9,"async"),s(10,"mat-card-content",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),p(15,"admin.mobile-app.applications"),r(),s(16,"tb-toggle-select",11)(17,"tb-toggle-option",12),p(18),c(19,"translate"),r(),s(20,"tb-toggle-option",12),p(21),c(22,"translate"),r()()(),v(23,b3,5,6,"div",13),s(24,"div",14)(25,"mat-slide-toggle",15),C("click",function(f){return f.stopPropagation()}),p(26),c(27,"translate"),r()(),s(28,"div",14)(29,"mat-slide-toggle",16),C("click",function(f){return f.stopPropagation()}),p(30),c(31,"translate"),r()()(),s(32,"div",17)(33,"div",9)(34,"div",10),p(35,"admin.mobile-app.appearance-on-home-page"),r(),s(36,"tb-toggle-select",18)(37,"tb-toggle-option",12),p(38),c(39,"translate"),r(),s(40,"tb-toggle-option",12),p(41),c(42,"translate"),r()()(),v(43,y3,9,6,"div",19)(44,C3,9,7,"div",19)(45,S3,4,1,"div",20),r()(),s(46,"div",21)(47,"button",22),c(48,"async"),C("click",function(){return t.save()}),p(49),c(50,"translate"),r()()()()),o&2&&(a(6),m("ngIf",u(7,19,t.isLoading$)),a(2),m("ngIf",!u(9,21,t.isLoading$)),a(3),m("formGroup",t.mobileAppSettingsForm),a(6),m("value",!0),a(),B(u(19,23,"admin.mobile-app.default")),a(2),m("value",!1),a(),B(u(22,25,"admin.mobile-app.custom")),a(2),m("ngIf",!t.mobileAppSettingsForm.get("useDefaultApp").value),a(3),b(" ",u(27,27,"admin.mobile-app.android")," "),a(4),b(" ",u(31,29,"admin.mobile-app.ios")," "),a(7),m("value",!0),a(),B(u(39,31,"admin.mobile-app.enabled")),a(2),m("value",!1),a(),B(u(42,33,"admin.mobile-app.disabled")),a(2),m("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),a(),m("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),a(),m("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),a(2),m("disabled",u(48,35,t.isLoading$)||t.mobileAppSettingsForm.invalid||!t.mobileAppSettingsForm.dirty),a(2),b(" ",u(50,37,"action.save")," "))},dependencies:[xe,U,$t,ca,te,re,Zt,ni,ui,ci,Ue,be,de,Xt,vt,gt,Mt,ht,he,W,X,ne,le,bt,J,Di,Fi,Cf,me,xr,R],styles:['@charset "UTF-8";.tb-qrcode-preview[_ngcontent-%COMP%]{background-color:#0000000a;box-shadow:none}.tb-qrcode-preview[_ngcontent-%COMP%]   .tb-form-panel-title[_ngcontent-%COMP%]{color:#00000061}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']});let i=n;return i})();var Vg=[{path:"qr-code-widget",component:$p,canDeactivate:[Ee],data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.qr-code-widget",breadcrumb:{menuId:ve.mobile_qr_code_widget}}}],T3=[{path:"settings/mobile-app",pathMatch:"full",redirectTo:"/mobile-center/qr-code-widget"}],Jp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(T3),V]});let i=n;return i})();(function(){Q(Jp,{imports:[V],exports:[V]})})();var x3=[{path:"mobile-center",component:pn,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],breadcrumb:{menuId:ve.mobile_center}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],redirectTo:"/mobile-center/bundles"}},...kg,...Rg,...Vg]}],Qp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[V.forChild(x3),V]});let i=n;return i})();(function(){Q(Qp,{imports:[V],exports:[V]})})();S();S();var Yp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae]});let i=n;return i})();(function(){Q(Yp,{declarations:[hr],imports:[oe,ae],exports:[hr]})})();var Kp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Yp,Vp]});let i=n;return i})();(function(){Q(Kp,{declarations:[Wa,kp,br,Bp],imports:[oe,ae,ye,Yp,Vp],exports:[br]})})();S();var Xp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,tc]});let i=n;return i})();(function(){Q(Xp,{declarations:[jp,Hp,Wp,qp,Lp,Ha,Gp,Up,zp],imports:[oe,ae,ye,tc]})})();S();var Zp=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Sd,Jp]});let i=n;return i})();(function(){Q(Zp,{declarations:[$p],imports:[oe,ae,ye,Sd,Jp]})})();var ed=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[oe,ae,ye,Kp,Xp,Zp,Qp]});let i=n;return i})();(function(){Q(ed,{imports:[oe,ae,ye,Kp,Xp,Zp,Qp]})})();var E3=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=z({type:n}),n.\u0275inj=H({imports:[wl,Fl,kl,Ul,Jm,Yl,Km,pp,cp,bp,yp,ed,Mp,Dm,Pm,fp,tp,Bm,xm,Um,qm,Wm,Em,Zm,Np,ap,wm,sp,Fp,Ap]});let i=n;return i})();(function(){Q(E3,{exports:[wl,Fl,kl,Ul,Jm,Yl,Km,pp,cp,bp,yp,ed,Mp,Dm,Pm,fp,tp,Bm,xm,Um,qm,Wm,Em,Zm,Np,ap,wm,sp,Fp,Ap]})})();export{E3 as HomePagesModule};
