import{b as a}from"./chunk-EEMO7NZW.js";import{h as p}from"./chunk-UKY6W7HD.js";import{b as g}from"./chunk-HMZCTV6Z.js";import"./chunk-MRUKSJRB.js";import{Jc as m,sc as S,xd as d}from"./chunk-7OOXQFUB.js";import{Aa as h,Ba as n,Sb as u}from"./chunk-2KNKNWMU.js";import{se as r}from"./chunk-YRZDTKHG.js";import{j as c}from"./chunk-Z4H5XVQJ.js";c();var f=class b{constructor(i,e){this.ctx=i;let l=$("#"+e,i.$container)[0],t=i.settings;this.localSettings={},this.localSettings.minValue=t.minValue||0,this.localSettings.maxValue=t.maxValue||100,this.localSettings.gaugeType=t.gaugeType||"arc",this.localSettings.neonGlowBrightness=t.neonGlowBrightness||0,this.localSettings.dashThickness=t.dashThickness||0,this.localSettings.roundedLineCap=t.roundedLineCap===!0;let s=i.data[0].dataKey,o=t.defaultColor||s.color;this.localSettings.unitTitle=t.showUnitTitle===!0?t.unitTitle&&t.unitTitle.length>0?t.unitTitle:s.label:"",this.localSettings.showUnitTitle=t.showUnitTitle===!0,this.localSettings.showTimestamp=t.showTimestamp===!0,this.localSettings.timestampFormat=t.timestampFormat&&t.timestampFormat.length?t.timestampFormat:"yyyy-MM-dd HH:mm:ss",this.localSettings.gaugeWidthScale=t.gaugeWidthScale||.75,this.localSettings.gaugeColor=t.gaugeColor||u(o).setAlpha(.2).toRgbString(),p(t,o),this.localSettings.barColor=t.barColor,this.localSettings.showTicks=t.showTicks||!1,this.localSettings.ticks=[],this.localSettings.ticksValue=t.ticksValue||[],this.localSettings.tickWidth=t.tickWidth||4,this.localSettings.colorTicks=t.colorTicks||"#666",this.localSettings.decimals=h(s.decimals)?s.decimals:n(t.decimals)?t.decimals:i.decimals,this.localSettings.units=s.units&&s.units.length?s.units:h(t.units)&&t.units.length>0?t.units:i.units,this.localSettings.hideValue=t.showValue!==!0,this.localSettings.hideMinMax=t.showMinMax!==!0,this.localSettings.donutStartAngle=n(t.donutStartAngle)?-b.toRadians(t.donutStartAngle):null,this.localSettings.title=t.showTitle===!0?t.title&&t.title.length>0?t.title:s.label:"",!this.localSettings.unitTitle&&this.localSettings.showTimestamp&&(this.localSettings.unitTitle=" "),this.localSettings.titleFont=a(t.titleFont,{size:12,style:"normal",weight:"500",color:o}),this.localSettings.valueFont=a(t.valueFont,{size:18,style:"normal",weight:"500",color:o}),this.localSettings.minMaxFont=a(t.minMaxFont,{size:10,style:"normal",weight:"500",color:o}),this.localSettings.labelFont=a(t.labelFont,{size:8,style:"normal",weight:"500",color:o}),this.barColorProcessor=m.fromSettings(t.barColor,this.ctx);let T={renderTo:l,gaugeWidthScale:this.localSettings.gaugeWidthScale,gaugeColor:this.localSettings.gaugeColor,barColorProcessor:this.barColorProcessor,colorTicks:this.localSettings.colorTicks,tickWidth:this.localSettings.tickWidth,ticks:this.localSettings.ticks,title:this.localSettings.title,fontTitleSize:this.localSettings.titleFont.size,fontTitleStyle:this.localSettings.titleFont.style,fontTitleWeight:this.localSettings.titleFont.weight,colorTitle:this.localSettings.titleFont.color,fontTitle:this.localSettings.titleFont.family,fontValueSize:this.localSettings.valueFont.size,fontValueStyle:this.localSettings.valueFont.style,fontValueWeight:this.localSettings.valueFont.weight,colorValue:this.localSettings.valueFont.color,fontValue:this.localSettings.valueFont.family,fontMinMaxSize:this.localSettings.minMaxFont.size,fontMinMaxStyle:this.localSettings.minMaxFont.style,fontMinMaxWeight:this.localSettings.minMaxFont.weight,colorMinMax:this.localSettings.minMaxFont.color,fontMinMax:this.localSettings.minMaxFont.family,fontLabelSize:this.localSettings.labelFont.size,fontLabelStyle:this.localSettings.labelFont.style,fontLabelWeight:this.localSettings.labelFont.weight,colorLabel:this.localSettings.labelFont.color,fontLabel:this.localSettings.labelFont.family,minValue:this.localSettings.minValue,maxValue:this.localSettings.maxValue,gaugeType:this.localSettings.gaugeType,dashThickness:this.localSettings.dashThickness,roundedLineCap:this.localSettings.roundedLineCap,symbol:this.localSettings.units,unitTitle:this.localSettings.unitTitle,showUnitTitle:this.localSettings.showUnitTitle,showTimestamp:this.localSettings.showTimestamp,hideValue:this.localSettings.hideValue,hideMinMax:this.localSettings.hideMinMax,donutStartAngle:this.localSettings.donutStartAngle,valueDec:this.localSettings.decimals,neonGlowBrightness:this.localSettings.neonGlowBrightness,animation:t.animation!==!1&&!i.isMobile,animationDuration:n(t.animationDuration)?t.animationDuration:500,animationRule:t.animationRule||"linear",isMobile:i.isMobile};this.gauge=new g(T).draw(),this.init()}static toRadians(i){return i*(Math.PI/180)}init(){let i=!1;this.localSettings.showTicks&&this.localSettings.ticksValue?.length&&(this.localSettings.ticks=this.localSettings.ticksValue.map(e=>e.type===S.constant&&isFinite(e.value)?e.value:null),d(this.ctx,this.localSettings.ticksValue,this.updateAttribute.bind(this)).subscribe(e=>{this.ticksSourcesSubscription=e}),i=!0),i&&this.updateSetting(),this.barColorProcessor.colorUpdated?.subscribe(()=>{this.gauge.update({})})}updateAttribute(i){for(let e of i.data)if(e&&e.data&&e.data[0]){let l=e.data[0][1];if(isFinite(l))for(let t of e.dataKey.settings.indexes)this.localSettings.ticks[t]=l}this.updateSetting()}updateSetting(){this.gauge.options.ticks=this.localSettings.ticks,this.gauge.options=g.configure(this.gauge.options),this.gauge.update({})}update(){if(this.ctx.data.length>0){let i=this.ctx.data[0];if(i.data.length>0){let e=i.data[i.data.length-1],l;if(this.localSettings.showTimestamp){l=e[0];let s=this.ctx.$injector.get(r);this.gauge.options.labelTimestamp=s.transform(l,this.localSettings.timestampFormat)}let t=parseFloat(e[1]);t!==this.gauge.value?(this.gauge.options.animation?delete this.gauge._value:this.gauge._value=t,this.gauge.value=t):this.localSettings.showTimestamp&&this.gauge.timestamp!==l&&(this.gauge.timestamp=l)}}}mobileModeChanged(){let i=this.ctx.settings.animation!==!1&&!this.ctx.isMobile;this.gauge.update({animation:i,isMobile:this.ctx.isMobile})}resize(){this.gauge.update({width:this.ctx.width,height:this.ctx.height})}destroy(){this.gauge.destroy(),this.barColorProcessor.destroy(),this.ticksSourcesSubscription&&this.ctx.subscriptionApi.removeSubscription(this.ticksSourcesSubscription.id),this.gauge=null}};export{f as TbCanvasDigitalGauge};
